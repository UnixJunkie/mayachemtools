<html>
<head>
<title>MayaChemTools:Code:RDKitFilterTorsionStrainEnergyAlerts.py</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsPythonCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
    1 <span class="ch">#!/bin/env python</span>
    2 <span class="c1">#</span>
    3 <span class="c1"># File: RDKitFilterTorsionStrainEnergyAlerts.py</span>
    4 <span class="c1"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
    5 <span class="c1">#</span>
    6 <span class="c1"># Collaborator: Pat Walters</span>
    7 <span class="c1">#</span>
    8 <span class="c1"># Copyright (C) 2022 Manish Sud. All rights reserved.</span>
    9 <span class="c1">#</span>
   10 <span class="c1"># This script uses the torsion strain energy library developed by Gu, S.;</span>
   11 <span class="c1"># Smith, M. S.; Yang, Y.; Irwin, J. J.; Shoichet, B. K. [ Ref 153 ].</span>
   12 <span class="c1">#</span>
   13 <span class="c1"># The torsion strain enegy library is based on the Torsion Library jointly</span>
   14 <span class="c1"># developed by the University of Hamburg, Center for Bioinformatics,</span>
   15 <span class="c1"># Hamburg, Germany and F. Hoffmann-La-Roche Ltd., Basel, Switzerland.</span>
   16 <span class="c1">#</span>
   17 <span class="c1"># The functionality available in this script is implemented using RDKit, an</span>
   18 <span class="c1"># open source toolkit for cheminformatics developed by Greg Landrum.</span>
   19 <span class="c1">#</span>
   20 <span class="c1"># This file is part of MayaChemTools.</span>
   21 <span class="c1">#</span>
   22 <span class="c1"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
   23 <span class="c1"># the terms of the GNU Lesser General Public License as published by the Free</span>
   24 <span class="c1"># Software Foundation; either version 3 of the License, or (at your option) any</span>
   25 <span class="c1"># later version.</span>
   26 <span class="c1">#</span>
   27 <span class="c1"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
   28 <span class="c1"># any warranty; without even the implied warranty of merchantability of fitness</span>
   29 <span class="c1"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
   30 <span class="c1"># details.</span>
   31 <span class="c1">#</span>
   32 <span class="c1"># You should have received a copy of the GNU Lesser General Public License</span>
   33 <span class="c1"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
   34 <span class="c1"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
   35 <span class="c1"># Boston, MA, 02111-1307, USA.</span>
   36 <span class="c1">#</span>
   37 
   38 <span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
   39 
   40 <span class="c1"># Add local python path to the global path and import standard library modules...</span>
   41 <span class="kn">import</span> <span class="nn">os</span>
   42 <span class="kn">import</span> <span class="nn">sys</span><span class="p">;</span>  <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;lib&quot;</span><span class="p">,</span> <span class="s2">&quot;Python&quot;</span><span class="p">))</span>
   43 <span class="kn">import</span> <span class="nn">time</span>
   44 <span class="kn">import</span> <span class="nn">re</span>
   45 <span class="kn">import</span> <span class="nn">glob</span>
   46 <span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="kn">as</span> <span class="nn">mp</span>
   47 <span class="kn">import</span> <span class="nn">math</span>
   48 
   49 <span class="c1"># RDKit imports...</span>
   50 <span class="k">try</span><span class="p">:</span>
   51     <span class="kn">from</span> <span class="nn">rdkit</span> <span class="kn">import</span> <span class="n">rdBase</span>
   52     <span class="kn">from</span> <span class="nn">rdkit</span> <span class="kn">import</span> <span class="n">Chem</span>
   53     <span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="kn">import</span> <span class="n">rdMolTransforms</span>
   54 <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">ErrMsg</span><span class="p">:</span>
   55     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Failed to import RDKit module/package: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ErrMsg</span><span class="p">)</span>
   56     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Check/update your RDKit environment and try again.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
   57     <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   58 
   59 <span class="c1"># MayaChemTools imports...</span>
   60 <span class="k">try</span><span class="p">:</span>
   61     <span class="kn">from</span> <span class="nn">docopt</span> <span class="kn">import</span> <span class="n">docopt</span>
   62     <span class="kn">import</span> <span class="nn">MiscUtil</span>
   63     <span class="kn">import</span> <span class="nn">RDKitUtil</span>
   64     <span class="kn">import</span> <span class="nn">TorsionLibraryUtil</span>
   65 <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">ErrMsg</span><span class="p">:</span>
   66     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Failed to import MayaChemTools module/package: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ErrMsg</span><span class="p">)</span>
   67     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Check/update your MayaChemTools environment and try again.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
   68     <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   69 
   70 <span class="n">ScriptName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   71 <span class="n">Options</span> <span class="o">=</span> <span class="p">{}</span>
   72 <span class="n">OptionsInfo</span> <span class="o">=</span> <span class="p">{}</span>
   73 
   74 <span class="n">TorsionLibraryInfo</span> <span class="o">=</span> <span class="p">{}</span>
   75 
   76 <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
   77     <span class="sd">&quot;&quot;&quot;Start execution of the script.&quot;&quot;&quot;</span>
   78     
   79     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="s2"> (RDKit v</span><span class="si">%s</span><span class="s2">; MayaChemTools v</span><span class="si">%s</span><span class="s2">; </span><span class="si">%s</span><span class="s2">): Starting...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ScriptName</span><span class="p">,</span> <span class="n">rdBase</span><span class="o">.</span><span class="n">rdkitVersion</span><span class="p">,</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">GetMayaChemToolsVersion</span><span class="p">(),</span> <span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">()))</span>
   80     
   81     <span class="p">(</span><span class="n">WallClockTime</span><span class="p">,</span> <span class="n">ProcessorTime</span><span class="p">)</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">GetWallClockAndProcessorTime</span><span class="p">()</span>
   82     
   83     <span class="c1"># Retrieve command line arguments and options...</span>
   84     <span class="n">RetrieveOptions</span><span class="p">()</span>
   85     
   86     <span class="k">if</span>  <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--list&quot;</span><span class="p">]:</span>
   87         <span class="c1"># Handle listing of torsion library information...</span>
   88         <span class="n">ProcessListTorsionLibraryOption</span><span class="p">()</span>
   89     <span class="k">else</span><span class="p">:</span>
   90         <span class="c1"># Process and validate command line arguments and options...</span>
   91         <span class="n">ProcessOptions</span><span class="p">()</span>
   92         
   93         <span class="c1"># Perform actions required by the script...</span>
   94         <span class="n">PerformFiltering</span><span class="p">()</span>
   95     
   96     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="s2">: Done...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ScriptName</span><span class="p">)</span>
   97     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Total time: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">GetFormattedElapsedTime</span><span class="p">(</span><span class="n">WallClockTime</span><span class="p">,</span> <span class="n">ProcessorTime</span><span class="p">))</span>
   98 
   99 <span class="k">def</span> <span class="nf">PerformFiltering</span><span class="p">():</span>
  100     <span class="sd">&quot;&quot;&quot;Filter molecules using SMARTS torsion rules in the torsion strain energy</span>
  101 <span class="sd">    library file.&quot;&quot;&quot;</span>
  102 
  103     <span class="c1"># Process torsion library info...</span>
  104     <span class="n">ProcessTorsionLibraryInfo</span><span class="p">()</span>
  105     
  106     <span class="c1"># Set up a pattern molecule for rotatable bonds...</span>
  107     <span class="n">RotBondsPatternMol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RotBondsSMARTSPattern&quot;</span><span class="p">])</span>
  108     
  109     <span class="c1"># Setup a molecule reader...</span>
  110     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Processing file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Infile&quot;</span><span class="p">])</span>
  111     <span class="n">Mols</span>  <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">ReadMolecules</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Infile&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfileParams&quot;</span><span class="p">])</span>
  112     
  113     <span class="n">MolCount</span><span class="p">,</span> <span class="n">ValidMolCount</span><span class="p">,</span> <span class="n">RemainingMolCount</span><span class="p">,</span> <span class="n">WriteFailedCount</span> <span class="o">=</span> <span class="n">ProcessMolecules</span><span class="p">(</span><span class="n">Mols</span><span class="p">,</span> <span class="n">RotBondsPatternMol</span><span class="p">)</span>
  114 
  115     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total number of molecules: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MolCount</span><span class="p">)</span>
  116     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Number of valid molecules: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ValidMolCount</span><span class="p">)</span>
  117     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Number of molecules failed during writing: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">WriteFailedCount</span><span class="p">)</span>
  118     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Number of ignored molecules: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MolCount</span> <span class="o">-</span> <span class="n">ValidMolCount</span> <span class="o">+</span> <span class="n">WriteFailedCount</span><span class="p">))</span>
  119 
  120     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Number of remaining molecules: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">RemainingMolCount</span><span class="p">)</span>
  121     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Number of filtered molecules: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ValidMolCount</span> <span class="o">-</span> <span class="n">RemainingMolCount</span><span class="p">))</span>
  122 
  123 <span class="k">def</span> <span class="nf">ProcessMolecules</span><span class="p">(</span><span class="n">Mols</span><span class="p">,</span> <span class="n">RotBondsPatternMol</span><span class="p">):</span>
  124     <span class="sd">&quot;&quot;&quot;Process and filter molecules.&quot;&quot;&quot;</span>
  125     
  126     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MPMode&quot;</span><span class="p">]:</span>
  127         <span class="k">return</span> <span class="n">ProcessMoleculesUsingMultipleProcesses</span><span class="p">(</span><span class="n">Mols</span><span class="p">,</span> <span class="n">RotBondsPatternMol</span><span class="p">)</span>
  128     <span class="k">else</span><span class="p">:</span>
  129         <span class="k">return</span> <span class="n">ProcessMoleculesUsingSingleProcess</span><span class="p">(</span><span class="n">Mols</span><span class="p">,</span> <span class="n">RotBondsPatternMol</span><span class="p">)</span>
  130 
  131 <span class="k">def</span> <span class="nf">ProcessMoleculesUsingSingleProcess</span><span class="p">(</span><span class="n">Mols</span><span class="p">,</span> <span class="n">RotBondsPatternMol</span><span class="p">):</span>
  132     <span class="sd">&quot;&quot;&quot;Process and filter molecules using a single process.&quot;&quot;&quot;</span>
  133     
  134     <span class="n">SetupTorsionLibraryInfo</span><span class="p">()</span>
  135     
  136     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Filtering molecules...&quot;</span><span class="p">)</span>
  137     
  138     <span class="n">OutfileFilteredMode</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileFilteredMode&quot;</span><span class="p">]</span>
  139 
  140     <span class="c1"># Set up writers...</span>
  141     <span class="n">OutfilesWriters</span> <span class="o">=</span> <span class="n">SetupOutfilesWriters</span><span class="p">()</span>
  142     
  143     <span class="n">WriterRemaining</span> <span class="o">=</span> <span class="n">OutfilesWriters</span><span class="p">[</span><span class="s2">&quot;WriterRemaining&quot;</span><span class="p">]</span>
  144     <span class="n">WriterFiltered</span> <span class="o">=</span> <span class="n">OutfilesWriters</span><span class="p">[</span><span class="s2">&quot;WriterFiltered&quot;</span><span class="p">]</span>
  145     <span class="n">WriterAlertSummary</span> <span class="o">=</span> <span class="n">OutfilesWriters</span><span class="p">[</span><span class="s2">&quot;WriterAlertSummary&quot;</span><span class="p">]</span>
  146     
  147     <span class="c1"># Initialize alerts summary info...</span>
  148     <span class="n">TorsionAlertsSummaryInfo</span> <span class="o">=</span> <span class="n">InitializeTorsionAlertsSummaryInfo</span><span class="p">()</span>
  149 
  150     <span class="p">(</span><span class="n">MolCount</span><span class="p">,</span> <span class="n">ValidMolCount</span><span class="p">,</span> <span class="n">RemainingMolCount</span><span class="p">,</span> <span class="n">WriteFailedCount</span><span class="p">,</span> <span class="n">FilteredMolWriteCount</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span>
  151     <span class="k">for</span> <span class="n">Mol</span> <span class="ow">in</span> <span class="n">Mols</span><span class="p">:</span>
  152         <span class="n">MolCount</span> <span class="o">+=</span> <span class="mi">1</span>
  153         
  154         <span class="k">if</span> <span class="n">Mol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  155             <span class="k">continue</span>
  156         
  157         <span class="k">if</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">IsMolEmpty</span><span class="p">(</span><span class="n">Mol</span><span class="p">):</span>
  158             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Ignoring empty molecule: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">GetMolName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolCount</span><span class="p">))</span>
  159             <span class="k">continue</span>
  160 
  161         <span class="c1"># Check for 3D flag...</span>
  162         <span class="k">if</span> <span class="ow">not</span> <span class="n">Mol</span><span class="o">.</span><span class="n">GetConformer</span><span class="p">()</span><span class="o">.</span><span class="n">Is3D</span><span class="p">():</span>
  163             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;3D tag is not set. Ignoring molecule: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">GetMolName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolCount</span><span class="p">))</span>
  164             <span class="k">continue</span>
  165         
  166         <span class="n">ValidMolCount</span> <span class="o">+=</span> <span class="mi">1</span>
  167         
  168         <span class="c1"># Identify torsion library alerts for rotatable bonds..</span>
  169         <span class="n">RotBondsAlertsStatus</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span> <span class="o">=</span> <span class="n">IdentifyTorsionLibraryAlertsForRotatableBonds</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondsPatternMol</span><span class="p">)</span>
  170 
  171         <span class="n">TrackTorsionAlertsSummaryInfo</span><span class="p">(</span><span class="n">TorsionAlertsSummaryInfo</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span><span class="p">)</span>
  172         
  173         <span class="c1"># Write out filtered and remaining molecules...</span>
  174         <span class="n">WriteStatus</span> <span class="o">=</span> <span class="bp">True</span>
  175         <span class="k">if</span> <span class="n">RotBondsAlertsStatus</span><span class="p">:</span>
  176             <span class="k">if</span> <span class="n">OutfileFilteredMode</span><span class="p">:</span>
  177                 <span class="n">WriteStatus</span> <span class="o">=</span> <span class="n">WriteMolecule</span><span class="p">(</span><span class="n">WriterFiltered</span><span class="p">,</span> <span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span><span class="p">)</span>
  178                 <span class="k">if</span> <span class="n">WriteStatus</span><span class="p">:</span>
  179                     <span class="n">FilteredMolWriteCount</span> <span class="o">+=</span> <span class="mi">1</span>
  180         <span class="k">else</span><span class="p">:</span>
  181             <span class="n">RemainingMolCount</span> <span class="o">+=</span> <span class="mi">1</span>
  182             <span class="n">WriteStatus</span> <span class="o">=</span> <span class="n">WriteMolecule</span><span class="p">(</span><span class="n">WriterRemaining</span><span class="p">,</span> <span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span><span class="p">)</span>
  183         
  184         <span class="k">if</span> <span class="ow">not</span> <span class="n">WriteStatus</span><span class="p">:</span>
  185             <span class="n">WriteFailedCount</span> <span class="o">+=</span> <span class="mi">1</span>
  186 
  187     <span class="n">WriteTorsionAlertsSummaryInfo</span><span class="p">(</span><span class="n">WriterAlertSummary</span><span class="p">,</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">)</span>
  188     <span class="n">CloseOutfilesWriters</span><span class="p">(</span><span class="n">OutfilesWriters</span><span class="p">)</span>
  189 
  190     <span class="k">if</span> <span class="n">FilteredMolWriteCount</span><span class="p">:</span>
  191         <span class="n">WriteTorsionAlertsFilteredByRulesInfo</span><span class="p">(</span><span class="n">TorsionAlertsSummaryInfo</span><span class="p">)</span>
  192     
  193     <span class="k">return</span> <span class="p">(</span><span class="n">MolCount</span><span class="p">,</span> <span class="n">ValidMolCount</span><span class="p">,</span> <span class="n">RemainingMolCount</span><span class="p">,</span> <span class="n">WriteFailedCount</span><span class="p">)</span>
  194 
  195 <span class="k">def</span> <span class="nf">ProcessMoleculesUsingMultipleProcesses</span><span class="p">(</span><span class="n">Mols</span><span class="p">,</span> <span class="n">RotBondsPatternMol</span><span class="p">):</span>
  196     <span class="sd">&quot;&quot;&quot;Process and filter molecules using multiprocessing.&quot;&quot;&quot;</span>
  197 
  198     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Filtering molecules using multiprocessing...&quot;</span><span class="p">)</span>
  199     
  200     <span class="n">MPParams</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MPParams&quot;</span><span class="p">]</span>
  201     <span class="n">OutfileFilteredMode</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileFilteredMode&quot;</span><span class="p">]</span>
  202 
  203     <span class="c1"># Set up writers...</span>
  204     <span class="n">OutfilesWriters</span> <span class="o">=</span> <span class="n">SetupOutfilesWriters</span><span class="p">()</span>
  205     
  206     <span class="n">WriterRemaining</span> <span class="o">=</span> <span class="n">OutfilesWriters</span><span class="p">[</span><span class="s2">&quot;WriterRemaining&quot;</span><span class="p">]</span>
  207     <span class="n">WriterFiltered</span> <span class="o">=</span> <span class="n">OutfilesWriters</span><span class="p">[</span><span class="s2">&quot;WriterFiltered&quot;</span><span class="p">]</span>
  208     <span class="n">WriterAlertSummary</span> <span class="o">=</span> <span class="n">OutfilesWriters</span><span class="p">[</span><span class="s2">&quot;WriterAlertSummary&quot;</span><span class="p">]</span>
  209     
  210     <span class="c1"># Initialize alerts summary info...</span>
  211     <span class="n">TorsionAlertsSummaryInfo</span> <span class="o">=</span> <span class="n">InitializeTorsionAlertsSummaryInfo</span><span class="p">()</span>
  212 
  213     <span class="c1"># Setup data for initializing a worker process...</span>
  214     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Encoding options info and rotatable bond pattern molecule...&quot;</span><span class="p">)</span>
  215     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;EncodedRotBondsPatternMol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">MolToBase64EncodedMolString</span><span class="p">(</span><span class="n">RotBondsPatternMol</span><span class="p">)</span>
  216     <span class="n">InitializeWorkerProcessArgs</span> <span class="o">=</span> <span class="p">(</span><span class="n">MiscUtil</span><span class="o">.</span><span class="n">ObjectToBase64EncodedString</span><span class="p">(</span><span class="n">Options</span><span class="p">),</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ObjectToBase64EncodedString</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">))</span>
  217 
  218     <span class="c1"># Setup a encoded mols data iterable for a worker process...</span>
  219     <span class="n">WorkerProcessDataIterable</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">GenerateBase64EncodedMolStrings</span><span class="p">(</span><span class="n">Mols</span><span class="p">)</span>
  220     
  221     <span class="c1"># Setup process pool along with data initialization for each process...</span>
  222     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Configuring multiprocessing using </span><span class="si">%s</span><span class="s2"> method...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;mp.Pool.imap()&quot;</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Lazy$&quot;</span><span class="p">,</span> <span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;InputDataMode&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;mp.Pool.map()&quot;</span><span class="p">))</span>
  223     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;NumProcesses: </span><span class="si">%s</span><span class="s2">; InputDataMode: </span><span class="si">%s</span><span class="s2">; ChunkSize: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;NumProcesses&quot;</span><span class="p">],</span> <span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;InputDataMode&quot;</span><span class="p">],</span> <span class="p">(</span><span class="s2">&quot;automatic&quot;</span> <span class="k">if</span> <span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;ChunkSize&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;ChunkSize&quot;</span><span class="p">])))</span>
  224     
  225     <span class="n">ProcessPool</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;NumProcesses&quot;</span><span class="p">],</span> <span class="n">InitializeWorkerProcess</span><span class="p">,</span> <span class="n">InitializeWorkerProcessArgs</span><span class="p">)</span>
  226     
  227     <span class="c1"># Start processing...</span>
  228     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Lazy$&quot;</span><span class="p">,</span> <span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;InputDataMode&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  229         <span class="n">Results</span> <span class="o">=</span> <span class="n">ProcessPool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">WorkerProcess</span><span class="p">,</span> <span class="n">WorkerProcessDataIterable</span><span class="p">,</span> <span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;ChunkSize&quot;</span><span class="p">])</span>
  230     <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^InMemory$&quot;</span><span class="p">,</span> <span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;InputDataMode&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  231         <span class="n">Results</span> <span class="o">=</span> <span class="n">ProcessPool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">WorkerProcess</span><span class="p">,</span> <span class="n">WorkerProcessDataIterable</span><span class="p">,</span> <span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;ChunkSize&quot;</span><span class="p">])</span>
  232     <span class="k">else</span><span class="p">:</span>
  233         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The value, </span><span class="si">%s</span><span class="s2">, specified for </span><span class="se">\&quot;</span><span class="s2">--inputDataMode</span><span class="se">\&quot;</span><span class="s2"> is not supported.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;InputDataMode&quot;</span><span class="p">]))</span>
  234     
  235     <span class="p">(</span><span class="n">MolCount</span><span class="p">,</span> <span class="n">ValidMolCount</span><span class="p">,</span> <span class="n">RemainingMolCount</span><span class="p">,</span> <span class="n">WriteFailedCount</span><span class="p">,</span> <span class="n">FilteredMolWriteCount</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span>
  236     <span class="k">for</span> <span class="n">Result</span> <span class="ow">in</span> <span class="n">Results</span><span class="p">:</span>
  237         <span class="n">MolCount</span> <span class="o">+=</span> <span class="mi">1</span>
  238         <span class="n">MolIndex</span><span class="p">,</span> <span class="n">EncodedMol</span><span class="p">,</span> <span class="n">RotBondsAlertsStatus</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span> <span class="o">=</span> <span class="n">Result</span>
  239         
  240         <span class="k">if</span> <span class="n">EncodedMol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  241             <span class="k">continue</span>
  242         <span class="n">ValidMolCount</span> <span class="o">+=</span> <span class="mi">1</span>
  243         
  244         <span class="n">Mol</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">MolFromBase64EncodedMolString</span><span class="p">(</span><span class="n">EncodedMol</span><span class="p">)</span>
  245         
  246         <span class="n">TrackTorsionAlertsSummaryInfo</span><span class="p">(</span><span class="n">TorsionAlertsSummaryInfo</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span><span class="p">)</span>
  247         
  248         <span class="c1"># Write out filtered and remaining molecules...</span>
  249         <span class="n">WriteStatus</span> <span class="o">=</span> <span class="bp">True</span>
  250         <span class="k">if</span> <span class="n">RotBondsAlertsStatus</span><span class="p">:</span>
  251             <span class="k">if</span> <span class="n">OutfileFilteredMode</span><span class="p">:</span>
  252                 <span class="n">WriteStatus</span> <span class="o">=</span> <span class="n">WriteMolecule</span><span class="p">(</span><span class="n">WriterFiltered</span><span class="p">,</span> <span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span><span class="p">)</span>
  253                 <span class="k">if</span> <span class="n">WriteStatus</span><span class="p">:</span>
  254                     <span class="n">FilteredMolWriteCount</span> <span class="o">+=</span> <span class="mi">1</span>
  255         <span class="k">else</span><span class="p">:</span>
  256             <span class="n">RemainingMolCount</span> <span class="o">+=</span> <span class="mi">1</span>
  257             <span class="n">WriteStatus</span> <span class="o">=</span> <span class="n">WriteMolecule</span><span class="p">(</span><span class="n">WriterRemaining</span><span class="p">,</span> <span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span><span class="p">)</span>
  258 
  259         <span class="k">if</span> <span class="ow">not</span> <span class="n">WriteStatus</span><span class="p">:</span>
  260             <span class="n">WriteFailedCount</span> <span class="o">+=</span> <span class="mi">1</span>
  261     
  262     <span class="n">WriteTorsionAlertsSummaryInfo</span><span class="p">(</span><span class="n">WriterAlertSummary</span><span class="p">,</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">)</span>
  263     <span class="n">CloseOutfilesWriters</span><span class="p">(</span><span class="n">OutfilesWriters</span><span class="p">)</span>
  264 
  265     <span class="k">if</span> <span class="n">FilteredMolWriteCount</span><span class="p">:</span>
  266         <span class="n">WriteTorsionAlertsFilteredByRulesInfo</span><span class="p">(</span><span class="n">TorsionAlertsSummaryInfo</span><span class="p">)</span>
  267     
  268     <span class="k">return</span> <span class="p">(</span><span class="n">MolCount</span><span class="p">,</span> <span class="n">ValidMolCount</span><span class="p">,</span> <span class="n">RemainingMolCount</span><span class="p">,</span> <span class="n">WriteFailedCount</span><span class="p">)</span>
  269 
  270 <span class="k">def</span> <span class="nf">InitializeWorkerProcess</span><span class="p">(</span><span class="o">*</span><span class="n">EncodedArgs</span><span class="p">):</span>
  271     <span class="sd">&quot;&quot;&quot;Initialize data for a worker process.&quot;&quot;&quot;</span>
  272     
  273     <span class="k">global</span> <span class="n">Options</span><span class="p">,</span> <span class="n">OptionsInfo</span>
  274     
  275     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Starting process (PID: </span><span class="si">%s</span><span class="s2">)...&quot;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
  276     
  277     <span class="c1"># Decode Options and OptionInfo...</span>
  278     <span class="n">Options</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ObjectFromBase64EncodedString</span><span class="p">(</span><span class="n">EncodedArgs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  279     <span class="n">OptionsInfo</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ObjectFromBase64EncodedString</span><span class="p">(</span><span class="n">EncodedArgs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
  280 
  281     <span class="c1"># Decode RotBondsPatternMol...</span>
  282     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RotBondsPatternMol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">MolFromBase64EncodedMolString</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;EncodedRotBondsPatternMol&quot;</span><span class="p">])</span>
  283     
  284     <span class="c1"># Setup torsion library...</span>
  285     <span class="n">RetrieveTorsionLibraryInfo</span><span class="p">(</span><span class="n">Quiet</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
  286     <span class="n">SetupTorsionLibraryInfo</span><span class="p">(</span><span class="n">Quiet</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
  287 
  288 <span class="k">def</span> <span class="nf">WorkerProcess</span><span class="p">(</span><span class="n">EncodedMolInfo</span><span class="p">):</span>
  289     <span class="sd">&quot;&quot;&quot;Process data for a worker process.&quot;&quot;&quot;</span>
  290 
  291     <span class="n">MolIndex</span><span class="p">,</span> <span class="n">EncodedMol</span> <span class="o">=</span> <span class="n">EncodedMolInfo</span>
  292     
  293     <span class="k">if</span> <span class="n">EncodedMol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  294         <span class="k">return</span> <span class="p">[</span><span class="n">MolIndex</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
  295     
  296     <span class="n">Mol</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">MolFromBase64EncodedMolString</span><span class="p">(</span><span class="n">EncodedMol</span><span class="p">)</span>
  297     <span class="k">if</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">IsMolEmpty</span><span class="p">(</span><span class="n">Mol</span><span class="p">):</span>
  298         <span class="n">MolName</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">GetMolName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="p">(</span><span class="n">MolIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
  299         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Ignoring empty molecule: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MolName</span><span class="p">)</span>
  300         <span class="k">return</span> <span class="p">[</span><span class="n">MolIndex</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
  301         
  302     <span class="c1"># Check for 3D flag...</span>
  303     <span class="k">if</span> <span class="ow">not</span> <span class="n">Mol</span><span class="o">.</span><span class="n">GetConformer</span><span class="p">()</span><span class="o">.</span><span class="n">Is3D</span><span class="p">():</span>
  304         <span class="n">MolName</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">GetMolName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="p">(</span><span class="n">MolIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
  305         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;3D tag is not set. Ignoring molecule: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MolName</span><span class="p">)</span>
  306         <span class="k">return</span> <span class="p">[</span><span class="n">MolIndex</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
  307     
  308     <span class="c1"># Identify torsion library alerts for rotatable bonds..</span>
  309     <span class="n">RotBondsAlertsStatus</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span> <span class="o">=</span> <span class="n">IdentifyTorsionLibraryAlertsForRotatableBonds</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RotBondsPatternMol&quot;</span><span class="p">])</span>
  310 
  311     <span class="k">return</span> <span class="p">[</span><span class="n">MolIndex</span><span class="p">,</span> <span class="n">EncodedMol</span><span class="p">,</span> <span class="n">RotBondsAlertsStatus</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span><span class="p">]</span>
  312     
  313 <span class="k">def</span>  <span class="nf">IdentifyTorsionLibraryAlertsForRotatableBonds</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondsPatternMol</span><span class="p">):</span>
  314     <span class="sd">&quot;&quot;&quot;Identify rotatable bonds for torsion library alerts.&quot;&quot;&quot;</span>
  315     
  316     <span class="c1"># Identify rotatable bonds...</span>
  317     <span class="n">RotBondsStatus</span><span class="p">,</span> <span class="n">RotBondsInfo</span> <span class="o">=</span> <span class="n">TorsionLibraryUtil</span><span class="o">.</span><span class="n">IdentifyRotatableBondsForTorsionLibraryMatch</span><span class="p">(</span><span class="n">TorsionLibraryInfo</span><span class="p">,</span> <span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondsPatternMol</span><span class="p">)</span>
  318     
  319     <span class="k">if</span> <span class="ow">not</span> <span class="n">RotBondsStatus</span><span class="p">:</span>
  320         <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
  321 
  322     <span class="c1"># Identify alerts for rotatable bonds...</span>
  323     <span class="n">RotBondsAlertsStatus</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span> <span class="o">=</span> <span class="n">MatchRotatableBondsToTorsionLibrary</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondsInfo</span><span class="p">)</span>
  324     
  325     <span class="k">return</span> <span class="p">(</span><span class="n">RotBondsAlertsStatus</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span><span class="p">)</span>
  326 
  327 <span class="k">def</span> <span class="nf">MatchRotatableBondsToTorsionLibrary</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondsInfo</span><span class="p">):</span>
  328     <span class="sd">&quot;&quot;&quot;Match rotatable bond to torsion library.&quot;&quot;&quot;</span>
  329 
  330     <span class="c1"># Initialize...</span>
  331     <span class="n">RotBondsAlertsInfo</span> <span class="o">=</span> <span class="n">InitializeRotatableBondsAlertsInfo</span><span class="p">()</span>
  332     
  333     <span class="c1"># Match rotatable bonds to torsion library...</span>
  334     <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">RotBondsInfo</span><span class="p">[</span><span class="s2">&quot;IDs&quot;</span><span class="p">]:</span>
  335         <span class="n">AtomIndices</span> <span class="o">=</span> <span class="n">RotBondsInfo</span><span class="p">[</span><span class="s2">&quot;AtomIndices&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span>
  336         <span class="n">HierarchyClass</span> <span class="o">=</span> <span class="n">RotBondsInfo</span><span class="p">[</span><span class="s2">&quot;HierarchyClass&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span>
  337 
  338         <span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span> <span class="o">=</span> <span class="n">MatchRotatableBondToTorsionLibrary</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">AtomIndices</span><span class="p">,</span> <span class="n">HierarchyClass</span><span class="p">)</span>
  339         <span class="n">TrackRotatableBondsAlertsInfo</span><span class="p">(</span><span class="n">RotBondsAlertsInfo</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">AtomIndices</span><span class="p">,</span> <span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span><span class="p">)</span>
  340         
  341     <span class="n">RotBondsAlertsStatus</span> <span class="o">=</span> <span class="n">SetupRotatableBondsAlertStatusTotalStrainEnergiesInfo</span><span class="p">(</span><span class="n">RotBondsAlertsInfo</span><span class="p">)</span>
  342 
  343     <span class="k">return</span> <span class="p">(</span><span class="n">RotBondsAlertsStatus</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span><span class="p">)</span>
  344 
  345 <span class="k">def</span> <span class="nf">InitializeRotatableBondsAlertsInfo</span><span class="p">():</span>
  346     <span class="sd">&quot;&quot;&quot;Initialize alerts information for rotatable bonds.&quot;&quot;&quot;</span>
  347     
  348     <span class="n">RotBondsAlertsInfo</span> <span class="o">=</span> <span class="p">{}</span>
  349     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;IDs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  350 
  351     <span class="k">for</span> <span class="n">DataLabel</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;RotBondsAlertsStatus&quot;</span><span class="p">,</span> <span class="s2">&quot;TotalEnergy&quot;</span><span class="p">,</span> <span class="s2">&quot;TotalEnergyLowerBound&quot;</span><span class="p">,</span> <span class="s2">&quot;TotalEnergyUpperBound&quot;</span><span class="p">,</span> <span class="s2">&quot;AnglesNotObservedCount&quot;</span><span class="p">,</span> <span class="s2">&quot;MaxSingleEnergy&quot;</span><span class="p">,</span> <span class="s2">&quot;MaxSingleEnergyAlertsCount&quot;</span><span class="p">]:</span>
  352         <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="n">DataLabel</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
  353     
  354     <span class="k">for</span> <span class="n">DataLabel</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;MatchStatus&quot;</span><span class="p">,</span> <span class="s2">&quot;MaxSingleEnergyAlertStatus&quot;</span><span class="p">,</span> <span class="s2">&quot;AtomIndices&quot;</span><span class="p">,</span> <span class="s2">&quot;TorsionAtomIndices&quot;</span><span class="p">,</span> <span class="s2">&quot;TorsionAngle&quot;</span><span class="p">,</span> <span class="s2">&quot;HierarchyClassName&quot;</span><span class="p">,</span> <span class="s2">&quot;HierarchySubClassName&quot;</span><span class="p">,</span> <span class="s2">&quot;TorsionRuleNodeID&quot;</span><span class="p">,</span> <span class="s2">&quot;TorsionRuleSMARTS&quot;</span><span class="p">,</span> <span class="s2">&quot;EnergyMethod&quot;</span><span class="p">,</span> <span class="s2">&quot;AngleNotObserved&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy&quot;</span><span class="p">,</span> <span class="s2">&quot;EnergyLowerBound&quot;</span><span class="p">,</span> <span class="s2">&quot;EnergyUpperBound&quot;</span><span class="p">]:</span>
  355         <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="n">DataLabel</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  356         
  357     <span class="k">return</span> <span class="n">RotBondsAlertsInfo</span>
  358 
  359 <span class="k">def</span> <span class="nf">TrackRotatableBondsAlertsInfo</span><span class="p">(</span><span class="n">RotBondsAlertsInfo</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">AtomIndices</span><span class="p">,</span> <span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span><span class="p">):</span>
  360     <span class="sd">&quot;&quot;&quot;Track alerts information for rotatable bonds.&quot;&quot;&quot;</span>
  361     
  362     <span class="k">if</span> <span class="n">MatchInfo</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">MatchInfo</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
  363         <span class="n">TorsionAtomIndices</span><span class="p">,</span> <span class="n">TorsionAngle</span><span class="p">,</span> <span class="n">HierarchyClassName</span><span class="p">,</span> <span class="n">HierarchySubClassName</span><span class="p">,</span> <span class="n">TorsionRuleNodeID</span><span class="p">,</span> <span class="n">TorsionRuleSMARTS</span><span class="p">,</span> <span class="n">EnergyMethod</span><span class="p">,</span> <span class="n">AngleNotObserved</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">EnergyLowerBound</span><span class="p">,</span> <span class="n">EnergyUpperBound</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">11</span>
  364     <span class="k">else</span><span class="p">:</span>
  365         <span class="n">TorsionAtomIndices</span><span class="p">,</span> <span class="n">TorsionAngle</span><span class="p">,</span> <span class="n">HierarchyClassName</span><span class="p">,</span> <span class="n">HierarchySubClassName</span><span class="p">,</span> <span class="n">TorsionRuleNodeID</span><span class="p">,</span> <span class="n">TorsionRuleSMARTS</span><span class="p">,</span> <span class="n">EnergyMethod</span><span class="p">,</span> <span class="n">AngleNotObserved</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">EnergyLowerBound</span><span class="p">,</span> <span class="n">EnergyUpperBound</span> <span class="o">=</span> <span class="n">MatchInfo</span>
  366     
  367     <span class="c1"># Track torsion match information...</span>
  368     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;IDs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span>
  369     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MatchStatus&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">MatchStatus</span>
  370     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AtomIndices&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">AtomIndices</span>
  371     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionAtomIndices&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">TorsionAtomIndices</span>
  372     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionAngle&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">TorsionAngle</span>
  373     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;HierarchyClassName&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">HierarchyClassName</span>
  374     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;HierarchySubClassName&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">HierarchySubClassName</span>
  375     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionRuleNodeID&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">TorsionRuleNodeID</span>
  376     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionRuleSMARTS&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">TorsionRuleSMARTS</span>
  377     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyMethod&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">EnergyMethod</span>
  378     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AngleNotObserved&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">AngleNotObserved</span>
  379     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;Energy&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">Energy</span>
  380     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyLowerBound&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">EnergyLowerBound</span>
  381     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyUpperBound&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">EnergyUpperBound</span>
  382 
  383 <span class="k">def</span> <span class="nf">SetupRotatableBondsAlertStatusTotalStrainEnergiesInfo</span><span class="p">(</span><span class="n">RotBondsAlertsInfo</span><span class="p">):</span>
  384     <span class="sd">&quot;&quot;&quot;Setup rotatable bonds alert status along with total strain energies.&quot;&quot;&quot;</span>
  385 
  386     <span class="c1"># Initialize...</span>
  387     <span class="n">RotBondsAlertsStatus</span> <span class="o">=</span> <span class="bp">False</span>
  388     <span class="n">TotalEnergy</span><span class="p">,</span> <span class="n">TotalEnergyLowerBound</span><span class="p">,</span> <span class="n">TotalEnergyUpperBound</span><span class="p">,</span> <span class="n">AnglesNotObservedCount</span>  <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
  389     <span class="n">MaxSingleEnergy</span><span class="p">,</span> <span class="n">MaxSingleEnergyAlertsCount</span>  <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
  390 
  391     <span class="c1"># Initialize max single energy alert status...</span>
  392     <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;IDs&quot;</span><span class="p">]:</span>
  393         <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertStatus&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
  394     
  395     <span class="c1"># Check for torsion angles not obervered in the strain library...</span>
  396     <span class="n">AnglesNotObservedCount</span> <span class="o">=</span> <span class="mi">0</span>
  397     <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;IDs&quot;</span><span class="p">]:</span>
  398         <span class="n">AngleNotObserved</span> <span class="o">=</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AngleNotObserved&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span>
  399         <span class="k">if</span> <span class="n">AngleNotObserved</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">AngleNotObserved</span><span class="p">:</span>
  400             <span class="n">AnglesNotObservedCount</span> <span class="o">+=</span> <span class="mi">1</span>
  401 
  402     <span class="c1"># Setup alert status for rotable bonds...</span>
  403     <span class="k">if</span> <span class="n">AnglesNotObservedCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
  404         <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;FilterTorsionsNotObserved&quot;</span><span class="p">]:</span>
  405             <span class="n">RotBondsAlertsStatus</span> <span class="o">=</span> <span class="bp">True</span>
  406     <span class="k">else</span><span class="p">:</span>
  407         <span class="n">TotalEnergy</span> <span class="o">=</span> <span class="mf">0.0</span>
  408         <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;IDs&quot;</span><span class="p">]:</span>
  409             <span class="n">Energy</span> <span class="o">=</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;Energy&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span>
  410             <span class="n">TotalEnergy</span> <span class="o">+=</span> <span class="n">Energy</span>
  411             <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TotalEnergyMode&quot;</span><span class="p">]:</span>
  412                 <span class="k">if</span> <span class="n">TotalEnergy</span> <span class="o">&gt;</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TotalEnergyCutoff&quot;</span><span class="p">]:</span>
  413                     <span class="n">RotBondsAlertsStatus</span> <span class="o">=</span> <span class="bp">True</span>
  414                     <span class="k">break</span>
  415             <span class="k">elif</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyMode&quot;</span><span class="p">]:</span>
  416                 <span class="k">if</span> <span class="n">Energy</span> <span class="o">&gt;</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyCutoff&quot;</span><span class="p">]:</span>
  417                     <span class="n">RotBondsAlertsStatus</span> <span class="o">=</span> <span class="bp">True</span>
  418                     <span class="k">break</span>
  419             <span class="k">elif</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TotalOrMaxSingleEnergyMode&quot;</span><span class="p">]:</span>
  420                 <span class="k">if</span> <span class="n">TotalEnergy</span> <span class="o">&gt;</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TotalEnergyCutoff&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">Energy</span> <span class="o">&gt;</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyCutoff&quot;</span><span class="p">]:</span>
  421                     <span class="n">RotBondsAlertsStatus</span> <span class="o">=</span> <span class="bp">True</span>
  422                     <span class="k">break</span>
  423     
  424         <span class="c1"># Setup energy infomation...</span>
  425         <span class="n">TotalEnergy</span><span class="p">,</span> <span class="n">TotalEnergyLowerBound</span><span class="p">,</span> <span class="n">TotalEnergyUpperBound</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
  426         <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyMode&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TotalOrMaxSingleEnergyMode&quot;</span><span class="p">]:</span>
  427             <span class="n">MaxSingleEnergy</span><span class="p">,</span> <span class="n">MaxSingleEnergyAlertsCount</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
  428         
  429         <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;IDs&quot;</span><span class="p">]:</span>
  430             <span class="n">Energy</span> <span class="o">=</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;Energy&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span>
  431             
  432             <span class="c1"># Setup total energy along with the lower and upper bounds...</span>
  433             <span class="n">TotalEnergy</span> <span class="o">+=</span> <span class="n">Energy</span>
  434             <span class="n">TotalEnergyLowerBound</span> <span class="o">+=</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyLowerBound&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span>
  435             <span class="n">TotalEnergyUpperBound</span> <span class="o">+=</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyUpperBound&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span>
  436         
  437             <span class="c1"># Setup max single energy and max single energy alerts count...</span>
  438             <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyMode&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TotalOrMaxSingleEnergyMode&quot;</span><span class="p">]:</span>
  439                 <span class="n">MaxSingleEnergyAlertStatus</span> <span class="o">=</span> <span class="bp">False</span>
  440                 
  441                 <span class="k">if</span> <span class="n">Energy</span> <span class="o">&gt;</span> <span class="n">MaxSingleEnergy</span><span class="p">:</span>
  442                     <span class="n">MaxSingleEnergy</span> <span class="o">=</span> <span class="n">Energy</span>
  443                     <span class="k">if</span> <span class="n">Energy</span> <span class="o">&gt;</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyCutoff&quot;</span><span class="p">]:</span>
  444                         <span class="n">MaxSingleEnergyAlertStatus</span> <span class="o">=</span> <span class="bp">True</span>
  445                         <span class="n">MaxSingleEnergyAlertsCount</span> <span class="o">+=</span> <span class="mi">1</span>
  446                 
  447                 <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertStatus&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">MaxSingleEnergyAlertStatus</span>
  448     
  449     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;RotBondsAlertsStatus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RotBondsAlertsStatus</span>
  450     
  451     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TotalEnergy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TotalEnergy</span>
  452     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TotalEnergyLowerBound&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TotalEnergyLowerBound</span>
  453     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TotalEnergyUpperBound&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TotalEnergyUpperBound</span>
  454     
  455     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AnglesNotObservedCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AnglesNotObservedCount</span>
  456     
  457     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MaxSingleEnergy</span>
  458     <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertsCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MaxSingleEnergyAlertsCount</span>
  459 
  460     <span class="k">return</span> <span class="n">RotBondsAlertsStatus</span>
  461     
  462 <span class="k">def</span> <span class="nf">MatchRotatableBondToTorsionLibrary</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">RotBondHierarchyClass</span><span class="p">):</span>
  463     <span class="sd">&quot;&quot;&quot;Match rotatable bond to torsion library.&quot;&quot;&quot;</span>
  464 
  465     <span class="k">if</span> <span class="n">TorsionLibraryUtil</span><span class="o">.</span><span class="n">IsSpecificHierarchyClass</span><span class="p">(</span><span class="n">TorsionLibraryInfo</span><span class="p">,</span> <span class="n">RotBondHierarchyClass</span><span class="p">):</span>
  466         <span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span> <span class="o">=</span> <span class="n">MatchRotatableBondAgainstSpecificHierarchyClass</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">RotBondHierarchyClass</span><span class="p">)</span>
  467         <span class="k">if</span> <span class="ow">not</span> <span class="n">MatchStatus</span><span class="p">:</span>
  468             <span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span> <span class="o">=</span> <span class="n">MatchRotatableBondAgainstGenericHierarchyClass</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">RotBondHierarchyClass</span><span class="p">)</span>
  469     <span class="k">else</span><span class="p">:</span>
  470         <span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span> <span class="o">=</span> <span class="n">MatchRotatableBondAgainstGenericHierarchyClass</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">RotBondHierarchyClass</span><span class="p">)</span>
  471 
  472     <span class="k">return</span> <span class="p">(</span><span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span><span class="p">)</span>
  473 
  474 <span class="k">def</span> <span class="nf">MatchRotatableBondAgainstSpecificHierarchyClass</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">RotBondHierarchyClass</span><span class="p">):</span>
  475     <span class="sd">&quot;&quot;&quot;Match rotatable bond against a specific hierarchy class.&quot;&quot;&quot;</span>
  476 
  477     <span class="n">HierarchyClassElementNode</span> <span class="o">=</span> <span class="bp">None</span>
  478     <span class="k">if</span> <span class="n">RotBondHierarchyClass</span> <span class="ow">in</span> <span class="n">TorsionLibraryInfo</span><span class="p">[</span><span class="s2">&quot;SpecificClasses&quot;</span><span class="p">][</span><span class="s2">&quot;ElementNode&quot;</span><span class="p">]:</span>
  479         <span class="n">HierarchyClassElementNode</span> <span class="o">=</span> <span class="n">TorsionLibraryInfo</span><span class="p">[</span><span class="s2">&quot;SpecificClasses&quot;</span><span class="p">][</span><span class="s2">&quot;ElementNode&quot;</span><span class="p">][</span><span class="n">RotBondHierarchyClass</span><span class="p">]</span>
  480     
  481     <span class="k">if</span> <span class="n">HierarchyClassElementNode</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  482         <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
  483 
  484     <span class="n">TorsionLibraryUtil</span><span class="o">.</span><span class="n">TrackHierarchyClassElementNode</span><span class="p">(</span><span class="n">TorsionLibraryInfo</span><span class="p">,</span> <span class="n">HierarchyClassElementNode</span><span class="p">)</span>
  485     <span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span> <span class="o">=</span> <span class="n">ProcessElementForRotatableBondMatch</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">HierarchyClassElementNode</span><span class="p">)</span>
  486     <span class="n">TorsionLibraryUtil</span><span class="o">.</span><span class="n">RemoveLastHierarchyClassElementNodeFromTracking</span><span class="p">(</span><span class="n">TorsionLibraryInfo</span><span class="p">)</span>
  487     
  488     <span class="k">return</span> <span class="p">(</span><span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span><span class="p">)</span>
  489 
  490 <span class="k">def</span> <span class="nf">MatchRotatableBondAgainstGenericHierarchyClass</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">RotBondHierarchyClass</span><span class="p">):</span>
  491     <span class="sd">&quot;&quot;&quot;Match rotatable bond against a generic hierarchy class.&quot;&quot;&quot;</span>
  492     
  493     <span class="n">HierarchyClassElementNode</span> <span class="o">=</span> <span class="n">TorsionLibraryUtil</span><span class="o">.</span><span class="n">GetGenericHierarchyClassElementNode</span><span class="p">(</span><span class="n">TorsionLibraryInfo</span><span class="p">)</span>
  494     <span class="k">if</span> <span class="n">HierarchyClassElementNode</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  495         <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
  496 
  497     <span class="n">TorsionLibraryUtil</span><span class="o">.</span><span class="n">TrackHierarchyClassElementNode</span><span class="p">(</span><span class="n">TorsionLibraryInfo</span><span class="p">,</span> <span class="n">HierarchyClassElementNode</span><span class="p">)</span>
  498     
  499     <span class="c1">#  Match hierarchy subclasses before matching torsion rules...</span>
  500     <span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span> <span class="o">=</span> <span class="n">MatchRotatableBondAgainstGenericHierarchySubClasses</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">HierarchyClassElementNode</span><span class="p">)</span>
  501     
  502     <span class="k">if</span> <span class="ow">not</span> <span class="n">MatchStatus</span><span class="p">:</span>
  503         <span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span> <span class="o">=</span> <span class="n">MatchRotatableBondAgainstGenericHierarchyTorsionRules</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">HierarchyClassElementNode</span><span class="p">)</span>
  504     
  505     <span class="n">TorsionLibraryUtil</span><span class="o">.</span><span class="n">RemoveLastHierarchyClassElementNodeFromTracking</span><span class="p">(</span><span class="n">TorsionLibraryInfo</span><span class="p">)</span>
  506     
  507     <span class="k">return</span> <span class="p">(</span><span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span><span class="p">)</span>
  508 
  509 <span class="k">def</span> <span class="nf">MatchRotatableBondAgainstGenericHierarchySubClasses</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">HierarchyClassElementNode</span><span class="p">):</span>
  510     <span class="sd">&quot;&quot;&quot;Match rotatable bond againat generic hierarchy subclasses.&quot;&quot;&quot;</span>
  511 
  512     <span class="k">for</span> <span class="n">ElementChildNode</span> <span class="ow">in</span> <span class="n">HierarchyClassElementNode</span><span class="p">:</span>
  513         <span class="k">if</span> <span class="n">ElementChildNode</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="s2">&quot;hierarchySubClass&quot;</span><span class="p">:</span>
  514             <span class="k">continue</span>
  515         
  516         <span class="n">SubClassMatchStatus</span> <span class="o">=</span> <span class="n">ProcessHierarchySubClassElementForRotatableBondMatch</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">ElementChildNode</span><span class="p">)</span>
  517         
  518         <span class="k">if</span> <span class="n">SubClassMatchStatus</span><span class="p">:</span>
  519             <span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span> <span class="o">=</span> <span class="n">ProcessElementForRotatableBondMatch</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">ElementChildNode</span><span class="p">)</span>
  520             
  521             <span class="k">if</span> <span class="n">MatchStatus</span><span class="p">:</span>
  522                 <span class="k">return</span> <span class="p">(</span><span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span><span class="p">)</span>
  523         
  524     <span class="k">return</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
  525 
  526 <span class="k">def</span> <span class="nf">MatchRotatableBondAgainstGenericHierarchyTorsionRules</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">HierarchyClassElementNode</span><span class="p">):</span>
  527     <span class="sd">&quot;&quot;&quot;Match rotatable bond againat torsion rules generic hierarchy class.&quot;&quot;&quot;</span>
  528     
  529     <span class="k">for</span> <span class="n">ElementChildNode</span> <span class="ow">in</span> <span class="n">HierarchyClassElementNode</span><span class="p">:</span>
  530         <span class="k">if</span> <span class="n">ElementChildNode</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="s2">&quot;torsionRule&quot;</span><span class="p">:</span>
  531             <span class="k">continue</span>
  532         
  533         <span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span> <span class="o">=</span> <span class="n">ProcessTorsionRuleElementForRotatableBondMatch</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">ElementChildNode</span><span class="p">)</span>
  534         
  535         <span class="k">if</span> <span class="n">MatchStatus</span><span class="p">:</span>
  536             <span class="k">return</span> <span class="p">(</span><span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span><span class="p">)</span>
  537 
  538     <span class="k">return</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
  539     
  540 <span class="k">def</span> <span class="nf">ProcessElementForRotatableBondMatch</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">ElementNode</span><span class="p">):</span>
  541     <span class="sd">&quot;&quot;&quot;Process element node to recursively match rotatable bond against hierarchy</span>
  542 <span class="sd">    subclasses and torsion rules.&quot;&quot;&quot;</span>
  543     
  544     <span class="k">for</span> <span class="n">ElementChildNode</span> <span class="ow">in</span> <span class="n">ElementNode</span><span class="p">:</span>
  545         <span class="k">if</span> <span class="n">ElementChildNode</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;hierarchySubClass&quot;</span><span class="p">:</span>
  546             <span class="n">SubClassMatchStatus</span> <span class="o">=</span> <span class="n">ProcessHierarchySubClassElementForRotatableBondMatch</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">ElementChildNode</span><span class="p">)</span>
  547             
  548             <span class="k">if</span> <span class="n">SubClassMatchStatus</span><span class="p">:</span>
  549                 <span class="n">TorsionLibraryUtil</span><span class="o">.</span><span class="n">TrackHierarchySubClassElementNode</span><span class="p">(</span><span class="n">TorsionLibraryInfo</span><span class="p">,</span> <span class="n">ElementChildNode</span><span class="p">)</span>
  550                 
  551                 <span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span> <span class="o">=</span> <span class="n">ProcessElementForRotatableBondMatch</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">ElementChildNode</span><span class="p">)</span>
  552                 <span class="k">if</span> <span class="n">MatchStatus</span><span class="p">:</span>
  553                     <span class="n">TorsionLibraryUtil</span><span class="o">.</span><span class="n">RemoveLastHierarchySubClassElementNodeFromTracking</span><span class="p">(</span><span class="n">TorsionLibraryInfo</span><span class="p">)</span>
  554                     <span class="k">return</span> <span class="p">(</span><span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span><span class="p">)</span>
  555             
  556                 <span class="n">TorsionLibraryUtil</span><span class="o">.</span><span class="n">RemoveLastHierarchySubClassElementNodeFromTracking</span><span class="p">(</span><span class="n">TorsionLibraryInfo</span><span class="p">)</span>
  557             
  558         <span class="k">elif</span> <span class="n">ElementChildNode</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;torsionRule&quot;</span><span class="p">:</span>
  559             <span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span> <span class="o">=</span> <span class="n">ProcessTorsionRuleElementForRotatableBondMatch</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">ElementChildNode</span><span class="p">)</span>
  560             
  561             <span class="k">if</span> <span class="n">MatchStatus</span><span class="p">:</span>
  562                 <span class="k">return</span> <span class="p">(</span><span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span><span class="p">)</span>
  563     
  564     <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
  565 
  566 <span class="k">def</span> <span class="nf">ProcessHierarchySubClassElementForRotatableBondMatch</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">ElementNode</span><span class="p">):</span>
  567     <span class="sd">&quot;&quot;&quot;Process hierarchy subclass element to match rotatable bond.&quot;&quot;&quot;</span>
  568     
  569     <span class="c1"># Setup subclass SMARTS pattern mol...</span>
  570     <span class="n">SubClassPatternMol</span> <span class="o">=</span> <span class="n">TorsionLibraryUtil</span><span class="o">.</span><span class="n">SetupHierarchySubClassElementPatternMol</span><span class="p">(</span><span class="n">TorsionLibraryInfo</span><span class="p">,</span> <span class="n">ElementNode</span><span class="p">)</span>
  571     <span class="k">if</span> <span class="n">SubClassPatternMol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  572         <span class="k">return</span> <span class="bp">False</span>
  573 
  574     <span class="c1"># Match SMARTS pattern...</span>
  575     <span class="n">SubClassPatternMatches</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">FilterSubstructureMatchesByAtomMapNumbers</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">SubClassPatternMol</span><span class="p">,</span> <span class="n">Mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">SubClassPatternMol</span><span class="p">,</span> <span class="n">useChirality</span> <span class="o">=</span> <span class="bp">False</span><span class="p">))</span>
  576     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SubClassPatternMatches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
  577         <span class="k">return</span> <span class="bp">False</span>
  578 
  579     <span class="c1"># Match rotatable bond indices...</span>
  580     <span class="n">RotBondAtomIndex1</span><span class="p">,</span> <span class="n">RotBondAtomIndex2</span> <span class="o">=</span> <span class="n">RotBondAtomIndices</span>
  581     <span class="n">MatchStatus</span> <span class="o">=</span> <span class="bp">False</span>
  582     <span class="k">for</span> <span class="n">SubClassPatternMatch</span> <span class="ow">in</span> <span class="n">SubClassPatternMatches</span><span class="p">:</span>
  583         <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SubClassPatternMatch</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
  584             <span class="c1"># Matched to pattern containing map atom numbers &quot;:2&quot; and &quot;:3&quot;...</span>
  585             <span class="n">CentralAtomsIndex1</span><span class="p">,</span> <span class="n">CentralAtomsIndex2</span> <span class="o">=</span> <span class="n">SubClassPatternMatch</span>
  586         <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">SubClassPatternMatch</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
  587             <span class="c1"># Matched to pattern containing map atom numbers &quot;:1&quot;, &quot;:2&quot;, &quot;:3&quot; and &quot;:4&quot;...</span>
  588             <span class="n">CentralAtomsIndex1</span> <span class="o">=</span> <span class="n">SubClassPatternMatch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  589             <span class="n">CentralAtomsIndex2</span> <span class="o">=</span> <span class="n">SubClassPatternMatch</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  590         <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">SubClassPatternMatch</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
  591             <span class="n">SubClassSMARTSPattern</span> <span class="o">=</span> <span class="n">ElementNode</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;smarts&quot;</span><span class="p">)</span>
  592             <span class="k">if</span> <span class="n">TorsionLibraryUtil</span><span class="o">.</span><span class="n">DoesSMARTSContainsMappedAtoms</span><span class="p">(</span><span class="n">SubClassSMARTSPattern</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;:2&quot;</span><span class="p">,</span> <span class="s2">&quot;:3&quot;</span><span class="p">,</span> <span class="s2">&quot;:4&quot;</span><span class="p">]):</span>
  593                 <span class="c1"># Matched to pattern containing map atom numbers &quot;:2&quot;, &quot;:3&quot; and &quot;:4&quot;...</span>
  594                 <span class="n">CentralAtomsIndex1</span> <span class="o">=</span> <span class="n">SubClassPatternMatch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  595                 <span class="n">CentralAtomsIndex2</span> <span class="o">=</span> <span class="n">SubClassPatternMatch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  596             <span class="k">else</span><span class="p">:</span>
  597                 <span class="c1"># Matched to pattern containing map atom numbers &quot;:1&quot;, &quot;:2&quot; and &quot;:3&quot;...</span>
  598                 <span class="n">CentralAtomsIndex1</span> <span class="o">=</span> <span class="n">SubClassPatternMatch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  599                 <span class="n">CentralAtomsIndex2</span> <span class="o">=</span> <span class="n">SubClassPatternMatch</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  600         <span class="k">else</span><span class="p">:</span>
  601             <span class="k">continue</span>
  602 
  603         <span class="k">if</span> <span class="n">CentralAtomsIndex1</span> <span class="o">!=</span> <span class="n">CentralAtomsIndex2</span><span class="p">:</span>
  604             <span class="k">if</span> <span class="p">((</span><span class="n">CentralAtomsIndex1</span> <span class="o">==</span> <span class="n">RotBondAtomIndex1</span> <span class="ow">and</span> <span class="n">CentralAtomsIndex2</span> <span class="o">==</span> <span class="n">RotBondAtomIndex2</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">CentralAtomsIndex1</span> <span class="o">==</span> <span class="n">RotBondAtomIndex2</span> <span class="ow">and</span> <span class="n">CentralAtomsIndex2</span> <span class="o">==</span> <span class="n">RotBondAtomIndex1</span><span class="p">)):</span>
  605                 <span class="n">MatchStatus</span> <span class="o">=</span> <span class="bp">True</span>
  606                 <span class="k">break</span>
  607     
  608     <span class="k">return</span> <span class="p">(</span><span class="n">MatchStatus</span><span class="p">)</span>
  609 
  610 <span class="k">def</span> <span class="nf">ProcessTorsionRuleElementForRotatableBondMatch</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">ElementNode</span><span class="p">):</span>
  611     <span class="sd">&quot;&quot;&quot;Process torsion rule element to match rotatable bond.&quot;&quot;&quot;</span>
  612 
  613     <span class="c1">#  Retrieve torsions matched to rotatable bond...</span>
  614     <span class="n">TorsionAtomIndicesList</span><span class="p">,</span> <span class="n">TorsionAnglesList</span> <span class="o">=</span> <span class="n">MatchTorsionRuleToRotatableBond</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">ElementNode</span><span class="p">)</span>
  615     <span class="k">if</span> <span class="n">TorsionAtomIndicesList</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  616         <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
  617     
  618     <span class="c1"># Setup torsion angles and enery bin information for matched torsion rule...</span>
  619     <span class="n">TorsionRuleAnglesInfo</span> <span class="o">=</span> <span class="n">TorsionLibraryUtil</span><span class="o">.</span><span class="n">SetupTorsionRuleAnglesInfo</span><span class="p">(</span><span class="n">TorsionLibraryInfo</span><span class="p">,</span> <span class="n">ElementNode</span><span class="p">)</span>
  620     <span class="k">if</span> <span class="n">TorsionRuleAnglesInfo</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  621         <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
  622 
  623     <span class="c1"># Setup highest strain energy for matched torsions...</span>
  624     <span class="n">TorsionAtomIndices</span><span class="p">,</span> <span class="n">TorsionAngle</span><span class="p">,</span> <span class="n">EnergyMethod</span><span class="p">,</span> <span class="n">AngleNotObserved</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">EnergyLowerBound</span><span class="p">,</span> <span class="n">EnergyUpperBound</span> <span class="o">=</span> <span class="n">SelectHighestStrainEnergyTorsionForRotatableBond</span><span class="p">(</span><span class="n">TorsionRuleAnglesInfo</span><span class="p">,</span> <span class="n">TorsionAtomIndicesList</span><span class="p">,</span> <span class="n">TorsionAnglesList</span><span class="p">)</span>
  625     
  626     <span class="c1"># Setup hierarchy class and subclass names...</span>
  627     <span class="n">HierarchyClassName</span><span class="p">,</span> <span class="n">HierarchySubClassName</span> <span class="o">=</span> <span class="n">TorsionLibraryUtil</span><span class="o">.</span><span class="n">SetupHierarchyClassAndSubClassNamesForRotatableBond</span><span class="p">(</span><span class="n">TorsionLibraryInfo</span><span class="p">)</span>
  628     
  629     <span class="c1"># Setup rule node ID...</span>
  630     <span class="n">TorsionRuleNodeID</span> <span class="o">=</span> <span class="n">ElementNode</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;NodeID&quot;</span><span class="p">)</span>
  631     
  632     <span class="c1"># Setup SMARTS...</span>
  633     <span class="n">TorsionRuleSMARTS</span> <span class="o">=</span> <span class="n">ElementNode</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;smarts&quot;</span><span class="p">)</span>
  634     <span class="k">if</span> <span class="s2">&quot; &quot;</span> <span class="ow">in</span> <span class="n">TorsionRuleSMARTS</span><span class="p">:</span>
  635         <span class="n">TorsionRuleSMARTS</span> <span class="o">=</span> <span class="n">TorsionRuleSMARTS</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
  636 
  637     <span class="c1"># Setup match info...</span>
  638     <span class="n">MatchInfo</span> <span class="o">=</span> <span class="p">[</span><span class="n">TorsionAtomIndices</span><span class="p">,</span> <span class="n">TorsionAngle</span><span class="p">,</span> <span class="n">HierarchyClassName</span><span class="p">,</span> <span class="n">HierarchySubClassName</span><span class="p">,</span> <span class="n">TorsionRuleNodeID</span><span class="p">,</span> <span class="n">TorsionRuleSMARTS</span><span class="p">,</span> <span class="n">EnergyMethod</span><span class="p">,</span> <span class="n">AngleNotObserved</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">EnergyLowerBound</span><span class="p">,</span> <span class="n">EnergyUpperBound</span><span class="p">]</span>
  639     
  640     <span class="c1"># Setup match status...</span>
  641     <span class="n">MatchStatus</span> <span class="o">=</span> <span class="bp">True</span>
  642     
  643     <span class="k">return</span> <span class="p">(</span><span class="n">MatchStatus</span><span class="p">,</span> <span class="n">MatchInfo</span><span class="p">)</span>
  644 
  645 <span class="k">def</span> <span class="nf">SelectHighestStrainEnergyTorsionForRotatableBond</span><span class="p">(</span><span class="n">TorsionRuleAnglesInfo</span><span class="p">,</span> <span class="n">TorsionAtomIndicesList</span><span class="p">,</span> <span class="n">TorsionAnglesList</span><span class="p">):</span>
  646     <span class="sd">&quot;&quot;&quot;Select highest strain energy torsion matched to a rotatable bond.&quot;&quot;&quot;</span>
  647     
  648     <span class="n">TorsionAtomIndices</span><span class="p">,</span> <span class="n">TorsionAngle</span><span class="p">,</span> <span class="n">EnergyMethod</span><span class="p">,</span> <span class="n">AngleNotObserved</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">EnergyLowerBound</span><span class="p">,</span> <span class="n">EnergyUpperBound</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">7</span>
  649     <span class="n">ValidEnergyValue</span><span class="p">,</span> <span class="n">ValidCurrentEnergyValue</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
  650     
  651     <span class="n">FirstTorsion</span> <span class="o">=</span> <span class="bp">True</span>
  652     <span class="k">for</span> <span class="n">Index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">TorsionAtomIndicesList</span><span class="p">)):</span>
  653         <span class="n">CurrentTorsionAtomIndices</span> <span class="o">=</span> <span class="n">TorsionAtomIndicesList</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span>
  654         <span class="n">CurrentTorsionAngle</span> <span class="o">=</span> <span class="n">TorsionAnglesList</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span>
  655 
  656         <span class="k">if</span> <span class="n">FirstTorsion</span><span class="p">:</span>
  657             <span class="n">FirstTorsion</span> <span class="o">=</span> <span class="bp">False</span>
  658             <span class="n">EnergyMethod</span><span class="p">,</span> <span class="n">AngleNotObserved</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">EnergyLowerBound</span><span class="p">,</span> <span class="n">EnergyUpperBound</span> <span class="o">=</span> <span class="n">SetupStrainEnergyForRotatableBond</span><span class="p">(</span><span class="n">TorsionRuleAnglesInfo</span><span class="p">,</span> <span class="n">CurrentTorsionAngle</span><span class="p">)</span>
  659             <span class="n">TorsionAtomIndices</span> <span class="o">=</span> <span class="n">CurrentTorsionAtomIndices</span>
  660             <span class="n">TorsionAngle</span> <span class="o">=</span> <span class="n">CurrentTorsionAngle</span>
  661             <span class="n">ValidEnergyValue</span> <span class="o">=</span> <span class="n">IsEnergyValueValid</span><span class="p">(</span><span class="n">Energy</span><span class="p">)</span>
  662             <span class="k">continue</span>
  663 
  664         <span class="c1"># Select highest strain energy...</span>
  665         <span class="n">CurrentEnergyMethod</span><span class="p">,</span> <span class="n">CurrentAngleNotObserved</span><span class="p">,</span> <span class="n">CurrentEnergy</span><span class="p">,</span> <span class="n">CurrentEnergyLowerBound</span><span class="p">,</span> <span class="n">CurrentEnergyUpperBound</span> <span class="o">=</span> <span class="n">SetupStrainEnergyForRotatableBond</span><span class="p">(</span><span class="n">TorsionRuleAnglesInfo</span><span class="p">,</span> <span class="n">CurrentTorsionAngle</span><span class="p">)</span>
  666         <span class="n">ValidCurrentEnergyValue</span> <span class="o">=</span> <span class="n">IsEnergyValueValid</span><span class="p">(</span><span class="n">CurrentEnergy</span><span class="p">)</span>
  667         
  668         <span class="n">UpdateValues</span> <span class="o">=</span> <span class="bp">False</span>
  669         <span class="k">if</span> <span class="n">ValidEnergyValue</span> <span class="ow">and</span> <span class="n">ValidCurrentEnergyValue</span><span class="p">:</span>
  670             <span class="k">if</span> <span class="n">CurrentEnergy</span> <span class="o">&gt;</span> <span class="n">Energy</span><span class="p">:</span>
  671                 <span class="n">UpdateValues</span> <span class="o">=</span> <span class="bp">True</span>
  672         <span class="k">elif</span> <span class="n">ValidCurrentEnergyValue</span><span class="p">:</span>
  673             <span class="k">if</span> <span class="ow">not</span> <span class="n">ValidEnergyValue</span><span class="p">:</span>
  674                 <span class="n">UpdateValues</span> <span class="o">=</span> <span class="bp">True</span>
  675         
  676         <span class="k">if</span> <span class="n">UpdateValues</span><span class="p">:</span>
  677             <span class="n">EnergyMethod</span><span class="p">,</span> <span class="n">AngleNotObserved</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">EnergyLowerBound</span><span class="p">,</span> <span class="n">EnergyUpperBound</span> <span class="o">=</span> <span class="p">[</span><span class="n">CurrentEnergyMethod</span><span class="p">,</span> <span class="n">CurrentAngleNotObserved</span><span class="p">,</span> <span class="n">CurrentEnergy</span><span class="p">,</span> <span class="n">CurrentEnergyLowerBound</span><span class="p">,</span> <span class="n">CurrentEnergyUpperBound</span><span class="p">]</span>
  678             <span class="n">TorsionAtomIndices</span> <span class="o">=</span> <span class="n">CurrentTorsionAtomIndices</span>
  679             <span class="n">TorsionAngle</span> <span class="o">=</span> <span class="n">CurrentTorsionAngle</span>
  680     
  681     <span class="k">return</span> <span class="p">(</span><span class="n">TorsionAtomIndices</span><span class="p">,</span> <span class="n">TorsionAngle</span><span class="p">,</span> <span class="n">EnergyMethod</span><span class="p">,</span> <span class="n">AngleNotObserved</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">EnergyLowerBound</span><span class="p">,</span> <span class="n">EnergyUpperBound</span><span class="p">)</span>
  682 
  683 <span class="k">def</span> <span class="nf">IsEnergyValueValid</span><span class="p">(</span><span class="n">Value</span><span class="p">):</span>
  684     <span class="sd">&quot;&quot;&quot;Check for valid energy value.&quot;&quot;&quot;</span>
  685 
  686     <span class="k">return</span> <span class="bp">False</span> <span class="k">if</span> <span class="p">(</span><span class="n">Value</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Value</span><span class="p">)</span> <span class="ow">or</span> <span class="n">math</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">Value</span><span class="p">))</span> <span class="k">else</span> <span class="bp">True</span>
  687 
  688 <span class="k">def</span> <span class="nf">SetupStrainEnergyForRotatableBond</span><span class="p">(</span><span class="n">TorsionRuleAnglesInfo</span><span class="p">,</span> <span class="n">TorsionAngle</span><span class="p">):</span>
  689     <span class="sd">&quot;&quot;&quot;Setup strain energy for rotatable bond.&quot;&quot;&quot;</span>
  690 
  691     <span class="k">if</span> <span class="n">TorsionRuleAnglesInfo</span><span class="p">[</span><span class="s2">&quot;EnergyMethodExact&quot;</span><span class="p">]:</span>
  692         <span class="k">return</span> <span class="p">(</span><span class="n">SetupStrainEnergyForRotatableBondByExactMethod</span><span class="p">(</span><span class="n">TorsionRuleAnglesInfo</span><span class="p">,</span> <span class="n">TorsionAngle</span><span class="p">))</span>
  693     <span class="k">elif</span> <span class="n">TorsionRuleAnglesInfo</span><span class="p">[</span><span class="s2">&quot;EnergyMethodApproximate&quot;</span><span class="p">]:</span>
  694         <span class="k">return</span> <span class="p">(</span><span class="n">SetupStrainEnergyForRotatableBondByApproximateMethod</span><span class="p">(</span><span class="n">TorsionRuleAnglesInfo</span><span class="p">,</span> <span class="n">TorsionAngle</span><span class="p">))</span>
  695     <span class="k">else</span><span class="p">:</span>
  696         <span class="n">EnergyMethod</span><span class="p">,</span> <span class="n">AngleNotObserved</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">EnergyLowerBound</span><span class="p">,</span> <span class="n">EnergyUpperBound</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
  697         <span class="k">return</span> <span class="p">(</span><span class="n">EnergyMethod</span><span class="p">,</span> <span class="n">AngleNotObserved</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">EnergyLowerBound</span><span class="p">,</span> <span class="n">EnergyUpperBound</span><span class="p">)</span>
  698 
  699 <span class="k">def</span> <span class="nf">SetupStrainEnergyForRotatableBondByExactMethod</span><span class="p">(</span><span class="n">TorsionRuleAnglesInfo</span><span class="p">,</span> <span class="n">TorsionAngle</span><span class="p">):</span>
  700     <span class="sd">&quot;&quot;&quot;Setup strain energy for rotatable bond by exact method.&quot;&quot;&quot;</span>
  701     
  702     <span class="n">EnergyMethod</span><span class="p">,</span> <span class="n">AngleNotObserved</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">EnergyLowerBound</span><span class="p">,</span> <span class="n">EnergyUpperBound</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Exact&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
  703 
  704     <span class="c1"># Map angle to energy bin numbers...</span>
  705     <span class="n">BinNum</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">TorsionAngle</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="mi">17</span>
  706     <span class="n">PreviousBinNum</span> <span class="o">=</span> <span class="p">(</span><span class="n">BinNum</span> <span class="o">+</span> <span class="mi">35</span><span class="p">)</span> <span class="o">%</span> <span class="mi">36</span>
  707     
  708     <span class="c1"># Bin angle from -170 to 180 by the right end points...</span>
  709     <span class="n">BinAngleRightSide</span> <span class="o">=</span> <span class="p">(</span><span class="n">BinNum</span> <span class="o">-</span> <span class="mi">17</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>
  710     
  711     <span class="c1"># Angle offset towards the left of the bin from the right end point...</span>
  712     <span class="n">AngleOffset</span> <span class="o">=</span> <span class="n">TorsionAngle</span> <span class="o">-</span> <span class="n">BinAngleRightSide</span>
  713     
  714     <span class="n">BinEnergy</span> <span class="o">=</span> <span class="n">TorsionRuleAnglesInfo</span><span class="p">[</span><span class="s2">&quot;HistogramEnergy&quot;</span><span class="p">][</span><span class="n">BinNum</span><span class="p">]</span>
  715     <span class="n">PreviousBinEnergy</span> <span class="o">=</span> <span class="n">TorsionRuleAnglesInfo</span><span class="p">[</span><span class="s2">&quot;HistogramEnergy&quot;</span><span class="p">][</span><span class="n">PreviousBinNum</span><span class="p">]</span>
  716     <span class="n">Energy</span> <span class="o">=</span>  <span class="n">BinEnergy</span> <span class="o">+</span> <span class="p">(</span><span class="n">BinEnergy</span> <span class="o">-</span> <span class="n">PreviousBinEnergy</span><span class="p">)</span><span class="o">/</span><span class="mf">10.0</span> <span class="o">*</span> <span class="n">AngleOffset</span>
  717     
  718     <span class="n">BinEnergyLowerBound</span> <span class="o">=</span> <span class="n">TorsionRuleAnglesInfo</span><span class="p">[</span><span class="s2">&quot;HistogramEnergyLowerBound&quot;</span><span class="p">][</span><span class="n">BinNum</span><span class="p">]</span>
  719     <span class="n">PreviousBinEnergyLowerBound</span> <span class="o">=</span> <span class="n">TorsionRuleAnglesInfo</span><span class="p">[</span><span class="s2">&quot;HistogramEnergyLowerBound&quot;</span><span class="p">][</span><span class="n">PreviousBinNum</span><span class="p">]</span>
  720     <span class="n">EnergyLowerBound</span> <span class="o">=</span>  <span class="n">BinEnergyLowerBound</span> <span class="o">+</span> <span class="p">(</span><span class="n">BinEnergyLowerBound</span> <span class="o">-</span> <span class="n">PreviousBinEnergyLowerBound</span><span class="p">)</span><span class="o">/</span><span class="mf">10.0</span> <span class="o">*</span> <span class="n">AngleOffset</span>
  721     
  722     <span class="n">BinEnergyUpperBound</span> <span class="o">=</span> <span class="n">TorsionRuleAnglesInfo</span><span class="p">[</span><span class="s2">&quot;HistogramEnergyUpperBound&quot;</span><span class="p">][</span><span class="n">BinNum</span><span class="p">]</span>
  723     <span class="n">PreviousBinEnergyUpperBound</span> <span class="o">=</span> <span class="n">TorsionRuleAnglesInfo</span><span class="p">[</span><span class="s2">&quot;HistogramEnergyUpperBound&quot;</span><span class="p">][</span><span class="n">PreviousBinNum</span><span class="p">]</span>
  724     <span class="n">EnergyUpperBound</span> <span class="o">=</span>  <span class="n">BinEnergyUpperBound</span> <span class="o">+</span> <span class="p">(</span><span class="n">BinEnergyUpperBound</span> <span class="o">-</span> <span class="n">PreviousBinEnergyUpperBound</span><span class="p">)</span><span class="o">/</span><span class="mf">10.0</span> <span class="o">*</span> <span class="n">AngleOffset</span>
  725     
  726     <span class="k">return</span> <span class="p">(</span><span class="n">EnergyMethod</span><span class="p">,</span> <span class="n">AngleNotObserved</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">EnergyLowerBound</span><span class="p">,</span> <span class="n">EnergyUpperBound</span><span class="p">)</span>
  727 
  728 <span class="k">def</span> <span class="nf">SetupStrainEnergyForRotatableBondByApproximateMethod</span><span class="p">(</span><span class="n">TorsionRuleAnglesInfo</span><span class="p">,</span> <span class="n">TorsionAngle</span><span class="p">):</span>
  729     <span class="sd">&quot;&quot;&quot;Setup strain energy for rotatable bond by approximate method.&quot;&quot;&quot;</span>
  730 
  731     <span class="n">EnergyMethod</span><span class="p">,</span> <span class="n">AngleNotObserved</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">EnergyLowerBound</span><span class="p">,</span> <span class="n">EnergyUpperBound</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Approximate&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
  732     
  733     <span class="k">for</span> <span class="n">AngleID</span> <span class="ow">in</span> <span class="n">TorsionRuleAnglesInfo</span><span class="p">[</span><span class="s2">&quot;IDs&quot;</span><span class="p">]:</span>
  734         <span class="n">Tolerance2</span> <span class="o">=</span> <span class="n">TorsionRuleAnglesInfo</span><span class="p">[</span><span class="s2">&quot;Tolerance2&quot;</span><span class="p">][</span><span class="n">AngleID</span><span class="p">]</span>
  735         <span class="n">Theta0</span> <span class="o">=</span> <span class="n">TorsionRuleAnglesInfo</span><span class="p">[</span><span class="s2">&quot;Theta0&quot;</span><span class="p">][</span><span class="n">AngleID</span><span class="p">]</span>
  736         
  737         <span class="n">AngleDiff</span> <span class="o">=</span> <span class="n">TorsionLibraryUtil</span><span class="o">.</span><span class="n">CalculateTorsionAngleDifference</span><span class="p">(</span><span class="n">TorsionAngle</span><span class="p">,</span> <span class="n">Theta0</span><span class="p">)</span>
  738         <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">AngleDiff</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">Tolerance2</span><span class="p">:</span>
  739             <span class="n">Beta1</span> <span class="o">=</span> <span class="n">TorsionRuleAnglesInfo</span><span class="p">[</span><span class="s2">&quot;Beta1&quot;</span><span class="p">][</span><span class="n">AngleID</span><span class="p">]</span>
  740             <span class="n">Beta2</span> <span class="o">=</span> <span class="n">TorsionRuleAnglesInfo</span><span class="p">[</span><span class="s2">&quot;Beta2&quot;</span><span class="p">][</span><span class="n">AngleID</span><span class="p">]</span>
  741             
  742             <span class="n">Energy</span> <span class="o">=</span> <span class="n">Beta1</span><span class="o">*</span><span class="p">(</span><span class="n">AngleDiff</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">Beta2</span><span class="o">*</span><span class="p">(</span><span class="n">AngleDiff</span><span class="o">**</span> <span class="mi">4</span><span class="p">)</span>
  743 
  744             <span class="c1"># Estimates of lower and upper bound are not available for</span>
  745             <span class="c1"># approximate method...</span>
  746             <span class="n">EnergyLowerBound</span> <span class="o">=</span> <span class="n">Energy</span>
  747             <span class="n">EnergyUpperBound</span> <span class="o">=</span> <span class="n">Energy</span>
  748             
  749             <span class="n">AngleNotObserved</span> <span class="o">=</span> <span class="bp">False</span>
  750             
  751             <span class="k">break</span>
  752     
  753     <span class="k">return</span> <span class="p">(</span><span class="n">EnergyMethod</span><span class="p">,</span> <span class="n">AngleNotObserved</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">EnergyLowerBound</span><span class="p">,</span> <span class="n">EnergyUpperBound</span><span class="p">)</span>
  754 
  755 <span class="k">def</span> <span class="nf">MatchTorsionRuleToRotatableBond</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondAtomIndices</span><span class="p">,</span> <span class="n">ElementNode</span><span class="p">):</span>
  756     <span class="sd">&quot;&quot;&quot;Retrieve matched torsions for torsion rule matched to rotatable bond.&quot;&quot;&quot;</span>
  757 
  758     <span class="c1"># Get torsion matches...</span>
  759     <span class="n">TorsionMatches</span> <span class="o">=</span> <span class="n">GetMatchesForTorsionRule</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">ElementNode</span><span class="p">)</span>
  760     <span class="k">if</span> <span class="n">TorsionMatches</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">TorsionMatches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
  761         <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
  762 
  763     <span class="c1"># Identify all torsion matches corresponding to central atoms in RotBondAtomIndices...</span>
  764     <span class="n">RotBondAtomIndex1</span><span class="p">,</span> <span class="n">RotBondAtomIndex2</span> <span class="o">=</span> <span class="n">RotBondAtomIndices</span>
  765     <span class="n">RotBondTorsionMatches</span><span class="p">,</span> <span class="n">RotBondTorsionAngles</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
  766     
  767     <span class="k">for</span> <span class="n">TorsionMatch</span> <span class="ow">in</span> <span class="n">TorsionMatches</span><span class="p">:</span>
  768         <span class="n">CentralAtomIndex1</span> <span class="o">=</span> <span class="n">TorsionMatch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  769         <span class="n">CentralAtomIndex2</span> <span class="o">=</span> <span class="n">TorsionMatch</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  770         
  771         <span class="k">if</span> <span class="p">((</span><span class="n">CentralAtomIndex1</span> <span class="o">==</span> <span class="n">RotBondAtomIndex1</span> <span class="ow">and</span> <span class="n">CentralAtomIndex2</span> <span class="o">==</span> <span class="n">RotBondAtomIndex2</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">CentralAtomIndex1</span> <span class="o">==</span> <span class="n">RotBondAtomIndex2</span> <span class="ow">and</span> <span class="n">CentralAtomIndex2</span> <span class="o">==</span> <span class="n">RotBondAtomIndex1</span><span class="p">)):</span>
  772             <span class="n">TorsionAngle</span> <span class="o">=</span> <span class="n">CalculateTorsionAngle</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">TorsionMatch</span><span class="p">)</span>
  773             <span class="k">if</span> <span class="n">RotBondTorsionMatches</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  774                 <span class="n">RotBondTorsionMatches</span> <span class="o">=</span> <span class="p">[]</span>
  775                 <span class="n">RotBondTorsionAngles</span> <span class="o">=</span> <span class="p">[]</span>
  776             <span class="n">RotBondTorsionMatches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TorsionMatch</span><span class="p">)</span>
  777             <span class="n">RotBondTorsionAngles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TorsionAngle</span><span class="p">)</span>
  778             
  779     <span class="k">return</span> <span class="p">(</span><span class="n">RotBondTorsionMatches</span><span class="p">,</span> <span class="n">RotBondTorsionAngles</span><span class="p">)</span>
  780 
  781 <span class="k">def</span> <span class="nf">CalculateTorsionAngle</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">TorsionMatch</span><span class="p">):</span>
  782     <span class="sd">&quot;&quot;&quot;Calculate torsion angle.&quot;&quot;&quot;</span>
  783 
  784     <span class="c1"># Calculate torsion angle using torsion atom indices..</span>
  785     <span class="n">MolConf</span> <span class="o">=</span> <span class="n">Mol</span><span class="o">.</span><span class="n">GetConformer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  786     <span class="n">TorsionAngle</span> <span class="o">=</span> <span class="n">rdMolTransforms</span><span class="o">.</span><span class="n">GetDihedralDeg</span><span class="p">(</span><span class="n">MolConf</span><span class="p">,</span> <span class="n">TorsionMatch</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">TorsionMatch</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">TorsionMatch</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">TorsionMatch</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
  787     <span class="n">TorsionAngle</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">TorsionAngle</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
  788     
  789     <span class="k">return</span> <span class="n">TorsionAngle</span>
  790 
  791 <span class="k">def</span> <span class="nf">GetMatchesForTorsionRule</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">ElementNode</span><span class="p">):</span>
  792     <span class="sd">&quot;&quot;&quot;Get matches for torsion rule.&quot;&quot;&quot;</span>
  793 
  794     <span class="c1"># Match torsions...</span>
  795     <span class="n">TorsionMatches</span> <span class="o">=</span> <span class="n">GetSubstructureMatchesForTorsionRule</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">ElementNode</span><span class="p">)</span>
  796     
  797     <span class="k">if</span> <span class="n">TorsionMatches</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">TorsionMatches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
  798         <span class="k">return</span> <span class="n">TorsionMatches</span>
  799 
  800     <span class="c1"># Filter torsion matches...</span>
  801     <span class="n">FiltertedTorsionMatches</span> <span class="o">=</span> <span class="p">[]</span>
  802     <span class="k">for</span> <span class="n">TorsionMatch</span> <span class="ow">in</span> <span class="n">TorsionMatches</span><span class="p">:</span>
  803         <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">TorsionMatch</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
  804             <span class="k">continue</span>
  805 
  806         <span class="c1"># Ignore matches containing hydrogen atoms as first or last atom...</span>
  807         <span class="k">if</span> <span class="n">Mol</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="n">TorsionMatch</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">GetAtomicNum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
  808             <span class="k">continue</span>
  809         <span class="k">if</span> <span class="n">Mol</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="n">TorsionMatch</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">GetAtomicNum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
  810             <span class="k">continue</span>
  811         
  812         <span class="n">FiltertedTorsionMatches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TorsionMatch</span><span class="p">)</span>
  813     
  814     <span class="k">return</span> <span class="n">FiltertedTorsionMatches</span>
  815 
  816 <span class="k">def</span> <span class="nf">GetSubstructureMatchesForTorsionRule</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">ElementNode</span><span class="p">):</span>
  817     <span class="sd">&quot;&quot;&quot;Get substructure matches for a torsion rule.&quot;&quot;&quot;</span>
  818     
  819     <span class="c1"># Setup torsion rule SMARTS pattern mol....</span>
  820     <span class="n">TorsionRuleNodeID</span> <span class="o">=</span> <span class="n">ElementNode</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;NodeID&quot;</span><span class="p">)</span>
  821     <span class="n">TorsionSMARTSPattern</span> <span class="o">=</span> <span class="n">ElementNode</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;smarts&quot;</span><span class="p">)</span>
  822     <span class="n">TorsionPatternMol</span> <span class="o">=</span> <span class="n">TorsionLibraryUtil</span><span class="o">.</span><span class="n">SetupTorsionRuleElementPatternMol</span><span class="p">(</span><span class="n">TorsionLibraryInfo</span><span class="p">,</span> <span class="n">ElementNode</span><span class="p">,</span> <span class="n">TorsionRuleNodeID</span><span class="p">,</span> <span class="n">TorsionSMARTSPattern</span><span class="p">)</span>
  823     <span class="k">if</span> <span class="n">TorsionPatternMol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  824         <span class="k">return</span> <span class="bp">None</span>
  825     
  826     <span class="c1"># Match torsions...</span>
  827     <span class="n">TorsionMatches</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">FilterSubstructureMatchesByAtomMapNumbers</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">TorsionPatternMol</span><span class="p">,</span> <span class="n">Mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">TorsionPatternMol</span><span class="p">,</span> <span class="n">useChirality</span> <span class="o">=</span> <span class="bp">False</span><span class="p">))</span>
  828     
  829     <span class="k">return</span> <span class="n">TorsionMatches</span>
  830 
  831 <span class="k">def</span> <span class="nf">InitializeTorsionAlertsSummaryInfo</span><span class="p">():</span>
  832     <span class="sd">&quot;&quot;&quot;Initialize torsion alerts summary.&quot;&quot;&quot;</span>
  833 
  834     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;CountMode&quot;</span><span class="p">]:</span>
  835         <span class="k">return</span> <span class="bp">None</span>
  836     
  837     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TrackAlertsSummaryInfo&quot;</span><span class="p">]:</span>
  838         <span class="k">return</span> <span class="bp">None</span>
  839     
  840     <span class="n">TorsionAlertsSummaryInfo</span> <span class="o">=</span> <span class="p">{}</span>
  841     <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;RuleIDs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  842 
  843     <span class="k">for</span> <span class="n">DataLabel</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;SMARTSToRuleIDs&quot;</span><span class="p">,</span> <span class="s2">&quot;RuleSMARTS&quot;</span><span class="p">,</span> <span class="s2">&quot;HierarchyClassName&quot;</span><span class="p">,</span> <span class="s2">&quot;HierarchySubClassName&quot;</span><span class="p">,</span> <span class="s2">&quot;EnergyMethod&quot;</span><span class="p">,</span> <span class="s2">&quot;MaxSingleEnergyAlertTypes&quot;</span><span class="p">,</span> <span class="s2">&quot;MaxSingleEnergyAlertTypesMolCount&quot;</span><span class="p">]:</span>
  844         <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="n">DataLabel</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  845     
  846     <span class="k">return</span> <span class="n">TorsionAlertsSummaryInfo</span>
  847 
  848 <span class="k">def</span> <span class="nf">TrackTorsionAlertsSummaryInfo</span><span class="p">(</span><span class="n">TorsionAlertsSummaryInfo</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span><span class="p">):</span>
  849     <span class="sd">&quot;&quot;&quot;Track torsion alerts summary information for matched torsion rules in a</span>
  850 <span class="sd">    molecule.&quot;&quot;&quot;</span>
  851     
  852     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;CountMode&quot;</span><span class="p">]:</span>
  853         <span class="k">return</span>
  854     
  855     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TrackAlertsSummaryInfo&quot;</span><span class="p">]:</span>
  856         <span class="k">return</span>
  857 
  858     <span class="k">if</span> <span class="n">RotBondsAlertsInfo</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  859         <span class="k">return</span>
  860     
  861     <span class="n">MolAlertsInfo</span> <span class="o">=</span> <span class="p">{}</span>
  862     <span class="n">MolAlertsInfo</span><span class="p">[</span><span class="s2">&quot;RuleIDs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  863     <span class="n">MolAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  864 
  865     <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;IDs&quot;</span><span class="p">]:</span>
  866         <span class="k">if</span> <span class="ow">not</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MatchStatus&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]:</span>
  867             <span class="k">continue</span>
  868         
  869         <span class="k">if</span> <span class="n">SkipRotatableBondAlertInfo</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span><span class="p">):</span>
  870             <span class="k">continue</span>
  871 
  872         <span class="n">MaxSingleEnergyAlertType</span> <span class="o">=</span> <span class="n">SetupMaxSingleEnergyAlertStatusValue</span><span class="p">(</span><span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertStatus&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">])</span>
  873         
  874         <span class="n">TorsionRuleNodeID</span> <span class="o">=</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionRuleNodeID&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span>
  875         <span class="n">TorsionRuleSMARTS</span> <span class="o">=</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionRuleSMARTS&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span>
  876         
  877         <span class="c1"># Track data for torsion alert summary information across molecules...</span>
  878         <span class="k">if</span> <span class="n">TorsionRuleNodeID</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;RuleSMARTS&quot;</span><span class="p">]:</span>
  879             <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;RuleIDs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TorsionRuleNodeID</span><span class="p">)</span>
  880             <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;SMARTSToRuleIDs&quot;</span><span class="p">][</span><span class="n">TorsionRuleSMARTS</span><span class="p">]</span> <span class="o">=</span> <span class="n">TorsionRuleNodeID</span>
  881             
  882             <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;RuleSMARTS&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="n">TorsionRuleSMARTS</span>
  883             <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;HierarchyClassName&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;HierarchyClassName&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span>
  884             <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;HierarchySubClassName&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;HierarchySubClassName&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span>
  885             
  886             <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;EnergyMethod&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyMethod&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span>
  887             
  888             <span class="c1"># Initialize number of alert types across all molecules...</span>
  889             <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypes&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  890             
  891             <span class="c1"># Initialize number of molecules flagged by each alert type...</span>
  892             <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypesMolCount&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  893         
  894         <span class="k">if</span> <span class="n">MaxSingleEnergyAlertType</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypes&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]:</span>
  895             <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypes&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">][</span><span class="n">MaxSingleEnergyAlertType</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
  896             <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypesMolCount&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">][</span><span class="n">MaxSingleEnergyAlertType</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
  897         
  898         <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypes&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">][</span><span class="n">MaxSingleEnergyAlertType</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
  899         
  900         <span class="c1"># Track data for torsion alert information in a molecule...</span>
  901         <span class="k">if</span> <span class="n">TorsionRuleNodeID</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">MolAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypes&quot;</span><span class="p">]:</span>
  902             <span class="n">MolAlertsInfo</span><span class="p">[</span><span class="s2">&quot;RuleIDs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TorsionRuleNodeID</span><span class="p">)</span>
  903             <span class="n">MolAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypes&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  904         
  905         <span class="k">if</span> <span class="n">MaxSingleEnergyAlertType</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">MolAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypes&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]:</span>
  906             <span class="n">MolAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypes&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">][</span><span class="n">MaxSingleEnergyAlertType</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
  907         <span class="n">MolAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypes&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">][</span><span class="n">MaxSingleEnergyAlertType</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
  908     
  909     <span class="c1"># Track number of molecules flagged by a specific torsion alert...</span>
  910     <span class="k">for</span> <span class="n">TorsionRuleNodeID</span> <span class="ow">in</span> <span class="n">MolAlertsInfo</span><span class="p">[</span><span class="s2">&quot;RuleIDs&quot;</span><span class="p">]:</span>
  911         <span class="k">for</span> <span class="n">MaxSingleEnergyAlertType</span> <span class="ow">in</span> <span class="n">MolAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypes&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]:</span>
  912             <span class="k">if</span> <span class="n">MolAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypes&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">][</span><span class="n">MaxSingleEnergyAlertType</span><span class="p">]:</span>
  913                 <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypesMolCount&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">][</span><span class="n">MaxSingleEnergyAlertType</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
  914 
  915 <span class="k">def</span> <span class="nf">WriteTorsionAlertsSummaryInfo</span><span class="p">(</span><span class="n">Writer</span><span class="p">,</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">):</span>
  916     <span class="sd">&quot;&quot;&quot;Write out torsion alerts summary informatio to a CSV file.&quot;&quot;&quot;</span>
  917     
  918     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;CountMode&quot;</span><span class="p">]:</span>
  919         <span class="k">return</span>
  920     
  921     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileSummaryMode&quot;</span><span class="p">]:</span>
  922         <span class="k">return</span>
  923 
  924     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;RuleIDs&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
  925         <span class="k">return</span>
  926     
  927     <span class="c1"># Write headers...</span>
  928     <span class="n">QuoteValues</span> <span class="o">=</span> <span class="bp">True</span>
  929     <span class="n">Values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;TorsionRule&quot;</span><span class="p">,</span> <span class="s2">&quot;HierarchyClass&quot;</span><span class="p">,</span> <span class="s2">&quot;HierarchySubClass&quot;</span><span class="p">,</span> <span class="s2">&quot;EnergyMethod&quot;</span><span class="p">,</span> <span class="s2">&quot;MaxSingleEnergyTorsionAlertTypes&quot;</span><span class="p">,</span> <span class="s2">&quot;MaxSingleEnergyTorsionAlertCount&quot;</span><span class="p">,</span> <span class="s2">&quot;MaxSingleEnergyTorsionAlertMolCount&quot;</span><span class="p">]</span>
  930     <span class="n">Writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">JoinWords</span><span class="p">(</span><span class="n">Values</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">QuoteValues</span><span class="p">))</span>
  931     
  932     <span class="n">SortedRuleIDs</span> <span class="o">=</span> <span class="n">GetSortedTorsionAlertsSummaryInfoRuleIDs</span><span class="p">(</span><span class="n">TorsionAlertsSummaryInfo</span><span class="p">)</span>
  933     
  934     <span class="c1"># Write alerts information...</span>
  935     <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">SortedRuleIDs</span><span class="p">:</span>
  936         <span class="c1"># Remove any double quotes in SMARTS...</span>
  937         <span class="n">RuleSMARTS</span> <span class="o">=</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;RuleSMARTS&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span>
  938         <span class="n">RuleSMARTS</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">RuleSMARTS</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
  939         
  940         <span class="n">HierarchyClassName</span> <span class="o">=</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;HierarchyClassName&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span>
  941         <span class="n">HierarchySubClassName</span> <span class="o">=</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;HierarchySubClassName&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span>
  942         
  943         <span class="n">EnergyMethod</span> <span class="o">=</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;EnergyMethod&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span>
  944         
  945         <span class="n">MaxSingleEnergyAlertTypes</span> <span class="o">=</span> <span class="p">[]</span>
  946         <span class="n">MaxSingleEnergyAlertTypesCount</span> <span class="o">=</span> <span class="p">[]</span>
  947         <span class="n">MaxSingleEnergyAlertTypesMolCount</span> <span class="o">=</span> <span class="p">[]</span>
  948         <span class="k">for</span> <span class="n">MaxSingleEnergyAlertType</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypes&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]):</span>
  949             <span class="n">MaxSingleEnergyAlertTypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MaxSingleEnergyAlertType</span><span class="p">)</span>
  950             <span class="n">MaxSingleEnergyAlertTypesCount</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypes&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">][</span><span class="n">MaxSingleEnergyAlertType</span><span class="p">])</span>
  951             <span class="n">MaxSingleEnergyAlertTypesMolCount</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypesMolCount&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">][</span><span class="n">MaxSingleEnergyAlertType</span><span class="p">])</span>
  952         
  953         <span class="n">Values</span> <span class="o">=</span> <span class="p">[</span><span class="n">RuleSMARTS</span><span class="p">,</span> <span class="n">HierarchyClassName</span><span class="p">,</span> <span class="n">HierarchySubClassName</span><span class="p">,</span> <span class="n">EnergyMethod</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">JoinWords</span><span class="p">(</span><span class="n">MaxSingleEnergyAlertTypes</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">),</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MiscUtil</span><span class="o">.</span><span class="n">JoinWords</span><span class="p">(</span><span class="n">MaxSingleEnergyAlertTypesCount</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">)),</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MiscUtil</span><span class="o">.</span><span class="n">JoinWords</span><span class="p">(</span><span class="n">MaxSingleEnergyAlertTypesMolCount</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">))]</span>
  954         <span class="n">Writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">JoinWords</span><span class="p">(</span><span class="n">Values</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">QuoteValues</span><span class="p">))</span>
  955 
  956 <span class="k">def</span> <span class="nf">GetSortedTorsionAlertsSummaryInfoRuleIDs</span><span class="p">(</span><span class="n">TorsionAlertsSummaryInfo</span><span class="p">):</span>
  957     <span class="sd">&quot;&quot;&quot;Sort torsion rule IDs by  alert types molecule count in descending order.&quot;&quot;&quot;</span>
  958 
  959     <span class="n">SortedRuleIDs</span> <span class="o">=</span> <span class="p">[]</span>
  960     
  961     <span class="n">RuleIDs</span> <span class="o">=</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;RuleIDs&quot;</span><span class="p">]</span>
  962     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">RuleIDs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
  963         <span class="k">return</span> <span class="n">SortedRuleIDs</span>
  964     
  965     <span class="c1"># Setup a map from AlertTypesMolCount to IDs for sorting alerts...</span>
  966     <span class="n">RuleIDs</span> <span class="o">=</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;RuleIDs&quot;</span><span class="p">]</span>
  967     <span class="n">MolCountMap</span> <span class="o">=</span> <span class="p">{}</span>
  968     <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">RuleIDs</span><span class="p">:</span>
  969         <span class="n">MolCount</span> <span class="o">=</span> <span class="mi">0</span>
  970         <span class="k">for</span> <span class="n">AlertType</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypes&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]):</span>
  971             <span class="n">MolCount</span> <span class="o">+=</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertTypesMolCount&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">][</span><span class="n">AlertType</span><span class="p">]</span>
  972         <span class="n">MolCountMap</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">MolCount</span>
  973 
  974     <span class="n">SortedRuleIDs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">RuleIDs</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ID</span><span class="p">:</span> <span class="n">MolCountMap</span><span class="p">[</span><span class="n">ID</span><span class="p">],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
  975     
  976     <span class="k">return</span> <span class="n">SortedRuleIDs</span>
  977 
  978 <span class="k">def</span> <span class="nf">WriteTorsionAlertsFilteredByRulesInfo</span><span class="p">(</span><span class="n">TorsionAlertsSummaryInfo</span><span class="p">):</span>
  979     <span class="sd">&quot;&quot;&quot;Write out torsion alerts SD files for individual torsion rules.&quot;&quot;&quot;</span>
  980     
  981     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;CountMode&quot;</span><span class="p">]:</span>
  982         <span class="k">return</span>
  983     
  984     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesFilteredByRulesMode&quot;</span><span class="p">]:</span>
  985         <span class="k">return</span>
  986 
  987     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;RuleIDs&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
  988         <span class="k">return</span>
  989 
  990     <span class="c1"># Setup a molecule reader for filtered molecules...</span>
  991     <span class="n">FilteredMols</span>  <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">ReadMolecules</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileFiltered&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfileParams&quot;</span><span class="p">])</span>
  992 
  993     <span class="c1"># Get torsion rule IDs for writing out filtered SD files for individual torsion alert rules... </span>
  994     <span class="n">TorsionRuleIDs</span> <span class="o">=</span> <span class="n">GetTorsionAlertsFilteredByRuleFilesRuleIDs</span><span class="p">(</span><span class="n">TorsionAlertsSummaryInfo</span><span class="p">)</span>
  995 
  996     <span class="c1"># Setup writers...</span>
  997     <span class="n">ByRuleOutfilesWriters</span> <span class="o">=</span> <span class="n">SetupByRuleOutfilesWriters</span><span class="p">(</span><span class="n">TorsionRuleIDs</span><span class="p">)</span>
  998     
  999     <span class="k">for</span> <span class="n">Mol</span> <span class="ow">in</span> <span class="n">FilteredMols</span><span class="p">:</span>
 1000         <span class="c1"># Retrieve torsion alerts info...</span>
 1001         <span class="n">TorsionAlertsInfo</span> <span class="o">=</span> <span class="n">RetrieveTorsionAlertsInfo</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">)</span>
 1002         <span class="k">if</span> <span class="n">TorsionAlertsInfo</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1003             <span class="k">continue</span>
 1004         
 1005         <span class="k">for</span> <span class="n">TorsionRuleID</span> <span class="ow">in</span> <span class="n">TorsionRuleIDs</span><span class="p">:</span>
 1006             <span class="k">if</span> <span class="n">TorsionRuleID</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;RuleSMARTS&quot;</span><span class="p">]:</span>
 1007                 <span class="k">continue</span>
 1008             
 1009             <span class="n">WriteMoleculeFilteredByRuleID</span><span class="p">(</span><span class="n">ByRuleOutfilesWriters</span><span class="p">[</span><span class="n">TorsionRuleID</span><span class="p">],</span> <span class="n">Mol</span><span class="p">,</span> <span class="n">TorsionRuleID</span><span class="p">,</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">,</span> <span class="n">TorsionAlertsInfo</span><span class="p">)</span>
 1010         
 1011     <span class="n">CloseByRuleOutfilesWriters</span><span class="p">(</span><span class="n">ByRuleOutfilesWriters</span><span class="p">)</span>
 1012 
 1013 <span class="k">def</span> <span class="nf">GetTorsionAlertsFilteredByRuleFilesRuleIDs</span><span class="p">(</span><span class="n">TorsionAlertsSummaryInfo</span><span class="p">):</span>
 1014     <span class="sd">&quot;&quot;&quot;Get torsion rule IDs for writing out individual SD files filtered by torsion alert rules.&quot;&quot;&quot;</span>
 1015     
 1016     <span class="c1"># Get torsion rule IDs triggering torsion alerts sorted in the order from the most to</span>
 1017     <span class="c1"># the least number of unique molecules...</span>
 1018     <span class="n">RuleIDs</span> <span class="o">=</span> <span class="n">GetSortedTorsionAlertsSummaryInfoRuleIDs</span><span class="p">(</span><span class="n">TorsionAlertsSummaryInfo</span><span class="p">)</span>
 1019 
 1020     <span class="c1"># Select torsion rule IDs for writing out SD files...</span>
 1021     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesFilteredByRulesAllMode&quot;</span><span class="p">]:</span>
 1022         <span class="n">MaxRuleIDs</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesFilteredByRulesMaxCount&quot;</span><span class="p">]</span>
 1023         <span class="k">if</span> <span class="n">MaxRuleIDs</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">RuleIDs</span><span class="p">):</span>
 1024             <span class="n">RuleIDs</span> <span class="o">=</span> <span class="n">RuleIDs</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">MaxRuleIDs</span><span class="p">]</span>
 1025     
 1026     <span class="k">return</span> <span class="n">RuleIDs</span>
 1027 
 1028 <span class="k">def</span> <span class="nf">RetrieveTorsionAlertsInfo</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">):</span>
 1029     <span class="sd">&quot;&quot;&quot;Parse torsion alerts data field value to retrieve alerts information for rotatable bonds.&quot;&quot;&quot;</span>
 1030     
 1031     <span class="n">TorsionAlertsLabel</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SDFieldIDsToLabels&quot;</span><span class="p">][</span><span class="s2">&quot;TorsionAlertsLabel&quot;</span><span class="p">]</span>
 1032     <span class="n">TorsionAlerts</span> <span class="o">=</span> <span class="n">Mol</span><span class="o">.</span><span class="n">GetProp</span><span class="p">(</span><span class="n">TorsionAlertsLabel</span><span class="p">)</span> <span class="k">if</span> <span class="n">Mol</span><span class="o">.</span><span class="n">HasProp</span><span class="p">(</span><span class="n">TorsionAlertsLabel</span><span class="p">)</span> <span class="k">else</span> <span class="bp">None</span>
 1033     
 1034     <span class="k">if</span> <span class="n">TorsionAlerts</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">TorsionAlerts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
 1035         <span class="k">return</span> <span class="bp">None</span>
 1036 
 1037     <span class="c1"># Initialize for tracking by rule IDs...</span>
 1038     <span class="n">TorsionAlertsInfo</span> <span class="o">=</span> <span class="p">{}</span>
 1039     <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;RuleIDs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1040     
 1041     <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;RuleSMARTS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1042     <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;HierarchyClassName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1043     <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;HierarchySubClassName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1044     <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyMethod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1045     
 1046     <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AtomIndices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1047     <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionAtomIndices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1048     <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionAngle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1049     
 1050     <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;Energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1051     <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyLowerBound&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1052     <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyUpperBound&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1053 
 1054     <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AngleNotObserved&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1055     <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1056     
 1057     <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AnglesNotObservedCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1058     <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertsCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1059     
 1060     <span class="n">ValuesDelimiter</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;IntraSetValuesDelim&quot;</span><span class="p">]</span>
 1061     <span class="n">TorsionAlertsSetSize</span> <span class="o">=</span> <span class="mi">12</span>
 1062     
 1063     <span class="n">TorsionAlertsWords</span> <span class="o">=</span> <span class="n">TorsionAlerts</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
 1064     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">TorsionAlertsWords</span><span class="p">)</span> <span class="o">%</span> <span class="n">TorsionAlertsSetSize</span><span class="p">:</span>
 1065         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The number of space delimited values, </span><span class="si">%s</span><span class="s2">, for TorsionAlerts data field in filtered SD file must be a multiple of </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TorsionAlertsWords</span><span class="p">),</span> <span class="n">TorsionAlertsSetSize</span><span class="p">))</span>
 1066 
 1067     <span class="n">ID</span> <span class="o">=</span> <span class="mi">0</span>
 1068     <span class="k">for</span> <span class="n">Index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">TorsionAlertsWords</span><span class="p">),</span> <span class="n">TorsionAlertsSetSize</span><span class="p">):</span>
 1069         <span class="n">ID</span> <span class="o">+=</span> <span class="mi">1</span>
 1070         
 1071         <span class="n">RotBondIndices</span><span class="p">,</span> <span class="n">TorsionIndices</span><span class="p">,</span> <span class="n">TorsionAngle</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">EnergyLowerBound</span><span class="p">,</span> <span class="n">EnergyUpperBound</span><span class="p">,</span> <span class="n">HierarchyClass</span><span class="p">,</span> <span class="n">HierarchySubClass</span><span class="p">,</span> <span class="n">TorsionRule</span><span class="p">,</span> <span class="n">EnergyMethod</span><span class="p">,</span> <span class="n">AngleNotObserved</span><span class="p">,</span> <span class="n">MaxSingleEnergyAlertType</span> <span class="o">=</span> <span class="n">TorsionAlertsWords</span><span class="p">[</span><span class="n">Index</span><span class="p">:</span> <span class="n">Index</span> <span class="o">+</span> <span class="n">TorsionAlertsSetSize</span><span class="p">]</span>
 1072         <span class="n">RotBondIndices</span> <span class="o">=</span> <span class="n">RotBondIndices</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">ValuesDelimiter</span><span class="p">)</span>
 1073         <span class="n">TorsionIndices</span> <span class="o">=</span> <span class="n">TorsionIndices</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">ValuesDelimiter</span><span class="p">)</span>
 1074 
 1075         <span class="k">if</span> <span class="n">TorsionRule</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;SMARTSToRuleIDs&quot;</span><span class="p">]:</span>
 1076             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;The SMARTS pattern, </span><span class="si">%s</span><span class="s2">, for TorsionAlerts data field in filtered SD file doesn&#39;t map to any torsion rule...&quot;</span> <span class="o">%</span> <span class="n">TorsionRule</span><span class="p">)</span>
 1077             <span class="k">continue</span>
 1078         <span class="n">TorsionRuleNodeID</span> <span class="o">=</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">[</span><span class="s2">&quot;SMARTSToRuleIDs&quot;</span><span class="p">][</span><span class="n">TorsionRule</span><span class="p">]</span>
 1079     
 1080         <span class="c1"># Track data for torsion alerts in a molecule...</span>
 1081         <span class="k">if</span> <span class="n">TorsionRuleNodeID</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;RuleSMARTS&quot;</span><span class="p">]:</span>
 1082             <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;RuleIDs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TorsionRuleNodeID</span><span class="p">)</span>
 1083 
 1084             <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;RuleSMARTS&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="n">TorsionRule</span>
 1085             <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;HierarchyClassName&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="n">HierarchyClass</span>
 1086             <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;HierarchySubClassName&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="n">HierarchySubClass</span>
 1087             <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyMethod&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="n">EnergyMethod</span>
 1088 
 1089             <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AtomIndices&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1090             <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionAtomIndices&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1091             <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionAngle&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1092     
 1093             <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;Energy&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1094             <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyLowerBound&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1095             <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyUpperBound&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1096             <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AngleNotObserved&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1097             <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertType&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1098             
 1099             <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AnglesNotObservedCount&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
 1100             <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertsCount&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
 1101             
 1102         <span class="c1"># Track multiple values for a rule ID...</span>
 1103         <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AtomIndices&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RotBondIndices</span><span class="p">)</span>
 1104         <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionAtomIndices&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TorsionIndices</span><span class="p">)</span>
 1105         <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionAngle&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TorsionAngle</span><span class="p">)</span>
 1106         
 1107         <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;Energy&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Energy</span><span class="p">)</span>
 1108         <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyLowerBound&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EnergyLowerBound</span><span class="p">)</span>
 1109         <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyUpperBound&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EnergyUpperBound</span><span class="p">)</span>
 1110         <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AngleNotObserved&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AngleNotObserved</span><span class="p">)</span>
 1111         
 1112         <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertType&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MaxSingleEnergyAlertType</span><span class="p">)</span>
 1113         
 1114         <span class="c1"># Count angles not observer for a rule ID...</span>
 1115         <span class="k">if</span> <span class="n">AngleNotObserved</span> <span class="o">==</span> <span class="s1">&#39;Yes&#39;</span><span class="p">:</span>
 1116             <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AnglesNotObservedCount&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
 1117 
 1118         <span class="c1"># Count max single energy alert for a rule ID...</span>
 1119         <span class="k">if</span> <span class="n">MaxSingleEnergyAlertType</span> <span class="o">==</span> <span class="s1">&#39;Yes&#39;</span><span class="p">:</span>
 1120             <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertsCount&quot;</span><span class="p">][</span><span class="n">TorsionRuleNodeID</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
 1121     
 1122     <span class="k">return</span> <span class="n">TorsionAlertsInfo</span>
 1123 
 1124 <span class="k">def</span> <span class="nf">WriteMolecule</span><span class="p">(</span><span class="n">Writer</span><span class="p">,</span> <span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span><span class="p">):</span>
 1125     <span class="sd">&quot;&quot;&quot;Write out molecule.&quot;&quot;&quot;</span>
 1126     
 1127     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;CountMode&quot;</span><span class="p">]:</span>
 1128         <span class="k">return</span> <span class="bp">True</span>
 1129 
 1130     <span class="n">SetupMolPropertiesForAlertsInformation</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span><span class="p">)</span>
 1131 
 1132     <span class="k">try</span><span class="p">:</span>
 1133         <span class="n">Writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Mol</span><span class="p">)</span>
 1134     <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ErrMsg</span><span class="p">:</span>
 1135         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Failed to write molecule </span><span class="si">%s</span><span class="s2">:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">RDKitUtil</span><span class="o">.</span><span class="n">GetMolName</span><span class="p">(</span><span class="n">Mol</span><span class="p">),</span> <span class="n">ErrMsg</span><span class="p">))</span>
 1136         <span class="k">return</span> <span class="bp">False</span>
 1137     
 1138     <span class="k">return</span> <span class="bp">True</span>
 1139 
 1140 <span class="k">def</span> <span class="nf">SetupMolPropertiesForAlertsInformation</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span><span class="p">):</span>
 1141     <span class="sd">&quot;&quot;&quot;Setup molecule properties containing alerts information for rotatable bonds.&quot;&quot;&quot;</span>
 1142 
 1143     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileAlerts&quot;</span><span class="p">]:</span>
 1144         <span class="k">return</span>
 1145 
 1146     <span class="n">SDFieldIDsToLabels</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SDFieldIDsToLabels&quot;</span><span class="p">]</span>
 1147     <span class="n">Precision</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Precision&quot;</span><span class="p">]</span>
 1148     
 1149     <span class="c1"># Setup rotatable bonds count...</span>
 1150     <span class="n">RotBondsCount</span> <span class="o">=</span> <span class="mi">0</span>
 1151     <span class="k">if</span> <span class="n">RotBondsAlertsInfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
 1152         <span class="n">RotBondsCount</span> <span class="o">=</span>  <span class="nb">len</span><span class="p">(</span><span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;IDs&quot;</span><span class="p">])</span>
 1153     <span class="n">Mol</span><span class="o">.</span><span class="n">SetProp</span><span class="p">(</span><span class="n">SDFieldIDsToLabels</span><span class="p">[</span><span class="s2">&quot;RotBondsCountLabel&quot;</span><span class="p">],</span>  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">RotBondsCount</span><span class="p">)</span>
 1154 
 1155     <span class="k">if</span> <span class="n">RotBondsAlertsInfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
 1156         <span class="c1"># Setup total energy along with lower and upper bounds...</span>
 1157         <span class="n">Mol</span><span class="o">.</span><span class="n">SetProp</span><span class="p">(</span><span class="n">SDFieldIDsToLabels</span><span class="p">[</span><span class="s2">&quot;TotalEnergyLabel&quot;</span><span class="p">],</span>  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">SetupEnergyValueForSDField</span><span class="p">(</span><span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TotalEnergy&quot;</span><span class="p">],</span> <span class="n">Precision</span><span class="p">))</span>
 1158         <span class="n">Mol</span><span class="o">.</span><span class="n">SetProp</span><span class="p">(</span><span class="n">SDFieldIDsToLabels</span><span class="p">[</span><span class="s2">&quot;TotalEnergyLowerBoundCILabel&quot;</span><span class="p">],</span>  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">SetupEnergyValueForSDField</span><span class="p">(</span><span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TotalEnergyLowerBound&quot;</span><span class="p">],</span> <span class="n">Precision</span><span class="p">))</span>
 1159         <span class="n">Mol</span><span class="o">.</span><span class="n">SetProp</span><span class="p">(</span><span class="n">SDFieldIDsToLabels</span><span class="p">[</span><span class="s2">&quot;TotalEnergyUpperBoundCILabel&quot;</span><span class="p">],</span>  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">SetupEnergyValueForSDField</span><span class="p">(</span><span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TotalEnergyUpperBound&quot;</span><span class="p">],</span> <span class="n">Precision</span><span class="p">))</span>
 1160         
 1161         <span class="c1"># Setup max single energy and alert count...</span>
 1162         <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyMode&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TotalOrMaxSingleEnergyMode&quot;</span><span class="p">]:</span>
 1163             <span class="n">Mol</span><span class="o">.</span><span class="n">SetProp</span><span class="p">(</span><span class="n">SDFieldIDsToLabels</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyLabel&quot;</span><span class="p">],</span>  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">SetupEnergyValueForSDField</span><span class="p">(</span><span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergy&quot;</span><span class="p">],</span> <span class="n">Precision</span><span class="p">))</span>
 1164             <span class="n">Mol</span><span class="o">.</span><span class="n">SetProp</span><span class="p">(</span><span class="n">SDFieldIDsToLabels</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertsCountLabel&quot;</span><span class="p">],</span>  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;NA&quot;</span> <span class="k">if</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertsCount&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertsCount&quot;</span><span class="p">]))</span>
 1165             
 1166         <span class="n">Mol</span><span class="o">.</span><span class="n">SetProp</span><span class="p">(</span><span class="n">SDFieldIDsToLabels</span><span class="p">[</span><span class="s2">&quot;AnglesNotObservedCountLabel&quot;</span><span class="p">],</span>  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;NA&quot;</span> <span class="k">if</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AnglesNotObservedCount&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AnglesNotObservedCount&quot;</span><span class="p">]))</span>
 1167     
 1168     
 1169     <span class="c1"># Setup alert information for rotatable bonds...</span>
 1170     <span class="n">AlertsInfoValues</span> <span class="o">=</span> <span class="p">[]</span>
 1171 
 1172     <span class="c1"># Delimiter for multiple values corresponding to specific set of information for</span>
 1173     <span class="c1"># a rotatable bond. For example: TorsionAtomIndices</span>
 1174     <span class="n">ValuesDelim</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;IntraSetValuesDelim&quot;</span><span class="p">]</span>
 1175 
 1176     <span class="c1"># Delimiter for various values for a rotatable bond...</span>
 1177     <span class="n">RotBondValuesDelim</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InterSetValuesDelim&quot;</span><span class="p">]</span>
 1178     
 1179     <span class="c1"># Delimiter for values corresponding to multiple rotatable bonds...</span>
 1180     <span class="n">AlertsInfoValuesDelim</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InterSetValuesDelim&quot;</span><span class="p">]</span>
 1181     
 1182     <span class="k">if</span> <span class="n">RotBondsAlertsInfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
 1183         <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;IDs&quot;</span><span class="p">]:</span>
 1184             <span class="k">if</span> <span class="ow">not</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MatchStatus&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]:</span>
 1185                 <span class="k">continue</span>
 1186 
 1187             <span class="k">if</span> <span class="n">SkipRotatableBondAlertInfo</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span><span class="p">):</span>
 1188                 <span class="k">continue</span>
 1189                 
 1190             <span class="n">RotBondValues</span> <span class="o">=</span> <span class="p">[]</span>
 1191             
 1192             <span class="c1"># Bond atom indices...</span>
 1193             <span class="n">Values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">Value</span> <span class="k">for</span> <span class="n">Value</span> <span class="ow">in</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AtomIndices&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]]</span>
 1194             <span class="n">RotBondValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ValuesDelim</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Values</span><span class="p">))</span>
 1195     
 1196             <span class="c1"># Torsion atom indices...</span>
 1197             <span class="n">TorsionAtomIndices</span> <span class="o">=</span> <span class="n">SetupTorsionAtomIndicesValues</span><span class="p">(</span><span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionAtomIndices&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">],</span> <span class="n">ValuesDelim</span><span class="p">)</span>
 1198             <span class="n">RotBondValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TorsionAtomIndices</span><span class="p">)</span>
 1199 
 1200             <span class="c1"># Torsion angle...</span>
 1201             <span class="n">RotBondValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionAngle&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">])</span>
 1202 
 1203             <span class="c1"># Energy along with its lower and upper bound confidence interval...</span>
 1204             <span class="n">RotBondValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SetupEnergyValueForSDField</span><span class="p">(</span><span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;Energy&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">],</span> <span class="n">Precision</span><span class="p">))</span>
 1205             <span class="n">RotBondValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SetupEnergyValueForSDField</span><span class="p">(</span><span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyLowerBound&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">],</span> <span class="n">Precision</span><span class="p">))</span>
 1206             <span class="n">RotBondValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SetupEnergyValueForSDField</span><span class="p">(</span><span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyUpperBound&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">],</span> <span class="n">Precision</span><span class="p">))</span>
 1207             
 1208             <span class="c1"># Hierarchy class and subclass names...</span>
 1209             <span class="n">RotBondValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;HierarchyClassName&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">])</span>
 1210             <span class="n">RotBondValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;HierarchySubClassName&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">])</span>
 1211             
 1212             <span class="c1"># Torsion rule SMARTS...</span>
 1213             <span class="n">RotBondValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionRuleSMARTS&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">])</span>
 1214             
 1215             <span class="c1"># Energy method...</span>
 1216             <span class="n">RotBondValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyMethod&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">])</span>
 1217 
 1218             <span class="c1"># Angle not observed...</span>
 1219             <span class="n">RotBondValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">SetupAngleNotObservedValue</span><span class="p">(</span><span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AngleNotObserved&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]))</span>
 1220             
 1221             <span class="c1"># Max single energy alert status...</span>
 1222             <span class="n">RotBondValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">SetupMaxSingleEnergyAlertStatusValue</span><span class="p">(</span><span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertStatus&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]))</span>
 1223                 
 1224             <span class="c1"># Track joined values for a rotatable bond...</span>
 1225             <span class="n">AlertsInfoValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">RotBondValuesDelim</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">RotBondValues</span><span class="p">))</span>
 1226     
 1227     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">AlertsInfoValues</span><span class="p">):</span>
 1228         <span class="n">Mol</span><span class="o">.</span><span class="n">SetProp</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SDFieldIDsToLabels&quot;</span><span class="p">][</span><span class="s2">&quot;TorsionAlertsLabel&quot;</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">AlertsInfoValuesDelim</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">AlertsInfoValues</span><span class="p">)))</span>
 1229 
 1230 <span class="k">def</span> <span class="nf">WriteMoleculeFilteredByRuleID</span><span class="p">(</span><span class="n">Writer</span><span class="p">,</span> <span class="n">Mol</span><span class="p">,</span> <span class="n">TorsionRuleID</span><span class="p">,</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">,</span> <span class="n">TorsionAlertsInfo</span><span class="p">):</span>
 1231     <span class="sd">&quot;&quot;&quot;Write out molecule.&quot;&quot;&quot;</span>
 1232     
 1233     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;CountMode&quot;</span><span class="p">]:</span>
 1234         <span class="k">return</span>
 1235 
 1236     <span class="n">SetupMolPropertiesForFilteredByRuleIDAlertsInformation</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">TorsionRuleID</span><span class="p">,</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">,</span> <span class="n">TorsionAlertsInfo</span><span class="p">)</span>
 1237         
 1238     <span class="n">Writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Mol</span><span class="p">)</span>
 1239 
 1240 <span class="k">def</span> <span class="nf">SetupMolPropertiesForFilteredByRuleIDAlertsInformation</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">TorsionRuleID</span><span class="p">,</span> <span class="n">TorsionAlertsSummaryInfo</span><span class="p">,</span> <span class="n">TorsionAlertsInfo</span><span class="p">):</span>
 1241     <span class="sd">&quot;&quot;&quot;Setup molecule properties containing alerts information for torsion alerts</span>
 1242 <span class="sd">    fileted by Rule IDs.&quot;&quot;&quot;</span>
 1243 
 1244     <span class="c1"># Delete torsion alerts information for rotatable bonds...</span>
 1245     <span class="k">if</span> <span class="n">Mol</span><span class="o">.</span><span class="n">HasProp</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SDFieldIDsToLabels&quot;</span><span class="p">][</span><span class="s2">&quot;TorsionAlertsLabel&quot;</span><span class="p">]):</span>
 1246         <span class="n">Mol</span><span class="o">.</span><span class="n">ClearProp</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SDFieldIDsToLabels&quot;</span><span class="p">][</span><span class="s2">&quot;TorsionAlertsLabel&quot;</span><span class="p">])</span>
 1247 
 1248     <span class="c1"># Delimiter for values...</span>
 1249     <span class="n">IntraSetValuesDelim</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;IntraSetValuesDelim&quot;</span><span class="p">]</span>
 1250     <span class="n">InterSetValuesDelim</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InterSetValuesDelim&quot;</span><span class="p">]</span>
 1251 
 1252     <span class="c1"># Setup alert rule information...</span>
 1253     <span class="n">AlertRuleInfoValues</span> <span class="o">=</span> <span class="p">[]</span>
 1254     
 1255     <span class="n">AlertRuleInfoValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;HierarchyClassName&quot;</span><span class="p">][</span><span class="n">TorsionRuleID</span><span class="p">])</span>
 1256     <span class="n">AlertRuleInfoValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;HierarchySubClassName&quot;</span><span class="p">][</span><span class="n">TorsionRuleID</span><span class="p">])</span>
 1257     
 1258     <span class="n">AlertRuleInfoValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;RuleSMARTS&quot;</span><span class="p">][</span><span class="n">TorsionRuleID</span><span class="p">])</span>
 1259     <span class="n">AlertRuleInfoValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyMethod&quot;</span><span class="p">][</span><span class="n">TorsionRuleID</span><span class="p">])</span>
 1260     
 1261     <span class="n">Mol</span><span class="o">.</span><span class="n">SetProp</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SDFieldIDsToLabels&quot;</span><span class="p">][</span><span class="s2">&quot;TorsionRuleLabel&quot;</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">InterSetValuesDelim</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">AlertRuleInfoValues</span><span class="p">)))</span>
 1262 
 1263     <span class="c1"># Setup max single energy alert count for torsion rule...</span>
 1264     <span class="n">Mol</span><span class="o">.</span><span class="n">SetProp</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SDFieldIDsToLabels&quot;</span><span class="p">][</span><span class="s2">&quot;TorsionRuleMaxSingleEnergyAlertsCountLabel&quot;</span><span class="p">],</span>  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertsCount&quot;</span><span class="p">][</span><span class="n">TorsionRuleID</span><span class="p">])</span>
 1265     
 1266     <span class="c1"># Setup angle not observed count for torsion rule...</span>
 1267     <span class="n">Mol</span><span class="o">.</span><span class="n">SetProp</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SDFieldIDsToLabels&quot;</span><span class="p">][</span><span class="s2">&quot;TorsionRuleAnglesNotObservedCountLabel&quot;</span><span class="p">],</span>  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AnglesNotObservedCount&quot;</span><span class="p">][</span><span class="n">TorsionRuleID</span><span class="p">])</span>
 1268     
 1269     <span class="c1"># Setup torsion rule alerts...</span>
 1270     <span class="c1"># &quot;TorsionRuleAlertsLabel&quot;: &quot;TorsionRuleAlerts (RotBondIndices TorsionIndices TorsionAngle Energy EnergyLowerBoundCI EnergyUpperBoundCI EnergyMethod AngleNotObserved MaxSingleEnergyAlert)</span>
 1271     <span class="n">AlertsInfoValues</span> <span class="o">=</span> <span class="p">[]</span>
 1272     <span class="k">for</span> <span class="n">Index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AtomIndices&quot;</span><span class="p">][</span><span class="n">TorsionRuleID</span><span class="p">])):</span>
 1273         <span class="n">RotBondInfoValues</span> <span class="o">=</span> <span class="p">[]</span>
 1274         
 1275         <span class="c1"># Bond atom indices...</span>
 1276         <span class="n">Values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">Value</span> <span class="k">for</span> <span class="n">Value</span> <span class="ow">in</span> <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AtomIndices&quot;</span><span class="p">][</span><span class="n">TorsionRuleID</span><span class="p">][</span><span class="n">Index</span><span class="p">]]</span>
 1277         <span class="n">RotBondInfoValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IntraSetValuesDelim</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Values</span><span class="p">))</span>
 1278         
 1279         <span class="c1"># Torsion atom indices retrieved from the filtered SD file and stored as strings...</span>
 1280         <span class="n">Values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">Value</span> <span class="k">for</span> <span class="n">Value</span> <span class="ow">in</span> <span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionAtomIndices&quot;</span><span class="p">][</span><span class="n">TorsionRuleID</span><span class="p">][</span><span class="n">Index</span><span class="p">]]</span>
 1281         <span class="n">RotBondInfoValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IntraSetValuesDelim</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Values</span><span class="p">))</span>
 1282         
 1283         <span class="c1"># Torsion angle...</span>
 1284         <span class="n">RotBondInfoValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionAngle&quot;</span><span class="p">][</span><span class="n">TorsionRuleID</span><span class="p">][</span><span class="n">Index</span><span class="p">])</span>
 1285 
 1286         <span class="c1"># Energy and its bounds...</span>
 1287         <span class="n">RotBondInfoValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;Energy&quot;</span><span class="p">][</span><span class="n">TorsionRuleID</span><span class="p">][</span><span class="n">Index</span><span class="p">])</span>
 1288         <span class="n">RotBondInfoValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyLowerBound&quot;</span><span class="p">][</span><span class="n">TorsionRuleID</span><span class="p">][</span><span class="n">Index</span><span class="p">])</span>
 1289         <span class="n">RotBondInfoValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;EnergyUpperBound&quot;</span><span class="p">][</span><span class="n">TorsionRuleID</span><span class="p">][</span><span class="n">Index</span><span class="p">])</span>
 1290         
 1291         <span class="c1"># Angle not observed......</span>
 1292         <span class="n">RotBondInfoValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;AngleNotObserved&quot;</span><span class="p">][</span><span class="n">TorsionRuleID</span><span class="p">][</span><span class="n">Index</span><span class="p">])</span>
 1293         
 1294         <span class="c1"># Max single energy alert type...</span>
 1295         <span class="n">RotBondInfoValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TorsionAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertType&quot;</span><span class="p">][</span><span class="n">TorsionRuleID</span><span class="p">][</span><span class="n">Index</span><span class="p">])</span>
 1296         
 1297         <span class="c1"># Track alerts informaiton...</span>
 1298         <span class="n">AlertsInfoValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">InterSetValuesDelim</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">RotBondInfoValues</span><span class="p">))</span>
 1299         
 1300     <span class="n">Mol</span><span class="o">.</span><span class="n">SetProp</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SDFieldIDsToLabels&quot;</span><span class="p">][</span><span class="s2">&quot;TorsionRuleAlertsLabel&quot;</span><span class="p">],</span>  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">InterSetValuesDelim</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">AlertsInfoValues</span><span class="p">)))</span>
 1301     
 1302 <span class="k">def</span> <span class="nf">SkipRotatableBondAlertInfo</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">RotBondsAlertsInfo</span><span class="p">):</span>
 1303     <span class="sd">&quot;&quot;&quot;Skip rotatble bond alert info for a specific bond during writing to output files.&quot;&quot;&quot;</span>
 1304 
 1305     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileAlertsOnly&quot;</span><span class="p">]:</span>
 1306         <span class="k">return</span> <span class="bp">False</span>
 1307     
 1308     <span class="k">if</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;RotBondsAlertsStatus&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1309         <span class="k">return</span> <span class="bp">True</span>
 1310 
 1311     <span class="n">Status</span> <span class="o">=</span> <span class="bp">False</span>
 1312     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TotalEnergyMode&quot;</span><span class="p">]:</span>
 1313         <span class="k">if</span> <span class="ow">not</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;RotBondsAlertsStatus&quot;</span><span class="p">]:</span>
 1314             <span class="n">Status</span> <span class="o">=</span> <span class="bp">True</span>
 1315     <span class="k">elif</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyMode&quot;</span><span class="p">]:</span>
 1316         <span class="k">if</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertStatus&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyAlertStatus&quot;</span><span class="p">][</span><span class="n">ID</span><span class="p">]:</span>
 1317             <span class="n">Status</span> <span class="o">=</span> <span class="bp">True</span>
 1318     <span class="k">elif</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TotalOrMaxSingleEnergyMode&quot;</span><span class="p">]:</span>
 1319         <span class="k">if</span> <span class="ow">not</span> <span class="n">RotBondsAlertsInfo</span><span class="p">[</span><span class="s2">&quot;RotBondsAlertsStatus&quot;</span><span class="p">]:</span>
 1320             <span class="n">Status</span> <span class="o">=</span> <span class="bp">True</span>
 1321     
 1322     <span class="k">return</span> <span class="n">Status</span>
 1323 
 1324 <span class="k">def</span> <span class="nf">SetupEnergyValueForSDField</span><span class="p">(</span><span class="n">Value</span><span class="p">,</span> <span class="n">Precision</span><span class="p">):</span>
 1325     <span class="sd">&quot;&quot;&quot;Setup energy value for SD field.&quot;&quot;&quot;</span>
 1326     
 1327     <span class="k">if</span> <span class="n">Value</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Value</span><span class="p">)</span> <span class="ow">or</span> <span class="n">math</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">Value</span><span class="p">):</span>
 1328         <span class="k">return</span> <span class="s2">&quot;NA&quot;</span>
 1329 
 1330     <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%.*f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Precision</span><span class="p">,</span> <span class="n">Value</span><span class="p">)</span>
 1331     
 1332 <span class="k">def</span> <span class="nf">SetupAngleNotObservedValue</span><span class="p">(</span><span class="n">Value</span><span class="p">):</span>
 1333     <span class="sd">&quot;&quot;&quot;Setup angle not observed value.&quot;&quot;&quot;</span>
 1334     
 1335     <span class="k">if</span> <span class="n">Value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1336         <span class="k">return</span> <span class="s2">&quot;NA&quot;</span>
 1337 
 1338     <span class="k">return</span> <span class="s2">&quot;Yes&quot;</span> <span class="k">if</span> <span class="n">Value</span> <span class="k">else</span> <span class="s2">&quot;No&quot;</span>
 1339 
 1340 <span class="k">def</span> <span class="nf">SetupMaxSingleEnergyAlertStatusValue</span><span class="p">(</span><span class="n">Value</span><span class="p">):</span>
 1341     <span class="sd">&quot;&quot;&quot;Setup max single energy alert status value.&quot;&quot;&quot;</span>
 1342     
 1343     <span class="k">if</span> <span class="n">Value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1344         <span class="k">return</span> <span class="s2">&quot;NA&quot;</span>
 1345 
 1346     <span class="k">return</span> <span class="s2">&quot;Yes&quot;</span> <span class="k">if</span> <span class="n">Value</span> <span class="k">else</span> <span class="s2">&quot;No&quot;</span>
 1347 
 1348 <span class="k">def</span> <span class="nf">SetupTorsionAtomIndicesValues</span><span class="p">(</span><span class="n">TorsionAtomIndicesList</span><span class="p">,</span> <span class="n">ValuesDelim</span><span class="p">):</span>
 1349     <span class="sd">&quot;&quot;&quot;Setup torsion atom indices value for output files.&quot;&quot;&quot;</span>
 1350 
 1351     <span class="n">Values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">Value</span> <span class="k">for</span> <span class="n">Value</span> <span class="ow">in</span> <span class="n">TorsionAtomIndicesList</span><span class="p">]</span>
 1352     
 1353     <span class="k">return</span> <span class="n">ValuesDelim</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Values</span><span class="p">)</span>
 1354     
 1355 <span class="k">def</span> <span class="nf">SetupOutfilesWriters</span><span class="p">():</span>
 1356     <span class="sd">&quot;&quot;&quot;Setup molecule and summary writers.&quot;&quot;&quot;</span>
 1357 
 1358     <span class="n">OutfilesWriters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;WriterRemaining&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s2">&quot;WriterFiltered&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s2">&quot;WriterAlertSummary&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
 1359 
 1360     <span class="c1"># Writers for SD files...</span>
 1361     <span class="n">WriterRemaining</span><span class="p">,</span> <span class="n">WriterFiltered</span> <span class="o">=</span> <span class="n">SetupMoleculeWriters</span><span class="p">()</span>
 1362     <span class="n">OutfilesWriters</span><span class="p">[</span><span class="s2">&quot;WriterRemaining&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">WriterRemaining</span>
 1363     <span class="n">OutfilesWriters</span><span class="p">[</span><span class="s2">&quot;WriterFiltered&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">WriterFiltered</span>
 1364     
 1365     <span class="c1"># Writer for alert summary CSV file...</span>
 1366     <span class="n">WriterAlertSummary</span> <span class="o">=</span> <span class="n">SetupAlertSummaryWriter</span><span class="p">()</span>
 1367     <span class="n">OutfilesWriters</span><span class="p">[</span><span class="s2">&quot;WriterAlertSummary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">WriterAlertSummary</span>
 1368 
 1369     <span class="k">return</span> <span class="n">OutfilesWriters</span>
 1370 
 1371 <span class="k">def</span> <span class="nf">SetupMoleculeWriters</span><span class="p">():</span>
 1372     <span class="sd">&quot;&quot;&quot;Setup molecule writers.&quot;&quot;&quot;</span>
 1373     
 1374     <span class="n">Writer</span> <span class="o">=</span> <span class="bp">None</span>
 1375     <span class="n">WriterFiltered</span> <span class="o">=</span> <span class="bp">None</span>
 1376 
 1377     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;CountMode&quot;</span><span class="p">]:</span>
 1378         <span class="k">return</span> <span class="p">(</span><span class="n">Writer</span><span class="p">,</span> <span class="n">WriterFiltered</span><span class="p">)</span>
 1379 
 1380     <span class="n">Writer</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">MoleculesWriter</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileParams&quot;</span><span class="p">])</span>
 1381     <span class="k">if</span> <span class="n">Writer</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1382         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Failed to setup a writer for output fie </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">])</span>
 1383     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generating file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">])</span>
 1384     
 1385     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileFilteredMode&quot;</span><span class="p">]:</span>
 1386         <span class="n">WriterFiltered</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">MoleculesWriter</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileFiltered&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileParams&quot;</span><span class="p">])</span>
 1387         <span class="k">if</span> <span class="n">WriterFiltered</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1388             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Failed to setup a writer for output fie </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileFiltered&quot;</span><span class="p">])</span>
 1389         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Generating file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileFiltered&quot;</span><span class="p">])</span>
 1390     
 1391     <span class="k">return</span> <span class="p">(</span><span class="n">Writer</span><span class="p">,</span> <span class="n">WriterFiltered</span><span class="p">)</span>
 1392 
 1393 <span class="k">def</span> <span class="nf">SetupAlertSummaryWriter</span><span class="p">():</span>
 1394     <span class="sd">&quot;&quot;&quot;Setup a alert summary writer.&quot;&quot;&quot;</span>
 1395     
 1396     <span class="n">Writer</span> <span class="o">=</span> <span class="bp">None</span>
 1397     
 1398     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;CountMode&quot;</span><span class="p">]:</span>
 1399         <span class="k">return</span> <span class="n">Writer</span>
 1400         
 1401     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileSummaryMode&quot;</span><span class="p">]:</span>
 1402         <span class="k">return</span> <span class="n">Writer</span>
 1403     
 1404     <span class="n">Outfile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileSummary&quot;</span><span class="p">]</span>
 1405     <span class="n">Writer</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">Outfile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
 1406     <span class="k">if</span> <span class="n">Writer</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1407         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Failed to setup a writer for output fie </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">Outfile</span><span class="p">)</span>
 1408     
 1409     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Generating file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">Outfile</span><span class="p">)</span>
 1410     
 1411     <span class="k">return</span> <span class="n">Writer</span>
 1412     
 1413 <span class="k">def</span> <span class="nf">CloseOutfilesWriters</span><span class="p">(</span><span class="n">OutfilesWriters</span><span class="p">):</span>
 1414     <span class="sd">&quot;&quot;&quot;Close outfile writers.&quot;&quot;&quot;</span>
 1415 
 1416     <span class="k">for</span> <span class="n">WriterType</span><span class="p">,</span> <span class="n">Writer</span> <span class="ow">in</span> <span class="n">OutfilesWriters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
 1417         <span class="k">if</span> <span class="n">Writer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
 1418             <span class="n">Writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
 1419 
 1420 <span class="k">def</span> <span class="nf">SetupByRuleOutfilesWriters</span><span class="p">(</span><span class="n">RuleIDs</span><span class="p">):</span>
 1421     <span class="sd">&quot;&quot;&quot;Setup by rule outfiles writers.&quot;&quot;&quot;</span>
 1422 
 1423     <span class="c1"># Initialize...</span>
 1424     <span class="n">OutfilesWriters</span> <span class="o">=</span> <span class="p">{}</span>
 1425     <span class="k">for</span> <span class="n">RuleID</span> <span class="ow">in</span> <span class="n">RuleIDs</span><span class="p">:</span>
 1426         <span class="n">OutfilesWriters</span><span class="p">[</span><span class="n">RuleID</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
 1427     
 1428     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;CountMode&quot;</span><span class="p">]:</span>
 1429         <span class="k">return</span> <span class="n">OutfilesWriters</span>
 1430         
 1431     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesFilteredByRulesMode&quot;</span><span class="p">]:</span>
 1432         <span class="k">return</span> <span class="n">OutfilesWriters</span>
 1433     
 1434     <span class="n">FileDir</span><span class="p">,</span> <span class="n">FileName</span><span class="p">,</span> <span class="n">FileExt</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ParseFileName</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">])</span>
 1435     <span class="n">OutfilesRoot</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_Filtered_TopRule&quot;</span> <span class="o">%</span> <span class="n">FileName</span>
 1436     <span class="n">OutfilesExt</span> <span class="o">=</span> <span class="s2">&quot;sdf&quot;</span>
 1437 
 1438     <span class="n">MsgTxt</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span> <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesFilteredByRulesAllMode&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;top </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesFilteredByRulesMaxCount&quot;</span><span class="p">]</span>
 1439     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generating output files </span><span class="si">%s</span><span class="s2">*.</span><span class="si">%s</span><span class="s2"> for </span><span class="si">%s</span><span class="s2"> torsion rules triggering alerts...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OutfilesRoot</span><span class="p">,</span> <span class="n">OutfilesExt</span><span class="p">,</span> <span class="n">MsgTxt</span><span class="p">))</span>
 1440     
 1441     <span class="c1"># Delete any existing output files...</span>
 1442     <span class="n">Outfiles</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">*.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OutfilesRoot</span><span class="p">,</span> <span class="n">OutfilesExt</span><span class="p">))</span>
 1443     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Outfiles</span><span class="p">):</span>
 1444         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Deleting existing output files </span><span class="si">%s</span><span class="s2">*.</span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OutfilesRoot</span><span class="p">,</span> <span class="n">OutfilesExt</span><span class="p">))</span>
 1445         <span class="k">for</span> <span class="n">Outfile</span> <span class="ow">in</span> <span class="n">Outfiles</span><span class="p">:</span>
 1446             <span class="k">try</span><span class="p">:</span>
 1447                 <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">Outfile</span><span class="p">)</span>
 1448             <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ErrMsg</span><span class="p">:</span>
 1449                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Failed to delete file: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ErrMsg</span><span class="p">)</span>
 1450     
 1451     <span class="n">RuleIndex</span> <span class="o">=</span> <span class="mi">0</span>
 1452     <span class="k">for</span> <span class="n">RuleID</span> <span class="ow">in</span> <span class="n">RuleIDs</span><span class="p">:</span>
 1453         <span class="n">RuleIndex</span> <span class="o">+=</span> <span class="mi">1</span>
 1454         <span class="n">Outfile</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OutfilesRoot</span><span class="p">,</span> <span class="n">RuleIndex</span><span class="p">,</span> <span class="n">OutfilesExt</span><span class="p">)</span>
 1455         <span class="n">Writer</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">MoleculesWriter</span><span class="p">(</span><span class="n">Outfile</span><span class="p">,</span> <span class="o">**</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileParams&quot;</span><span class="p">])</span>
 1456         <span class="k">if</span> <span class="n">Writer</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1457             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Failed to setup a writer for output fie </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">Outfile</span><span class="p">)</span>
 1458             
 1459         <span class="n">OutfilesWriters</span><span class="p">[</span><span class="n">RuleID</span><span class="p">]</span> <span class="o">=</span> <span class="n">Writer</span>
 1460 
 1461     <span class="k">return</span> <span class="n">OutfilesWriters</span>
 1462 
 1463 <span class="k">def</span> <span class="nf">CloseByRuleOutfilesWriters</span><span class="p">(</span><span class="n">OutfilesWriters</span><span class="p">):</span>
 1464     <span class="sd">&quot;&quot;&quot;Close by rule outfile writers.&quot;&quot;&quot;</span>
 1465 
 1466     <span class="k">for</span> <span class="n">RuleID</span><span class="p">,</span> <span class="n">Writer</span> <span class="ow">in</span> <span class="n">OutfilesWriters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
 1467         <span class="k">if</span> <span class="n">Writer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
 1468             <span class="n">Writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
 1469 
 1470 <span class="k">def</span> <span class="nf">ProcessTorsionLibraryInfo</span><span class="p">():</span>
 1471     <span class="sd">&quot;&quot;&quot;Process torsion library information.&quot;&quot;&quot;</span>
 1472 
 1473     <span class="n">RetrieveTorsionLibraryInfo</span><span class="p">()</span>
 1474     <span class="n">ListTorsionLibraryInfo</span><span class="p">()</span>
 1475 
 1476 <span class="k">def</span> <span class="nf">RetrieveTorsionLibraryInfo</span><span class="p">(</span><span class="n">Quiet</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
 1477     <span class="sd">&quot;&quot;&quot;Retrieve torsion library information.&quot;&quot;&quot;</span>
 1478     
 1479     <span class="n">TorsionLibraryFilePath</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionEnergyLibraryFile&quot;</span><span class="p">]</span>
 1480     <span class="k">if</span> <span class="n">TorsionLibraryFilePath</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1481         <span class="n">TorsionLibraryFile</span> <span class="o">=</span> <span class="s2">&quot;TorsionStrainEnergyLibrary.xml&quot;</span>
 1482         <span class="n">MayaChemToolsDataDir</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">GetMayaChemToolsLibDataPath</span><span class="p">()</span>
 1483         <span class="n">TorsionLibraryFilePath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MayaChemToolsDataDir</span><span class="p">,</span> <span class="n">TorsionLibraryFile</span><span class="p">)</span>
 1484         <span class="k">if</span> <span class="ow">not</span> <span class="n">Quiet</span><span class="p">:</span>
 1485             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Retrieving data from default torsion strain energy library file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">TorsionLibraryFile</span><span class="p">)</span>
 1486     <span class="k">else</span><span class="p">:</span>
 1487         <span class="n">TorsionLibraryFilePath</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionEnergyLibraryFile&quot;</span><span class="p">]</span>
 1488         <span class="k">if</span> <span class="ow">not</span> <span class="n">Quiet</span><span class="p">:</span>
 1489             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Retrieving data from torsion strain energy library file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">TorsionLibraryFilePath</span><span class="p">)</span>
 1490         
 1491     <span class="n">TorsionLibraryInfo</span><span class="p">[</span><span class="s2">&quot;TorsionLibElementTree&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TorsionLibraryUtil</span><span class="o">.</span><span class="n">RetrieveTorsionLibraryInfo</span><span class="p">(</span><span class="n">TorsionLibraryFilePath</span><span class="p">)</span>
 1492 
 1493 <span class="k">def</span> <span class="nf">ListTorsionLibraryInfo</span><span class="p">():</span>
 1494     <span class="sd">&quot;&quot;&quot;List torsion library information.&quot;&quot;&quot;</span>
 1495     
 1496     <span class="n">TorsionLibraryUtil</span><span class="o">.</span><span class="n">ListTorsionLibraryInfo</span><span class="p">(</span><span class="n">TorsionLibraryInfo</span><span class="p">[</span><span class="s2">&quot;TorsionLibElementTree&quot;</span><span class="p">])</span>
 1497 
 1498 <span class="k">def</span> <span class="nf">SetupTorsionLibraryInfo</span><span class="p">(</span><span class="n">Quiet</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
 1499     <span class="sd">&quot;&quot;&quot;Setup torsion library information for matching rotatable bonds.&quot;&quot;&quot;</span>
 1500 
 1501     <span class="k">if</span> <span class="ow">not</span> <span class="n">Quiet</span><span class="p">:</span>
 1502         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Setting up torsion library information for matching rotatable bonds...&quot;</span><span class="p">)</span>
 1503 
 1504     <span class="n">TorsionLibraryUtil</span><span class="o">.</span><span class="n">SetupTorsionLibraryInfoForMatchingRotatableBonds</span><span class="p">(</span><span class="n">TorsionLibraryInfo</span><span class="p">)</span>
 1505     
 1506 <span class="k">def</span> <span class="nf">ProcessRotatableBondsSMARTSMode</span><span class="p">():</span>
 1507     <span class="sd">&quot;&quot;&quot;&quot;Process SMARTS pattern for rotatable bonds.&quot;&quot;&quot;</span>
 1508 
 1509     <span class="n">RotBondsMode</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RotBondsSMARTSMode&quot;</span><span class="p">]</span>
 1510     <span class="n">RotBondsSMARTSPattern</span> <span class="o">=</span> <span class="bp">None</span>
 1511     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;NonStrict&quot;</span><span class="p">,</span> <span class="n">RotBondsMode</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1512         <span class="n">RotBondsSMARTSPattern</span> <span class="o">=</span> <span class="s2">&quot;[!$(*#*)&amp;!D1]-&amp;!@[!$(*#*)&amp;!D1]&quot;</span>
 1513     <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;SemiStrict&quot;</span><span class="p">,</span> <span class="n">RotBondsMode</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1514         <span class="n">RotBondsSMARTSPattern</span> <span class="o">=</span> <span class="s2">&quot;[!$(*#*)&amp;!D1&amp;!$(C(F)(F)F)&amp;!$(C(Cl)(Cl)Cl)&amp;!$(C(Br)(Br)Br)&amp;!$(C([CH3])([CH3])[CH3])]-!@[!$(*#*)&amp;!D1&amp;!$(C(F)(F)F)&amp;!$(C(Cl)(Cl)Cl)&amp;!$(C(Br)(Br)Br)&amp;!$(C([CH3])([CH3])[CH3])]&quot;</span>
 1515     <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;Strict&quot;</span><span class="p">,</span> <span class="n">RotBondsMode</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1516         <span class="n">RotBondsSMARTSPattern</span> <span class="o">=</span> <span class="s2">&quot;[!$(*#*)&amp;!D1&amp;!$(C(F)(F)F)&amp;!$(C(Cl)(Cl)Cl)&amp;!$(C(Br)(Br)Br)&amp;!$(C([CH3])([CH3])[CH3])&amp;!$([CD3](=[N,O,S])-!@[#7,O,S!D1])&amp;!$([#7,O,S!D1]-!@[CD3]=[N,O,S])&amp;!$([CD3](=[N+])-!@[#7!D1])&amp;!$([#7!D1]-!@[CD3]=[N+])]-!@[!$(*#*)&amp;!D1&amp;!$(C(F)(F)F)&amp;!$(C(Cl)(Cl)Cl)&amp;!$(C(Br)(Br)Br)&amp;!$(C([CH3])([CH3])[CH3])]&quot;</span>
 1517     <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;Specify&quot;</span><span class="p">,</span> <span class="n">RotBondsMode</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1518         <span class="n">RotBondsSMARTSPattern</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RotBondsSMARTSPatternSpecified&quot;</span><span class="p">]</span>
 1519         <span class="n">RotBondsSMARTSPattern</span> <span class="o">=</span> <span class="n">RotBondsSMARTSPattern</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
 1520         <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">RotBondsSMARTSPattern</span><span class="p">):</span>
 1521             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Empty value specified for SMILES/SMARTS pattern in  </span><span class="se">\&quot;</span><span class="s2">--rotBondsSMARTSPattern</span><span class="se">\&quot;</span><span class="s2"> option, </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">RotBondsMode</span><span class="p">)</span>
 1522     <span class="k">else</span><span class="p">:</span>
 1523         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The value, </span><span class="si">%s</span><span class="s2">, specified for option </span><span class="se">\&quot;</span><span class="s2">-r, --rotBondsSMARTSMode</span><span class="se">\&quot;</span><span class="s2"> is not valid. &quot;</span> <span class="o">%</span> <span class="n">RotBondsMode</span><span class="p">)</span>
 1524         
 1525     <span class="n">RotBondsPatternMol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="n">RotBondsSMARTSPattern</span><span class="p">)</span>
 1526     <span class="k">if</span> <span class="n">RotBondsPatternMol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1527         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;Specify&quot;</span><span class="p">,</span> <span class="n">RotBondsMode</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1528             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Failed to create rotatable bonds pattern molecule. The rotatable bonds SMARTS pattern, </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="s2">--rotBondsSMARTSPattern</span><span class="se">\&quot;</span><span class="s2"> option is not valid.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">RotBondsSMARTSPattern</span><span class="p">))</span>
 1529         <span class="k">else</span><span class="p">:</span>
 1530             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Failed to create rotatable bonds pattern molecule. The default rotatable bonds SMARTS pattern, </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">, used for, </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">, value of  </span><span class="se">\&quot;</span><span class="s2">-r, --rotBondsSMARTSMode</span><span class="se">\&quot;</span><span class="s2"> option is not valid.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">RotBondsSMARTSPattern</span><span class="p">,</span> <span class="n">RotBondsMode</span><span class="p">))</span>
 1531     
 1532     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RotBondsSMARTSPattern&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RotBondsSMARTSPattern</span>
 1533 
 1534 <span class="k">def</span> <span class="nf">ProcessSDFieldLabelsOption</span><span class="p">():</span>
 1535     <span class="sd">&quot;&quot;&quot;Process SD data field label option.&quot;&quot;&quot;</span>
 1536 
 1537     <span class="n">ParamsOptionName</span> <span class="o">=</span> <span class="s2">&quot;--outfileSDFieldLabels&quot;</span>
 1538     <span class="n">ParamsOptionValue</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfileSDFieldLabels&quot;</span><span class="p">]</span>
 1539 
 1540     <span class="n">ParamsIDsToLabels</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;RotBondsCountLabel&quot;</span><span class="p">:</span> <span class="s2">&quot;RotBondsCount&quot;</span><span class="p">,</span> <span class="s2">&quot;TotalEnergyLabel&quot;</span><span class="p">:</span> <span class="s2">&quot;TotalEnergy&quot;</span><span class="p">,</span> <span class="s2">&quot;TotalEnergyLowerBoundCILabel&quot;</span><span class="p">:</span> <span class="s2">&quot;TotalEnergyLowerBoundCI&quot;</span><span class="p">,</span> <span class="s2">&quot;TotalEnergyUpperBoundCILabel&quot;</span><span class="p">:</span> <span class="s2">&quot;TotalEnergyUpperBoundCI&quot;</span><span class="p">,</span> <span class="s2">&quot;MaxSingleEnergyLabel&quot;</span><span class="p">:</span> <span class="s2">&quot;MaxSingleEnergy&quot;</span><span class="p">,</span> <span class="s2">&quot;MaxSingleEnergyAlertsCountLabel&quot;</span><span class="p">:</span> <span class="s2">&quot;MaxSingleEnergyAlertsCount&quot;</span><span class="p">,</span> <span class="s2">&quot;AnglesNotObservedCountLabel&quot;</span><span class="p">:</span> <span class="s2">&quot;AnglesNotObservedCount&quot;</span><span class="p">,</span> <span class="s2">&quot;TorsionAlertsLabel&quot;</span><span class="p">:</span> <span class="s2">&quot;TorsionAlerts(RotBondIndices TorsionIndices TorsionAngle Energy EnergyLowerBoundCI EnergyUpperBoundCI HierarchyClass HierarchySubClass TorsionRule EnergyMethod AngleNotObserved MaxSingleEnergyAlert)&quot;</span><span class="p">,</span> <span class="s2">&quot;TorsionRuleLabel&quot;</span><span class="p">:</span> <span class="s2">&quot;TorsionRule (HierarchyClass HierarchySubClass TorsionRule EnergyMethod)&quot;</span><span class="p">,</span> <span class="s2">&quot;TorsionRuleMaxSingleEnergyAlertsCountLabel&quot;</span><span class="p">:</span> <span class="s2">&quot;TorsionRuleMaxSingleEnergyAlertsCount&quot;</span><span class="p">,</span> <span class="s2">&quot;TorsionRuleAnglesNotObservedCountLabel&quot;</span><span class="p">:</span> <span class="s2">&quot;TorsionRuleAnglesNotObservedCount&quot;</span><span class="p">,</span> <span class="s2">&quot;TorsionRuleAlertsLabel&quot;</span><span class="p">:</span> <span class="s2">&quot;TorsionRuleAlerts (RotBondIndices TorsionIndices TorsionAngle Energy EnergyLowerBoundCI EnergyUpperBoundCI AngleNotObserved MaxSingleEnergyAlert)&quot;</span><span class="p">}</span>
 1541 
 1542     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">ParamsOptionValue</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1543         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SDFieldIDsToLabels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ParamsIDsToLabels</span>
 1544         <span class="k">return</span>
 1545     
 1546     <span class="c1"># Setup a canonical paramater names...</span>
 1547     <span class="n">ValidParamNames</span> <span class="o">=</span> <span class="p">[]</span>
 1548     <span class="n">CanonicalParamNamesMap</span> <span class="o">=</span> <span class="p">{}</span>
 1549     <span class="k">for</span> <span class="n">ParamName</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ParamsIDsToLabels</span><span class="p">):</span>
 1550         <span class="n">ValidParamNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ParamName</span><span class="p">)</span>
 1551         <span class="n">CanonicalParamNamesMap</span><span class="p">[</span><span class="n">ParamName</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">ParamName</span>
 1552     
 1553     <span class="n">ParamsOptionValue</span> <span class="o">=</span> <span class="n">ParamsOptionValue</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
 1554     <span class="k">if</span> <span class="ow">not</span> <span class="n">ParamsOptionValue</span><span class="p">:</span>
 1555         <span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;No valid parameter name and value pairs specified using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> option&quot;</span> <span class="o">%</span> <span class="n">ParamsOptionName</span><span class="p">)</span>
 1556     
 1557     <span class="n">ParamsOptionValueWords</span> <span class="o">=</span> <span class="n">ParamsOptionValue</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
 1558     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ParamsOptionValueWords</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
 1559         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The number of comma delimited paramater names and values, </span><span class="si">%d</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> option must be an even number.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ParamsOptionValueWords</span><span class="p">),</span> <span class="n">ParamsOptionName</span><span class="p">))</span>
 1560     
 1561     <span class="c1"># Validate paramater name and value pairs...</span>
 1562     <span class="k">for</span> <span class="n">Index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ParamsOptionValueWords</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
 1563         <span class="n">Name</span> <span class="o">=</span> <span class="n">ParamsOptionValueWords</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
 1564         <span class="n">Value</span> <span class="o">=</span> <span class="n">ParamsOptionValueWords</span><span class="p">[</span><span class="n">Index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
 1565 
 1566         <span class="n">CanonicalName</span> <span class="o">=</span> <span class="n">Name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
 1567         <span class="k">if</span>  <span class="ow">not</span> <span class="n">CanonicalName</span> <span class="ow">in</span> <span class="n">CanonicalParamNamesMap</span><span class="p">:</span>
 1568             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The parameter name, </span><span class="si">%s</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> is not a valid name. Supported parameter names: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Name</span><span class="p">,</span> <span class="n">ParamsOptionName</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ValidParamNames</span><span class="p">)))</span>
 1569 
 1570         <span class="n">ParamName</span> <span class="o">=</span> <span class="n">CanonicalParamNamesMap</span><span class="p">[</span><span class="n">CanonicalName</span><span class="p">]</span>
 1571         <span class="n">ParamValue</span> <span class="o">=</span> <span class="n">Value</span>
 1572         
 1573         <span class="c1"># Set value...</span>
 1574         <span class="n">ParamsIDsToLabels</span><span class="p">[</span><span class="n">ParamName</span><span class="p">]</span> <span class="o">=</span> <span class="n">ParamValue</span>
 1575     
 1576     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SDFieldIDsToLabels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ParamsIDsToLabels</span>
 1577 
 1578 <span class="k">def</span> <span class="nf">ProcessOptions</span><span class="p">():</span>
 1579     <span class="sd">&quot;&quot;&quot;Process and validate command line arguments and options.&quot;&quot;&quot;</span>
 1580     
 1581     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Processing options...&quot;</span><span class="p">)</span>
 1582 
 1583     <span class="c1"># Validate options...</span>
 1584     <span class="n">ValidateOptions</span><span class="p">()</span>
 1585     
 1586     <span class="n">TotalEnergyMode</span><span class="p">,</span> <span class="n">MaxSingleEnergyMode</span><span class="p">,</span> <span class="n">TotalOrMaxSingleEnergyMode</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
 1587     <span class="n">AlertsMode</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alertsMode&quot;</span><span class="p">]</span>
 1588     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^TotalEnergy$&quot;</span><span class="p">,</span> <span class="n">AlertsMode</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1589         <span class="n">TotalEnergyMode</span> <span class="o">=</span> <span class="bp">True</span>
 1590     <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^MaxSingleEnergy$&quot;</span><span class="p">,</span> <span class="n">AlertsMode</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1591         <span class="n">MaxSingleEnergyMode</span> <span class="o">=</span> <span class="bp">True</span>
 1592     <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^TotalOrMaxSingleEnergy$&quot;</span><span class="p">,</span> <span class="n">AlertsMode</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1593         <span class="n">TotalOrMaxSingleEnergyMode</span> <span class="o">=</span> <span class="bp">True</span>
 1594     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;AlertsMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AlertsMode</span>
 1595     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TotalEnergyMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TotalEnergyMode</span>
 1596     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MaxSingleEnergyMode</span>
 1597     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TotalOrMaxSingleEnergyMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TotalOrMaxSingleEnergyMode</span>
 1598     
 1599     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;FilterTorsionsNotObserved&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--filterTorsionsNotObserved&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1600     
 1601     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MaxSingleEnergyCutoff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alertsMaxSingleEnergyCutoff&quot;</span><span class="p">])</span>
 1602     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TotalEnergyCutoff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alertsTotalEnergyCutoff&quot;</span><span class="p">])</span>
 1603     
 1604     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Infile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infile&quot;</span><span class="p">]</span>
 1605     <span class="n">ParamsDefaultInfoOverride</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;RemoveHydrogens&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">}</span>
 1606     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfileParams&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ProcessOptionInfileParameters</span><span class="p">(</span><span class="s2">&quot;--infileParams&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infileParams&quot;</span><span class="p">],</span> <span class="n">InfileName</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infile&quot;</span><span class="p">],</span> <span class="n">ParamsDefaultInfo</span> <span class="o">=</span> <span class="n">ParamsDefaultInfoOverride</span><span class="p">)</span>
 1607     
 1608     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">]</span>
 1609     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileParams&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ProcessOptionOutfileParameters</span><span class="p">(</span><span class="s2">&quot;--outfileParams&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfileParams&quot;</span><span class="p">],</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infile&quot;</span><span class="p">],</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">])</span>
 1610     
 1611     <span class="n">FileDir</span><span class="p">,</span> <span class="n">FileName</span><span class="p">,</span> <span class="n">FileExt</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ParseFileName</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">])</span>
 1612     <span class="n">OutfileFiltered</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_Filtered.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">FileName</span><span class="p">,</span> <span class="n">FileExt</span><span class="p">)</span>
 1613     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileFiltered&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OutfileFiltered</span>
 1614     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileFilteredMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfileFiltered&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1615 
 1616     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileSummary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_AlertsSummary.csv&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">FileName</span><span class="p">)</span>
 1617 
 1618     <span class="n">OutfileSummaryMode</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfileSummary&quot;</span><span class="p">]</span>
 1619     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">OutfileSummaryMode</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1620         <span class="n">OutfileSummaryMode</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^MaxSingleEnergy$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alertsMode&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;no&#39;</span>
 1621     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileSummaryMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^yes$&quot;</span><span class="p">,</span> <span class="n">OutfileSummaryMode</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1622     
 1623     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfileSummary&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1624         <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^MaxSingleEnergy$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alertsMode&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1625             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The value </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> specified for </span><span class="se">\&quot;</span><span class="s2">--outfileSummary</span><span class="se">\&quot;</span><span class="s2"> option is not valid. The specified value is only allowed during </span><span class="se">\&quot;</span><span class="s2">MaxSingleEnergy</span><span class="se">\&quot;</span><span class="s2"> value of </span><span class="se">\&quot;</span><span class="s2">-a, --alertsMode</span><span class="se">\&quot;</span><span class="s2"> option.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfileSummary&quot;</span><span class="p">]))</span>
 1626     
 1627     <span class="n">OutfilesFilteredByRulesMode</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfilesFilteredByRules&quot;</span><span class="p">]</span>
 1628     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">OutfilesFilteredByRulesMode</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1629         <span class="n">OutfilesFilteredByRulesMode</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^MaxSingleEnergy$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alertsMode&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;no&#39;</span>
 1630     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesFilteredByRulesMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^yes$&quot;</span><span class="p">,</span> <span class="n">OutfilesFilteredByRulesMode</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1631     
 1632     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfilesFilteredByRules&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1633         <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^MaxSingleEnergy$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alertsMode&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1634             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The value </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> specified for </span><span class="se">\&quot;</span><span class="s2">--outfilesFilteredByRules</span><span class="se">\&quot;</span><span class="s2"> option is not valid. The specified value is only allowed during </span><span class="se">\&quot;</span><span class="s2">MaxSingleEnergy</span><span class="se">\&quot;</span><span class="s2"> value of </span><span class="se">\&quot;</span><span class="s2">-a, --alertsMode</span><span class="se">\&quot;</span><span class="s2"> option.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfileSummary&quot;</span><span class="p">]))</span>
 1635     
 1636     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TrackAlertsSummaryInfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileSummaryMode&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesFilteredByRulesMode&quot;</span><span class="p">])</span> <span class="k">else</span> <span class="bp">False</span>
 1637     
 1638     <span class="n">OutfilesFilteredByRulesMaxCount</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfilesFilteredByRulesMaxCount&quot;</span><span class="p">]</span>
 1639     <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^All$&quot;</span><span class="p">,</span> <span class="n">OutfilesFilteredByRulesMaxCount</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1640         <span class="n">OutfilesFilteredByRulesMaxCount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">OutfilesFilteredByRulesMaxCount</span><span class="p">)</span>
 1641     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesFilteredByRulesMaxCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OutfilesFilteredByRulesMaxCount</span>
 1642     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesFilteredByRulesAllMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^All$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfilesFilteredByRulesMaxCount&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1643     
 1644     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileAlerts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfileAlerts&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1645     
 1646     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfilesFilteredByRules&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1647         <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfileAlerts&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1648             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The value </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> specified for </span><span class="se">\&quot;</span><span class="s2">--outfilesFilteredByRules</span><span class="se">\&quot;</span><span class="s2"> option is not valid. The specified value is only allowed during </span><span class="se">\&quot;</span><span class="s2">yes</span><span class="se">\&quot;</span><span class="s2"> value of </span><span class="se">\&quot;</span><span class="s2">--outfileAlerts</span><span class="se">\&quot;</span><span class="s2"> option.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfilesFilteredByRules&quot;</span><span class="p">]))</span>
 1649     
 1650     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileAlertsMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfileAlertsMode&quot;</span><span class="p">]</span>
 1651     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileAlertsOnly&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^AlertsOnly$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfileAlertsMode&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1652     
 1653     <span class="n">ProcessSDFieldLabelsOption</span><span class="p">()</span>
 1654     
 1655     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Overwrite&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--overwrite&quot;</span><span class="p">]</span>
 1656     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;CountMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^count$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--mode&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1657 
 1658     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Precision&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--precision&quot;</span><span class="p">])</span>
 1659     
 1660     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MPMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--mp&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1661     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MPParams&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ProcessOptionMultiprocessingParameters</span><span class="p">(</span><span class="s2">&quot;--mpParams&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--mpParams&quot;</span><span class="p">])</span>
 1662     
 1663     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RotBondsSMARTSMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--rotBondsSMARTSMode&quot;</span><span class="p">]</span>
 1664     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RotBondsSMARTSPatternSpecified&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--rotBondsSMARTSPattern&quot;</span><span class="p">]</span>
 1665     <span class="n">ProcessRotatableBondsSMARTSMode</span><span class="p">()</span>
 1666     
 1667     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionEnergyLibraryFile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
 1668     <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--torsionEnergyLibraryFile&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1669         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionEnergyLibraryFile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--torsionEnergyLibraryFile&quot;</span><span class="p">]</span>
 1670     
 1671     <span class="c1"># Setup delimiter for writing out torsion alert information to output files...</span>
 1672     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;IntraSetValuesDelim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span>
 1673     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InterSetValuesDelim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span>
 1674     
 1675 <span class="k">def</span> <span class="nf">RetrieveOptions</span><span class="p">():</span>
 1676     <span class="sd">&quot;&quot;&quot;Retrieve command line arguments and options.&quot;&quot;&quot;</span>
 1677     
 1678     <span class="c1"># Get options...</span>
 1679     <span class="k">global</span> <span class="n">Options</span>
 1680     <span class="n">Options</span> <span class="o">=</span> <span class="n">docopt</span><span class="p">(</span><span class="n">_docoptUsage_</span><span class="p">)</span>
 1681     
 1682     <span class="c1"># Set current working directory to the specified directory...</span>
 1683     <span class="n">WorkingDir</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--workingdir&quot;</span><span class="p">]</span>
 1684     <span class="k">if</span> <span class="n">WorkingDir</span><span class="p">:</span>
 1685         <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">WorkingDir</span><span class="p">)</span>
 1686     
 1687     <span class="c1"># Handle examples option...</span>
 1688     <span class="k">if</span> <span class="s2">&quot;--examples&quot;</span> <span class="ow">in</span> <span class="n">Options</span> <span class="ow">and</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--examples&quot;</span><span class="p">]:</span>
 1689         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="n">MiscUtil</span><span class="o">.</span><span class="n">GetExamplesTextFromDocOptText</span><span class="p">(</span><span class="n">_docoptUsage_</span><span class="p">))</span>
 1690         <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
 1691     
 1692 <span class="k">def</span> <span class="nf">ProcessListTorsionLibraryOption</span><span class="p">():</span>
 1693     <span class="sd">&quot;&quot;&quot;Process list torsion library information.&quot;&quot;&quot;</span>
 1694 
 1695     <span class="c1"># Validate and process dataFile option for listing torsion library information...</span>
 1696     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionEnergyLibraryFile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
 1697     <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--torsionEnergyLibraryFile&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1698         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFilePath</span><span class="p">(</span><span class="s2">&quot;-t, --torsionEnergyLibraryFile&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--torsionEnergyLibraryFile&quot;</span><span class="p">])</span>
 1699         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;TorsionEnergyLibraryFile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--torsionEnergyLibraryFile&quot;</span><span class="p">]</span>
 1700     
 1701     <span class="n">RetrieveTorsionLibraryInfo</span><span class="p">()</span>
 1702     <span class="n">ListTorsionLibraryInfo</span><span class="p">()</span>
 1703     
 1704 <span class="k">def</span> <span class="nf">ValidateOptions</span><span class="p">():</span>
 1705     <span class="sd">&quot;&quot;&quot;Validate option values.&quot;&quot;&quot;</span>
 1706 
 1707     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;-a, --alertsMode&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alertsMode&quot;</span><span class="p">],</span> <span class="s2">&quot;TotalEnergy MaxSingleEnergy TotalOrMaxSingleEnergy&quot;</span><span class="p">)</span>
 1708     
 1709     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFloatValue</span><span class="p">(</span><span class="s2">&quot;--alertsMaxSingleEnergyCutoff&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alertsMaxSingleEnergyCutoff&quot;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
 1710     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFloatValue</span><span class="p">(</span><span class="s2">&quot;--alertsTotalEnergyCutoff&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alertsTotalEnergyCutoff&quot;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
 1711     
 1712     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--filterTorsionsNotObserved&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--filterTorsionsNotObserved&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1713     
 1714     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFilePath</span><span class="p">(</span><span class="s2">&quot;-i, --infile&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infile&quot;</span><span class="p">])</span>
 1715     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFileExt</span><span class="p">(</span><span class="s2">&quot;-i, --infile&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infile&quot;</span><span class="p">],</span> <span class="s2">&quot;sdf sd mol&quot;</span><span class="p">)</span>
 1716     
 1717     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFileExt</span><span class="p">(</span><span class="s2">&quot;-o, --outfile&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">],</span> <span class="s2">&quot;sdf sd&quot;</span><span class="p">)</span>
 1718     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^filter$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--mode&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1719         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionsOutputFileOverwrite</span><span class="p">(</span><span class="s2">&quot;-o, --outfile&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">],</span> <span class="s2">&quot;--overwrite&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--overwrite&quot;</span><span class="p">])</span>
 1720         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionsDistinctFileNames</span><span class="p">(</span><span class="s2">&quot;-i, --infile&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infile&quot;</span><span class="p">],</span> <span class="s2">&quot;-o, --outfile&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">])</span>
 1721 
 1722     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--outfileFiltered&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfileFiltered&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1723     
 1724     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--outfilesFilteredByRules&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfilesFilteredByRules&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no auto&quot;</span><span class="p">)</span>
 1725     <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^All$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfilesFilteredByRulesMaxCount&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1726         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionIntegerValue</span><span class="p">(</span><span class="s2">&quot;--outfilesFilteredByRulesMaxCount&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfilesFilteredByRulesMaxCount&quot;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
 1727     
 1728     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--outfileSummary&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfileSummary&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no auto&quot;</span><span class="p">)</span>
 1729     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--outfileAlerts&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfileAlerts&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1730     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--outfileAlertsMode&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfileAlertsMode&quot;</span><span class="p">],</span> <span class="s2">&quot;All AlertsOnly&quot;</span><span class="p">)</span>
 1731     
 1732     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;-m, --mode&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--mode&quot;</span><span class="p">],</span> <span class="s2">&quot;filter count&quot;</span><span class="p">)</span>
 1733     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^filter$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--mode&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1734         <span class="k">if</span> <span class="ow">not</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">]:</span>
 1735             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The outfile must be specified using </span><span class="se">\&quot;</span><span class="s2">-o, --outfile</span><span class="se">\&quot;</span><span class="s2"> during </span><span class="se">\&quot;</span><span class="s2">filter</span><span class="se">\&quot;</span><span class="s2"> value of </span><span class="se">\&quot;</span><span class="s2">-m, --mode</span><span class="se">\&quot;</span><span class="s2"> option&quot;</span><span class="p">)</span>
 1736         
 1737     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--mp&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--mp&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1738     
 1739     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionIntegerValue</span><span class="p">(</span><span class="s2">&quot;-p, --precision&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--precision&quot;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
 1740     
 1741     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;-r, --rotBondsSMARTSMode&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--rotBondsSMARTSMode&quot;</span><span class="p">],</span> <span class="s2">&quot;NonStrict SemiStrict Strict Specify&quot;</span><span class="p">)</span>
 1742     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Specify$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--rotBondsSMARTSMode&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1743         <span class="k">if</span> <span class="ow">not</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--rotBondsSMARTSPattern&quot;</span><span class="p">]:</span>
 1744             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The SMARTS pattern must be specified using </span><span class="se">\&quot;</span><span class="s2">--rotBondsSMARTSPattern</span><span class="se">\&quot;</span><span class="s2"> during </span><span class="se">\&quot;</span><span class="s2">Specify</span><span class="se">\&quot;</span><span class="s2"> value of </span><span class="se">\&quot;</span><span class="s2">-r, --rotBondsSMARTS</span><span class="se">\&quot;</span><span class="s2"> option&quot;</span><span class="p">)</span>
 1745     
 1746     <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--torsionEnergyLibraryFile&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1747         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFilePath</span><span class="p">(</span><span class="s2">&quot;-t, --torsionEnergyLibraryFile&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--torsionEnergyLibraryFile&quot;</span><span class="p">])</span>
 1748 
 1749 <span class="c1"># Setup a usage string for docopt...</span>
 1750 <span class="n">_docoptUsage_</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
 1751 <span class="s2">RDKitFilterTorsionStrainEnergyAlerts.py - Filter torsion strain energy library alerts</span>
 1752 
 1753 <span class="s2">Usage:</span>
 1754 <span class="s2">    RDKitFilterTorsionStrainEnergyAlerts.py [--alertsMode &lt;TotalEnergy, MaxSingleEnergy, or TotalOrMaxSingleEnergy&gt;]</span>
 1755 <span class="s2">                                            [--alertsMaxSingleEnergyCutoff &lt;Number&gt;] [--alertsTotalEnergyCutoff &lt;Number&gt;]</span>
 1756 <span class="s2">                                            [--filterTorsionsNotObserved &lt;yes or no&gt;] [--infileParams &lt;Name,Value,...&gt;] [--mode &lt;filter or count&gt;]</span>
 1757 <span class="s2">                                            [--mp &lt;yes or no&gt;] [--mpParams &lt;Name,Value,...&gt;] [--outfileAlerts &lt;yes or no&gt;]</span>
 1758 <span class="s2">                                            [--outfileAlertsMode &lt;All or AlertsOnly&gt;] [--outfileFiltered &lt;yes or no&gt;]</span>
 1759 <span class="s2">                                            [--outfilesFilteredByRules &lt;yes or no&gt;] [--outfilesFilteredByRulesMaxCount &lt;All or number&gt;]</span>
 1760 <span class="s2">                                            [--outfileSummary &lt;yes or no&gt;] [--outfileSDFieldLabels &lt;Type,Label,...&gt;] [--outfileParams &lt;Name,Value,...&gt;]</span>
 1761 <span class="s2">                                            [--overwrite] [--precision &lt;number&gt;] [ --rotBondsSMARTSMode &lt;NonStrict, SemiStrict,...&gt;]</span>
 1762 <span class="s2">                                            [--rotBondsSMARTSPattern &lt;SMARTS&gt;] [--torsionEnergyLibraryFile &lt;FileName or auto&gt;]</span>
 1763 <span class="s2">                                            [-w &lt;dir&gt;] -i &lt;infile&gt; -o &lt;outfile&gt;</span>
 1764 <span class="s2">    RDKitFilterTorsionStrainEnergyAlerts.py [--torsionEnergyLibraryFile &lt;FileName or auto&gt;] -l | --list</span>
 1765 <span class="s2">    RDKitFilterTorsionStrainEnergyAlerts.py -h | --help | -e | --examples</span>
 1766 
 1767 <span class="s2">Description:</span>
 1768 <span class="s2">    Filter strained molecules from an input file for torsion strain energy library</span>
 1769 <span class="s2">    [ Ref 153 ] alerts by matching rotatable bonds against SMARTS patterns specified</span>
 1770 <span class="s2">    for torsion rules in a torsion energy library file and write out appropriate</span>
 1771 <span class="s2">    molecules to output files. The molecules must have 3D coordinates in input file.</span>
 1772 <span class="s2">    The default torsion strain energy library file, TorsionStrainEnergyLibrary.xml,</span>
 1773 <span class="s2">    is available under MAYACHEMTOOLS/lib/data directory.</span>
 1774 <span class="s2">    </span>
 1775 <span class="s2">    The data in torsion strain energy library file is organized in a hierarchical</span>
 1776 <span class="s2">    manner. It consists of one generic class and six specific classes at the highest</span>
 1777 <span class="s2">    level. Each class contains multiple subclasses corresponding to named functional</span>
 1778 <span class="s2">    groups or substructure patterns. The subclasses consist of torsion rules sorted</span>
 1779 <span class="s2">    from specific to generic torsion patterns. The torsion rule, in turn, contains a</span>
 1780 <span class="s2">    list of peak values for torsion angles and two tolerance values. A pair of tolerance</span>
 1781 <span class="s2">    values define torsion bins around a torsion peak value.</span>
 1782 <span class="s2">    </span>
 1783 <span class="s2">    A strain energy calculation method, &#39;exact&#39; or &#39;approximate&#39; [ Ref 153 ], is </span>
 1784 <span class="s2">    associated with each torsion rule for calculating torsion strain energy. The &#39;exact&#39;</span>
 1785 <span class="s2">    stain energy calculation relies on the energy bins available under the energy histogram</span>
 1786 <span class="s2">    consisting of 36 bins covering angles from -180 to 180. The width of each bin is 10</span>
 1787 <span class="s2">    degree. The energy bins are are defined at the right end points. The first and the</span>
 1788 <span class="s2">    last energy bins correspond to -170 and 180 respectively. The torsion angle is mapped</span>
 1789 <span class="s2">    to a energy bin. An angle offset is calculated for the torsion angle from the the right</span>
 1790 <span class="s2">    end point angle of the bin. The strain energy is estimated for the angle offset based</span>
 1791 <span class="s2">    on the energy difference between the current and previous bins. The torsion strain</span>
 1792 <span class="s2">    energy, in terms of torsion energy units (TEUs), corresponds to the sum of bin strain</span>
 1793 <span class="s2">    energy and the angle offset strain energy.</span>
 1794 <span class="s2">        </span>
 1795 <span class="s2">        Energy = BinEnergyDiff/10.0 * BinAngleOffset + BinEnergy[BinNum]</span>
 1796 <span class="s2">        </span>
 1797 <span class="s2">        Where:</span>
 1798 <span class="s2">        </span>
 1799 <span class="s2">        BinEnergyDiff = BinEnergy[BinNum] - BinEnergy[PreviousBinNum]</span>
 1800 <span class="s2">        BinAngleOffset = TorsionAngle - BinAngleRightSide</span>
 1801 <span class="s2">        </span>
 1802 <span class="s2">    The &#39;approximate&#39; strain energy calculation relies on the angle difference between a</span>
 1803 <span class="s2">    torsion angle and the torsion peaks observed for the torsion rules in the torsion</span>
 1804 <span class="s2">    energy library. The torsion angle is matched to a torsion peak based on the value of</span>
 1805 <span class="s2">    torsion angle difference. It must be less than or equal to the value for the second</span>
 1806 <span class="s2">    tolerance &#39;tolerance2&#39;. Otherwise, the torsion angle is not observed in the torsion</span>
 1807 <span class="s2">    energy library and a value of &#39;NA&#39; is assigned for torsion energy along with the lower</span>
 1808 <span class="s2">    and upper bounds on energy at 95</span><span class="si">% c</span><span class="s2">onfidence interval. The &#39;approximate&#39; torsion</span>
 1809 <span class="s2">    energy (TEUs) for observed torsion angle is calculated using the following formula:</span>
 1810 <span class="s2">        </span>
 1811 <span class="s2">        Energy = beta_1 * (AngleDiff ** 2) + beta_2 * (AngleDiff ** 4)</span>
 1812 <span class="s2">        </span>
 1813 <span class="s2">    The coefficients &#39;beta_1&#39; and &#39;beta_2&#39; are available for the observed angles in </span>
 1814 <span class="s2">    the torsion strain energy library. The &#39;AngleDiff&#39; is the difference between the</span>
 1815 <span class="s2">    torsion angle and the matched torsion peak.</span>
 1816 <span class="s2">    </span>
 1817 <span class="s2">    For example:</span>
 1818 <span class="s2">         </span>
 1819 <span class="s2">        &lt;library&gt;</span>
 1820 <span class="s2">            &lt;hierarchyClass id1=&quot;G&quot; id2=&quot;G&quot; name=&quot;GG&quot;&gt;</span>
 1821 <span class="s2">            ...</span>
 1822 <span class="s2">            &lt;/hierarchyClass&gt;</span>
 1823 <span class="s2">            &lt;hierarchyClass id1=&quot;C&quot; id2=&quot;O&quot; name=&quot;CO&quot;&gt;</span>
 1824 <span class="s2">                &lt;hierarchySubClass name=&quot;Ester bond I&quot; smarts=&quot;O=[C:2][O:3]&quot;&gt;</span>
 1825 <span class="s2">                    &lt;torsionRule method=&quot;exact&quot; smarts=</span>
 1826 <span class="s2">                        &quot;[O:1]=[C:2]!@[O:3]~[CH0:4]&quot;&gt;</span>
 1827 <span class="s2">                        &lt;angleList&gt;</span>
 1828 <span class="s2">                            &lt;angle score=&quot;56.52&quot; tolerance1=&quot;20.00&quot;</span>
 1829 <span class="s2">                            tolerance2=&quot;25.00&quot; value=&quot;0.0&quot;/&gt;</span>
 1830 <span class="s2">                        &lt;/angleList&gt;</span>
 1831 <span class="s2">                        &lt;histogram&gt;</span>
 1832 <span class="s2">                            &lt;bin count=&quot;1&quot;/&gt;</span>
 1833 <span class="s2">                            ...</span>
 1834 <span class="s2">                        &lt;/histogram&gt;</span>
 1835 <span class="s2">                        &lt;histogram_shifted&gt;</span>
 1836 <span class="s2">                            &lt;bin count=&quot;0&quot;/&gt;</span>
 1837 <span class="s2">                            ...</span>
 1838 <span class="s2">                        &lt;/histogram_shifted&gt;</span>
 1839 <span class="s2">                        &lt;histogram_converted&gt;</span>
 1840 <span class="s2">                            &lt;bin energy=&quot;4.67... lower=&quot;2.14...&quot; upper=&quot;Inf&quot;/&gt;</span>
 1841 <span class="s2">                            ...</span>
 1842 <span class="s2">                            &lt;bin energy=&quot;1.86...&quot; lower=&quot;1.58...&quot; upper=&quot;2.40...&quot;/&gt;</span>
 1843 <span class="s2">                            ...</span>
 1844 <span class="s2">                           &lt;/histogram_converted&gt;</span>
 1845 <span class="s2">                    &lt;/torsionRule&gt;</span>
 1846 <span class="s2">                    &lt;torsionRule method=&quot;approximate&quot; smarts=</span>
 1847 <span class="s2">                        &quot;[cH0:1][c:2]([cH0])!@[O:3][p:4]&quot;&gt;</span>
 1848 <span class="s2">                        &lt;angleList&gt;</span>
 1849 <span class="s2">                        &lt;angle beta_1=&quot;0.002...&quot; beta_2=&quot;-7.843...e-07&quot;</span>
 1850 <span class="s2">                            score=&quot;27.14&quot; theta_0=&quot;-90.0&quot; tolerance1=&quot;30.00&quot;</span>
 1851 <span class="s2">                            tolerance2=&quot;45.00&quot; value=&quot;-90.0&quot;/&gt;</span>
 1852 <span class="s2">                        ...</span>
 1853 <span class="s2">                        &lt;/angleList&gt;</span>
 1854 <span class="s2">                        &lt;histogram&gt;</span>
 1855 <span class="s2">                            &lt;bin count=&quot;0&quot;/&gt;</span>
 1856 <span class="s2">                             ...</span>
 1857 <span class="s2">                        &lt;/histogram&gt;</span>
 1858 <span class="s2">                        &lt;histogram_shifted&gt;</span>
 1859 <span class="s2">                            &lt;bin count=&quot;0&quot;/&gt;</span>
 1860 <span class="s2">                            ...</span>
 1861 <span class="s2">                        &lt;/histogram_shifted&gt;</span>
 1862 <span class="s2">                    &lt;/torsionRule&gt;</span>
 1863 <span class="s2">                ...</span>
 1864 <span class="s2">             ...</span>
 1865 <span class="s2">            &lt;/hierarchyClass&gt;</span>
 1866 <span class="s2">             &lt;hierarchyClass id1=&quot;N&quot; id2=&quot;C&quot; name=&quot;NC&quot;&gt;</span>
 1867 <span class="s2">             ...</span>
 1868 <span class="s2">            &lt;/hierarchyClass&gt;</span>
 1869 <span class="s2">            &lt;hierarchyClass id1=&quot;S&quot; id2=&quot;N&quot; name=&quot;SN&quot;&gt;</span>
 1870 <span class="s2">            ...</span>
 1871 <span class="s2">            &lt;/hierarchyClass&gt;</span>
 1872 <span class="s2">            &lt;hierarchyClass id1=&quot;C&quot; id2=&quot;S&quot; name=&quot;CS&quot;&gt;</span>
 1873 <span class="s2">            ...</span>
 1874 <span class="s2">            &lt;/hierarchyClass&gt;</span>
 1875 <span class="s2">            &lt;hierarchyClass id1=&quot;C&quot; id2=&quot;C&quot; name=&quot;CC&quot;&gt;</span>
 1876 <span class="s2">            ...</span>
 1877 <span class="s2">            &lt;/hierarchyClass&gt;</span>
 1878 <span class="s2">            &lt;hierarchyClass id1=&quot;S&quot; id2=&quot;S&quot; name=&quot;SS&quot;&gt;</span>
 1879 <span class="s2">             ...</span>
 1880 <span class="s2">            &lt;/hierarchyClass&gt;</span>
 1881 <span class="s2">        &lt;/library&gt;</span>
 1882 <span class="s2">        </span>
 1883 <span class="s2">    The rotatable bonds in a 3D molecule are identified using a default SMARTS pattern.</span>
 1884 <span class="s2">    A custom SMARTS pattern may be optionally specified to detect rotatable bonds.</span>
 1885 <span class="s2">    Each rotatable bond is matched to a torsion rule in the torsion strain energy library.</span>
 1886 <span class="s2">    The strain energy is calculated for each rotatable bond using the calculation</span>
 1887 <span class="s2">    method, &#39;exact&#39; or &#39;approximate&#39;, associated with the matched torsion rule.</span>
 1888 <span class="s2">    </span>
 1889 <span class="s2">    The total strain energy (TEUs) of a molecule corresponds to the sum of  &#39;exact&#39; and</span>
 1890 <span class="s2">    &#39;approximate&#39; strain energies calculated for all matched rotatable bonds in the</span>
 1891 <span class="s2">    molecule. The total strain energy is set to &#39;NA&#39; for molecules containing a &#39;approximate&#39;</span>
 1892 <span class="s2">    energy estimate for a torsion angle not observed in the torsion energy library. In</span>
 1893 <span class="s2">    addition, the lower and upper bounds on energy at 95</span><span class="si">% c</span><span class="s2">onfidence interval are</span>
 1894 <span class="s2">    set to &#39;NA&#39;.</span>
 1895 <span class="s2">    </span>
 1896 <span class="s2">    The following output files are generated after the filtering:</span>
 1897 <span class="s2">        </span>
 1898 <span class="s2">        &lt;OutfileRoot&gt;.sdf</span>
 1899 <span class="s2">        &lt;OutfileRoot&gt;_Filtered.sdf</span>
 1900 <span class="s2">        &lt;OutfileRoot&gt;_AlertsSummary.csv</span>
 1901 <span class="s2">        &lt;OutfileRoot&gt;_Filtered_TopRule*.sdf</span>
 1902 <span class="s2">        </span>
 1903 <span class="s2">    The last two set of outfile files, &lt;OutfileRoot&gt;_AlertsSummary.csv and</span>
 1904 <span class="s2">    &lt;OutfileRoot&gt;_&lt;OutfileRoot&gt;_AlertsSummary.csv, are only generated during filtering</span>
 1905 <span class="s2">    by &#39;MaxSingleEnergy&#39;.</span>
 1906 <span class="s2">    </span>
 1907 <span class="s2">    The supported input file formats are: Mol (.mol), SD (.sdf, .sd)</span>
 1908 <span class="s2">    </span>
 1909 <span class="s2">    The supported output file formats are: SD (.sdf, .sd)</span>
 1910 
 1911 <span class="s2">Options:</span>
 1912 <span class="s2">    -a, --alertsMode &lt;TotalEnergy,...&gt;  [default: TotalEnergy]</span>
 1913 <span class="s2">        Torsion strain energy library alert types to use for filtering molecules</span>
 1914 <span class="s2">        containing rotatable bonds based on the calculated values for the total</span>
 1915 <span class="s2">        torsion strain energy of a molecule and  the maximum single strain</span>
 1916 <span class="s2">        energy of a rotatable bond in a molecule.</span>
 1917 <span class="s2">        </span>
 1918 <span class="s2">        Possible values: TotalEnergy, MaxSingleEnergy, or TotalOrMaxSingleEnergy</span>
 1919 <span class="s2">        </span>
 1920 <span class="s2">        The strain energy cutoff values in terms of torsion energy units (TEUs) are</span>
 1921 <span class="s2">        used to filter molecules as shown below:</span>
 1922 <span class="s2">            </span>
 1923 <span class="s2">            AlertsMode                AlertsEnergyCutoffs (TEUs)</span>
 1924 <span class="s2">            </span>
 1925 <span class="s2">            TotalEnergy               &gt;= TotalEnergyCutoff</span>
 1926 <span class="s2">            </span>
 1927 <span class="s2">            MaxSingleEnergy           &gt;= MaxSingleEnergyCutoff</span>
 1928 <span class="s2">            </span>
 1929 <span class="s2">            TotalOrMaxSingleEnergy    &gt;= TotalEnergyCutoff</span>
 1930 <span class="s2">                                      or &gt;= MaxSingleEnergyCutoff</span>
 1931 <span class="s2">        </span>
 1932 <span class="s2">    --alertsMaxSingleEnergyCutoff &lt;Number&gt;  [default: 1.8]</span>
 1933 <span class="s2">        Maximum single strain energy (TEUs) cutoff [ Ref 153 ] for filtering molecules</span>
 1934 <span class="s2">        based on the maximum value of a single strain energy of a rotatable bond</span>
 1935 <span class="s2">        in  a molecule. This option is used during &#39;MaxSingleEnergy&#39; or</span>
 1936 <span class="s2">        &#39;TotalOrMaxSingleEnergy&#39; values of &#39;-a, --alertsMode&#39; option.</span>
 1937 <span class="s2">        </span>
 1938 <span class="s2">        The maximum single strain energy must be greater than or equal to the</span>
 1939 <span class="s2">        specified cutoff value for filtering molecules.</span>
 1940 <span class="s2">    --alertsTotalEnergyCutoff &lt;Number&gt;  [default: 6.0]</span>
 1941 <span class="s2">        Total strain strain energy (TEUs) cutoff [ Ref 153 ] for filtering molecules</span>
 1942 <span class="s2">        based on total strain energy for all rotatable bonds in a molecule. This</span>
 1943 <span class="s2">        option is used during &#39;TotalEnergy&#39; or &#39;TotalOrMaxSingleEnergy&#39;</span>
 1944 <span class="s2">        values of &#39;-a, --alertsMode&#39; option.</span>
 1945 <span class="s2">        </span>
 1946 <span class="s2">        The total strain energy must be greater than or equal to the specified</span>
 1947 <span class="s2">        cutoff value for filtering molecules.</span>
 1948 <span class="s2">    --filterTorsionsNotObserved &lt;yes or no&gt;  [default: no]</span>
 1949 <span class="s2">        Filter molecules containing torsion angles not observed in torsion strain</span>
 1950 <span class="s2">        energy library. It&#39;s not possible to calculate torsion strain energies for</span>
 1951 <span class="s2">        these torsions during &#39;approximate&#39; match to a specified torsion in the</span>
 1952 <span class="s2">        library.</span>
 1953 <span class="s2">        </span>
 1954 <span class="s2">        The &#39;approximate&#39; strain energy calculation relies on the angle difference</span>
 1955 <span class="s2">        between a torsion angle and the torsion peaks observed for the torsion</span>
 1956 <span class="s2">        rules in the torsion energy library. The torsion angle is matched to a</span>
 1957 <span class="s2">        torsion peak based on the value of torsion angle difference. It must be</span>
 1958 <span class="s2">        less than or equal to the value for the second tolerance &#39;tolerance2&#39;.</span>
 1959 <span class="s2">        Otherwise, the torsion angle is not observed in the torsion energy library</span>
 1960 <span class="s2">        and a value of &#39;NA&#39; is assigned for torsion energy along with the lower and</span>
 1961 <span class="s2">        upper bounds on energy at 95</span><span class="si">% c</span><span class="s2">onfidence interval.</span>
 1962 <span class="s2">    -e, --examples</span>
 1963 <span class="s2">        Print examples.</span>
 1964 <span class="s2">    -h, --help</span>
 1965 <span class="s2">        Print this help message.</span>
 1966 <span class="s2">    -i, --infile &lt;infile&gt;</span>
 1967 <span class="s2">        Input file name.</span>
 1968 <span class="s2">    --infileParams &lt;Name,Value,...&gt;  [default: auto]</span>
 1969 <span class="s2">        A comma delimited list of parameter name and value pairs for reading</span>
 1970 <span class="s2">        molecules from files. The supported parameter names for different file</span>
 1971 <span class="s2">        formats, along with their default values, are shown below:</span>
 1972 <span class="s2">            </span>
 1973 <span class="s2">            SD, MOL: removeHydrogens,no,sanitize,yes,strictParsing,yes</span>
 1974 <span class="s2">            </span>
 1975 <span class="s2">    -l, --list</span>
 1976 <span class="s2">        List torsion library information without performing any filtering.</span>
 1977 <span class="s2">    -m, --mode &lt;filter or count&gt;  [default: filter]</span>
 1978 <span class="s2">        Specify whether to filter molecules for torsion strain energy library [ Ref 153 ]</span>
 1979 <span class="s2">        alerts by matching rotatable bonds against SMARTS patterns specified for</span>
 1980 <span class="s2">        torsion rules to calculate torsion strain energies and write out the rest</span>
 1981 <span class="s2">        of the molecules to an outfile or simply count the number of matched</span>
 1982 <span class="s2">        molecules marked for filtering.</span>
 1983 <span class="s2">    --mp &lt;yes or no&gt;  [default: no]</span>
 1984 <span class="s2">        Use multiprocessing.</span>
 1985 <span class="s2">         </span>
 1986 <span class="s2">        By default, input data is retrieved in a lazy manner via mp.Pool.imap()</span>
 1987 <span class="s2">        function employing lazy RDKit data iterable. This allows processing of</span>
 1988 <span class="s2">        arbitrary large data sets without any additional requirements memory.</span>
 1989 <span class="s2">        </span>
 1990 <span class="s2">        All input data may be optionally loaded into memory by mp.Pool.map()</span>
 1991 <span class="s2">        before starting worker processes in a process pool by setting the value</span>
 1992 <span class="s2">        of &#39;inputDataMode&#39; to &#39;InMemory&#39; in &#39;--mpParams&#39; option.</span>
 1993 <span class="s2">        </span>
 1994 <span class="s2">        A word to the wise: The default &#39;chunkSize&#39; value of 1 during &#39;Lazy&#39; input</span>
 1995 <span class="s2">        data mode may adversely impact the performance. The &#39;--mpParams&#39; section</span>
 1996 <span class="s2">        provides additional information to tune the value of &#39;chunkSize&#39;.</span>
 1997 <span class="s2">    --mpParams &lt;Name,Value,...&gt;  [default: auto]</span>
 1998 <span class="s2">        A comma delimited list of parameter name and value pairs to configure</span>
 1999 <span class="s2">        multiprocessing.</span>
 2000 <span class="s2">        </span>
 2001 <span class="s2">        The supported parameter names along with their default and possible</span>
 2002 <span class="s2">        values are shown below:</span>
 2003 <span class="s2">        </span>
 2004 <span class="s2">            chunkSize, auto</span>
 2005 <span class="s2">            inputDataMode, Lazy   [ Possible values: InMemory or Lazy ]</span>
 2006 <span class="s2">            numProcesses, auto   [ Default: mp.cpu_count() ]</span>
 2007 <span class="s2">        </span>
 2008 <span class="s2">        These parameters are used by the following functions to configure and</span>
 2009 <span class="s2">        control the behavior of multiprocessing: mp.Pool(), mp.Pool.map(), and</span>
 2010 <span class="s2">        mp.Pool.imap().</span>
 2011 <span class="s2">        </span>
 2012 <span class="s2">        The chunkSize determines chunks of input data passed to each worker</span>
 2013 <span class="s2">        process in a process pool by mp.Pool.map() and mp.Pool.imap() functions.</span>
 2014 <span class="s2">        The default value of chunkSize is dependent on the value of &#39;inputDataMode&#39;.</span>
 2015 <span class="s2">        </span>
 2016 <span class="s2">        The mp.Pool.map() function, invoked during &#39;InMemory&#39; input data mode,</span>
 2017 <span class="s2">        automatically converts RDKit data iterable into a list, loads all data into</span>
 2018 <span class="s2">        memory, and calculates the default chunkSize using the following method</span>
 2019 <span class="s2">        as shown in its code:</span>
 2020 <span class="s2">        </span>
 2021 <span class="s2">            chunkSize, extra = divmod(len(dataIterable), len(numProcesses) * 4)</span>
 2022 <span class="s2">            if extra: chunkSize += 1</span>
 2023 <span class="s2">        </span>
 2024 <span class="s2">        For example, the default chunkSize will be 7 for a pool of 4 worker processes</span>
 2025 <span class="s2">        and 100 data items.</span>
 2026 <span class="s2">        </span>
 2027 <span class="s2">        The mp.Pool.imap() function, invoked during &#39;Lazy&#39; input data mode, employs</span>
 2028 <span class="s2">        &#39;lazy&#39; RDKit data iterable to retrieve data as needed, without loading all the</span>
 2029 <span class="s2">        data into memory. Consequently, the size of input data is not known a priori.</span>
 2030 <span class="s2">        It&#39;s not possible to estimate an optimal value for the chunkSize. The default </span>
 2031 <span class="s2">        chunkSize is set to 1.</span>
 2032 <span class="s2">        </span>
 2033 <span class="s2">        The default value for the chunkSize during &#39;Lazy&#39; data mode may adversely</span>
 2034 <span class="s2">        impact the performance due to the overhead associated with exchanging</span>
 2035 <span class="s2">        small chunks of data. It is generally a good idea to explicitly set chunkSize to</span>
 2036 <span class="s2">        a larger value during &#39;Lazy&#39; input data mode, based on the size of your input</span>
 2037 <span class="s2">        data and number of processes in the process pool.</span>
 2038 <span class="s2">        </span>
 2039 <span class="s2">        The mp.Pool.map() function waits for all worker processes to process all</span>
 2040 <span class="s2">        the data and return the results. The mp.Pool.imap() function, however,</span>
 2041 <span class="s2">        returns the the results obtained from worker processes as soon as the</span>
 2042 <span class="s2">        results become available for specified chunks of data.</span>
 2043 <span class="s2">        </span>
 2044 <span class="s2">        The order of data in the results returned by both mp.Pool.map() and </span>
 2045 <span class="s2">        mp.Pool.imap() functions always corresponds to the input data.</span>
 2046 <span class="s2">    -o, --outfile &lt;outfile&gt;</span>
 2047 <span class="s2">        Output file name.</span>
 2048 <span class="s2">    --outfileAlerts &lt;yes or no&gt;  [default: yes]</span>
 2049 <span class="s2">        Write out alerts information to SD output files.</span>
 2050 <span class="s2">    --outfileAlertsMode &lt;All or AlertsOnly&gt;  [default: AlertsOnly]</span>
 2051 <span class="s2">        Write alerts information to SD output files for all alerts or only for alerts</span>
 2052 <span class="s2">        specified by &#39;--AlertsMode&#39; option. Possible values: All or AlertsOnly</span>
 2053 <span class="s2">        This option is only valid for &#39;Yes&#39; value of &#39;--outfileAlerts&#39; option.</span>
 2054 <span class="s2">        </span>
 2055 <span class="s2">        The following alerts information is added to SD output files using</span>
 2056 <span class="s2">        &#39;TorsionAlerts&#39; data field:</span>
 2057 <span class="s2">            </span>
 2058 <span class="s2">            RotBondIndices TorsionIndices TorsionAngle</span>
 2059 <span class="s2">            Energy EnergyLowerBoundCI EnergyUpperBoundCI</span>
 2060 <span class="s2">            HierarchyClass HierarchySubClass TorsionRule</span>
 2061 <span class="s2">            EnergyMethod AngleNotObserved MaxSingleEnergyAlert</span>
 2062 <span class="s2">            </span>
 2063 <span class="s2">        The following data filelds are added to SD output files based on the value of</span>
 2064 <span class="s2">        &#39;--AlertsMode&#39; option:</span>
 2065 <span class="s2">            </span>
 2066 <span class="s2">            TotalEnergy</span>
 2067 <span class="s2">            TotalEnergyLowerBoundCI</span>
 2068 <span class="s2">            TotalEnergyUpperBoundCI</span>
 2069 <span class="s2">            </span>
 2070 <span class="s2">            MaxSingleEnergy</span>
 2071 <span class="s2">            MaxSingleEnergyAlertsCount</span>
 2072 <span class="s2">            </span>
 2073 <span class="s2">            AnglesNotObservedCount</span>
 2074 <span class="s2">            </span>
 2075 <span class="s2">        The &#39;RotBondsCount&#39; is always added to SD output files containing both</span>
 2076 <span class="s2">        remaining and filtered molecules.</span>
 2077 <span class="s2">        </span>
 2078 <span class="s2">        Format:</span>
 2079 <span class="s2">            </span>
 2080 <span class="s2">            &gt; &lt;RotBondsCount&gt;</span>
 2081 <span class="s2">            Number</span>
 2082 <span class="s2">            </span>
 2083 <span class="s2">            &gt; &lt;TotalEnergy&gt;</span>
 2084 <span class="s2">            Number</span>
 2085 <span class="s2">            </span>
 2086 <span class="s2">            &gt; &lt;TotalEnergyLowerBoundCI&gt;</span>
 2087 <span class="s2">            Number</span>
 2088 <span class="s2">            </span>
 2089 <span class="s2">            &gt; &lt;TotalEnergyUpperBoundCI&gt;</span>
 2090 <span class="s2">            Number</span>
 2091 <span class="s2">            </span>
 2092 <span class="s2">            &gt; &lt;MaxSingleEnergy&gt;</span>
 2093 <span class="s2">            Number</span>
 2094 <span class="s2">            </span>
 2095 <span class="s2">            &gt; &lt;MaxSingleEnergyAlertsCount&gt;</span>
 2096 <span class="s2">            Number</span>
 2097 <span class="s2">            </span>
 2098 <span class="s2">            &gt; &lt;AnglesNotObservedCount&gt;</span>
 2099 <span class="s2">            Number</span>
 2100 <span class="s2">            </span>
 2101 <span class="s2">            &gt; &lt;TorsionAlerts (RotBondIndices TorsionIndices TorsionAngle</span>
 2102 <span class="s2">                Energy EnergyLowerBoundCI EnergyUpperBoundCI</span>
 2103 <span class="s2">                HierarchyClass HierarchySubClass TorsionRule</span>
 2104 <span class="s2">                EnergyMethod AngleNotObserved MaxSingleEnergyAlert)&gt;</span>
 2105 <span class="s2">            AtomIndex2,AtomIndex3  AtomIndex1,AtomIndex2,AtomIndex3,AtomIndex4</span>
 2106 <span class="s2">            Angle  Energy EnergyLowerBoundCI EnergyUpperBoundCI</span>
 2107 <span class="s2">            ClassName SubClassName SMARTS EnergyMethod Yes|No|NA Yes|No|NA</span>
 2108 <span class="s2">            ... ... ...</span>
 2109 <span class="s2">            ... ... ...</span>
 2110 <span class="s2">            </span>
 2111 <span class="s2">        A set of 12 values is written out as value of &#39;TorsionAlerts&#39; data field for</span>
 2112 <span class="s2">        each torsion in a molecule. The space character is used as a delimiter</span>
 2113 <span class="s2">        to separate values with in a set and across set. The comma character</span>
 2114 <span class="s2">        is used to delimit multiple values for each value in a set.</span>
 2115 <span class="s2">        </span>
 2116 <span class="s2">        The &#39;RotBondIndices&#39; and &#39;TorsionIndices&#39; contain 2 and 4 comma delimited</span>
 2117 <span class="s2">        values representing atom indices for a rotatable bond and the matched</span>
 2118 <span class="s2">        torsion.</span>
 2119 <span class="s2">        </span>
 2120 <span class="s2">        The &#39;Energy&#39; value is the estimated strain energy for the matched torsion.</span>
 2121 <span class="s2">        The &#39;EnergyLowerBoundCI&#39; and &#39;EnergyUpperBoundCI&#39; represent lower and</span>
 2122 <span class="s2">        bound energy estimates at 95</span><span class="si">% c</span><span class="s2">onfidence interval. The &#39;EnergyMethod&#39;,</span>
 2123 <span class="s2">        exact or approximate, corresponds to the method employed to estimate</span>
 2124 <span class="s2">        torsion strain energy.</span>
 2125 <span class="s2">        </span>
 2126 <span class="s2">        The &#39;AngleNotObserved&#39; is only valid for &#39;approximate&#39; value of &#39;EnergyMethod&#39;.</span>
 2127 <span class="s2">        It has three possible values: Yes, No, or NA. The &#39;Yes&#39; value indicates that</span>
 2128 <span class="s2">        the &#39;TorsionAngle&#39; is outside the &#39;tolerance2&#39; of all peaks for the matched</span>
 2129 <span class="s2">        torsion rule in the torsion library.</span>
 2130 <span class="s2">        </span>
 2131 <span class="s2">        The &#39;MaxSingleEnergyAlert&#39; is valid for the following values of &#39;-a, --alertsMode&#39;</span>
 2132 <span class="s2">        option: &#39;MaxSingleEnergy&#39; or &#39;TotalOrMaxSingleEnergy&#39;. It has three possible</span>
 2133 <span class="s2">        values: Yes, No, or NA. It&#39;s set to &#39;NA&#39; for &#39;Yes&#39; or &#39;NA&#39; values of</span>
 2134 <span class="s2">        &#39;AngleNotObserved&#39;. The &#39;Yes&#39; value indicates that the estimated torsion</span>
 2135 <span class="s2">        energy is greater than the specified value for &#39;--alertsMaxSingleEnergyCutoff&#39;</span>
 2136 <span class="s2">        option.</span>
 2137 <span class="s2">        </span>
 2138 <span class="s2">        For example:</span>
 2139 <span class="s2">            </span>
 2140 <span class="s2">            &gt;  &lt;RotBondsCount&gt;  (1) </span>
 2141 <span class="s2">            14</span>
 2142 <span class="s2">            </span>
 2143 <span class="s2">            &gt;  &lt;TotalEnergy&gt;  (1) </span>
 2144 <span class="s2">            6.8065</span>
 2145 <span class="s2">            </span>
 2146 <span class="s2">            &gt;  &lt;TotalEnergyLowerBoundCI&gt;  (1) </span>
 2147 <span class="s2">            5.9340</span>
 2148 <span class="s2">            </span>
 2149 <span class="s2">            &gt;  &lt;TotalEnergyUpperBoundCI&gt;  (1) </span>
 2150 <span class="s2">            NA</span>
 2151 <span class="s2">            </span>
 2152 <span class="s2">            &gt;  &lt;MaxSingleEnergy&gt;  (1) </span>
 2153 <span class="s2">            1.7108</span>
 2154 <span class="s2">            </span>
 2155 <span class="s2">            &gt;  &lt;MaxSingleEnergyAlertsCount&gt;  (1) </span>
 2156 <span class="s2">            0</span>
 2157 <span class="s2">            </span>
 2158 <span class="s2">            &gt;  &lt;AnglesNotObservedCount&gt;  (1) </span>
 2159 <span class="s2">            0</span>
 2160 <span class="s2">             </span>
 2161 <span class="s2">            &gt;  &lt;TorsionAlerts(RotBondIndices TorsionIndices TorsionAngle Energy</span>
 2162 <span class="s2">                EnergyLowerBoundCI EnergyUpperBoundCI HierarchyClass</span>
 2163 <span class="s2">                HierarchySubClass TorsionRule EnergyMethod AngleNotObserved</span>
 2164 <span class="s2">                MaxSingleEnergyAlert)&gt;  (1) </span>
 2165 <span class="s2">            2,1 48,2,1,0 61.90 0.0159 -0.0320 0.0674 CO Ether [O:1][CX4:2]!</span>
 2166 <span class="s2">            @[O:3][CX4:4] Exact NA No 2,3 1,2,3,4 109.12 1.5640 1.1175 NA CC</span>
 2167 <span class="s2">            None/[CX4][CX3] [O:1][CX4:2]!@[CX3:3]=[O:4] Exact NA No</span>
 2168 <span class="s2">            ... ... ...</span>
 2169 <span class="s2">            </span>
 2170 <span class="s2">    --outfileFiltered &lt;yes or no&gt;  [default: yes]</span>
 2171 <span class="s2">        Write out a file containing filtered molecules. Its name is automatically</span>
 2172 <span class="s2">        generated from the specified output file. Default: &lt;OutfileRoot&gt;_</span>
 2173 <span class="s2">        Filtered.&lt;OutfileExt&gt;.</span>
 2174 <span class="s2">    --outfilesFilteredByRules &lt;yes or no&gt;  [default: auto]</span>
 2175 <span class="s2">        Write out SD files containing filtered molecules for individual torsion</span>
 2176 <span class="s2">        rules triggering alerts in molecules. The name of SD files are automatically</span>
 2177 <span class="s2">        generated from the specified output file. Default file names: &lt;OutfileRoot&gt;_</span>
 2178 <span class="s2">        Filtered_TopRule*.sdf.</span>
 2179 <span class="s2">        </span>
 2180 <span class="s2">        Default value: &#39;yes&#39; for &#39;MaxSingleEnergy&#39; of &#39;-a, --alertsMode&#39; option&#39;;</span>
 2181 <span class="s2">        otherwise, &#39;no&#39;.</span>
 2182 <span class="s2">        </span>
 2183 <span class="s2">        The output files are only generated for &#39;MaxSingleEnergy&#39; of</span>
 2184 <span class="s2">        &#39;-a, --alertsMode&#39; option.</span>
 2185 <span class="s2">        </span>
 2186 <span class="s2">        The following alerts information is added to SD output files:</span>
 2187 <span class="s2">            </span>
 2188 <span class="s2">            &gt; &lt;RotBondsCount&gt;</span>
 2189 <span class="s2">            Number</span>
 2190 <span class="s2">            </span>
 2191 <span class="s2">            &gt; &lt;TotalEnergy&gt;</span>
 2192 <span class="s2">            Number</span>
 2193 <span class="s2">            </span>
 2194 <span class="s2">            &gt; &lt;TotalEnergyLowerBoundCI&gt;</span>
 2195 <span class="s2">            Number</span>
 2196 <span class="s2">            </span>
 2197 <span class="s2">            &gt; &lt;TotalEnergyUpperBoundCI&gt;</span>
 2198 <span class="s2">            Number</span>
 2199 <span class="s2">            </span>
 2200 <span class="s2">            &gt; &lt;MaxSingleEnergy&gt;</span>
 2201 <span class="s2">            Number</span>
 2202 <span class="s2">            </span>
 2203 <span class="s2">            &gt; &lt;MaxSingleEnergyAlertsCount&gt;</span>
 2204 <span class="s2">            Number</span>
 2205 <span class="s2">            </span>
 2206 <span class="s2">            &gt; &lt;AnglesNotObservedCount&gt;</span>
 2207 <span class="s2">            Number</span>
 2208 <span class="s2">            </span>
 2209 <span class="s2">            &gt;  &lt;TorsionRule (HierarchyClass HierarchySubClass TorsionRule</span>
 2210 <span class="s2">                EnergyMethod)&gt; </span>
 2211 <span class="s2">            ClassName SubClassName EnergyMethod SMARTS</span>
 2212 <span class="s2">             ... ... ...</span>
 2213 <span class="s2">            </span>
 2214 <span class="s2">            &gt; &lt;TorsionRuleMaxSingleEnergyAlertsCount&gt;</span>
 2215 <span class="s2">            Number</span>
 2216 <span class="s2">            </span>
 2217 <span class="s2">            &gt; &lt;TorsionRuleAnglesNotObservedCount&gt;</span>
 2218 <span class="s2">            Number</span>
 2219 <span class="s2">            </span>
 2220 <span class="s2">            &gt;  &lt;TorsionRuleAlerts (RotBondIndices TorsionIndices TorsionAngle</span>
 2221 <span class="s2">                Energy EnergyLowerBoundCI EnergyUpperBoundCI</span>
 2222 <span class="s2">                AngleNotObserved MaxSingleEnergyAlert)&gt;</span>
 2223 <span class="s2">            AtomIndex2,AtomIndex3  AtomIndex1,AtomIndex2,AtomIndex3,AtomIndex4</span>
 2224 <span class="s2">            Angle Energy EnergyLowerBoundCI EnergyUpperBoundCI EnergyMethod</span>
 2225 <span class="s2">            Yes|No|NA Yes|No|NA</span>
 2226 <span class="s2">             ... ... ...</span>
 2227 <span class="s2">            </span>
 2228 <span class="s2">        For example:</span>
 2229 <span class="s2">            </span>
 2230 <span class="s2">            &gt;  &lt;RotBondsCount&gt;  (1) </span>
 2231 <span class="s2">            8</span>
 2232 <span class="s2">            </span>
 2233 <span class="s2">            &gt;  &lt;TotalEnergy&gt;  (1) </span>
 2234 <span class="s2">            6.1889</span>
 2235 <span class="s2">            </span>
 2236 <span class="s2">            &gt;  &lt;TotalEnergyLowerBoundCI&gt;  (1) </span>
 2237 <span class="s2">            5.1940</span>
 2238 <span class="s2">            </span>
 2239 <span class="s2">            &gt;  &lt;TotalEnergyUpperBoundCI&gt;  (1) </span>
 2240 <span class="s2">            NA</span>
 2241 <span class="s2">            </span>
 2242 <span class="s2">            &gt;  &lt;MaxSingleEnergy&gt;  (1) </span>
 2243 <span class="s2">            1.9576</span>
 2244 <span class="s2">            </span>
 2245 <span class="s2">            &gt;  &lt;MaxSingleEnergyAlertsCount&gt;  (1) </span>
 2246 <span class="s2">            1</span>
 2247 <span class="s2">            </span>
 2248 <span class="s2">            &gt;  &lt;AnglesNotObservedCount&gt;  (1) </span>
 2249 <span class="s2">            0</span>
 2250 <span class="s2">            </span>
 2251 <span class="s2">            &gt;  &lt;TorsionRule (HierarchyClass HierarchySubClass TorsionRule</span>
 2252 <span class="s2">                EnergyMethod)&gt;  (1) </span>
 2253 <span class="s2">            CC None/[CX4:2][CX4:3] [!#1:1][CX4:2]!@[CX4:3][!#1:4] Exact</span>
 2254 <span class="s2">            </span>
 2255 <span class="s2">            &gt;  &lt;TorsionRuleMaxSingleEnergyAlertsCount&gt;  (1) </span>
 2256 <span class="s2">            0</span>
 2257 <span class="s2">            </span>
 2258 <span class="s2">            &gt;  &lt;TorsionRuleAnglesNotObservedCount&gt;  (1) </span>
 2259 <span class="s2">            0</span>
 2260 <span class="s2">            </span>
 2261 <span class="s2">            &gt;  &lt;TorsionRuleAlerts (RotBondIndices TorsionIndices TorsionAngle</span>
 2262 <span class="s2">                Energy EnergyLowerBoundCI EnergyUpperBoundCI AngleNotObserved</span>
 2263 <span class="s2">               MaxSingleEnergyAlert)&gt;  (1) </span>
 2264 <span class="s2">            1,3 0,1,3,4 72.63 0.8946 0.8756 0.9145 NA No</span>
 2265 <span class="s2">            </span>
 2266 <span class="s2">    --outfilesFilteredByRulesMaxCount &lt;All or number&gt;  [default: 10]</span>
 2267 <span class="s2">        Write out SD files containing filtered molecules for specified number of</span>
 2268 <span class="s2">        top N torsion rules triggering alerts for the largest number of molecules</span>
 2269 <span class="s2">        or for all torsion rules triggering alerts across all molecules.</span>
 2270 <span class="s2">        </span>
 2271 <span class="s2">        These output files are only generated for &#39;MaxSingleEnergy&#39; value of</span>
 2272 <span class="s2">        &#39;-a, --alertsMode&#39; option.</span>
 2273 <span class="s2">    --outfileSummary &lt;yes or no&gt;  [default: auto]</span>
 2274 <span class="s2">        Write out a CVS text file containing summary of torsions rules responsible</span>
 2275 <span class="s2">        for triggering torsion alerts. Its name is automatically generated from the</span>
 2276 <span class="s2">        specified output file. Default: &lt;OutfileRoot&gt;_AlertsSummary.csv.</span>
 2277 <span class="s2">        </span>
 2278 <span class="s2">        Default value: &#39;yes&#39; for &#39;MaxSingleEnergy&#39; of &#39;-a, --alertsMode&#39; option&#39;;</span>
 2279 <span class="s2">        otherwise, &#39;no&#39;.</span>
 2280 <span class="s2">        </span>
 2281 <span class="s2">        The summary output file is only generated for &#39;MaxSingleEnergy&#39; of</span>
 2282 <span class="s2">        &#39;-a, --alertsMode&#39; option.</span>
 2283 <span class="s2">        </span>
 2284 <span class="s2">        The following alerts information is written to summary text file:</span>
 2285 <span class="s2">            </span>
 2286 <span class="s2">            TorsionRule, HierarchyClass, HierarchySubClass, EnergyMethod,</span>
 2287 <span class="s2">            MaxSingleEnergyTorsionAlertTypes, MaxSingleEnergyTorsionAlertCount,</span>
 2288 <span class="s2">            MaxSingleEnergyTorsionAlertMolCount</span>
 2289 <span class="s2">             </span>
 2290 <span class="s2">        The double quotes characters are removed from SMART patterns before</span>
 2291 <span class="s2">        before writing them to a CSV file. In addition, the torsion rules are sorted by</span>
 2292 <span class="s2">        TorsionAlertMolCount.</span>
 2293 <span class="s2">    --outfileSDFieldLabels &lt;Type,Label,...&gt;  [default: auto]</span>
 2294 <span class="s2">        A comma delimited list of SD data field type and label value pairs for writing</span>
 2295 <span class="s2">        torsion alerts information along with molecules to SD files.</span>
 2296 <span class="s2">        </span>
 2297 <span class="s2">        The supported SD data field label type along with their default values are</span>
 2298 <span class="s2">        shown below:</span>
 2299 <span class="s2">            </span>
 2300 <span class="s2">            For all SD files:</span>
 2301 <span class="s2">            </span>
 2302 <span class="s2">            RotBondsCountLabel, RotBondsCount,</span>
 2303 <span class="s2">            </span>
 2304 <span class="s2">            TotalEnergyLabel, TotalEnergy,</span>
 2305 <span class="s2">            TotalEnergyLowerBoundCILabel, TotalEnergyLowerBoundCI,</span>
 2306 <span class="s2">            TotalEnergyUpperBoundCILabel, TotalEnergyUpperBoundCI,</span>
 2307 <span class="s2">            </span>
 2308 <span class="s2">            MaxSingleEnergyLabel, MaxSingleEnergy,</span>
 2309 <span class="s2">            MaxSingleEnergyAlertsCountLabel,</span>
 2310 <span class="s2">                MaxSingleEnergyAlertsCount</span>
 2311 <span class="s2">            </span>
 2312 <span class="s2">            AnglesNotObservedCountLabel,</span>
 2313 <span class="s2">                AnglesNotObservedCount</span>
 2314 <span class="s2">            </span>
 2315 <span class="s2">            TorsionAlertsLabel, TorsionAlerts(RotBondIndices TorsionIndices</span>
 2316 <span class="s2">                TorsionAngle Energy EnergyLowerBoundCI EnergyUpperBoundCI</span>
 2317 <span class="s2">                HierarchyClass HierarchySubClass TorsionRule</span>
 2318 <span class="s2">                EnergyMethod AngleNotObserved)</span>
 2319 <span class="s2">            </span>
 2320 <span class="s2">            For individual SD files filtered by torsion rules:</span>
 2321 <span class="s2">            </span>
 2322 <span class="s2">            TorsionRuleLabel, TorsionRule (HierarchyClass HierarchySubClass</span>
 2323 <span class="s2">                EnergyMethod TorsionRule)</span>
 2324 <span class="s2">            TorsionRuleMaxSingleEnergyAlertsCountLabel,</span>
 2325 <span class="s2">                TorsionRuleMaxSingleEnergyAlertsCount,</span>
 2326 <span class="s2">            TorsionRuleAnglesNotObservedCountLabel,</span>
 2327 <span class="s2">                TorsionRuleAnglesNotObservedCount,</span>
 2328 <span class="s2">            TorsionRuleAlertsLabel, TorsionRuleAlerts (RotBondIndices</span>
 2329 <span class="s2">                TorsionIndices TorsionAngle Energy EnergyLowerBoundCI</span>
 2330 <span class="s2">                EnergyUpperBoundCI EnergyMethod AngleObserved)</span>
 2331 <span class="s2">            </span>
 2332 <span class="s2">    --outfileParams &lt;Name,Value,...&gt;  [default: auto]</span>
 2333 <span class="s2">        A comma delimited list of parameter name and value pairs for writing</span>
 2334 <span class="s2">        molecules to files. The supported parameter names for different file</span>
 2335 <span class="s2">        formats, along with their default values, are shown below:</span>
 2336 <span class="s2">            </span>
 2337 <span class="s2">            SD: kekulize,yes</span>
 2338 <span class="s2">            </span>
 2339 <span class="s2">    --overwrite</span>
 2340 <span class="s2">        Overwrite existing files.</span>
 2341 <span class="s2">    --precision &lt;number&gt;  [default: 4]</span>
 2342 <span class="s2">        Floating point precision for writing torsion strain energy values.</span>
 2343 <span class="s2">    -r, --rotBondsSMARTSMode &lt;NonStrict, SemiStrict,...&gt;  [default: SemiStrict]</span>
 2344 <span class="s2">        SMARTS pattern to use for identifying rotatable bonds in a molecule</span>
 2345 <span class="s2">        for matching against torsion rules in the torsion library. Possible values:</span>
 2346 <span class="s2">        NonStrict, SemiStrict, Strict or Specify. The rotatable bond SMARTS matches</span>
 2347 <span class="s2">        are filtered to ensure that each atom in the rotatable bond is attached to</span>
 2348 <span class="s2">        at least two heavy atoms.</span>
 2349 <span class="s2">        </span>
 2350 <span class="s2">        The following SMARTS patterns are used to identify rotatable bonds for</span>
 2351 <span class="s2">        different modes:</span>
 2352 <span class="s2">            </span>
 2353 <span class="s2">            NonStrict: [!$(*#*)&amp;!D1]-&amp;!@[!$(*#*)&amp;!D1]</span>
 2354 <span class="s2">            </span>
 2355 <span class="s2">            SemiStrict:</span>
 2356 <span class="s2">            [!$(*#*)&amp;!D1&amp;!$(C(F)(F)F)&amp;!$(C(Cl)(Cl)Cl)&amp;!$(C(Br)(Br)Br)</span>
 2357 <span class="s2">            &amp;!$(C([CH3])([CH3])[CH3])]-!@[!$(*#*)&amp;!D1&amp;!$(C(F)(F)F)</span>
 2358 <span class="s2">            &amp;!$(C(Cl)(Cl)Cl)&amp;!$(C(Br)(Br)Br)&amp;!$(C([CH3])([CH3])[CH3])]</span>
 2359 <span class="s2">            </span>
 2360 <span class="s2">            Strict:</span>
 2361 <span class="s2">            [!$(*#*)&amp;!D1&amp;!$(C(F)(F)F)&amp;!$(C(Cl)(Cl)Cl)&amp;!$(C(Br)(Br)Br)</span>
 2362 <span class="s2">            &amp;!$(C([CH3])([CH3])[CH3])&amp;!$([CD3](=[N,O,S])-!@[#7,O,S!D1])</span>
 2363 <span class="s2">            &amp;!$([#7,O,S!D1]-!@[CD3]=[N,O,S])&amp;!$([CD3](=[N+])-!@[#7!D1])</span>
 2364 <span class="s2">            &amp;!$([#7!D1]-!@[CD3]=[N+])]-!@[!$(*#*)&amp;!D1&amp;!$(C(F)(F)F)</span>
 2365 <span class="s2">            &amp;!$(C(Cl)(Cl)Cl)&amp;!$(C(Br)(Br)Br)&amp;!$(C([CH3])([CH3])[CH3])]</span>
 2366 <span class="s2">            </span>
 2367 <span class="s2">        The &#39;NonStrict&#39; and &#39;Strict&#39; SMARTS patterns are available in RDKit. The </span>
 2368 <span class="s2">        &#39;NonStrict&#39; SMARTS pattern corresponds to original Daylight SMARTS</span>
 2369 <span class="s2">        specification for rotatable bonds. The &#39;SemiStrict&#39; SMARTS pattern is </span>
 2370 <span class="s2">        derived from &#39;Strict&#39; SMARTS patterns for its usage in this script.</span>
 2371 <span class="s2">        </span>
 2372 <span class="s2">        You may use any arbitrary SMARTS pattern to identify rotatable bonds by</span>
 2373 <span class="s2">        choosing &#39;Specify&#39; value for &#39;-r, --rotBondsSMARTSMode&#39; option and providing its</span>
 2374 <span class="s2">        value via &#39;--rotBondsSMARTSPattern&#39; option.</span>
 2375 <span class="s2">    --rotBondsSMARTSPattern &lt;SMARTS&gt;</span>
 2376 <span class="s2">        SMARTS pattern for identifying rotatable bonds. This option is only valid</span>
 2377 <span class="s2">        for &#39;Specify&#39; value of &#39;-r, --rotBondsSMARTSMode&#39; option.</span>
 2378 <span class="s2">    -t, --torsionEnergyLibraryFile &lt;FileName or auto&gt;  [default: auto]</span>
 2379 <span class="s2">        Specify a XML file name containing data for torsion starin energy library</span>
 2380 <span class="s2">        hierarchy or use default file, TorsionEnergyLibrary.xml, available in</span>
 2381 <span class="s2">        MAYACHEMTOOLS/lib/data directory.</span>
 2382 <span class="s2">        </span>
 2383 <span class="s2">        The format of data in local XML file must match format of the data in Torsion</span>
 2384 <span class="s2">        Library [ Ref 153 ] file available in MAYACHEMTOOLS data directory.</span>
 2385 <span class="s2">    -w, --workingdir &lt;dir&gt;</span>
 2386 <span class="s2">        Location of working directory which defaults to the current directory.</span>
 2387 
 2388 <span class="s2">Examples:</span>
 2389 <span class="s2">    To filter molecules containing rotatable bonds with total strain energy value</span>
 2390 <span class="s2">    of &gt;= 6.0 (TEUs) based on torsion rules in the torsion energy library and write</span>
 2391 <span class="s2">    write out SD files containing remaining and filtered molecules, type:</span>
 2392 
 2393 <span class="s2">        % RDKitFilterTorsionStrainEnergyAlerts.py -i Sample3D.sdf</span>
 2394 <span class="s2">          -o Sample3DOut.sdf</span>
 2395 
 2396 <span class="s2">    To filter molecules containing any rotatable bonds with strain energy value of</span>
 2397 <span class="s2">    &gt;= 1.8 (TEUs) based on torsion rules in the torsion energy library and write out</span>
 2398 <span class="s2">    SD files containing remaining and filtered molecules, and individual SD files for</span>
 2399 <span class="s2">    torsion rules triggering alerts along with appropriate torsion information for</span>
 2400 <span class="s2">    red alerts, type:</span>
 2401 
 2402 <span class="s2">        % RDKitFilterTorsionStrainEnergyAlerts.py -a MaxSingleEnergy</span>
 2403 <span class="s2">          -i Sample3D.sdf -o Sample3DOut.sdf</span>
 2404 
 2405 <span class="s2">    To filter molecules containing rotatable bonds with total strain energy value</span>
 2406 <span class="s2">    of &gt;= 6.0 (TEUs) or any single strain energy value of &gt;= 1.8 (TEUs) and write out</span>
 2407 <span class="s2">    SD files containing remaining and filtered molecules, type:</span>
 2408 
 2409 <span class="s2">        % RDKitFilterTorsionStrainEnergyAlerts.py -a TotalOrMaxSingleEnergy</span>
 2410 <span class="s2">          -i Sample3D.sdf -o Sample3DOut.sdf</span>
 2411 
 2412 <span class="s2">    To filter molecules containing rotatable bonds with specific cutoff values for</span>
 2413 <span class="s2">    total or single torsion strain energy and write out SD files containing</span>
 2414 <span class="s2">    remaining and filtered molecules, type:</span>
 2415 
 2416 <span class="s2">        % RDKitFilterTorsionStrainEnergyAlerts.py -a TotalOrMaxSingleEnergy</span>
 2417 <span class="s2">          -i Sample3D.sdf -o Sample3DOut.sdf --alertsTotalEnergyCutoff 6.0</span>
 2418 <span class="s2">          --alertsMaxSingleEnergyCutoff 1.8</span>
 2419 
 2420 <span class="s2">    To run the first example for filtering molecules and writing out torsion</span>
 2421 <span class="s2">    information for all alert types to SD files, type:</span>
 2422 
 2423 <span class="s2">        % RDKitFilterTorsionStrainEnergyAlerts.py -i Sample3D.sdf</span>
 2424 <span class="s2">          -o Sample3DOut.sdf --outfileAlertsMode All</span>
 2425 
 2426 <span class="s2">    To run the first example for filtering molecules in multiprocessing mode on</span>
 2427 <span class="s2">    all available CPUs without loading all data into memory and write out SD files,</span>
 2428 <span class="s2">    type:</span>
 2429 
 2430 <span class="s2">        % RDKitFilterTorsionStrainEnergyAlerts.py --mp yes -i Sample3D.sdf</span>
 2431 <span class="s2">         -o Sample3DOut.sdf</span>
 2432 
 2433 <span class="s2">    To run the first example for filtering molecules in multiprocessing mode on</span>
 2434 <span class="s2">    all available CPUs by loading all data into memory and write out a SD files,</span>
 2435 <span class="s2">    type:</span>
 2436 
 2437 <span class="s2">        % RDKitFilterTorsionStrainEnergyAlerts.py  --mp yes --mpParams</span>
 2438 <span class="s2">          &quot;inputDataMode, InMemory&quot; -i Sample3D.sdf  -o Sample3DOut.sdf</span>
 2439 
 2440 <span class="s2">    To run the first example for filtering molecules in multiprocessing mode on</span>
 2441 <span class="s2">    specific number of CPUs and chunksize without loading all data into memory</span>
 2442 <span class="s2">    and write out SD files, type:</span>
 2443 
 2444 <span class="s2">        % RDKitFilterTorsionStrainEnergyAlerts.py --mp yes --mpParams</span>
 2445 <span class="s2">          &quot;inputDataMode,lazy,numProcesses,4,chunkSize,8&quot;  -i Sample3D.sdf</span>
 2446 <span class="s2">          -o Sample3DOut.sdf</span>
 2447 
 2448 <span class="s2">    To list information about default torsion library file without performing any</span>
 2449 <span class="s2">    filtering, type:</span>
 2450 
 2451 <span class="s2">        % RDKitFilterTorsionStrainEnergyAlerts.py -l</span>
 2452 
 2453 <span class="s2">    To list information about a local torsion library XML file without performing</span>
 2454 <span class="s2">    any, filtering, type:</span>
 2455 
 2456 <span class="s2">        % RDKitFilterTorsionStrainEnergyAlerts.py --torsionEnergyLibraryFile</span>
 2457 <span class="s2">          TorsionStrainEnergyLibrary.xml -l</span>
 2458 
 2459 <span class="s2">Author:</span>
 2460 <span class="s2">    Manish Sud (msud@san.rr.com)</span>
 2461 
 2462 <span class="s2">Collaborator:</span>
 2463 <span class="s2">    Pat Walters</span>
 2464 
 2465 <span class="s2">See also:</span>
 2466 <span class="s2">    RDKitFilterChEMBLAlerts.py, RDKitFilterPAINS.py, RDKitFilterTorsionLibraryAlerts.py,</span>
 2467 <span class="s2">    RDKitConvertFileFormat.py, RDKitSearchSMARTS.py</span>
 2468 
 2469 <span class="s2">Copyright:</span>
 2470 <span class="s2">    Copyright (C) 2022 Manish Sud. All rights reserved.</span>
 2471 
 2472 <span class="s2">    This script uses the torsion strain energy library developed by Gu, S.;</span>
 2473 <span class="s2">    Smith, M. S.; Yang, Y.; Irwin, J. J.; Shoichet, B. K. [ Ref 153 ].</span>
 2474 
 2475 <span class="s2">    The torsion strain enegy library is based on the Torsion Library jointly</span>
 2476 <span class="s2">    developed by the University of Hamburg, Center for Bioinformatics,</span>
 2477 <span class="s2">    Hamburg, Germany and F. Hoffmann-La-Roche Ltd., Basel, Switzerland.</span>
 2478 
 2479 <span class="s2">    The functionality available in this script is implemented using RDKit, an</span>
 2480 <span class="s2">    open source toolkit for cheminformatics developed by Greg Landrum.</span>
 2481 
 2482 <span class="s2">    This file is part of MayaChemTools.</span>
 2483 
 2484 <span class="s2">    MayaChemTools is free software; you can redistribute it and/or modify it under</span>
 2485 <span class="s2">    the terms of the GNU Lesser General Public License as published by the Free</span>
 2486 <span class="s2">    Software Foundation; either version 3 of the License, or (at your option) any</span>
 2487 <span class="s2">    later version.</span>
 2488 
 2489 <span class="s2">&quot;&quot;&quot;</span>
 2490 
 2491 <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
 2492     <span class="n">main</span><span class="p">()</span>
</pre>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
