<html>
<head>
<title>MayaChemTools:Code:Psi4VisualizeFrontierOrbitals.py</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsPythonCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
    1 <span class="ch">#!/bin/env python</span>
    2 <span class="c1">#</span>
    3 <span class="c1"># File: Psi4VisualizeFrontierOrbitals.py</span>
    4 <span class="c1"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
    5 <span class="c1">#</span>
    6 <span class="c1"># Copyright (C) 2022 Manish Sud. All rights reserved.</span>
    7 <span class="c1">#</span>
    8 <span class="c1"># The functionality available in this script is implemented using Psi4, an</span>
    9 <span class="c1"># open source quantum chemistry software package, and RDKit, an open</span>
   10 <span class="c1"># source toolkit for cheminformatics developed by Greg Landrum.</span>
   11 <span class="c1">#</span>
   12 <span class="c1"># This file is part of MayaChemTools.</span>
   13 <span class="c1">#</span>
   14 <span class="c1"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
   15 <span class="c1"># the terms of the GNU Lesser General Public License as published by the Free</span>
   16 <span class="c1"># Software Foundation; either version 3 of the License, or (at your option) any</span>
   17 <span class="c1"># later version.</span>
   18 <span class="c1">#</span>
   19 <span class="c1"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
   20 <span class="c1"># any warranty; without even the implied warranty of merchantability of fitness</span>
   21 <span class="c1"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
   22 <span class="c1"># details.</span>
   23 <span class="c1">#</span>
   24 <span class="c1"># You should have received a copy of the GNU Lesser General Public License</span>
   25 <span class="c1"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
   26 <span class="c1"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
   27 <span class="c1"># Boston, MA, 02111-1307, USA.</span>
   28 <span class="c1">#</span>
   29 
   30 <span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
   31 
   32 <span class="c1"># Add local python path to the global path and import standard library modules...</span>
   33 <span class="kn">import</span> <span class="nn">os</span>
   34 <span class="kn">import</span> <span class="nn">sys</span><span class="p">;</span>  <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;lib&quot;</span><span class="p">,</span> <span class="s2">&quot;Python&quot;</span><span class="p">))</span>
   35 <span class="kn">import</span> <span class="nn">time</span>
   36 <span class="kn">import</span> <span class="nn">re</span>
   37 <span class="kn">import</span> <span class="nn">glob</span>
   38 <span class="kn">import</span> <span class="nn">shutil</span>
   39 <span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="kn">as</span> <span class="nn">mp</span>
   40 
   41 <span class="c1"># Psi4 imports...</span>
   42 <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">shutil</span><span class="p">,</span> <span class="s1">&#39;which&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;psi4&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
   43     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Warning: Failed to find &#39;psi4&#39; in your PATH indicating potential issues with your</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
   44     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Psi4 environment. The &#39;import psi4&#39; directive in the global scope of the script</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
   45     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;interferes with the multiprocessing functionality. It is imported later in the</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
   46     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;local scope during the execution of the script and may fail. Check/update your</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
   47     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Psi4 environment and try again.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
   48 
   49 <span class="c1"># RDKit imports...</span>
   50 <span class="k">try</span><span class="p">:</span>
   51     <span class="kn">from</span> <span class="nn">rdkit</span> <span class="kn">import</span> <span class="n">rdBase</span>
   52     <span class="kn">from</span> <span class="nn">rdkit</span> <span class="kn">import</span> <span class="n">Chem</span>
   53     <span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="kn">import</span> <span class="n">AllChem</span>
   54 <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">ErrMsg</span><span class="p">:</span>
   55     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Failed to import RDKit module/package: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ErrMsg</span><span class="p">)</span>
   56     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Check/update your RDKit environment and try again.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
   57     <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   58 
   59 <span class="c1"># MayaChemTools imports...</span>
   60 <span class="k">try</span><span class="p">:</span>
   61     <span class="kn">from</span> <span class="nn">docopt</span> <span class="kn">import</span> <span class="n">docopt</span>
   62     <span class="kn">import</span> <span class="nn">MiscUtil</span>
   63     <span class="kn">import</span> <span class="nn">Psi4Util</span>
   64     <span class="kn">import</span> <span class="nn">RDKitUtil</span>
   65 <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">ErrMsg</span><span class="p">:</span>
   66     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Failed to import MayaChemTools module/package: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ErrMsg</span><span class="p">)</span>
   67     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Check/update your MayaChemTools environment and try again.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
   68     <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   69 
   70 <span class="n">ScriptName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   71 <span class="n">Options</span> <span class="o">=</span> <span class="p">{}</span>
   72 <span class="n">OptionsInfo</span> <span class="o">=</span> <span class="p">{}</span>
   73 
   74 <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
   75     <span class="sd">&quot;&quot;&quot;Start execution of the script.&quot;&quot;&quot;</span>
   76     
   77     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="s2"> (Psi4: Imported later; RDKit v</span><span class="si">%s</span><span class="s2">; MayaChemTools v</span><span class="si">%s</span><span class="s2">; </span><span class="si">%s</span><span class="s2">): Starting...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ScriptName</span><span class="p">,</span> <span class="n">rdBase</span><span class="o">.</span><span class="n">rdkitVersion</span><span class="p">,</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">GetMayaChemToolsVersion</span><span class="p">(),</span> <span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">()))</span>
   78     
   79     <span class="p">(</span><span class="n">WallClockTime</span><span class="p">,</span> <span class="n">ProcessorTime</span><span class="p">)</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">GetWallClockAndProcessorTime</span><span class="p">()</span>
   80     
   81     <span class="c1"># Retrieve command line arguments and options...</span>
   82     <span class="n">RetrieveOptions</span><span class="p">()</span>
   83     
   84     <span class="c1"># Process and validate command line arguments and options...</span>
   85     <span class="n">ProcessOptions</span><span class="p">()</span>
   86     
   87     <span class="c1"># Perform actions required by the script...</span>
   88     <span class="n">GenerateAndVisualizeFrontierOrbitals</span><span class="p">()</span>
   89     
   90     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="s2">: Done...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ScriptName</span><span class="p">)</span>
   91     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Total time: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">GetFormattedElapsedTime</span><span class="p">(</span><span class="n">WallClockTime</span><span class="p">,</span> <span class="n">ProcessorTime</span><span class="p">))</span>
   92 
   93 <span class="k">def</span> <span class="nf">GenerateAndVisualizeFrontierOrbitals</span><span class="p">():</span>
   94     <span class="sd">&quot;&quot;&quot;Generate and visualize frontier molecular orbitals.&quot;&quot;&quot;</span>
   95     
   96     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;GenerateCubeFiles&quot;</span><span class="p">]:</span>
   97         <span class="n">GenerateFrontierOrbitals</span><span class="p">()</span>
   98         
   99     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VisualizeCubeFiles&quot;</span><span class="p">]:</span>
  100         <span class="n">VisualizeFrontierOrbitals</span><span class="p">()</span>
  101 
  102 <span class="k">def</span> <span class="nf">GenerateFrontierOrbitals</span><span class="p">():</span>
  103     <span class="sd">&quot;&quot;&quot;Generate cube files for frontier orbitals.&quot;&quot;&quot;</span>
  104     
  105     <span class="c1"># Setup a molecule reader...</span>
  106     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Processing file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Infile&quot;</span><span class="p">])</span>
  107     <span class="n">Mols</span>  <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">ReadMolecules</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilePath&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfileParams&quot;</span><span class="p">])</span>
  108     
  109     <span class="n">MolCount</span><span class="p">,</span> <span class="n">ValidMolCount</span><span class="p">,</span> <span class="n">CubeFilesFailedCount</span> <span class="o">=</span> <span class="n">ProcessMolecules</span><span class="p">(</span><span class="n">Mols</span><span class="p">)</span>
  110     
  111     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total number of molecules: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MolCount</span><span class="p">)</span>
  112     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Number of valid molecules: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ValidMolCount</span><span class="p">)</span>
  113     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Number of molecules failed during generation of cube files: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">CubeFilesFailedCount</span><span class="p">)</span>
  114     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Number of ignored molecules: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MolCount</span> <span class="o">-</span> <span class="n">ValidMolCount</span> <span class="o">+</span> <span class="n">CubeFilesFailedCount</span><span class="p">))</span>
  115 
  116 <span class="k">def</span> <span class="nf">ProcessMolecules</span><span class="p">(</span><span class="n">Mols</span><span class="p">):</span>
  117     <span class="sd">&quot;&quot;&quot;Process and generate frontier orbital cube files for molecules.&quot;&quot;&quot;</span>
  118 
  119     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MPMode&quot;</span><span class="p">]:</span>
  120         <span class="k">return</span> <span class="n">ProcessMoleculesUsingMultipleProcesses</span><span class="p">(</span><span class="n">Mols</span><span class="p">)</span>
  121     <span class="k">else</span><span class="p">:</span>
  122         <span class="k">return</span> <span class="n">ProcessMoleculesUsingSingleProcess</span><span class="p">(</span><span class="n">Mols</span><span class="p">)</span>
  123 
  124 <span class="k">def</span> <span class="nf">ProcessMoleculesUsingSingleProcess</span><span class="p">(</span><span class="n">Mols</span><span class="p">):</span>
  125     <span class="sd">&quot;&quot;&quot;Process and generate frontier orbitals cube files for molecules using a single process.&quot;&quot;&quot;</span>
  126     
  127     <span class="c1"># Intialize Psi4...</span>
  128     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Initializing Psi4...&quot;</span><span class="p">)</span>
  129     <span class="n">Psi4Handle</span> <span class="o">=</span> <span class="n">Psi4Util</span><span class="o">.</span><span class="n">InitializePsi4</span><span class="p">(</span><span class="n">Psi4RunParams</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Psi4RunParams&quot;</span><span class="p">],</span> <span class="n">Psi4OptionsParams</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Psi4OptionsParams&quot;</span><span class="p">],</span> <span class="n">PrintVersion</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">PrintHeader</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
  130     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;psi4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Psi4Handle</span>
  131 
  132     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generating cube files for frontier orbitals...&quot;</span><span class="p">)</span>
  133     
  134     <span class="p">(</span><span class="n">MolCount</span><span class="p">,</span> <span class="n">ValidMolCount</span><span class="p">,</span> <span class="n">CubeFilesFailedCount</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
  135     <span class="k">for</span> <span class="n">Mol</span> <span class="ow">in</span> <span class="n">Mols</span><span class="p">:</span>
  136         <span class="n">MolCount</span> <span class="o">+=</span> <span class="mi">1</span>
  137         
  138         <span class="k">if</span> <span class="ow">not</span> <span class="n">CheckAndValidateMolecule</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolCount</span><span class="p">):</span>
  139             <span class="k">continue</span>
  140         
  141         <span class="c1"># Setup a Psi4 molecule...</span>
  142         <span class="n">Psi4Mol</span> <span class="o">=</span> <span class="n">SetupPsi4Mol</span><span class="p">(</span><span class="n">Psi4Handle</span><span class="p">,</span> <span class="n">Mol</span><span class="p">,</span> <span class="n">MolCount</span><span class="p">)</span>
  143         <span class="k">if</span> <span class="n">Psi4Mol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  144             <span class="k">continue</span>
  145         
  146         <span class="n">ValidMolCount</span> <span class="o">+=</span> <span class="mi">1</span>
  147         
  148         <span class="n">CalcStatus</span> <span class="o">=</span> <span class="n">GenerateMolCubeFiles</span><span class="p">(</span><span class="n">Psi4Handle</span><span class="p">,</span> <span class="n">Psi4Mol</span><span class="p">,</span> <span class="n">Mol</span><span class="p">,</span> <span class="n">MolCount</span><span class="p">)</span>
  149 
  150         <span class="k">if</span> <span class="ow">not</span> <span class="n">CalcStatus</span><span class="p">:</span>
  151             <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
  152                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Failed to generate cube files for molecule </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">GetMolName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolCount</span><span class="p">))</span>
  153             
  154             <span class="n">CubeFilesFailedCount</span> <span class="o">+=</span> <span class="mi">1</span>
  155             <span class="k">continue</span>
  156         
  157     <span class="k">return</span> <span class="p">(</span><span class="n">MolCount</span><span class="p">,</span> <span class="n">ValidMolCount</span><span class="p">,</span> <span class="n">CubeFilesFailedCount</span><span class="p">)</span>
  158     
  159 <span class="k">def</span> <span class="nf">ProcessMoleculesUsingMultipleProcesses</span><span class="p">(</span><span class="n">Mols</span><span class="p">):</span>
  160     <span class="sd">&quot;&quot;&quot;Process and generate frontier orbitals cube files for molecules using  multiple processes.&quot;&quot;&quot;</span>
  161 
  162     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generating frontier orbitals using multiprocessing...&quot;</span><span class="p">)</span>
  163     
  164     <span class="n">MPParams</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MPParams&quot;</span><span class="p">]</span>
  165     
  166     <span class="c1"># Setup data for initializing a worker process...</span>
  167     <span class="n">InitializeWorkerProcessArgs</span> <span class="o">=</span> <span class="p">(</span><span class="n">MiscUtil</span><span class="o">.</span><span class="n">ObjectToBase64EncodedString</span><span class="p">(</span><span class="n">Options</span><span class="p">),</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ObjectToBase64EncodedString</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">))</span>
  168     
  169     <span class="c1"># Setup a encoded mols data iterable for a worker process...</span>
  170     <span class="n">WorkerProcessDataIterable</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">GenerateBase64EncodedMolStrings</span><span class="p">(</span><span class="n">Mols</span><span class="p">)</span>
  171     
  172     <span class="c1"># Setup process pool along with data initialization for each process...</span>
  173     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
  174         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Configuring multiprocessing using </span><span class="si">%s</span><span class="s2"> method...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;mp.Pool.imap()&quot;</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Lazy$&quot;</span><span class="p">,</span> <span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;InputDataMode&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;mp.Pool.map()&quot;</span><span class="p">))</span>
  175         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;NumProcesses: </span><span class="si">%s</span><span class="s2">; InputDataMode: </span><span class="si">%s</span><span class="s2">; ChunkSize: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;NumProcesses&quot;</span><span class="p">],</span> <span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;InputDataMode&quot;</span><span class="p">],</span> <span class="p">(</span><span class="s2">&quot;automatic&quot;</span> <span class="k">if</span> <span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;ChunkSize&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;ChunkSize&quot;</span><span class="p">])))</span>
  176     
  177     <span class="n">ProcessPool</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;NumProcesses&quot;</span><span class="p">],</span> <span class="n">InitializeWorkerProcess</span><span class="p">,</span> <span class="n">InitializeWorkerProcessArgs</span><span class="p">)</span>
  178     
  179     <span class="c1"># Start processing...</span>
  180     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Lazy$&quot;</span><span class="p">,</span> <span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;InputDataMode&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  181         <span class="n">Results</span> <span class="o">=</span> <span class="n">ProcessPool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">WorkerProcess</span><span class="p">,</span> <span class="n">WorkerProcessDataIterable</span><span class="p">,</span> <span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;ChunkSize&quot;</span><span class="p">])</span>
  182     <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^InMemory$&quot;</span><span class="p">,</span> <span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;InputDataMode&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  183         <span class="n">Results</span> <span class="o">=</span> <span class="n">ProcessPool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">WorkerProcess</span><span class="p">,</span> <span class="n">WorkerProcessDataIterable</span><span class="p">,</span> <span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;ChunkSize&quot;</span><span class="p">])</span>
  184     <span class="k">else</span><span class="p">:</span>
  185         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The value, </span><span class="si">%s</span><span class="s2">, specified for </span><span class="se">\&quot;</span><span class="s2">--inputDataMode</span><span class="se">\&quot;</span><span class="s2"> is not supported.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MPParams</span><span class="p">[</span><span class="s2">&quot;InputDataMode&quot;</span><span class="p">]))</span>
  186 
  187     <span class="c1"># Print out Psi4 version in the main process...</span>
  188     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Initializing Psi4...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
  189     <span class="n">Psi4Handle</span>  <span class="o">=</span> <span class="n">Psi4Util</span><span class="o">.</span><span class="n">InitializePsi4</span><span class="p">(</span><span class="n">PrintVersion</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">PrintHeader</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
  190     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;psi4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Psi4Handle</span>
  191     
  192     <span class="p">(</span><span class="n">MolCount</span><span class="p">,</span> <span class="n">ValidMolCount</span><span class="p">,</span> <span class="n">CubeFilesFailedCount</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
  193     <span class="k">for</span> <span class="n">Result</span> <span class="ow">in</span> <span class="n">Results</span><span class="p">:</span>
  194         <span class="n">MolCount</span> <span class="o">+=</span> <span class="mi">1</span>
  195         <span class="n">MolIndex</span><span class="p">,</span> <span class="n">EncodedMol</span><span class="p">,</span> <span class="n">CalcStatus</span> <span class="o">=</span> <span class="n">Result</span>
  196         
  197         <span class="k">if</span> <span class="n">EncodedMol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  198             <span class="k">continue</span>
  199         
  200         <span class="n">ValidMolCount</span> <span class="o">+=</span> <span class="mi">1</span>
  201 
  202         <span class="n">Mol</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">MolFromBase64EncodedMolString</span><span class="p">(</span><span class="n">EncodedMol</span><span class="p">)</span>
  203         
  204         <span class="k">if</span> <span class="ow">not</span> <span class="n">CalcStatus</span><span class="p">:</span>
  205             <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
  206                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Failed to generate cube files for molecule </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">GetMolName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolCount</span><span class="p">))</span>
  207             
  208             <span class="n">CubeFilesFailedCount</span> <span class="o">+=</span> <span class="mi">1</span>
  209             <span class="k">continue</span>
  210         
  211     <span class="k">return</span> <span class="p">(</span><span class="n">MolCount</span><span class="p">,</span> <span class="n">ValidMolCount</span><span class="p">,</span> <span class="n">CubeFilesFailedCount</span><span class="p">)</span>
  212 
  213 <span class="k">def</span> <span class="nf">InitializeWorkerProcess</span><span class="p">(</span><span class="o">*</span><span class="n">EncodedArgs</span><span class="p">):</span>
  214     <span class="sd">&quot;&quot;&quot;Initialize data for a worker process.&quot;&quot;&quot;</span>
  215     
  216     <span class="k">global</span> <span class="n">Options</span><span class="p">,</span> <span class="n">OptionsInfo</span>
  217     
  218     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
  219         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Starting process (PID: </span><span class="si">%s</span><span class="s2">)...&quot;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
  220     
  221     <span class="c1"># Decode Options and OptionInfo...</span>
  222     <span class="n">Options</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ObjectFromBase64EncodedString</span><span class="p">(</span><span class="n">EncodedArgs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  223     <span class="n">OptionsInfo</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ObjectFromBase64EncodedString</span><span class="p">(</span><span class="n">EncodedArgs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
  224 
  225     <span class="c1"># Psi4 is initialized in the worker process to avoid creation of redundant Psi4</span>
  226     <span class="c1"># output files for each process...</span>
  227     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Psi4Initialized&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">False</span>
  228 
  229 <span class="k">def</span> <span class="nf">InitializePsi4ForWorkerProcess</span><span class="p">():</span>
  230     <span class="sd">&quot;&quot;&quot;Initialize Psi4 for a worker process.&quot;&quot;&quot;</span>
  231     
  232     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Psi4Initialized&quot;</span><span class="p">]:</span>
  233         <span class="k">return</span>
  234 
  235     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Psi4Initialized&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
  236     
  237     <span class="c1"># Update output file...</span>
  238     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Psi4RunParams&quot;</span><span class="p">][</span><span class="s2">&quot;OutputFile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Psi4Util</span><span class="o">.</span><span class="n">UpdatePsi4OutputFileUsingPID</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Psi4RunParams&quot;</span><span class="p">][</span><span class="s2">&quot;OutputFile&quot;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
  239     
  240     <span class="c1"># Intialize Psi4...</span>
  241     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;psi4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Psi4Util</span><span class="o">.</span><span class="n">InitializePsi4</span><span class="p">(</span><span class="n">Psi4RunParams</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Psi4RunParams&quot;</span><span class="p">],</span> <span class="n">Psi4OptionsParams</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Psi4OptionsParams&quot;</span><span class="p">],</span> <span class="n">PrintVersion</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">PrintHeader</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
  242     
  243 <span class="k">def</span> <span class="nf">WorkerProcess</span><span class="p">(</span><span class="n">EncodedMolInfo</span><span class="p">):</span>
  244     <span class="sd">&quot;&quot;&quot;Process data for a worker process.&quot;&quot;&quot;</span>
  245     
  246     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Psi4Initialized&quot;</span><span class="p">]:</span>
  247         <span class="n">InitializePsi4ForWorkerProcess</span><span class="p">()</span>
  248     
  249     <span class="n">MolIndex</span><span class="p">,</span> <span class="n">EncodedMol</span> <span class="o">=</span> <span class="n">EncodedMolInfo</span>
  250     
  251     <span class="n">CalcStatus</span> <span class="o">=</span> <span class="bp">False</span>
  252     
  253     <span class="k">if</span> <span class="n">EncodedMol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  254         <span class="k">return</span> <span class="p">[</span><span class="n">MolIndex</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">CalcStatus</span><span class="p">]</span>
  255     
  256     <span class="n">Mol</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">MolFromBase64EncodedMolString</span><span class="p">(</span><span class="n">EncodedMol</span><span class="p">)</span>
  257     <span class="n">MolCount</span> <span class="o">=</span> <span class="n">MolIndex</span> <span class="o">+</span> <span class="mi">1</span>
  258     
  259     <span class="k">if</span> <span class="ow">not</span> <span class="n">CheckAndValidateMolecule</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolCount</span><span class="p">):</span>
  260         <span class="k">return</span> <span class="p">[</span><span class="n">MolIndex</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">CalcStatus</span><span class="p">]</span>
  261     
  262     <span class="c1"># Setup a Psi4 molecule...</span>
  263     <span class="n">Psi4Mol</span> <span class="o">=</span> <span class="n">SetupPsi4Mol</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;psi4&quot;</span><span class="p">],</span> <span class="n">Mol</span><span class="p">,</span> <span class="n">MolCount</span><span class="p">)</span>
  264     <span class="k">if</span> <span class="n">Psi4Mol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  265         <span class="k">return</span> <span class="p">[</span><span class="n">MolIndex</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">CalcStatus</span><span class="p">]</span>
  266     
  267     <span class="n">CalcStatus</span> <span class="o">=</span> <span class="n">GenerateMolCubeFiles</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;psi4&quot;</span><span class="p">],</span> <span class="n">Psi4Mol</span><span class="p">,</span> <span class="n">Mol</span><span class="p">,</span> <span class="n">MolCount</span><span class="p">)</span>
  268     
  269     <span class="k">return</span> <span class="p">[</span><span class="n">MolIndex</span><span class="p">,</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">MolToBase64EncodedMolString</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">PropertyPickleFlags</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">PropertyPickleOptions</span><span class="o">.</span><span class="n">MolProps</span> <span class="o">|</span> <span class="n">Chem</span><span class="o">.</span><span class="n">PropertyPickleOptions</span><span class="o">.</span><span class="n">PrivateProps</span><span class="p">),</span> <span class="n">CalcStatus</span><span class="p">]</span>
  270 
  271 <span class="k">def</span> <span class="nf">GenerateMolCubeFiles</span><span class="p">(</span><span class="n">Psi4Handle</span><span class="p">,</span> <span class="n">Psi4Mol</span><span class="p">,</span> <span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  272     <span class="sd">&quot;&quot;&quot;Generate cube files for frontier orbitals.&quot;&quot;&quot;</span>
  273     
  274     <span class="c1">#  Setup reference wave function...</span>
  275     <span class="n">Reference</span> <span class="o">=</span> <span class="n">SetupReferenceWavefunction</span><span class="p">(</span><span class="n">Mol</span><span class="p">)</span>
  276     <span class="n">Psi4Handle</span><span class="o">.</span><span class="n">set_options</span><span class="p">({</span><span class="s1">&#39;Reference&#39;</span><span class="p">:</span> <span class="n">Reference</span><span class="p">})</span>
  277     
  278     <span class="c1"># Setup method name and basis set...</span>
  279     <span class="n">MethodName</span><span class="p">,</span> <span class="n">BasisSet</span> <span class="o">=</span> <span class="n">SetupMethodNameAndBasisSet</span><span class="p">(</span><span class="n">Mol</span><span class="p">)</span>
  280     
  281     <span class="c1"># Calculate single point energy to setup a wavefunction...</span>
  282     <span class="n">Status</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">WaveFunction</span> <span class="o">=</span> <span class="n">Psi4Util</span><span class="o">.</span><span class="n">CalculateSinglePointEnergy</span><span class="p">(</span><span class="n">Psi4Handle</span><span class="p">,</span> <span class="n">Psi4Mol</span><span class="p">,</span> <span class="n">MethodName</span><span class="p">,</span> <span class="n">BasisSet</span><span class="p">,</span> <span class="n">ReturnWaveFunction</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">Quiet</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">])</span>
  283 
  284     <span class="k">if</span> <span class="ow">not</span> <span class="n">Status</span><span class="p">:</span>
  285         <span class="n">PerformPsi4Cleanup</span><span class="p">(</span><span class="n">Psi4Handle</span><span class="p">)</span>
  286         <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">)</span>
  287     
  288     <span class="c1"># Generate cube files...</span>
  289     <span class="n">Status</span> <span class="o">=</span> <span class="n">GenerateCubeFilesForFrontierOrbitals</span><span class="p">(</span><span class="n">Psi4Handle</span><span class="p">,</span> <span class="n">WaveFunction</span><span class="p">,</span> <span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">)</span>
  290     
  291     <span class="c1"># Clean up</span>
  292     <span class="n">PerformPsi4Cleanup</span><span class="p">(</span><span class="n">Psi4Handle</span><span class="p">)</span>
  293 
  294     <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">)</span>
  295 
  296 <span class="k">def</span> <span class="nf">GenerateCubeFilesForFrontierOrbitals</span><span class="p">(</span><span class="n">Psi4Handle</span><span class="p">,</span> <span class="n">WaveFunction</span><span class="p">,</span> <span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">):</span>
  297     <span class="sd">&quot;&quot;&quot;Generate cube files for frontier orbitals.&quot;&quot;&quot;</span>
  298     
  299     <span class="c1"># Setup a temporary local directory to generate cube files...</span>
  300     <span class="n">Status</span><span class="p">,</span> <span class="n">CubeFilesDir</span><span class="p">,</span> <span class="n">CubeFilesDirPath</span> <span class="o">=</span> <span class="n">SetupMolCubeFilesDir</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">)</span>
  301     <span class="k">if</span> <span class="ow">not</span> <span class="n">Status</span><span class="p">:</span>
  302         <span class="k">return</span> <span class="bp">False</span>
  303     
  304     <span class="c1"># Generate cube files using psi4.cubeprop...</span>
  305     <span class="n">Status</span><span class="p">,</span> <span class="n">Psi4CubeFiles</span> <span class="o">=</span> <span class="n">GenerateCubeFilesUsingCubeprop</span><span class="p">(</span><span class="n">Psi4Handle</span><span class="p">,</span> <span class="n">WaveFunction</span><span class="p">,</span> <span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">,</span> <span class="n">CubeFilesDir</span><span class="p">,</span> <span class="n">CubeFilesDirPath</span><span class="p">)</span>
  306     <span class="k">if</span> <span class="ow">not</span> <span class="n">Status</span><span class="p">:</span>
  307         <span class="k">return</span> <span class="bp">False</span>
  308 
  309     <span class="c1"># Copy and rename cube files...</span>
  310     <span class="k">if</span> <span class="ow">not</span> <span class="n">MoveAndRenameCubeFiles</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">,</span> <span class="n">Psi4CubeFiles</span><span class="p">):</span>
  311         <span class="k">return</span> <span class="bp">False</span>
  312 
  313     <span class="c1"># Delete temporary local directory...</span>
  314     <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">CubeFilesDir</span><span class="p">):</span>
  315         <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">CubeFilesDir</span><span class="p">)</span>
  316     
  317     <span class="k">if</span> <span class="ow">not</span> <span class="n">GenerateMolFile</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">):</span>
  318         <span class="k">return</span> <span class="bp">False</span>
  319     
  320     <span class="k">return</span> <span class="bp">True</span>
  321 
  322 <span class="k">def</span> <span class="nf">SetupMolCubeFilesDir</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">):</span>
  323     <span class="sd">&quot;&quot;&quot;Setup a directory for generating cube files for a molecule.&quot;&quot;&quot;</span>
  324     
  325     <span class="n">MolPrefix</span> <span class="o">=</span> <span class="n">SetupMolPrefix</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">)</span>
  326 
  327     <span class="n">CubeFilesDir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_CubeFiles&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MolPrefix</span><span class="p">)</span>
  328     <span class="n">CubeFilesDirPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">CubeFilesDir</span><span class="p">)</span>
  329     <span class="k">try</span><span class="p">:</span>
  330         <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">CubeFilesDir</span><span class="p">):</span>
  331             <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">CubeFilesDir</span><span class="p">)</span>
  332         <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">CubeFilesDir</span><span class="p">)</span>
  333     <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ErrMsg</span><span class="p">:</span>
  334         <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
  335             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Failed to create cube files: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ErrMsg</span><span class="p">)</span>
  336             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Ignoring molecule: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">GetMolName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">))</span>
  337         <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
  338         
  339     <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">CubeFilesDir</span><span class="p">,</span> <span class="n">CubeFilesDirPath</span><span class="p">)</span>
  340 
  341 <span class="k">def</span> <span class="nf">GenerateCubeFilesUsingCubeprop</span><span class="p">(</span><span class="n">Psi4Handle</span><span class="p">,</span> <span class="n">WaveFunction</span><span class="p">,</span> <span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">,</span> <span class="n">CubeFilesDir</span><span class="p">,</span> <span class="n">CubeFilesDirPath</span><span class="p">):</span>
  342     <span class="sd">&quot;&quot;&quot;Generate cube files using cubeprop.&quot;&quot;&quot;</span>
  343     
  344     <span class="n">Psi4CubeFilesParams</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Psi4CubeFilesParams&quot;</span><span class="p">]</span>
  345 
  346     <span class="c1"># Generate cube files...</span>
  347     <span class="n">GridSpacing</span> <span class="o">=</span> <span class="n">Psi4CubeFilesParams</span><span class="p">[</span><span class="s2">&quot;GridSpacing&quot;</span><span class="p">]</span>
  348     <span class="n">GridOverage</span> <span class="o">=</span> <span class="n">Psi4CubeFilesParams</span><span class="p">[</span><span class="s2">&quot;GridOverage&quot;</span><span class="p">]</span>
  349     <span class="n">IsoContourThreshold</span> <span class="o">=</span> <span class="n">Psi4CubeFilesParams</span><span class="p">[</span><span class="s2">&quot;IsoContourThreshold&quot;</span><span class="p">]</span>
  350     <span class="k">try</span><span class="p">:</span>
  351         <span class="n">Psi4Handle</span><span class="o">.</span><span class="n">set_options</span><span class="p">({</span><span class="s2">&quot;CUBEPROP_TASKS&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;FRONTIER_ORBITALS&#39;</span><span class="p">],</span>
  352                                 <span class="s2">&quot;CUBIC_GRID_SPACING&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">GridSpacing</span><span class="p">,</span> <span class="n">GridSpacing</span><span class="p">,</span> <span class="n">GridSpacing</span><span class="p">],</span>
  353                                 <span class="s2">&quot;CUBIC_GRID_OVERAGE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">GridOverage</span><span class="p">,</span> <span class="n">GridOverage</span><span class="p">,</span> <span class="n">GridOverage</span><span class="p">],</span>
  354                                 <span class="s2">&quot;CUBEPROP_FILEPATH&quot;</span><span class="p">:</span> <span class="n">CubeFilesDirPath</span><span class="p">,</span>
  355                                 <span class="s2">&quot;CUBEPROP_ISOCONTOUR_THRESHOLD&quot;</span><span class="p">:</span> <span class="n">IsoContourThreshold</span><span class="p">})</span>
  356         <span class="n">Psi4Handle</span><span class="o">.</span><span class="n">cubeprop</span><span class="p">(</span><span class="n">WaveFunction</span><span class="p">)</span>
  357     <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ErrMsg</span><span class="p">:</span>
  358         <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">CubeFilesDir</span><span class="p">)</span>
  359         <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
  360             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Failed to create cube files: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ErrMsg</span><span class="p">)</span>
  361             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Ignoring molecule: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">GetMolName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">))</span>
  362         <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
  363 
  364     <span class="c1"># Collect cube files...</span>
  365     <span class="n">Psi4CubeFiles</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CubeFilesDir</span><span class="p">,</span> <span class="s2">&quot;Psi*.cube&quot;</span><span class="p">))</span>
  366     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Psi4CubeFiles</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
  367         <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">CubeFilesDir</span><span class="p">)</span>
  368         <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
  369             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Failed to create cube files for frontier orbitals...&quot;</span><span class="p">)</span>
  370             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Ignoring molecule: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">GetMolName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">))</span>
  371         <span class="k">return</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
  372     
  373     <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">Psi4CubeFiles</span><span class="p">)</span>
  374 
  375 <span class="k">def</span> <span class="nf">MoveAndRenameCubeFiles</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">,</span> <span class="n">Psi4CubeFiles</span><span class="p">):</span>
  376     <span class="sd">&quot;&quot;&quot;Move and rename cube files.&quot;&quot;&quot;</span>
  377     
  378     <span class="k">for</span> <span class="n">Psi4CubeFileName</span> <span class="ow">in</span> <span class="n">Psi4CubeFiles</span><span class="p">:</span>
  379         <span class="k">try</span><span class="p">:</span>
  380             <span class="n">NewCubeFileName</span> <span class="o">=</span> <span class="n">SetupMolCubeFileName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">,</span> <span class="n">Psi4CubeFileName</span><span class="p">)</span>
  381             <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">Psi4CubeFileName</span><span class="p">,</span> <span class="n">NewCubeFileName</span><span class="p">)</span>
  382         <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ErrMsg</span><span class="p">:</span>
  383             <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
  384                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Failed to move cube file: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ErrMsg</span><span class="p">)</span>
  385                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Ignoring molecule: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">GetMolName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">))</span>
  386             <span class="k">return</span> <span class="bp">False</span>
  387     
  388     <span class="k">return</span> <span class="bp">True</span>
  389 
  390 <span class="k">def</span> <span class="nf">GenerateMolFile</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">):</span>
  391     <span class="sd">&quot;&quot;&quot;Generate a SD file for molecules corresponding to cube files.&quot;&quot;&quot;</span>
  392 
  393     <span class="n">Outfile</span> <span class="o">=</span> <span class="n">SetupMolFileName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">)</span>
  394     
  395     <span class="n">OutfileParams</span> <span class="o">=</span> <span class="p">{}</span>
  396     <span class="n">Writer</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">MoleculesWriter</span><span class="p">(</span><span class="n">Outfile</span><span class="p">,</span> <span class="o">**</span><span class="n">OutfileParams</span><span class="p">)</span>
  397     <span class="k">if</span> <span class="n">Writer</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  398         <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
  399             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Failed to setup a writer for output fie </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">Outfile</span><span class="p">)</span>
  400         <span class="k">return</span> <span class="bp">False</span>
  401     
  402     <span class="n">Writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Mol</span><span class="p">)</span>
  403 
  404     <span class="k">if</span> <span class="n">Writer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
  405         <span class="n">Writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
  406     
  407     <span class="k">return</span> <span class="bp">True</span>
  408 
  409 <span class="k">def</span> <span class="nf">VisualizeFrontierOrbitals</span><span class="p">():</span>
  410     <span class="sd">&quot;&quot;&quot;Visualize cube files for frontier orbitals.&quot;&quot;&quot;</span>
  411     
  412     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Visualizing cube files for frontier orbitals...&quot;</span><span class="p">)</span>
  413 
  414     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;GenerateCubeFiles&quot;</span><span class="p">]:</span>
  415         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Initializing Psi4...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
  416         <span class="n">Psi4Handle</span>  <span class="o">=</span> <span class="n">Psi4Util</span><span class="o">.</span><span class="n">InitializePsi4</span><span class="p">(</span><span class="n">PrintVersion</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">PrintHeader</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
  417         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;psi4&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Psi4Handle</span>
  418     
  419     <span class="c1"># Setup a molecule reader...</span>
  420     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Processing file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Infile&quot;</span><span class="p">])</span>
  421     <span class="n">Mols</span>  <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">ReadMolecules</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilePath&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfileParams&quot;</span><span class="p">])</span>
  422     
  423     <span class="c1"># Setup for writing a PyMOL PML file...</span>
  424     <span class="n">Outfile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">]</span>
  425     <span class="n">OutFH</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">Outfile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
  426     <span class="k">if</span> <span class="n">OutFH</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  427         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Failed to open output fie </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">Outfile</span><span class="p">)</span>
  428     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generating file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">Outfile</span><span class="p">)</span>
  429 
  430     <span class="c1"># Setup header...</span>
  431     <span class="n">WritePMLHeader</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">ScriptName</span><span class="p">)</span>
  432     <span class="n">WritePyMOLParameters</span><span class="p">(</span><span class="n">OutFH</span><span class="p">)</span>
  433 
  434     <span class="c1"># Process cube files for molecules...</span>
  435     <span class="n">FirstMol</span> <span class="o">=</span> <span class="bp">True</span>
  436     <span class="p">(</span><span class="n">MolCount</span><span class="p">,</span> <span class="n">ValidMolCount</span><span class="p">,</span> <span class="n">CubeFilesMissingCount</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
  437     <span class="k">for</span> <span class="n">Mol</span> <span class="ow">in</span> <span class="n">Mols</span><span class="p">:</span>
  438         <span class="n">MolCount</span> <span class="o">+=</span> <span class="mi">1</span>
  439         
  440         <span class="k">if</span> <span class="n">Mol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  441             <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
  442                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Processing molecule number </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">MolCount</span><span class="p">)</span>
  443             <span class="k">continue</span>
  444         <span class="n">ValidMolCount</span> <span class="o">+=</span> <span class="mi">1</span>
  445         
  446         <span class="n">MolName</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">GetMolName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolCount</span><span class="p">)</span>
  447         <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
  448             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Processing molecule </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">MolName</span><span class="p">)</span>
  449         
  450         <span class="c1"># Retrieve cube files...</span>
  451         <span class="n">CubeFilesStatus</span><span class="p">,</span> <span class="n">CubeFilesInfo</span> <span class="o">=</span> <span class="n">RetrieveMolCubeFilesInfo</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolCount</span><span class="p">)</span>
  452         <span class="k">if</span> <span class="ow">not</span> <span class="n">CubeFilesStatus</span><span class="p">:</span>
  453             <span class="n">CubeFilesMissingCount</span> <span class="o">+=</span> <span class="mi">1</span>
  454             <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
  455                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Ignoring molecule with missing cube file...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
  456             <span class="k">continue</span>
  457         
  458         <span class="c1"># Setup PyMOL object names..</span>
  459         <span class="n">PyMOLObjectNames</span> <span class="o">=</span> <span class="n">SetupPyMOLObjectNames</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolCount</span><span class="p">,</span> <span class="n">CubeFilesInfo</span><span class="p">)</span>
  460 
  461         <span class="c1"># Setup molecule view...</span>
  462         <span class="n">WriteMolView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">CubeFilesInfo</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">)</span>
  463         
  464         <span class="c1"># Setup orbital views...</span>
  465         <span class="n">FirstOrbital</span> <span class="o">=</span> <span class="bp">True</span>
  466         <span class="k">for</span> <span class="n">OrbitalID</span> <span class="ow">in</span> <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;OrbitalIDs&quot;</span><span class="p">]:</span>
  467             <span class="n">FirstSpin</span> <span class="o">=</span> <span class="bp">True</span>
  468             <span class="k">for</span> <span class="n">SpinID</span> <span class="ow">in</span> <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;SpinIDs&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">]:</span>
  469                 <span class="n">WriteOrbitalSpinView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">CubeFilesInfo</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">OrbitalID</span><span class="p">,</span> <span class="n">SpinID</span><span class="p">,</span> <span class="n">FirstSpin</span><span class="p">)</span>
  470                 <span class="n">FirstSpin</span> <span class="o">=</span> <span class="bp">False</span>
  471         
  472             <span class="c1"># Setup orbital level group...</span>
  473             <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">]</span>
  474             <span class="k">if</span> <span class="n">FirstOrbital</span><span class="p">:</span>
  475                 <span class="n">FirstOrbital</span> <span class="o">=</span> <span class="bp">False</span>
  476                 <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span> <span class="o">=</span> <span class="p">[</span><span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">]</span>
  477             <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Orbitals&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="s2">&quot;OrbitalGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Orbitals&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="s2">&quot;OrbitalGroupMembers&quot;</span><span class="p">],</span> <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span><span class="p">)</span>
  478 
  479         <span class="c1"># Setup mol level group...</span>
  480         <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">]</span>
  481         <span class="k">if</span> <span class="n">FirstMol</span><span class="p">:</span>
  482             <span class="n">FirstMol</span> <span class="o">=</span> <span class="bp">False</span>
  483             <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span> <span class="o">=</span> <span class="p">[</span><span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">]</span>
  484         <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;MolGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;MolGroupMembers&quot;</span><span class="p">],</span> <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span><span class="p">)</span>
  485     
  486     <span class="n">OutFH</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
  487     
  488     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total number of molecules: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MolCount</span><span class="p">)</span>
  489     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Number of valid molecules: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ValidMolCount</span><span class="p">)</span>
  490     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Number of molecules with missing cube files: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">CubeFilesMissingCount</span><span class="p">)</span>
  491     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Number of ignored molecules: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MolCount</span> <span class="o">-</span> <span class="n">ValidMolCount</span> <span class="o">+</span> <span class="n">CubeFilesMissingCount</span><span class="p">))</span>
  492 
  493 <span class="k">def</span> <span class="nf">WritePMLHeader</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">ScriptName</span><span class="p">):</span>
  494     <span class="sd">&quot;&quot;&quot;Write out PML header.&quot;&quot;&quot;</span>
  495 
  496     <span class="n">HeaderInfo</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
  497 <span class="s2">#</span>
  498 <span class="s2"># This file is automatically generated by the following Psi4 script available in</span>
  499 <span class="s2"># MayaChemTools: </span><span class="si">%s</span><span class="s2"></span>
  500 <span class="s2">#</span>
  501 <span class="s2">cmd.reinitialize() &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ScriptName</span><span class="p">)</span>
  502     
  503     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">HeaderInfo</span><span class="p">)</span>
  504 
  505 <span class="k">def</span> <span class="nf">WritePyMOLParameters</span><span class="p">(</span><span class="n">OutFH</span><span class="p">):</span>
  506     <span class="sd">&quot;&quot;&quot;Write out PyMOL global parameters.&quot;&quot;&quot;</span>
  507 
  508     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Setting up PyMOL gobal parameters...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
  509     <span class="n">PMLCmds</span> <span class="o">=</span> <span class="p">[]</span>
  510     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;mesh_quality&quot;, </span><span class="si">%s</span><span class="s2">)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">][</span><span class="s2">&quot;MeshQuality&quot;</span><span class="p">]))</span>
  511     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;mesh_width&quot;, </span><span class="si">%.2f</span><span class="s2">)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">][</span><span class="s2">&quot;MeshWidth&quot;</span><span class="p">]))</span>
  512     
  513     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;surface_quality&quot;, </span><span class="si">%s</span><span class="s2">)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">][</span><span class="s2">&quot;SurfaceQuality&quot;</span><span class="p">]))</span>
  514     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;transparency&quot;, </span><span class="si">%.2f</span><span class="s2">)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">][</span><span class="s2">&quot;SurfaceTransparency&quot;</span><span class="p">]))</span>
  515     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PMLCmds</span><span class="p">)</span>
  516     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  517 
  518     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">][</span><span class="s2">&quot;SetupGlobalVolumeColorRamp&quot;</span><span class="p">]:</span>
  519         <span class="n">PyMOLViewParams</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">]</span>
  520         <span class="n">GenerateAndWritePMLForVolumeColorRamp</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;GlobalVolumeColorRampName&quot;</span><span class="p">],</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;ContourLevel1&quot;</span><span class="p">],</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;ContourColor1&quot;</span><span class="p">],</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;ContourLevel2&quot;</span><span class="p">],</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;ContourColor2&quot;</span><span class="p">],</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;VolumeContourWindowFactor&quot;</span><span class="p">],</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampOpacity&quot;</span><span class="p">])</span>
  521 
  522 <span class="k">def</span> <span class="nf">WriteMolView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">CubeFilesInfo</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">):</span>
  523     <span class="sd">&quot;&quot;&quot;Write out PML for viewing molecules.&quot;&quot;&quot;</span>
  524 
  525     <span class="n">MolName</span> <span class="o">=</span> <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;MolName&quot;</span><span class="p">]</span>
  526     <span class="n">MolFile</span> <span class="o">=</span> <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;MolFile&quot;</span><span class="p">]</span>
  527     
  528     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Loading </span><span class="si">%s</span><span class="s2"> and setting up view for molecule...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">MolFile</span><span class="p">)</span>
  529     
  530     <span class="n">PyMOLViewParams</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">]</span>
  531     <span class="n">PMLCmds</span> <span class="o">=</span> <span class="p">[]</span>
  532     
  533     <span class="c1"># Molecule...</span>
  534     <span class="n">Name</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Mol&quot;</span><span class="p">]</span>
  535     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.load(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MolFile</span><span class="p">,</span> <span class="n">Name</span><span class="p">))</span>
  536     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.hide(&quot;everything&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Name</span><span class="p">))</span>
  537     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;util.cbag(&quot;</span><span class="si">%s</span><span class="s2">&quot;, _self = cmd)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Name</span><span class="p">))</span>
  538     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.show(&quot;sticks&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Name</span><span class="p">))</span>
  539     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;stick_radius&quot;, </span><span class="si">%s</span><span class="s2">, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;DisplayStickRadius&quot;</span><span class="p">],</span> <span class="n">Name</span><span class="p">))</span>
  540     <span class="k">if</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;HideHydrogens&quot;</span><span class="p">]:</span>
  541         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.hide(&quot;(</span><span class="si">%s</span><span class="s2"> and hydro)&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Name</span><span class="p">))</span>
  542     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Sticks$&quot;</span><span class="p">,</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;DisplayMolecule&quot;</span><span class="p">]):</span>
  543         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.enable(&quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Name</span><span class="p">))</span>
  544     <span class="k">else</span><span class="p">:</span>
  545         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.disable(&quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Name</span><span class="p">))</span>
  546 
  547     <span class="c1"># Molecule ball and stick...</span>
  548     <span class="n">Name</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;MolBallAndStick&quot;</span><span class="p">]</span>
  549     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.load(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MolFile</span><span class="p">,</span> <span class="n">Name</span><span class="p">))</span>
  550     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.hide(&quot;everything&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Name</span><span class="p">))</span>
  551     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;util.cbag(&quot;</span><span class="si">%s</span><span class="s2">&quot;, _self = cmd)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Name</span><span class="p">))</span>
  552     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.show(&quot;sphere&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Name</span><span class="p">))</span>
  553     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.show(&quot;sticks&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Name</span><span class="p">))</span>
  554     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;sphere_scale&quot;, </span><span class="si">%s</span><span class="s2">, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;DisplaySphereScale&quot;</span><span class="p">],</span> <span class="n">Name</span><span class="p">))</span>
  555     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;stick_radius&quot;, </span><span class="si">%s</span><span class="s2">, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;DisplayStickRadius&quot;</span><span class="p">],</span> <span class="n">Name</span><span class="p">))</span>
  556     <span class="k">if</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;HideHydrogens&quot;</span><span class="p">]:</span>
  557         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.hide(&quot;(</span><span class="si">%s</span><span class="s2"> and hydro)&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Name</span><span class="p">))</span>
  558     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^BallAndStick$&quot;</span><span class="p">,</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;DisplayMolecule&quot;</span><span class="p">]):</span>
  559         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.enable(&quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Name</span><span class="p">))</span>
  560     <span class="k">else</span><span class="p">:</span>
  561         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.disable(&quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Name</span><span class="p">))</span>
  562     
  563     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PMLCmds</span><span class="p">)</span>
  564     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  565     
  566     <span class="c1"># MolAlone group...</span>
  567     <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;MolAloneGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;MolAloneGroupMembers&quot;</span><span class="p">],</span> <span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">)</span>
  568 
  569 <span class="k">def</span> <span class="nf">WriteOrbitalSpinView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">CubeFilesInfo</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">OrbitalID</span><span class="p">,</span> <span class="n">SpinID</span><span class="p">,</span> <span class="n">FirstSpin</span><span class="p">):</span>
  570     <span class="sd">&quot;&quot;&quot;Write out PML for viewing spins in an orbital.&quot;&quot;&quot;</span>
  571 
  572     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Setting up views for spin </span><span class="si">%s</span><span class="s2"> in orbital </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SpinID</span><span class="p">,</span> <span class="n">OrbitalID</span><span class="p">))</span>
  573     
  574     <span class="c1"># Cube...</span>
  575     <span class="n">SpinCubeFile</span> <span class="o">=</span> <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;FileName&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span>
  576     <span class="n">SpinCubeName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinCube&quot;</span><span class="p">]</span>
  577     <span class="n">PMLCmds</span> <span class="o">=</span> <span class="p">[]</span>
  578     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.load(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SpinCubeFile</span><span class="p">,</span> <span class="n">SpinCubeName</span><span class="p">))</span>
  579     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.disable(&quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SpinCubeName</span><span class="p">))</span>
  580     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
  581     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PMLCmds</span><span class="p">)</span>
  582     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  583 
  584     <span class="n">ContourLevel1</span> <span class="o">=</span> <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourLevel1&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span>
  585     <span class="n">ContourLevel2</span> <span class="o">=</span> <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourLevel2&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span>
  586     
  587     <span class="n">ContourColor1</span> <span class="o">=</span> <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourColor1&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span>
  588     <span class="n">ContourColor2</span> <span class="o">=</span> <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourColor2&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span>
  589     
  590     <span class="n">ContourWindowFactor</span> <span class="o">=</span> <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourWindowFactor&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span>
  591     <span class="n">ContourColorOpacity</span> <span class="o">=</span> <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourColorOpacity&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span>
  592 
  593     <span class="n">SetupLocalVolumeColorRamp</span> <span class="o">=</span> <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;SetupLocalVolumeColorRamp&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span>
  594     <span class="n">VolumeColorRampName</span> <span class="o">=</span> <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampName&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span>
  595     
  596     <span class="c1"># Volume ramp...</span>
  597     <span class="k">if</span> <span class="n">SetupLocalVolumeColorRamp</span><span class="p">:</span>
  598         <span class="n">GenerateAndWritePMLForVolumeColorRamp</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">VolumeColorRampName</span><span class="p">,</span> <span class="n">ContourLevel1</span><span class="p">,</span> <span class="n">ContourColor1</span><span class="p">,</span> <span class="n">ContourLevel2</span><span class="p">,</span> <span class="n">ContourColor2</span><span class="p">,</span> <span class="n">ContourWindowFactor</span><span class="p">,</span> <span class="n">ContourColorOpacity</span><span class="p">)</span>
  599     
  600     <span class="c1"># Volume...</span>
  601     <span class="n">SpinVolumeName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinVolume&quot;</span><span class="p">]</span>
  602     <span class="n">PMLCmds</span> <span class="o">=</span> <span class="p">[]</span>
  603     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.volume(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SpinVolumeName</span><span class="p">,</span> <span class="n">SpinCubeName</span><span class="p">,</span> <span class="n">VolumeColorRampName</span><span class="p">))</span>
  604     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.disable(&quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SpinVolumeName</span><span class="p">))</span>
  605     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
  606     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PMLCmds</span><span class="p">)</span>
  607     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  608     
  609     <span class="c1"># Mesh...</span>
  610     <span class="n">SpinMeshName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinMeshNegative&quot;</span><span class="p">]</span>
  611     <span class="n">PMLCmds</span> <span class="o">=</span> <span class="p">[]</span>
  612     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.isomesh(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SpinMeshName</span><span class="p">,</span> <span class="n">SpinCubeName</span><span class="p">,</span> <span class="n">ContourLevel1</span><span class="p">))</span>
  613     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;util.color_deep(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ContourColor1</span><span class="p">,</span> <span class="n">SpinMeshName</span><span class="p">))</span>
  614     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.enable(&quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SpinMeshName</span><span class="p">))</span>
  615     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
  616     
  617     <span class="n">SpinMeshName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinMeshPositive&quot;</span><span class="p">]</span>
  618     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.isomesh(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SpinMeshName</span><span class="p">,</span> <span class="n">SpinCubeName</span><span class="p">,</span> <span class="n">ContourLevel2</span><span class="p">))</span>
  619     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;util.color_deep(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ContourColor2</span><span class="p">,</span> <span class="n">SpinMeshName</span><span class="p">))</span>
  620     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.enable(&quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SpinMeshName</span><span class="p">))</span>
  621     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
  622     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PMLCmds</span><span class="p">)</span>
  623     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  624 
  625     <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinMeshGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinMeshGroupMembers&quot;</span><span class="p">],</span> <span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">)</span>
  626 
  627     <span class="c1"># Surface...</span>
  628     <span class="n">SpinSurfaceName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinSurfaceNegative&quot;</span><span class="p">]</span>
  629     <span class="n">PMLCmds</span> <span class="o">=</span> <span class="p">[]</span>
  630     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.isosurface(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SpinSurfaceName</span><span class="p">,</span> <span class="n">SpinCubeName</span><span class="p">,</span> <span class="n">ContourLevel1</span><span class="p">))</span>
  631     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;util.color_deep(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ContourColor1</span><span class="p">,</span> <span class="n">SpinSurfaceName</span><span class="p">))</span>
  632     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.enable(&quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SpinSurfaceName</span><span class="p">))</span>
  633     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
  634     
  635     <span class="n">SpinSurfaceName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinSurfacePositive&quot;</span><span class="p">]</span>
  636     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.isosurface(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SpinSurfaceName</span><span class="p">,</span> <span class="n">SpinCubeName</span><span class="p">,</span> <span class="n">ContourLevel2</span><span class="p">))</span>
  637     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;util.color_deep(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ContourColor2</span><span class="p">,</span> <span class="n">SpinSurfaceName</span><span class="p">))</span>
  638     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.enable(&quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SpinSurfaceName</span><span class="p">))</span>
  639     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
  640     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PMLCmds</span><span class="p">)</span>
  641     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  642     
  643     <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinSurfaceGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinSurfaceGroupMembers&quot;</span><span class="p">],</span> <span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">)</span>
  644 
  645     <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">FirstSpin</span> <span class="k">else</span> <span class="bp">False</span>
  646     <span class="n">Action</span> <span class="o">=</span> <span class="s2">&quot;open&quot;</span> <span class="k">if</span> <span class="n">FirstSpin</span> <span class="k">else</span> <span class="s2">&quot;close&quot;</span>
  647     <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinGroupMembers&quot;</span><span class="p">],</span> <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span><span class="p">)</span>
  648     
  649 <span class="k">def</span> <span class="nf">GenerateAndWritePMLForVolumeColorRamp</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">ColorRampName</span><span class="p">,</span> <span class="n">ContourLevel1</span><span class="p">,</span> <span class="n">ContourColor1</span><span class="p">,</span> <span class="n">ContourLevel2</span><span class="p">,</span> <span class="n">ContourColor2</span><span class="p">,</span> <span class="n">ContourWindowFactor</span><span class="p">,</span> <span class="n">ContourColorOpacity</span><span class="p">):</span>
  650     <span class="sd">&quot;&quot;&quot;Write out PML for volume color ramp.&quot;&quot;&quot;</span>
  651 
  652     <span class="n">RampWindowOffset1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ContourLevel1</span> <span class="o">*</span> <span class="n">ContourWindowFactor</span><span class="p">)</span>
  653     <span class="n">RampWindowOffset2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ContourLevel2</span> <span class="o">*</span> <span class="n">ContourWindowFactor</span><span class="p">)</span>
  654     
  655     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
  656 <span class="s2">cmd.volume_ramp_new(&quot;</span><span class="si">%s</span><span class="s2">&quot;, [</span><span class="si">%.4f</span><span class="s2">, &quot;</span><span class="si">%s</span><span class="s2">&quot;, 0.00, </span><span class="si">%.4f</span><span class="s2">, &quot;</span><span class="si">%s</span><span class="s2">&quot;, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%.4f</span><span class="s2">, &quot;</span><span class="si">%s</span><span class="s2">&quot;, 0.00, </span><span class="si">%4f</span><span class="s2">, &quot;</span><span class="si">%s</span><span class="s2">&quot;, 0.00, </span><span class="si">%.4f</span><span class="s2">, &quot;</span><span class="si">%s</span><span class="s2">&quot;, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%4f</span><span class="s2">, &quot;</span><span class="si">%s</span><span class="s2">&quot;, 0.00])&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ColorRampName</span><span class="p">,</span> <span class="p">(</span><span class="n">ContourLevel1</span> <span class="o">-</span> <span class="n">RampWindowOffset1</span><span class="p">),</span> <span class="n">ContourColor1</span><span class="p">,</span> <span class="n">ContourLevel1</span><span class="p">,</span> <span class="n">ContourColor1</span><span class="p">,</span> <span class="n">ContourColorOpacity</span><span class="p">,</span> <span class="p">(</span><span class="n">ContourLevel1</span> <span class="o">+</span> <span class="n">RampWindowOffset1</span><span class="p">),</span> <span class="n">ContourColor1</span><span class="p">,</span> <span class="p">(</span><span class="n">ContourLevel2</span> <span class="o">-</span> <span class="n">RampWindowOffset2</span><span class="p">),</span> <span class="n">ContourColor2</span><span class="p">,</span> <span class="n">ContourLevel2</span><span class="p">,</span> <span class="n">ContourColor2</span><span class="p">,</span> <span class="n">ContourColorOpacity</span><span class="p">,</span> <span class="p">(</span><span class="n">ContourLevel2</span> <span class="o">+</span> <span class="n">RampWindowOffset2</span><span class="p">),</span> <span class="n">ContourColor2</span><span class="p">)</span>
  657     
  658     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  659 
  660 <span class="k">def</span> <span class="nf">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">GroupName</span><span class="p">,</span> <span class="n">GroupMembersList</span><span class="p">,</span> <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span><span class="p">):</span>
  661     <span class="sd">&quot;&quot;&quot;Generate and write PML for group.&quot;&quot;&quot;</span>
  662     
  663     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Setting up group </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">GroupName</span><span class="p">)</span>
  664     
  665     <span class="n">PMLCmds</span> <span class="o">=</span> <span class="p">[]</span>
  666     
  667     <span class="n">GroupMembers</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">GroupMembersList</span><span class="p">)</span>
  668     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.group(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupName</span><span class="p">,</span> <span class="n">GroupMembers</span><span class="p">))</span>
  669     
  670     <span class="k">if</span> <span class="n">Enable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
  671         <span class="k">if</span> <span class="n">Enable</span><span class="p">:</span>
  672             <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.enable(&quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">GroupName</span><span class="p">)</span>
  673         <span class="k">else</span><span class="p">:</span>
  674             <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.disable(&quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">GroupName</span><span class="p">)</span>
  675     
  676     <span class="k">if</span> <span class="n">Action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
  677         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.group(&quot;</span><span class="si">%s</span><span class="s2">&quot;, action=&quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupName</span><span class="p">,</span> <span class="n">Action</span><span class="p">))</span>
  678 
  679     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PMLCmds</span><span class="p">)</span>
  680     
  681     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  682 
  683 <span class="k">def</span> <span class="nf">RetrieveMolCubeFilesInfo</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">):</span>
  684     <span class="sd">&quot;&quot;&quot;Retrieve available cube files info for a molecule.&quot;&quot;&quot;</span>
  685 
  686     <span class="n">CubeFilesInfo</span> <span class="o">=</span> <span class="p">{}</span>
  687     <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;OrbitalIDs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  688     <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;SpinIDs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  689     <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;FileName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  690 
  691     <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;IsocontourRangeMin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  692     <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;IsocontourRangeMax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  693     
  694     <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourLevel1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  695     <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourLevel2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  696     <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourColor1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  697     <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourColor2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  698     
  699     <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourWindowFactor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  700     <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourColorOpacity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  701     
  702     <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  703     <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;SetupLocalVolumeColorRamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  704     
  705     <span class="c1"># Setup cube mol info...</span>
  706     <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;MolPrefix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SetupMolPrefix</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">)</span>
  707     <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;MolName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SetupMolName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">)</span>
  708     <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;MolFile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SetupMolFileName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">)</span>
  709     
  710     <span class="n">MolPrefix</span> <span class="o">=</span> <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;MolPrefix&quot;</span><span class="p">]</span>
  711     <span class="n">CubeFilesCount</span> <span class="o">=</span> <span class="mi">0</span>
  712     <span class="k">for</span> <span class="n">OrbitalID</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;HOMO&quot;</span><span class="p">,</span> <span class="s2">&quot;LUMO&quot;</span><span class="p">,</span> <span class="s2">&quot;DOMO&quot;</span><span class="p">,</span> <span class="s2">&quot;LVMO&quot;</span><span class="p">,</span> <span class="s2">&quot;SOMO&quot;</span><span class="p">]:</span>
  713         <span class="n">CubeFiles</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">*</span><span class="si">%s</span><span class="s2">.cube&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MolPrefix</span><span class="p">,</span> <span class="n">OrbitalID</span><span class="p">))</span>
  714         <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">CubeFiles</span><span class="p">):</span>
  715             <span class="k">continue</span>
  716 
  717         <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;OrbitalIDs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OrbitalID</span><span class="p">)</span>
  718         <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;SpinIDs&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  719         <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;FileName&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  720         
  721         <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;IsocontourRangeMin&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  722         <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;IsocontourRangeMax&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  723         
  724         <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourLevel1&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  725         <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourLevel2&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  726         <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourColor1&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  727         <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourColor2&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  728         
  729         <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourWindowFactor&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  730         <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourColorOpacity&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  731         
  732         <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampName&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  733         <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;SetupLocalVolumeColorRamp&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  734         
  735         <span class="n">AlphaSpinCount</span><span class="p">,</span> <span class="n">BetaSpinCount</span><span class="p">,</span> <span class="n">SpinCount</span><span class="p">,</span> <span class="n">CurrentSpinCount</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
  736         <span class="k">for</span> <span class="n">CubeFile</span> <span class="ow">in</span> <span class="n">CubeFiles</span><span class="p">:</span>
  737             <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_a_&quot;</span> <span class="o">%</span> <span class="n">MolPrefix</span><span class="p">,</span> <span class="n">CubeFile</span><span class="p">):</span>
  738                 <span class="n">SpinID</span> <span class="o">=</span> <span class="s2">&quot;Alpha&quot;</span>
  739                 <span class="n">AlphaSpinCount</span> <span class="o">+=</span> <span class="mi">1</span>
  740                 <span class="n">CurrentSpinCount</span> <span class="o">=</span> <span class="n">AlphaSpinCount</span>
  741             <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_b_&quot;</span> <span class="o">%</span> <span class="n">MolPrefix</span><span class="p">,</span> <span class="n">CubeFile</span><span class="p">):</span>
  742                 <span class="n">SpinID</span> <span class="o">=</span> <span class="s2">&quot;Beta&quot;</span>
  743                 <span class="n">BetaSpinCount</span> <span class="o">+=</span> <span class="mi">1</span>
  744                 <span class="n">CurrentSpinCount</span> <span class="o">=</span> <span class="n">BetaSpinCount</span>
  745             <span class="k">else</span><span class="p">:</span>
  746                 <span class="n">SpinID</span> <span class="o">=</span> <span class="s2">&quot;Spin&quot;</span>
  747                 <span class="n">SpinCount</span> <span class="o">+=</span> <span class="mi">1</span>
  748                 <span class="n">CurrentSpinCount</span> <span class="o">=</span> <span class="n">SpinCount</span>
  749 
  750             <span class="c1"># Set up a unique spin ID...</span>
  751             <span class="k">if</span> <span class="n">SpinID</span> <span class="ow">in</span> <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;FileName&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">]:</span>
  752                 <span class="n">SpinID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SpinID</span><span class="p">,</span> <span class="n">CurrentSpinCount</span><span class="p">)</span>
  753                 
  754             <span class="n">CubeFilesCount</span> <span class="o">+=</span> <span class="mi">1</span>
  755             <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;SpinIDs&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SpinID</span><span class="p">)</span>
  756             <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;FileName&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span> <span class="o">=</span> <span class="n">CubeFile</span>
  757             
  758             <span class="n">IsocontourRangeMin</span><span class="p">,</span> <span class="n">IsocontourRangeMax</span><span class="p">,</span> <span class="n">ContourLevel1</span><span class="p">,</span> <span class="n">ContourLevel2</span> <span class="o">=</span> <span class="n">SetupIsocontourRangeAndContourLevels</span><span class="p">(</span><span class="n">CubeFile</span><span class="p">)</span>
  759             
  760             <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;IsocontourRangeMin&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span> <span class="o">=</span> <span class="n">IsocontourRangeMin</span>
  761             <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;IsocontourRangeMax&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span> <span class="o">=</span> <span class="n">IsocontourRangeMax</span>
  762             
  763             <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourLevel1&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span> <span class="o">=</span> <span class="n">ContourLevel1</span>
  764             <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourLevel2&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span> <span class="o">=</span> <span class="n">ContourLevel2</span>
  765             <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourColor1&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">][</span><span class="s2">&quot;ContourColor1&quot;</span><span class="p">]</span>
  766             <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourColor2&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">][</span><span class="s2">&quot;ContourColor2&quot;</span><span class="p">]</span>
  767             
  768             <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourWindowFactor&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">][</span><span class="s2">&quot;VolumeContourWindowFactor&quot;</span><span class="p">]</span>
  769             <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;ContourColorOpacity&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">][</span><span class="s2">&quot;VolumeColorRampOpacity&quot;</span><span class="p">]</span>
  770             
  771             <span class="n">VolumeColorRampName</span> <span class="o">=</span> <span class="n">SetupVolumeColorRampName</span><span class="p">(</span><span class="n">CubeFilesInfo</span><span class="p">)</span>
  772             <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampName&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span> <span class="o">=</span> <span class="n">VolumeColorRampName</span>
  773             <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;SetupLocalVolumeColorRamp&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">][</span><span class="s2">&quot;SetupGlobalVolumeColorRamp&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="bp">True</span>
  774     
  775     <span class="n">Status</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">CubeFilesCount</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">False</span>
  776 
  777     <span class="k">return</span> <span class="p">(</span><span class="n">Status</span><span class="p">,</span> <span class="n">CubeFilesInfo</span><span class="p">)</span>
  778 
  779 <span class="k">def</span> <span class="nf">SetupVolumeColorRampName</span><span class="p">(</span><span class="n">CubeFilesInfo</span><span class="p">):</span>
  780     <span class="sd">&quot;&quot;&quot;Setup volume color ramp name and status.&quot;&quot;&quot;</span>
  781     
  782     <span class="n">PyMOLViewParams</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">]</span>
  783     
  784     <span class="c1"># Setup info for generating local volume color ramps for individual cube files...</span>
  785     <span class="n">VolumeColorRampName</span> <span class="o">=</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;VolumeColorRamp&quot;</span><span class="p">]</span>
  786     <span class="k">if</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampAuto&quot;</span><span class="p">]:</span>
  787         <span class="n">VolumeColorRampName</span> <span class="o">=</span> <span class="n">SetupDefaultVolumeRampName</span><span class="p">()</span>
  788         <span class="k">if</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;ContourLevel1Auto&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;ContourLevel2Auto&quot;</span><span class="p">]:</span>
  789             <span class="n">VolumeColorRampName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;MolPrefix&quot;</span><span class="p">],</span> <span class="n">VolumeColorRampName</span><span class="p">)</span>
  790     
  791     <span class="k">return</span> <span class="n">VolumeColorRampName</span>
  792 
  793 <span class="k">def</span> <span class="nf">SetupIsocontourRangeAndContourLevels</span><span class="p">(</span><span class="n">CubeFileName</span><span class="p">):</span>
  794     <span class="sd">&quot;&quot;&quot;Setup isocontour range.&quot;&quot;&quot;</span>
  795 
  796     <span class="n">PyMOLViewParams</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">]</span>
  797     
  798     <span class="c1"># Setup isocontour range and contour levels...</span>
  799     <span class="n">IsocontourRangeMin</span><span class="p">,</span> <span class="n">IsocontourRangeMax</span> <span class="o">=</span> <span class="n">Psi4Util</span><span class="o">.</span><span class="n">RetrieveIsocontourRangeFromCubeFile</span><span class="p">(</span><span class="n">CubeFileName</span><span class="p">)</span>
  800 
  801     <span class="n">DefaultIsocontourRange</span> <span class="o">=</span> <span class="mf">0.06</span>
  802     <span class="k">if</span> <span class="n">IsocontourRangeMin</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  803         <span class="n">IsocontourRangeMin</span> <span class="o">=</span> <span class="o">-</span><span class="n">DefaultIsocontourRange</span>
  804         <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
  805             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve isocontour range from the cube file. Setting min isocontour value to </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">IsocontourRangeMin</span><span class="p">))</span>
  806     
  807     <span class="k">if</span> <span class="n">IsocontourRangeMax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  808         <span class="n">IsocontourRangeMax</span> <span class="o">=</span> <span class="n">DefaultIsocontourRange</span>
  809         <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
  810             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve isocontour range from the cube file. Setting max isocontour value to </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">IsocontourRangeMax</span><span class="p">))</span>
  811 
  812     <span class="c1"># Setup contour levels...</span>
  813     <span class="n">ContourLevel</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">IsocontourRangeMin</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">IsocontourRangeMax</span><span class="p">))</span> <span class="o">*</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;ContourLevelAutoAt&quot;</span><span class="p">]</span>
  814     <span class="k">if</span> <span class="n">ContourLevel</span> <span class="o">&gt;=</span> <span class="mf">0.01</span><span class="p">:</span>
  815         <span class="n">ContourLevel</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ContourLevel</span><span class="p">)</span>
  816     <span class="k">elif</span> <span class="n">ContourLevel</span> <span class="o">&gt;=</span> <span class="mf">0.001</span><span class="p">:</span>
  817         <span class="n">ContourLevel</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ContourLevel</span><span class="p">)</span>
  818     <span class="k">elif</span> <span class="n">ContourLevel</span> <span class="o">&gt;=</span> <span class="mf">0.0001</span><span class="p">:</span>
  819         <span class="n">ContourLevel</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ContourLevel</span><span class="p">)</span>
  820     
  821     <span class="n">ContourLevel1</span> <span class="o">=</span> <span class="o">-</span><span class="n">ContourLevel</span> <span class="k">if</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;ContourLevel1Auto&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;ContourLevel1&quot;</span><span class="p">]</span>
  822     <span class="n">ContourLevel2</span> <span class="o">=</span> <span class="n">ContourLevel</span> <span class="k">if</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;ContourLevel2Auto&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="n">PyMOLViewParams</span><span class="p">[</span><span class="s2">&quot;ContourLevel2&quot;</span><span class="p">]</span>
  823     
  824     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
  825         <span class="k">if</span> <span class="n">IsocontourRangeMin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">IsocontourRangeMax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
  826             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;CubeFileName: </span><span class="si">%s</span><span class="s2">; Isocontour range for </span><span class="si">%s</span><span class="s2"> percent of the density: </span><span class="si">%.4f</span><span class="s2"> to </span><span class="si">%.4f</span><span class="s2">; ContourLevel1: </span><span class="si">%s</span><span class="s2">; ContourLevel2: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CubeFileName</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Psi4CubeFilesParams&quot;</span><span class="p">][</span><span class="s2">&quot;IsoContourThreshold&quot;</span><span class="p">]),</span> <span class="n">IsocontourRangeMin</span><span class="p">,</span> <span class="n">IsocontourRangeMax</span><span class="p">,</span> <span class="n">ContourLevel1</span><span class="p">,</span> <span class="n">ContourLevel2</span><span class="p">))</span>
  827 
  828     <span class="k">return</span> <span class="p">(</span><span class="n">IsocontourRangeMin</span><span class="p">,</span> <span class="n">IsocontourRangeMax</span><span class="p">,</span> <span class="n">ContourLevel1</span><span class="p">,</span> <span class="n">ContourLevel2</span><span class="p">)</span>
  829 
  830 <span class="k">def</span> <span class="nf">SetupPyMOLObjectNames</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">,</span> <span class="n">CubeFilesInfo</span><span class="p">):</span>
  831     <span class="sd">&quot;&quot;&quot;Setup PyMOL object names.&quot;&quot;&quot;</span>
  832     
  833     <span class="n">PyMOLObjectNames</span> <span class="o">=</span> <span class="p">{}</span>
  834     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Orbitals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  835     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  836     
  837     <span class="n">SetupPyMOLObjectNamesForMol</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">,</span> <span class="n">CubeFilesInfo</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">)</span>
  838     
  839     <span class="k">for</span> <span class="n">OrbitalID</span> <span class="ow">in</span> <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;OrbitalIDs&quot;</span><span class="p">]:</span>
  840         <span class="n">SetupPyMOLObjectNamesForOrbital</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">,</span> <span class="n">CubeFilesInfo</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">OrbitalID</span><span class="p">)</span>
  841         <span class="k">for</span> <span class="n">SpinID</span> <span class="ow">in</span> <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;SpinIDs&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">]:</span>
  842             <span class="n">SetupPyMOLObjectNamesForSpin</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">,</span> <span class="n">CubeFilesInfo</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">OrbitalID</span><span class="p">,</span> <span class="n">SpinID</span><span class="p">)</span>
  843         
  844     <span class="k">return</span> <span class="n">PyMOLObjectNames</span>
  845 
  846 <span class="k">def</span> <span class="nf">SetupPyMOLObjectNamesForMol</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">,</span> <span class="n">CubeFilesInfo</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">):</span>
  847     <span class="sd">&quot;&quot;&quot;Setup groups and objects for molecule.&quot;&quot;&quot;</span>
  848 
  849     <span class="n">MolFileRoot</span> <span class="o">=</span> <span class="n">CubeFilesInfo</span><span class="p">[</span><span class="s2">&quot;MolPrefix&quot;</span><span class="p">]</span>
  850     
  851     <span class="n">MolGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MolFileRoot</span>
  852     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;MolGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MolGroupName</span>
  853     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;MolGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  854 
  855     <span class="c1"># Molecule alone group...</span>
  856     <span class="n">MolAloneGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Molecule&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MolGroupName</span><span class="p">)</span>
  857     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;MolAloneGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MolAloneGroupName</span>
  858     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;MolGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MolAloneGroupName</span><span class="p">)</span>
  859     
  860     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;MolAloneGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  861 
  862     <span class="c1"># Molecule...</span>
  863     <span class="n">MolName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Molecule&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MolAloneGroupName</span><span class="p">)</span>
  864     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Mol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MolName</span>
  865     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;MolAloneGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MolName</span><span class="p">)</span>
  866     
  867     <span class="c1"># BallAndStick...</span>
  868     <span class="n">MolBallAndStickName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.BallAndStick&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MolAloneGroupName</span><span class="p">)</span>
  869     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;MolBallAndStick&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MolBallAndStickName</span>
  870     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;MolAloneGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MolBallAndStickName</span><span class="p">)</span>
  871     
  872 <span class="k">def</span> <span class="nf">SetupPyMOLObjectNamesForOrbital</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">,</span> <span class="n">CubeFilesInfo</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">OrbitalID</span><span class="p">):</span>
  873     <span class="sd">&quot;&quot;&quot;Setup groups and objects for orbital.&quot;&quot;&quot;</span>
  874 
  875     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Orbitals&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  876     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  877 
  878     <span class="n">MolGroupName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;MolGroup&quot;</span><span class="p">]</span>
  879     
  880     <span class="c1"># Setup orbital group...</span>
  881     <span class="n">OrbitalGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MolGroupName</span><span class="p">,</span> <span class="n">OrbitalID</span><span class="p">)</span>
  882     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Orbitals&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="s2">&quot;OrbitalGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrbitalGroupName</span>
  883     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;MolGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OrbitalGroupName</span><span class="p">)</span>
  884     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Orbitals&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="s2">&quot;OrbitalGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  885  
  886 <span class="k">def</span> <span class="nf">SetupPyMOLObjectNamesForSpin</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">,</span> <span class="n">CubeFilesInfo</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">OrbitalID</span><span class="p">,</span> <span class="n">SpinID</span><span class="p">):</span>
  887     <span class="sd">&quot;&quot;&quot;Setup groups and objects for spin.&quot;&quot;&quot;</span>
  888 
  889     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  890     
  891     <span class="n">OrbitalGroupName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Orbitals&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="s2">&quot;OrbitalGroup&quot;</span><span class="p">]</span>
  892     
  893     <span class="c1"># Setup spin group at orbital level...</span>
  894     <span class="n">SpinGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OrbitalGroupName</span><span class="p">,</span> <span class="n">SpinID</span><span class="p">)</span>
  895     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SpinGroupName</span>
  896     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Orbitals&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="s2">&quot;OrbitalGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SpinGroupName</span><span class="p">)</span>
  897     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  898 
  899     <span class="c1"># Cube...</span>
  900     <span class="n">SpinCubeName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Cube&quot;</span> <span class="o">%</span> <span class="n">SpinGroupName</span>
  901     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinCube&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SpinCubeName</span>
  902     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SpinCubeName</span><span class="p">)</span>
  903     
  904     <span class="c1"># Volume...</span>
  905     <span class="n">SpinVolumeName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Volume&quot;</span> <span class="o">%</span> <span class="n">SpinGroupName</span>
  906     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinVolume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SpinVolumeName</span>
  907     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SpinVolumeName</span><span class="p">)</span>
  908     
  909     <span class="c1"># Mesh...</span>
  910     <span class="n">SpinMeshGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Mesh&quot;</span> <span class="o">%</span> <span class="n">SpinGroupName</span>
  911     <span class="n">SpinMeshNegativeName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Negative_Phase&quot;</span> <span class="o">%</span> <span class="n">SpinMeshGroupName</span>
  912     <span class="n">SpinMeshPositiveName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Positive_Phase&quot;</span> <span class="o">%</span> <span class="n">SpinMeshGroupName</span>
  913     
  914     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinMeshGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SpinMeshGroupName</span>
  915     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SpinMeshGroupName</span><span class="p">)</span>
  916     
  917     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinMeshNegative&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SpinMeshNegativeName</span>
  918     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinMeshPositive&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SpinMeshPositiveName</span>
  919     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinMeshGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  920     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinMeshGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SpinMeshNegativeName</span><span class="p">)</span>
  921     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinMeshGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SpinMeshPositiveName</span><span class="p">)</span>
  922     
  923     <span class="c1"># Surface...</span>
  924     <span class="n">SpinSurfaceGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Surface&quot;</span> <span class="o">%</span> <span class="n">SpinGroupName</span>
  925     <span class="n">SpinSurfaceNegativeName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Negative_Phase&quot;</span> <span class="o">%</span> <span class="n">SpinSurfaceGroupName</span>
  926     <span class="n">SpinSurfacePositiveName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Positive_Phase&quot;</span> <span class="o">%</span> <span class="n">SpinSurfaceGroupName</span>
  927     
  928     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinSurfaceGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SpinSurfaceGroupName</span>
  929     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SpinSurfaceGroupName</span><span class="p">)</span>
  930     
  931     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinSurfaceNegative&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SpinSurfaceNegativeName</span>
  932     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinSurfacePositive&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SpinSurfacePositiveName</span>
  933     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinSurfaceGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  934     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinSurfaceGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SpinSurfaceNegativeName</span><span class="p">)</span>
  935     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Spins&quot;</span><span class="p">][</span><span class="n">OrbitalID</span><span class="p">][</span><span class="n">SpinID</span><span class="p">][</span><span class="s2">&quot;SpinSurfaceGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SpinSurfacePositiveName</span><span class="p">)</span>
  936     
  937 <span class="k">def</span> <span class="nf">SetupMolFileName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">):</span>
  938     <span class="sd">&quot;&quot;&quot;Setup SD file name for a molecule.&quot;&quot;&quot;</span>
  939 
  940     <span class="n">MolPrefix</span> <span class="o">=</span> <span class="n">SetupMolPrefix</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">)</span>
  941     <span class="n">MolFileName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.sdf&quot;</span> <span class="o">%</span> <span class="n">MolPrefix</span>
  942 
  943     <span class="k">return</span> <span class="n">MolFileName</span>
  944     
  945 <span class="k">def</span> <span class="nf">SetupMolCubeFileName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">,</span> <span class="n">Psi4CubeFileName</span><span class="p">):</span>
  946     <span class="sd">&quot;&quot;&quot;Setup cube file name for a molecule.&quot;&quot;&quot;</span>
  947 
  948     <span class="n">FileDir</span><span class="p">,</span> <span class="n">FileName</span><span class="p">,</span> <span class="n">FileExt</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ParseFileName</span><span class="p">(</span><span class="n">Psi4CubeFileName</span><span class="p">)</span>
  949     <span class="n">CubeFileName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">FileName</span><span class="p">,</span> <span class="n">FileExt</span><span class="p">)</span>
  950 
  951     <span class="c1"># Replace Psi by MolPrefix...</span>
  952     <span class="n">MolPrefix</span> <span class="o">=</span> <span class="n">SetupMolPrefix</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">)</span>
  953     <span class="n">CubeFileName</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;^Psi&quot;</span><span class="p">,</span> <span class="n">MolPrefix</span><span class="p">,</span> <span class="n">CubeFileName</span><span class="p">)</span>
  954     
  955     <span class="c1"># Replace prime (&#39;) and dprime (&#39;&#39;) in the cube file names..</span>
  956     <span class="n">CubeFileName</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;dblprime&quot;</span><span class="p">,</span> <span class="n">CubeFileName</span><span class="p">)</span>
  957     <span class="n">CubeFileName</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&#39;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;prime&quot;</span><span class="p">,</span> <span class="n">CubeFileName</span><span class="p">)</span>
  958 
  959     <span class="k">return</span> <span class="n">CubeFileName</span>
  960     
  961 <span class="k">def</span> <span class="nf">SetupMolPrefix</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">):</span>
  962     <span class="sd">&quot;&quot;&quot;Get molecule prefix for generating files and directories.&quot;&quot;&quot;</span>
  963 
  964     <span class="n">MolNamePrefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
  965     <span class="k">if</span> <span class="n">Mol</span><span class="o">.</span><span class="n">HasProp</span><span class="p">(</span><span class="s2">&quot;_Name&quot;</span><span class="p">):</span>
  966         <span class="n">MolNamePrefix</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;[^a-zA-Z0-9]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">Mol</span><span class="o">.</span><span class="n">GetProp</span><span class="p">(</span><span class="s2">&quot;_Name&quot;</span><span class="p">))</span>
  967     
  968     <span class="n">MolNumPrefix</span> <span class="o">=</span> <span class="s2">&quot;Mol</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MolNum</span>
  969 
  970     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;UseMolNumPrefix&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;UseMolNamePrefix&quot;</span><span class="p">]:</span>
  971         <span class="n">MolPrefix</span> <span class="o">=</span> <span class="n">MolNumPrefix</span>
  972         <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">MolNamePrefix</span><span class="p">):</span>
  973             <span class="n">MolPrefix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MolNumPrefix</span><span class="p">,</span> <span class="n">MolNamePrefix</span><span class="p">)</span>
  974     <span class="k">elif</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;UseMolNamePrefix&quot;</span><span class="p">]:</span>
  975         <span class="n">MolPrefix</span> <span class="o">=</span> <span class="n">MolNamePrefix</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">MolNamePrefix</span><span class="p">)</span> <span class="k">else</span> <span class="n">MolNumPrefix</span>
  976     <span class="k">elif</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;UseMolNumPrefix&quot;</span><span class="p">]:</span>
  977         <span class="n">MolPrefix</span> <span class="o">=</span> <span class="n">MolNumPrefix</span>
  978     
  979     <span class="k">return</span> <span class="n">MolPrefix</span>
  980 
  981 <span class="k">def</span> <span class="nf">SetupMolName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolNum</span><span class="p">):</span>
  982     <span class="sd">&quot;&quot;&quot;Get molecule name.&quot;&quot;&quot;</span>
  983 
  984     <span class="c1"># Test for creating PyMOL object name for molecule...</span>
  985     <span class="n">MolNamePrefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
  986     <span class="k">if</span> <span class="n">Mol</span><span class="o">.</span><span class="n">HasProp</span><span class="p">(</span><span class="s2">&quot;_Name&quot;</span><span class="p">):</span>
  987         <span class="n">MolName</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;[^a-zA-Z0-9]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">Mol</span><span class="o">.</span><span class="n">GetProp</span><span class="p">(</span><span class="s2">&quot;_Name&quot;</span><span class="p">))</span>
  988     <span class="k">else</span><span class="p">:</span>
  989         <span class="n">MolName</span> <span class="o">=</span> <span class="s2">&quot;Mol</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MolNum</span>
  990     
  991     <span class="k">return</span> <span class="n">MolName</span>
  992 
  993 <span class="k">def</span> <span class="nf">SetupDefaultVolumeRampName</span><span class="p">():</span>
  994     <span class="sd">&quot;&quot;&quot;Setup a default name for a volume ramp.&quot;&quot;&quot;</span>
  995 
  996     <span class="k">return</span> <span class="s2">&quot;psi4_cube_mo&quot;</span>
  997 
  998 <span class="k">def</span> <span class="nf">SetupPsi4Mol</span><span class="p">(</span><span class="n">Psi4Handle</span><span class="p">,</span> <span class="n">Mol</span><span class="p">,</span> <span class="n">MolCount</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  999     <span class="sd">&quot;&quot;&quot;Setup a Psi4 molecule object.&quot;&quot;&quot;</span>
 1000     
 1001     <span class="n">MolGeometry</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">GetPsi4XYZFormatString</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">NoCom</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">NoReorient</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
 1002     
 1003     <span class="k">try</span><span class="p">:</span>
 1004         <span class="n">Psi4Mol</span> <span class="o">=</span> <span class="n">Psi4Handle</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="n">MolGeometry</span><span class="p">)</span>
 1005     <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ErrMsg</span><span class="p">:</span>
 1006         <span class="n">Psi4Mol</span> <span class="o">=</span> <span class="bp">None</span>
 1007         <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
 1008             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Failed to create Psi4 molecule from geometry string: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ErrMsg</span><span class="p">)</span>
 1009             <span class="n">MolName</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">GetMolName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolCount</span><span class="p">)</span>
 1010             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Ignoring molecule: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MolName</span><span class="p">)</span>
 1011     
 1012     <span class="k">return</span> <span class="n">Psi4Mol</span>
 1013 
 1014 <span class="k">def</span> <span class="nf">PerformPsi4Cleanup</span><span class="p">(</span><span class="n">Psi4Handle</span><span class="p">):</span>
 1015     <span class="sd">&quot;&quot;&quot;Perform clean up.&quot;&quot;&quot;</span>
 1016     
 1017     <span class="c1"># Clean up after Psi4 run ...</span>
 1018     <span class="n">Psi4Handle</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
 1019     
 1020     <span class="c1"># Clean up any leftover scratch files...</span>
 1021     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MPMode&quot;</span><span class="p">]:</span>
 1022         <span class="n">Psi4Util</span><span class="o">.</span><span class="n">RemoveScratchFiles</span><span class="p">(</span><span class="n">Psi4Handle</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Psi4RunParams&quot;</span><span class="p">][</span><span class="s2">&quot;OutputFile&quot;</span><span class="p">])</span>
 1023 
 1024 <span class="k">def</span> <span class="nf">CheckAndValidateMolecule</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolCount</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
 1025     <span class="sd">&quot;&quot;&quot;Validate molecule for Psi4 calculations.&quot;&quot;&quot;</span>
 1026     
 1027     <span class="k">if</span> <span class="n">Mol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1028         <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
 1029             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Processing molecule number </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">MolCount</span><span class="p">)</span>
 1030         <span class="k">return</span> <span class="bp">False</span>
 1031     
 1032     <span class="n">MolName</span> <span class="o">=</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">GetMolName</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="n">MolCount</span><span class="p">)</span>
 1033     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
 1034         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Processing molecule </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">MolName</span><span class="p">)</span>
 1035     
 1036     <span class="k">if</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">IsMolEmpty</span><span class="p">(</span><span class="n">Mol</span><span class="p">):</span>
 1037         <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
 1038             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Ignoring empty molecule: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MolName</span><span class="p">)</span>
 1039         <span class="k">return</span> <span class="bp">False</span>
 1040     
 1041     <span class="k">if</span> <span class="ow">not</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">ValidateElementSymbols</span><span class="p">(</span><span class="n">RDKitUtil</span><span class="o">.</span><span class="n">GetAtomSymbols</span><span class="p">(</span><span class="n">Mol</span><span class="p">)):</span>
 1042         <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
 1043             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Ignoring molecule containing invalid element symbols: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MolName</span><span class="p">)</span>
 1044         <span class="k">return</span> <span class="bp">False</span>
 1045     
 1046     <span class="c1"># Check for 3D flag...</span>
 1047     <span class="k">if</span> <span class="ow">not</span> <span class="n">Mol</span><span class="o">.</span><span class="n">GetConformer</span><span class="p">()</span><span class="o">.</span><span class="n">Is3D</span><span class="p">():</span>
 1048         <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
 1049             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;3D tag is not set for molecule: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MolName</span><span class="p">)</span>
 1050     
 1051     <span class="c1"># Check for missing hydrogens...</span>
 1052     <span class="k">if</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">AreHydrogensMissingInMolecule</span><span class="p">(</span><span class="n">Mol</span><span class="p">):</span>
 1053         <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]:</span>
 1054             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Missing hydrogens in molecule: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MolName</span><span class="p">)</span>
 1055     
 1056     <span class="k">return</span> <span class="bp">True</span>
 1057 
 1058 <span class="k">def</span> <span class="nf">SetupMethodNameAndBasisSet</span><span class="p">(</span><span class="n">Mol</span><span class="p">):</span>
 1059     <span class="sd">&quot;&quot;&quot;Setup method name and basis set.&quot;&quot;&quot;</span>
 1060     
 1061     <span class="n">MethodName</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MethodName&quot;</span><span class="p">]</span>
 1062     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MethodNameAuto&quot;</span><span class="p">]:</span>
 1063         <span class="n">MethodName</span> <span class="o">=</span> <span class="s2">&quot;B3LYP&quot;</span>
 1064     
 1065     <span class="n">BasisSet</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;BasisSet&quot;</span><span class="p">]</span>
 1066     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;BasisSetAuto&quot;</span><span class="p">]:</span>
 1067         <span class="n">BasisSet</span> <span class="o">=</span> <span class="s2">&quot;6-31+G**&quot;</span> <span class="k">if</span> <span class="n">RDKitUtil</span><span class="o">.</span><span class="n">IsAtomSymbolPresentInMol</span><span class="p">(</span><span class="n">Mol</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;6-31G**&quot;</span>
 1068     
 1069     <span class="k">return</span> <span class="p">(</span><span class="n">MethodName</span><span class="p">,</span> <span class="n">BasisSet</span><span class="p">)</span>
 1070 
 1071 <span class="k">def</span> <span class="nf">SetupReferenceWavefunction</span><span class="p">(</span><span class="n">Mol</span><span class="p">):</span>
 1072     <span class="sd">&quot;&quot;&quot;Setup reference wavefunction.&quot;&quot;&quot;</span>
 1073     
 1074     <span class="n">Reference</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Reference&quot;</span><span class="p">]</span>
 1075     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;ReferenceAuto&quot;</span><span class="p">]:</span>
 1076         <span class="n">Reference</span> <span class="o">=</span> <span class="s1">&#39;UHF&#39;</span> <span class="k">if</span> <span class="p">(</span><span class="n">RDKitUtil</span><span class="o">.</span><span class="n">GetSpinMultiplicity</span><span class="p">(</span><span class="n">Mol</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;RHF&#39;</span>
 1077     
 1078     <span class="k">return</span> <span class="n">Reference</span>
 1079 
 1080 <span class="k">def</span> <span class="nf">CheckAndSetupOutfilesDir</span><span class="p">():</span>
 1081     <span class="sd">&quot;&quot;&quot;Check and setup outfiles directory.&quot;&quot;&quot;</span>
 1082     
 1083     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;GenerateCubeFiles&quot;</span><span class="p">]:</span>
 1084         <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesDir&quot;</span><span class="p">]):</span>
 1085             <span class="k">if</span> <span class="ow">not</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--overwrite&quot;</span><span class="p">]:</span>
 1086                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The outfiles directory, </span><span class="si">%s</span><span class="s2">, corresponding to output file specified, </span><span class="si">%s</span><span class="s2">, for option </span><span class="se">\&quot;</span><span class="s2">-o, --outfile</span><span class="se">\&quot;</span><span class="s2"> already exist. Use option </span><span class="se">\&quot;</span><span class="s2">--overwrite</span><span class="se">\&quot;</span><span class="s2"> or </span><span class="se">\&quot;</span><span class="s2">--ov</span><span class="se">\&quot;</span><span class="s2">  and try again to generate and visualize cube files...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesDir&quot;</span><span class="p">],</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">]))</span>
 1087     
 1088     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VisualizeCubeFiles&quot;</span><span class="p">]:</span>
 1089         <span class="k">if</span> <span class="ow">not</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--overwrite&quot;</span><span class="p">]:</span>
 1090             <span class="k">if</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesDir&quot;</span><span class="p">],</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">])):</span>
 1091                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The outfile file specified, </span><span class="si">%s</span><span class="s2">, for option </span><span class="se">\&quot;</span><span class="s2">-o, --outfile</span><span class="se">\&quot;</span><span class="s2"> already exist in outfiles dir, </span><span class="si">%s</span><span class="s2">. Use option </span><span class="se">\&quot;</span><span class="s2">--overwrite</span><span class="se">\&quot;</span><span class="s2"> or </span><span class="se">\&quot;</span><span class="s2">--ov</span><span class="se">\&quot;</span><span class="s2"> to overwrite and try again to generate and visualize cube files.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">],</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesDir&quot;</span><span class="p">]))</span>
 1092                     
 1093         <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;GenerateCubeFiles&quot;</span><span class="p">]:</span>
 1094             <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesDir&quot;</span><span class="p">]):</span>
 1095                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The outfiles directory, </span><span class="si">%s</span><span class="s2">, corresponding to output file specified, </span><span class="si">%s</span><span class="s2">, for option </span><span class="se">\&quot;</span><span class="s2">-o, --outfile</span><span class="se">\&quot;</span><span class="s2"> doesn&#39;t exist. Use value, GenerateCubeFiles or Both, for option </span><span class="se">\&quot;</span><span class="s2">--mode</span><span class="se">\&quot;</span><span class="s2"> and try again to generate and visualize cube files...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesDir&quot;</span><span class="p">],</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">]))</span>
 1096             
 1097             <span class="n">CubeFiles</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesDir&quot;</span><span class="p">],</span> <span class="s2">&quot;*.cube&quot;</span><span class="p">))</span>
 1098             <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">CubeFiles</span><span class="p">):</span>
 1099                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The outfiles directory, </span><span class="si">%s</span><span class="s2">, contains no cube files, </span><span class="se">\&quot;</span><span class="s2">*.cube</span><span class="se">\&quot;</span><span class="s2">. Use value, GenerateCubeFiles or Both, for option </span><span class="se">\&quot;</span><span class="s2">--mode</span><span class="se">\&quot;</span><span class="s2"> and try again to generate and visualize cube...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesDir&quot;</span><span class="p">]))</span>
 1100     
 1101     <span class="n">OutfilesDir</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesDir&quot;</span><span class="p">]</span>
 1102     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;GenerateCubeFiles&quot;</span><span class="p">]:</span>
 1103         <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">OutfilesDir</span><span class="p">):</span>
 1104             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Creating directory </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">OutfilesDir</span><span class="p">)</span>
 1105             <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">OutfilesDir</span><span class="p">)</span>
 1106 
 1107     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Changing directory to </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">OutfilesDir</span><span class="p">)</span>
 1108     <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">OutfilesDir</span><span class="p">)</span>
 1109 
 1110 <span class="k">def</span> <span class="nf">ProcessOptions</span><span class="p">():</span>
 1111     <span class="sd">&quot;&quot;&quot;Process and validate command line arguments and options.&quot;&quot;&quot;</span>
 1112     
 1113     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Processing options...&quot;</span><span class="p">)</span>
 1114     
 1115     <span class="c1"># Validate options...</span>
 1116     <span class="n">ValidateOptions</span><span class="p">()</span>
 1117 
 1118     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Infile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infile&quot;</span><span class="p">]</span>
 1119     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilePath&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infile&quot;</span><span class="p">])</span>
 1120     
 1121     <span class="n">ParamsDefaultInfoOverride</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;RemoveHydrogens&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">}</span>
 1122     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfileParams&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ProcessOptionInfileParameters</span><span class="p">(</span><span class="s2">&quot;--infileParams&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infileParams&quot;</span><span class="p">],</span> <span class="n">InfileName</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infile&quot;</span><span class="p">],</span> <span class="n">ParamsDefaultInfo</span> <span class="o">=</span> <span class="n">ParamsDefaultInfoOverride</span><span class="p">)</span>
 1123 
 1124     <span class="n">Outfile</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">]</span>
 1125     <span class="n">FileDir</span><span class="p">,</span> <span class="n">FileName</span><span class="p">,</span> <span class="n">FileExt</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ParseFileName</span><span class="p">(</span><span class="n">Outfile</span><span class="p">)</span>
 1126     
 1127     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Outfile</span>
 1128     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileRoot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FileName</span>
 1129     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileExt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FileExt</span>
 1130     
 1131     <span class="n">OutfilesDir</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfilesDir&quot;</span><span class="p">]</span>
 1132     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">OutfilesDir</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1133         <span class="n">OutfilesDir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_FrontierOrbitals&quot;</span> <span class="o">%</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfileRoot&quot;</span><span class="p">]</span>
 1134     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesDir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OutfilesDir</span>
 1135     
 1136     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Overwrite&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--overwrite&quot;</span><span class="p">]</span>
 1137     
 1138     <span class="c1"># Method, basis set, and reference wavefunction...</span>
 1139     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;BasisSet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--basisSet&quot;</span><span class="p">]</span>
 1140     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;BasisSetAuto&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--basisSet&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1141     
 1142     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MethodName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--methodName&quot;</span><span class="p">]</span>
 1143     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MethodNameAuto&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--methodName&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1144     
 1145     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Reference&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--reference&quot;</span><span class="p">]</span>
 1146     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;ReferenceAuto&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--reference&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1147     
 1148     <span class="c1"># Run, options, and cube files parameters...</span>
 1149     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Psi4OptionsParams&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Psi4Util</span><span class="o">.</span><span class="n">ProcessPsi4OptionsParameters</span><span class="p">(</span><span class="s2">&quot;--psi4OptionsParams&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--psi4OptionsParams&quot;</span><span class="p">])</span>
 1150     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Psi4RunParams&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Psi4Util</span><span class="o">.</span><span class="n">ProcessPsi4RunParameters</span><span class="p">(</span><span class="s2">&quot;--psi4RunParams&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--psi4RunParams&quot;</span><span class="p">],</span> <span class="n">InfileName</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Infile&quot;</span><span class="p">])</span>
 1151 
 1152     <span class="n">ParamsDefaultInfoOverride</span> <span class="o">=</span> <span class="p">{}</span>
 1153     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Psi4CubeFilesParams&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Psi4Util</span><span class="o">.</span><span class="n">ProcessPsi4CubeFilesParameters</span><span class="p">(</span><span class="s2">&quot;--psi4CubeFilesParams&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--psi4CubeFilesParams&quot;</span><span class="p">],</span> <span class="n">ParamsDefaultInfo</span> <span class="o">=</span> <span class="n">ParamsDefaultInfoOverride</span><span class="p">)</span>
 1154     
 1155     <span class="n">ParamsDefaultInfoOverride</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ContourColor1&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;ContourColor2&quot;</span><span class="p">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;ContourLevel1&quot;</span><span class="p">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;ContourLevel2&quot;</span><span class="p">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;ContourLevelAutoAt&quot;</span><span class="p">:</span> <span class="mf">0.75</span><span class="p">,</span> <span class="s2">&quot;DisplayMolecule&quot;</span><span class="p">:</span> <span class="s2">&quot;BallAndStick&quot;</span><span class="p">,</span> <span class="s2">&quot;DisplaySphereScale&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;DisplayStickRadius&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;HideHydrogens&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>  <span class="s2">&quot;MeshWidth&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;MeshQuality&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;SurfaceQuality&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;SurfaceTransparency&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span> <span class="s2">&quot;VolumeColorRamp&quot;</span><span class="p">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;VolumeColorRampOpacity&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;VolumeContourWindowFactor&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">}</span>
 1156     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ProcessOptionPyMOLCubeFileViewParameters</span><span class="p">(</span><span class="s2">&quot;--pymolViewParams&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pymolViewParams&quot;</span><span class="p">],</span> <span class="n">ParamsDefaultInfo</span> <span class="o">=</span> <span class="n">ParamsDefaultInfoOverride</span><span class="p">)</span>
 1157     
 1158     <span class="n">SetupGlobalVolumeColorRamp</span> <span class="o">=</span> <span class="bp">False</span>
 1159     <span class="n">GlobalVolumeColorRampName</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">][</span><span class="s2">&quot;VolumeColorRamp&quot;</span><span class="p">]</span>
 1160     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">][</span><span class="s2">&quot;VolumeColorRampAuto&quot;</span><span class="p">]:</span>
 1161         <span class="n">GlobalVolumeColorRampName</span> <span class="o">=</span> <span class="n">SetupDefaultVolumeRampName</span><span class="p">()</span>
 1162         <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">][</span><span class="s2">&quot;ContourLevel1Auto&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">][</span><span class="s2">&quot;ContourLevel2Auto&quot;</span><span class="p">]):</span>
 1163             <span class="n">SetupGlobalVolumeColorRamp</span> <span class="o">=</span> <span class="bp">True</span>
 1164     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">][</span><span class="s2">&quot;GlobalVolumeColorRampName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GlobalVolumeColorRampName</span>
 1165     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLViewParams&quot;</span><span class="p">][</span><span class="s2">&quot;SetupGlobalVolumeColorRamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SetupGlobalVolumeColorRamp</span>
 1166 
 1167     <span class="n">Mode</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--mode&quot;</span><span class="p">]</span>
 1168     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^GenerateCubeFiles$&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1169         <span class="n">GenerateCubeFiles</span> <span class="o">=</span> <span class="bp">True</span>
 1170         <span class="n">VisualizeCubeFiles</span> <span class="o">=</span> <span class="bp">False</span>
 1171     <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^VisualizeCubeFiles$&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1172         <span class="n">GenerateCubeFiles</span> <span class="o">=</span> <span class="bp">False</span>
 1173         <span class="n">VisualizeCubeFiles</span> <span class="o">=</span> <span class="bp">True</span>
 1174     <span class="k">else</span><span class="p">:</span>
 1175         <span class="n">GenerateCubeFiles</span> <span class="o">=</span> <span class="bp">True</span>
 1176         <span class="n">VisualizeCubeFiles</span> <span class="o">=</span> <span class="bp">True</span>
 1177     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Mode</span>
 1178     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;GenerateCubeFiles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GenerateCubeFiles</span>
 1179     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VisualizeCubeFiles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VisualizeCubeFiles</span>
 1180     
 1181     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MPMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--mp&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1182     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MPParams&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ProcessOptionMultiprocessingParameters</span><span class="p">(</span><span class="s2">&quot;--mpParams&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--mpParams&quot;</span><span class="p">])</span>
 1183     
 1184     <span class="n">OutfilesMolPrefix</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfilesMolPrefix&quot;</span><span class="p">]</span>
 1185     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^MolName$&quot;</span><span class="p">,</span> <span class="n">OutfilesMolPrefix</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1186         <span class="n">UseMolNamePrefix</span> <span class="o">=</span> <span class="bp">True</span>
 1187         <span class="n">UseMolNumPrefix</span> <span class="o">=</span> <span class="bp">False</span>
 1188     <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^MolNum$&quot;</span><span class="p">,</span> <span class="n">OutfilesMolPrefix</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1189         <span class="n">UseMolNamePrefix</span> <span class="o">=</span> <span class="bp">False</span>
 1190         <span class="n">UseMolNumPrefix</span> <span class="o">=</span> <span class="bp">True</span>
 1191     <span class="k">else</span><span class="p">:</span>
 1192         <span class="n">UseMolNamePrefix</span> <span class="o">=</span> <span class="bp">True</span>
 1193         <span class="n">UseMolNumPrefix</span> <span class="o">=</span> <span class="bp">True</span>
 1194     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;OutfilesMolPrefix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OutfilesMolPrefix</span>
 1195     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;UseMolNamePrefix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">UseMolNamePrefix</span>
 1196     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;UseMolNumPrefix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">UseMolNumPrefix</span>
 1197     
 1198     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;QuietMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--quiet&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1199     
 1200     <span class="n">CheckAndSetupOutfilesDir</span><span class="p">()</span>
 1201 
 1202 <span class="k">def</span> <span class="nf">RetrieveOptions</span><span class="p">():</span>
 1203     <span class="sd">&quot;&quot;&quot;Retrieve command line arguments and options.&quot;&quot;&quot;</span>
 1204     
 1205     <span class="c1"># Get options...</span>
 1206     <span class="k">global</span> <span class="n">Options</span>
 1207     <span class="n">Options</span> <span class="o">=</span> <span class="n">docopt</span><span class="p">(</span><span class="n">_docoptUsage_</span><span class="p">)</span>
 1208     
 1209     <span class="c1"># Set current working directory to the specified directory...</span>
 1210     <span class="n">WorkingDir</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--workingdir&quot;</span><span class="p">]</span>
 1211     <span class="k">if</span> <span class="n">WorkingDir</span><span class="p">:</span>
 1212         <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">WorkingDir</span><span class="p">)</span>
 1213     
 1214     <span class="c1"># Handle examples option...</span>
 1215     <span class="k">if</span> <span class="s2">&quot;--examples&quot;</span> <span class="ow">in</span> <span class="n">Options</span> <span class="ow">and</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--examples&quot;</span><span class="p">]:</span>
 1216         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="n">MiscUtil</span><span class="o">.</span><span class="n">GetExamplesTextFromDocOptText</span><span class="p">(</span><span class="n">_docoptUsage_</span><span class="p">))</span>
 1217         <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
 1218 
 1219 <span class="k">def</span> <span class="nf">ValidateOptions</span><span class="p">():</span>
 1220     <span class="sd">&quot;&quot;&quot;Validate option values.&quot;&quot;&quot;</span>
 1221     
 1222     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFilePath</span><span class="p">(</span><span class="s2">&quot;-i, --infile&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infile&quot;</span><span class="p">])</span>
 1223     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFileExt</span><span class="p">(</span><span class="s2">&quot;-i, --infile&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infile&quot;</span><span class="p">],</span> <span class="s2">&quot;sdf sd mol&quot;</span><span class="p">)</span>
 1224 
 1225     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFileExt</span><span class="p">(</span><span class="s2">&quot;-o, --outfile&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">],</span> <span class="s2">&quot;pml&quot;</span><span class="p">)</span>
 1226     
 1227     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--mode&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--mode&quot;</span><span class="p">],</span> <span class="s2">&quot;GenerateCubeFiles VisualizeCubeFiles Both&quot;</span><span class="p">)</span>
 1228     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--mp&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--mp&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1229     
 1230     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--outfilesMolPrefix&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfilesMolPrefix&quot;</span><span class="p">],</span> <span class="s2">&quot;MolNum MolName Both&quot;</span><span class="p">)</span>
 1231     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;-q, --quiet&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--quiet&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1232  
 1233 <span class="c1"># Setup a usage string for docopt...</span>
 1234 <span class="n">_docoptUsage_</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
 1235 <span class="s2">Psi4VisualizeFrontierOrbitals.py - Visualize frontier molecular orbitals</span>
 1236 
 1237 <span class="s2">Usage:</span>
 1238 <span class="s2">    Psi4VisualizeFrontierOrbitals.py [--basisSet &lt;text&gt;] [--infileParams &lt;Name,Value,...&gt;] [--methodName &lt;text&gt;]</span>
 1239 <span class="s2">                                     [--mode &lt;GenerateCubeFiles, VisualizeCubeFiles, Both&gt;] [--mp &lt;yes or no&gt;] [--mpParams &lt;Name, Value,...&gt;]</span>
 1240 <span class="s2">                                     [--outfilesDir &lt;text&gt;] [--outfilesMolPrefix &lt;MolNum, MolName, Both&gt; ] [--overwrite]</span>
 1241 <span class="s2">                                     [--psi4CubeFilesParams &lt;Name,Value,...&gt;] [--psi4OptionsParams &lt;Name,Value,...&gt;]</span>
 1242 <span class="s2">                                     [--psi4RunParams &lt;Name,Value,...&gt;] [--pymolViewParams &lt;Name,Value,...&gt;] [--quiet &lt;yes or no&gt;]</span>
 1243 <span class="s2">                                     [--reference &lt;text&gt;] [-w &lt;dir&gt;] -i &lt;infile&gt; -o &lt;outfile&gt; </span>
 1244 <span class="s2">    Psi4VisualizeFrontierOrbitals.py -h | --help | -e | --examples</span>
 1245 
 1246 <span class="s2">Description:</span>
 1247 <span class="s2">    Generate and visualize frontier molecular orbitals for molecules in input</span>
 1248 <span class="s2">    file. A set of cube files, corresponding to frontier orbitals, is generated for </span>
 1249 <span class="s2">    molecules. The cube files are used to create a PyMOL visualization file for</span>
 1250 <span class="s2">    viewing volumes, meshes, and surfaces representing frontier molecular</span>
 1251 <span class="s2">    orbitals. An option is available to skip the generation of new cube files</span>
 1252 <span class="s2">    and use existing cube files to visualize frontier molecular orbitals.</span>
 1253 <span class="s2">    </span>
 1254 <span class="s2">    A Psi4 XYZ format geometry string is automatically generated for each molecule</span>
 1255 <span class="s2">    in input file. It contains atom symbols and 3D coordinates for each atom in a</span>
 1256 <span class="s2">    molecule. In addition, the formal charge and spin multiplicity are present in the</span>
 1257 <span class="s2">    the geometry string. These values are either retrieved from molecule properties</span>
 1258 <span class="s2">    named &#39;FormalCharge&#39; and &#39;SpinMultiplicty&#39; or dynamically calculated for a</span>
 1259 <span class="s2">    molecule.</span>
 1260 <span class="s2">    </span>
 1261 <span class="s2">    A set of cube and SD output files is generated for each molecule in input file</span>
 1262 <span class="s2">    as shown below:</span>
 1263 <span class="s2">        </span>
 1264 <span class="s2">        Ouput dir: &lt;OutfileRoot&gt;_FrontierOrbitals or &lt;OutfilesDir&gt;</span>
 1265 <span class="s2">        </span>
 1266 <span class="s2">        Closed-shell systems:</span>
 1267 <span class="s2">        </span>
 1268 <span class="s2">        &lt;MolIDPrefix&gt;.sdf</span>
 1269 <span class="s2">        &lt;MolIDPrefix&gt;*HOMO.cube</span>
 1270 <span class="s2">        &lt;MolIDPrefix&gt;*LUMO.cube</span>
 1271 <span class="s2">        </span>
 1272 <span class="s2">        Open-shell systems:</span>
 1273 <span class="s2">        </span>
 1274 <span class="s2">        &lt;MolIDPrefix&gt;.sdf</span>
 1275 <span class="s2">        &lt;MolIDPrefix&gt;*DOMO.cube</span>
 1276 <span class="s2">        &lt;MolIDPrefix&gt;*LVMO.cube</span>
 1277 <span class="s2">        &lt;MolIDPrefix&gt;*SOMO.cube</span>
 1278 <span class="s2">        </span>
 1279 <span class="s2">        &lt;MolIDPrefix&gt;: Mol&lt;Num&gt;_&lt;MolName&gt;, Mol&lt;Num&gt;, or &lt;MolName&gt;</span>
 1280 <span class="s2">        </span>
 1281 <span class="s2">        Abbreviations:</span>
 1282 <span class="s2">        </span>
 1283 <span class="s2">        HOMO: Highest Occupied Molecular Orbital</span>
 1284 <span class="s2">        LUMO: Lowest Unoccupied Molecular Orbital</span>
 1285 <span class="s2">    </span>
 1286 <span class="s2">        DOMO: Double Occupied Molecular Orbital</span>
 1287 <span class="s2">        SOMO: Singly Occupied Molecular Orbital</span>
 1288 <span class="s2">        LVMO: Lowest Virtual (Unoccupied) Molecular Orbital</span>
 1289 <span class="s2">        </span>
 1290 <span class="s2">    In addition, a &lt;OutfileRoot&gt;.pml is generated containing  frontier molecular</span>
 1291 <span class="s2">    orbitals for all molecules in input file.</span>
 1292 <span class="s2">    </span>
 1293 <span class="s2">    The supported input file formats are: Mol (.mol), SD (.sdf, .sd)</span>
 1294 <span class="s2">     </span>
 1295 <span class="s2">    The supported output file formats are: PyMOL script file (.pml)</span>
 1296 <span class="s2">    </span>
 1297 <span class="s2">    A variety of PyMOL groups and objects are  created for visualization of frontier</span>
 1298 <span class="s2">    molecular orbitals as shown below:</span>
 1299 <span class="s2">        </span>
 1300 <span class="s2">        Closed-shell systems:</span>
 1301 <span class="s2">        </span>
 1302 <span class="s2">        &lt;MoleculeID&gt;</span>
 1303 <span class="s2">            .Molecule</span>
 1304 <span class="s2">                .Molecule</span>
 1305 <span class="s2">                .BallAndStick</span>
 1306 <span class="s2">            .HOMO</span>
 1307 <span class="s2">                .Alpha</span>
 1308 <span class="s2">                    .Cube</span>
 1309 <span class="s2">                    .Volume</span>
 1310 <span class="s2">                    .Mesh</span>
 1311 <span class="s2">                        .Negative_Phase</span>
 1312 <span class="s2">                        .Positive_Phase</span>
 1313 <span class="s2">                    .Surface</span>
 1314 <span class="s2">                        .Negative_Phase</span>
 1315 <span class="s2">                        .Positive_Phase</span>
 1316 <span class="s2">            .LUMO</span>
 1317 <span class="s2">                .Alpha</span>
 1318 <span class="s2">                    .Cube</span>
 1319 <span class="s2">                    .Volume</span>
 1320 <span class="s2">                    .Mesh</span>
 1321 <span class="s2">                        .Negative_Phase</span>
 1322 <span class="s2">                        .Positive_Phase</span>
 1323 <span class="s2">                    .Surface</span>
 1324 <span class="s2">                        .Negative_Phase</span>
 1325 <span class="s2">                        .Positive_Phase</span>
 1326 <span class="s2">        &lt;MoleculeID&gt;</span>
 1327 <span class="s2">            .Molecule</span>
 1328 <span class="s2">                ... ... ...</span>
 1329 <span class="s2">            .HOMO</span>
 1330 <span class="s2">                ... ... ...</span>
 1331 <span class="s2">            .LUMO</span>
 1332 <span class="s2">                ... ... ...</span>
 1333 <span class="s2">        </span>
 1334 <span class="s2">        Open-shell systems:</span>
 1335 <span class="s2">        </span>
 1336 <span class="s2">        &lt;MoleculeID&gt;</span>
 1337 <span class="s2">            .Molecule</span>
 1338 <span class="s2">                .Molecule</span>
 1339 <span class="s2">                .BallAndStick</span>
 1340 <span class="s2">            .DOMO</span>
 1341 <span class="s2">                .Alpha</span>
 1342 <span class="s2">                    .Cube</span>
 1343 <span class="s2">                    .Volume</span>
 1344 <span class="s2">                    .Mesh</span>
 1345 <span class="s2">                        .Negative_Phase</span>
 1346 <span class="s2">                        .Positive_Phase</span>
 1347 <span class="s2">                    .Surface</span>
 1348 <span class="s2">                        .Negative_Phase</span>
 1349 <span class="s2">                        .Positive_Phase</span>
 1350 <span class="s2">                .Beta</span>
 1351 <span class="s2">                    .Cube</span>
 1352 <span class="s2">                    .Volume</span>
 1353 <span class="s2">                    .Mesh</span>
 1354 <span class="s2">                        .Negative_Phase</span>
 1355 <span class="s2">                        .Positive_Phase</span>
 1356 <span class="s2">                    .Surface</span>
 1357 <span class="s2">                        .Negative_Phase</span>
 1358 <span class="s2">                        .Positive_Phase</span>
 1359 <span class="s2">            .LVMO</span>
 1360 <span class="s2">                .Alpha</span>
 1361 <span class="s2">                    .Cube</span>
 1362 <span class="s2">                    .Volume</span>
 1363 <span class="s2">                    .Mesh</span>
 1364 <span class="s2">                        .Negative_Phase</span>
 1365 <span class="s2">                        .Positive_Phase</span>
 1366 <span class="s2">                    .Surface</span>
 1367 <span class="s2">                        .Negative_Phase</span>
 1368 <span class="s2">                        .Positive_Phase</span>
 1369 <span class="s2">                .Beta</span>
 1370 <span class="s2">                    .Cube</span>
 1371 <span class="s2">                    .Volume</span>
 1372 <span class="s2">                    .Mesh</span>
 1373 <span class="s2">                        .Negative_Phase</span>
 1374 <span class="s2">                        .Positive_Phase</span>
 1375 <span class="s2">                    .Surface</span>
 1376 <span class="s2">                        .Negative_Phase</span>
 1377 <span class="s2">                        .Positive_Phase</span>
 1378 <span class="s2">            .SOMO</span>
 1379 <span class="s2">                .Alpha</span>
 1380 <span class="s2">                    .Cube</span>
 1381 <span class="s2">                    .Volume</span>
 1382 <span class="s2">                    .Mesh</span>
 1383 <span class="s2">                        .Negative_Phase</span>
 1384 <span class="s2">                        .Positive_Phase</span>
 1385 <span class="s2">                    .Surface</span>
 1386 <span class="s2">                        .Negative_Phase</span>
 1387 <span class="s2">                        .Positive_Phase</span>
 1388 <span class="s2">                .Alpha_&lt;Num&gt;</span>
 1389 <span class="s2">                    ... ... ...</span>
 1390 <span class="s2">        &lt;MoleculeID&gt;</span>
 1391 <span class="s2">            .Molecule</span>
 1392 <span class="s2">                ... ... ...</span>
 1393 <span class="s2">            .DOMO</span>
 1394 <span class="s2">                ... ... ...</span>
 1395 <span class="s2">            .LVMO</span>
 1396 <span class="s2">                ... ... ...</span>
 1397 <span class="s2">            .SOMO</span>
 1398 <span class="s2">                ... ... ...</span>
 1399 
 1400 <span class="s2">Options:</span>
 1401 <span class="s2">    -b, --basisSet &lt;text&gt;  [default: auto]</span>
 1402 <span class="s2">        Basis set to use for calculating single point energy before generating</span>
 1403 <span class="s2">        cube files for frontier molecular orbitals. Default: 6-31+G** for sulfur</span>
 1404 <span class="s2">        containing molecules; Otherwise, 6-31G** [ Ref 150 ]. The specified </span>
 1405 <span class="s2">        value must be a valid Psi4 basis set. No validation is performed.</span>
 1406 <span class="s2">        </span>
 1407 <span class="s2">        The following list shows a representative sample of basis sets available</span>
 1408 <span class="s2">        in Psi4:</span>
 1409 <span class="s2">            </span>
 1410 <span class="s2">            STO-3G, 6-31G, 6-31+G, 6-31++G, 6-31G*, 6-31+G*,  6-31++G*, </span>
 1411 <span class="s2">            6-31G**, 6-31+G**, 6-31++G**, 6-311G, 6-311+G, 6-311++G,</span>
 1412 <span class="s2">            6-311G*, 6-311+G*, 6-311++G*, 6-311G**, 6-311+G**, 6-311++G**,</span>
 1413 <span class="s2">            cc-pVDZ, cc-pCVDZ, aug-cc-pVDZ, cc-pVDZ-DK, cc-pCVDZ-DK, def2-SVP,</span>
 1414 <span class="s2">            def2-SVPD, def2-TZVP, def2-TZVPD, def2-TZVPP, def2-TZVPPD</span>
 1415 <span class="s2">            </span>
 1416 <span class="s2">    -e, --examples</span>
 1417 <span class="s2">        Print examples.</span>
 1418 <span class="s2">    -h, --help</span>
 1419 <span class="s2">        Print this help message.</span>
 1420 <span class="s2">    -i, --infile &lt;infile&gt;</span>
 1421 <span class="s2">        Input file name.</span>
 1422 <span class="s2">    --infileParams &lt;Name,Value,...&gt;  [default: auto]</span>
 1423 <span class="s2">        A comma delimited list of parameter name and value pairs for reading</span>
 1424 <span class="s2">        molecules from files. The supported parameter names for different file</span>
 1425 <span class="s2">        formats, along with their default values, are shown below:</span>
 1426 <span class="s2">            </span>
 1427 <span class="s2">            SD, MOL: removeHydrogens,no,sanitize,yes,strictParsing,yes</span>
 1428 <span class="s2">            </span>
 1429 <span class="s2">    -m, --methodName &lt;text&gt;  [default: auto]</span>
 1430 <span class="s2">        Method to use for calculating single point energy before generating</span>
 1431 <span class="s2">        cube files for frontier molecular orbitals. Default: B3LYP [ Ref 150 ].</span>
 1432 <span class="s2">        The specified value must be a valid Psi4 method name. No validation is</span>
 1433 <span class="s2">        performed.</span>
 1434 <span class="s2">        </span>
 1435 <span class="s2">        The following list shows a representative sample of methods available</span>
 1436 <span class="s2">        in Psi4:</span>
 1437 <span class="s2">            </span>
 1438 <span class="s2">            B1LYP, B2PLYP, B2PLYP-D3BJ, B2PLYP-D3MBJ, B3LYP, B3LYP-D3BJ,</span>
 1439 <span class="s2">            B3LYP-D3MBJ, CAM-B3LYP, CAM-B3LYP-D3BJ, HF, HF-D3BJ,  HF3c, M05,</span>
 1440 <span class="s2">            M06, M06-2x, M06-HF, M06-L, MN12-L, MN15, MN15-D3BJ,PBE, PBE0,</span>
 1441 <span class="s2">            PBEH3c, PW6B95, PW6B95-D3BJ, WB97, WB97X, WB97X-D, WB97X-D3BJ</span>
 1442 <span class="s2">            </span>
 1443 <span class="s2">    --mode &lt;GenerateCubeFiles, VisualizeCubeFiles, or Both&gt;  [default: Both]</span>
 1444 <span class="s2">        Generate and visualize cube files for frontier molecular orbitals. The </span>
 1445 <span class="s2">        &#39;VisualizeCubes&#39; value skips the generation of new cube files and uses</span>
 1446 <span class="s2">         existing cube files for visualization of molecular orbitals. Multiprocessing</span>
 1447 <span class="s2">         is not supported during &#39;VisualizeCubeFiles&#39; value of &#39;--mode&#39; option.</span>
 1448 <span class="s2">    --mp &lt;yes or no&gt;  [default: no]</span>
 1449 <span class="s2">        Use multiprocessing.</span>
 1450 <span class="s2">         </span>
 1451 <span class="s2">        By default, input data is retrieved in a lazy manner via mp.Pool.imap()</span>
 1452 <span class="s2">        function employing lazy RDKit data iterable. This allows processing of</span>
 1453 <span class="s2">        arbitrary large data sets without any additional requirements memory.</span>
 1454 <span class="s2">        </span>
 1455 <span class="s2">        All input data may be optionally loaded into memory by mp.Pool.map()</span>
 1456 <span class="s2">        before starting worker processes in a process pool by setting the value</span>
 1457 <span class="s2">        of &#39;inputDataMode&#39; to &#39;InMemory&#39; in &#39;--mpParams&#39; option.</span>
 1458 <span class="s2">        </span>
 1459 <span class="s2">        A word to the wise: The default &#39;chunkSize&#39; value of 1 during &#39;Lazy&#39; input</span>
 1460 <span class="s2">        data mode may adversely impact the performance. The &#39;--mpParams&#39; section</span>
 1461 <span class="s2">        provides additional information to tune the value of &#39;chunkSize&#39;.</span>
 1462 <span class="s2">    --mpParams &lt;Name,Value,...&gt;  [default: auto]</span>
 1463 <span class="s2">        A comma delimited list of parameter name and value pairs to configure</span>
 1464 <span class="s2">        multiprocessing.</span>
 1465 <span class="s2">        </span>
 1466 <span class="s2">        The supported parameter names along with their default and possible</span>
 1467 <span class="s2">        values are shown below:</span>
 1468 <span class="s2">        </span>
 1469 <span class="s2">            chunkSize, auto</span>
 1470 <span class="s2">            inputDataMode, Lazy   [ Possible values: InMemory or Lazy ]</span>
 1471 <span class="s2">            numProcesses, auto   [ Default: mp.cpu_count() ]</span>
 1472 <span class="s2">        </span>
 1473 <span class="s2">        These parameters are used by the following functions to configure and</span>
 1474 <span class="s2">        control the behavior of multiprocessing: mp.Pool(), mp.Pool.map(), and</span>
 1475 <span class="s2">        mp.Pool.imap().</span>
 1476 <span class="s2">        </span>
 1477 <span class="s2">        The chunkSize determines chunks of input data passed to each worker</span>
 1478 <span class="s2">        process in a process pool by mp.Pool.map() and mp.Pool.imap() functions.</span>
 1479 <span class="s2">        The default value of chunkSize is dependent on the value of &#39;inputDataMode&#39;.</span>
 1480 <span class="s2">        </span>
 1481 <span class="s2">        The mp.Pool.map() function, invoked during &#39;InMemory&#39; input data mode,</span>
 1482 <span class="s2">        automatically converts RDKit data iterable into a list, loads all data into</span>
 1483 <span class="s2">        memory, and calculates the default chunkSize using the following method</span>
 1484 <span class="s2">        as shown in its code:</span>
 1485 <span class="s2">        </span>
 1486 <span class="s2">            chunkSize, extra = divmod(len(dataIterable), len(numProcesses) * 4)</span>
 1487 <span class="s2">            if extra: chunkSize += 1</span>
 1488 <span class="s2">        </span>
 1489 <span class="s2">        For example, the default chunkSize will be 7 for a pool of 4 worker processes</span>
 1490 <span class="s2">        and 100 data items.</span>
 1491 <span class="s2">        </span>
 1492 <span class="s2">        The mp.Pool.imap() function, invoked during &#39;Lazy&#39; input data mode, employs</span>
 1493 <span class="s2">        &#39;lazy&#39; RDKit data iterable to retrieve data as needed, without loading all the</span>
 1494 <span class="s2">        data into memory. Consequently, the size of input data is not known a priori.</span>
 1495 <span class="s2">        It&#39;s not possible to estimate an optimal value for the chunkSize. The default </span>
 1496 <span class="s2">        chunkSize is set to 1.</span>
 1497 <span class="s2">        </span>
 1498 <span class="s2">        The default value for the chunkSize during &#39;Lazy&#39; data mode may adversely</span>
 1499 <span class="s2">        impact the performance due to the overhead associated with exchanging</span>
 1500 <span class="s2">        small chunks of data. It is generally a good idea to explicitly set chunkSize to</span>
 1501 <span class="s2">        a larger value during &#39;Lazy&#39; input data mode, based on the size of your input</span>
 1502 <span class="s2">        data and number of processes in the process pool.</span>
 1503 <span class="s2">        </span>
 1504 <span class="s2">        The mp.Pool.map() function waits for all worker processes to process all</span>
 1505 <span class="s2">        the data and return the results. The mp.Pool.imap() function, however,</span>
 1506 <span class="s2">        returns the the results obtained from worker processes as soon as the</span>
 1507 <span class="s2">        results become available for specified chunks of data.</span>
 1508 <span class="s2">        </span>
 1509 <span class="s2">        The order of data in the results returned by both mp.Pool.map() and </span>
 1510 <span class="s2">        mp.Pool.imap() functions always corresponds to the input data.</span>
 1511 <span class="s2">    -o, --outfile &lt;outfile&gt;</span>
 1512 <span class="s2">        Output file name for PyMOL PML file. The PML output file, along with cube</span>
 1513 <span class="s2">        files, is generated in a local directory corresponding to &#39;--outfilesDir&#39;</span>
 1514 <span class="s2">        option.</span>
 1515 <span class="s2">    --outfilesDir &lt;text&gt;  [default: auto]</span>
 1516 <span class="s2">        Directory name containing PML and cube files. Default:</span>
 1517 <span class="s2">       &lt;OutfileRoot&gt;_FrontierOrbitals. This directory must be present during</span>
 1518 <span class="s2">        &#39;VisualizeCubeFiles&#39; value of &#39;--mode&#39; option.</span>
 1519 <span class="s2">    --outfilesMolPrefix &lt;MolNum, MolName, Both&gt;  [default: Both]</span>
 1520 <span class="s2">        Molecule prefix to use for the names of cube files. Possible values:</span>
 1521 <span class="s2">        MolNum, MolName, or Both. By default, both molecule number and name</span>
 1522 <span class="s2">        are used. The format of molecule prefix is as follows: MolNum - Mol&lt;Num&gt;;</span>
 1523 <span class="s2">        MolName - &lt;MolName&gt;, Both: Mol&lt;Num&gt;_&lt;MolName&gt;. Empty molecule names</span>
 1524 <span class="s2">        are ignored. Molecule numbers are used for empty molecule names.</span>
 1525 <span class="s2">    --overwrite</span>
 1526 <span class="s2">        Overwrite existing files.</span>
 1527 <span class="s2">    --psi4CubeFilesParams &lt;Name,Value,...&gt;  [default: auto]</span>
 1528 <span class="s2">        A comma delimited list of parameter name and value pairs for generating</span>
 1529 <span class="s2">        Psi4 cube files.</span>
 1530 <span class="s2">        </span>
 1531 <span class="s2">        The supported parameter names along with their default and possible</span>
 1532 <span class="s2">        values are shown below:</span>
 1533 <span class="s2">             </span>
 1534 <span class="s2">            gridSpacing, 0.2, gridOverage, 4.0, isoContourThreshold, 0.85</span>
 1535 <span class="s2">             </span>
 1536 <span class="s2">        gridSpacing: Grid spacing for generating cube files. Units: Bohr. A higher</span>
 1537 <span class="s2">        value reduces the size of the cube files on the disk. This option corresponds</span>
 1538 <span class="s2">        to Psi4 option CUBIC_GRID_SPACING.</span>
 1539 <span class="s2">        </span>
 1540 <span class="s2">        gridOverage: Grid overage for generating cube files. Units: Bohr.This option</span>
 1541 <span class="s2">        corresponds to Psi4 option CUBIC_GRID_OVERAGE.</span>
 1542 <span class="s2">        </span>
 1543 <span class="s2">        isoContourThreshold: IsoContour values for generating cube files that capture</span>
 1544 <span class="s2">        specified percent of the probability density using the least amount of grid</span>
 1545 <span class="s2">        points. Default: 0.85 (85%). This option corresponds to Psi4 option</span>
 1546 <span class="s2">        CUBEPROP_ISOCONTOUR_THRESHOLD.</span>
 1547 <span class="s2">    --psi4OptionsParams &lt;Name,Value,...&gt;  [default: none]</span>
 1548 <span class="s2">        A comma delimited list of Psi4 option name and value pairs for setting</span>
 1549 <span class="s2">        global and module options. The names are &#39;option_name&#39; for global options</span>
 1550 <span class="s2">        and &#39;module_name__option_name&#39; for options local to a module. The</span>
 1551 <span class="s2">        specified option names must be valid Psi4 names. No validation is</span>
 1552 <span class="s2">        performed.</span>
 1553 <span class="s2">        </span>
 1554 <span class="s2">        The specified option name and  value pairs are processed and passed to</span>
 1555 <span class="s2">        psi4.set_options() as a dictionary. The supported value types are float,</span>
 1556 <span class="s2">        integer, boolean, or string. The float value string is converted into a float.</span>
 1557 <span class="s2">        The valid values for a boolean string are yes, no, true, false, on, or off. </span>
 1558 <span class="s2">    --psi4RunParams &lt;Name,Value,...&gt;  [default: auto]</span>
 1559 <span class="s2">        A comma delimited list of parameter name and value pairs for configuring</span>
 1560 <span class="s2">        Psi4 jobs.</span>
 1561 <span class="s2">        </span>
 1562 <span class="s2">        The supported parameter names along with their default and possible</span>
 1563 <span class="s2">        values are shown below:</span>
 1564 <span class="s2">             </span>
 1565 <span class="s2">            MemoryInGB, 1</span>
 1566 <span class="s2">            NumThreads, 1</span>
 1567 <span class="s2">            OutputFile, auto   [ Possible  values: stdout, quiet, or FileName ]</span>
 1568 <span class="s2">            ScratchDir, auto   [ Possivle values: DirName]</span>
 1569 <span class="s2">            RemoveOutputFile, yes   [ Possible values: yes, no, true, or false]</span>
 1570 <span class="s2">            </span>
 1571 <span class="s2">        These parameters control the runtime behavior of Psi4.</span>
 1572 <span class="s2">        </span>
 1573 <span class="s2">        The default file name for &#39;OutputFile&#39; is &lt;InFileRoot&gt;_Psi4.out. The PID</span>
 1574 <span class="s2">        is appended to output file name during multiprocessing as shown:</span>
 1575 <span class="s2">        &lt;InFileRoot&gt;_Psi4_&lt;PIDNum&gt;.out. The &#39;stdout&#39; value for &#39;OutputType&#39;</span>
 1576 <span class="s2">        sends Psi4 output to stdout. The &#39;quiet&#39; or &#39;devnull&#39; value suppresses</span>
 1577 <span class="s2">        all Psi4 output.</span>
 1578 <span class="s2">        </span>
 1579 <span class="s2">        The default &#39;Yes&#39; value of &#39;RemoveOutputFile&#39; option forces the removal</span>
 1580 <span class="s2">        of any existing Psi4 before creating new files to append output from</span>
 1581 <span class="s2">        multiple Psi4 runs.</span>
 1582 <span class="s2">        </span>
 1583 <span class="s2">        The option &#39;ScratchDir&#39; is a directory path to the location of scratch</span>
 1584 <span class="s2">        files. The default value corresponds to Psi4 default. It may be used to</span>
 1585 <span class="s2">        override the deafult path.</span>
 1586 <span class="s2">    --pymolViewParams &lt;Name,Value,...&gt;  [default: auto]</span>
 1587 <span class="s2">        A comma delimited list of parameter name and value pairs for visualizing</span>
 1588 <span class="s2">        cube files in PyMOL.</span>
 1589 <span class="s2">            </span>
 1590 <span class="s2">            contourColor1, red, contourColor2, blue,</span>
 1591 <span class="s2">            contourLevel1, auto, contourLevel2, auto,</span>
 1592 <span class="s2">            contourLevelAutoAt, 0.75,</span>
 1593 <span class="s2">            displayMolecule, BallAndStick, displaySphereScale, 0.2,</span>
 1594 <span class="s2">            displayStickRadius, 0.1, hideHydrogens, yes,</span>
 1595 <span class="s2">            meshWidth, 0.5, meshQuality, 2,</span>
 1596 <span class="s2">            surfaceQuality, 2, surfaceTransparency, 0.25,</span>
 1597 <span class="s2">            volumeColorRamp, auto, volumeColorRampOpacity,0.2</span>
 1598 <span class="s2">            volumeContourWindowFactor,0.05</span>
 1599 <span class="s2">            </span>
 1600 <span class="s2">        contourColor1 and contourColor2: Color to use for visualizing volumes,</span>
 1601 <span class="s2">        meshes, and surfaces corresponding to the negative and positive values</span>
 1602 <span class="s2">        in cube files. The specified values must be valid PyMOL color names. No</span>
 1603 <span class="s2">        validation is performed.</span>
 1604 <span class="s2">        </span>
 1605 <span class="s2">        contourLevel1 and contourLevel2: Contour levels to use for visualizing</span>
 1606 <span class="s2">        volumes, meshes, and surfaces corresponding to the negative and positive</span>
 1607 <span class="s2">        values in cube files. Default: auto. The specified values for contourLevel1</span>
 1608 <span class="s2">        and contourLevel2 must be negative and positive numbers.</span>
 1609 <span class="s2">        </span>
 1610 <span class="s2">        The contour levels are automatically calculated by default. The isocontour</span>
 1611 <span class="s2">        range for specified percent of the density is retrieved from the cube files.</span>
 1612 <span class="s2">        The contour levels are set at &#39;contourLevelAutoAt&#39; of the absolute maximum</span>
 1613 <span class="s2">        value of the isocontour range. For example: contour levels are set to plus and</span>
 1614 <span class="s2">        minus 0.03 at &#39;contourLevelAutoAt&#39; of 0.5 for isocontour range of -0.06 to</span>
 1615 <span class="s2">        0.06 covering specified percent of the density.</span>
 1616 <span class="s2">        </span>
 1617 <span class="s2">        contourLevelAutoAt: Set contour levels at specified fraction of the absolute</span>
 1618 <span class="s2">        maximum value of the isocontour range retrieved from  the cube files. This</span>
 1619 <span class="s2">        option is only used during the automatic calculations of the contour levels.</span>
 1620 <span class="s2">        </span>
 1621 <span class="s2">        hideHydrogens: Hide hydrogens in molecules. Default: yes. Possible</span>
 1622 <span class="s2">        values: yes or no.</span>
 1623 <span class="s2">        </span>
 1624 <span class="s2">        displayMolecule: Display mode for molecules. Possible values: Sticks or</span>
 1625 <span class="s2">        BallAndStick. Both displays objects are created for molecules.</span>
 1626 <span class="s2">        </span>
 1627 <span class="s2">        displaySphereScale: Sphere scale for displaying molecule during</span>
 1628 <span class="s2">        BallAndStick display.</span>
 1629 <span class="s2">        </span>
 1630 <span class="s2">        displayStickRadius: Stick radius  for displaying molecule during Sticks</span>
 1631 <span class="s2">        and BallAndStick display.</span>
 1632 <span class="s2">        </span>
 1633 <span class="s2">        hideHydrogens: Hide hydrogens in molecules. Default: yes. Possible</span>
 1634 <span class="s2">        values: yes or no.</span>
 1635 <span class="s2">        meshWidth: Line width for mesh lines to visualize cube files.</span>
 1636 <span class="s2">        </span>
 1637 <span class="s2">        meshQuality: Mesh quality for meshes to visualize cube files. The</span>
 1638 <span class="s2">        higher values represents better quality.</span>
 1639 <span class="s2">        </span>
 1640 <span class="s2">        meshWidth: Line width for mesh lines to visualize cube files.</span>
 1641 <span class="s2">        </span>
 1642 <span class="s2">        surfaceQuality: Surface quality for surfaces to visualize cube files.</span>
 1643 <span class="s2">        The higher values represents better quality.</span>
 1644 <span class="s2">        </span>
 1645 <span class="s2">        surfaceTransparency: Surface transparency for surfaces to visualize cube</span>
 1646 <span class="s2">        files.</span>
 1647 <span class="s2">        </span>
 1648 <span class="s2">        volumeColorRamp: Name of a PyMOL volume color ramp to use for visualizing</span>
 1649 <span class="s2">        cube files. Default name(s): &lt;OutfielsMolPrefix&gt;_psi4_cube_mo or psi4_cube_mo</span>
 1650 <span class="s2">        The default volume color ramps are automatically generated using contour</span>
 1651 <span class="s2">        levels and colors during &#39;auto&#39; value of &#39;volumeColorRamp&#39;. An explicitly</span>
 1652 <span class="s2">        specified value must be a valid PyMOL volume color ramp. No validation is</span>
 1653 <span class="s2">        preformed.</span>
 1654 <span class="s2">        </span>
 1655 <span class="s2">        VolumeColorRampOpacity: Opacity for generating volume color ramps</span>
 1656 <span class="s2">        for visualizing cube files. This value is equivalent to 1 minus Transparency.</span>
 1657 <span class="s2">        </span>
 1658 <span class="s2">        volumeContourWindowFactor: Fraction of contour level representing  window</span>
 1659 <span class="s2">        widths around contour levels during generation of volume color ramps for</span>
 1660 <span class="s2">        visualizing cube files. For example, the value of 0.05 implies a ramp window</span>
 1661 <span class="s2">        size of 0.0015 at contour level of 0.03.</span>
 1662 <span class="s2">    -q, --quiet &lt;yes or no&gt;  [default: no]</span>
 1663 <span class="s2">        Use quiet mode. The warning and information messages will not be printed.</span>
 1664 <span class="s2">    -r, --reference &lt;text&gt;  [default: auto]</span>
 1665 <span class="s2">        Reference wave function to use for calculating single point energy before</span>
 1666 <span class="s2">        generating cube files for frontier molecular orbitals. Default: RHF or UHF.</span>
 1667 <span class="s2">        The default values are Restricted Hartree-Fock (RHF) for closed-shell molecules</span>
 1668 <span class="s2">        with all electrons paired and Unrestricted artree-Fock (UHF) for open-shell</span>
 1669 <span class="s2">        molecules with unpaired electrons.</span>
 1670 <span class="s2">        </span>
 1671 <span class="s2">        The specified value must be a valid Psi4 reference wave function. No validation</span>
 1672 <span class="s2">        is performed. For example: ROHF, CUHF, RKS, etc.</span>
 1673 <span class="s2">        </span>
 1674 <span class="s2">        The spin multiplicity determines the default value of reference wave function</span>
 1675 <span class="s2">        for input molecules. It is calculated from number of free radical electrons using</span>
 1676 <span class="s2">        Hund&#39;s rule of maximum multiplicity defined as 2S + 1 where S is the total</span>
 1677 <span class="s2">        electron spin. The total spin is 1/2 the number of free radical electrons in a </span>
 1678 <span class="s2">        molecule. The value of &#39;SpinMultiplicity&#39; molecule property takes precedence</span>
 1679 <span class="s2">        over the calculated value of spin multiplicity.</span>
 1680 <span class="s2">    -w, --workingdir &lt;dir&gt;</span>
 1681 <span class="s2">        Location of working directory which defaults to the current directory.</span>
 1682 
 1683 <span class="s2">Examples:</span>
 1684 <span class="s2">    To generate and visualize frontier molecular orbitals based on a single point </span>
 1685 <span class="s2">    energy calculation using  B3LYP/6-31G** and B3LYP/6-31+G** for non-sulfur</span>
 1686 <span class="s2">    and sulfur containing molecules in a SD file with 3D structures, use RHF and</span>
 1687 <span class="s2">    UHF for closed-shell and open-shell molecules, and write a new PML file, type:</span>
 1688 
 1689 <span class="s2">        % Psi4VisualizeFrontierOrbitals.py -i Psi4Sample3D.sdf</span>
 1690 <span class="s2">          -o Psi4Sample3DOut.pml</span>
 1691 
 1692 <span class="s2">    To run the first example to only generate cube files and skip generation of </span>
 1693 <span class="s2">    a PML file to visualize frontier molecular orbitals, type:</span>
 1694 
 1695 <span class="s2">        % Psi4VisualizeFrontierOrbitals.py --mode GenerateCubeFiles</span>
 1696 <span class="s2">          -i Psi4Sample3D.sdf -o Psi4Sample3DOut.pml</span>
 1697 
 1698 <span class="s2">    To run the first example to skip generation of cube files and use existing cube</span>
 1699 <span class="s2">    files to visualize frontier molecular orbitals and write out a PML file, type:</span>
 1700 
 1701 <span class="s2">        % Psi4VisualizeFrontierOrbitals.py --mode VisualizeCubeFiles</span>
 1702 <span class="s2">          -i Psi4Sample3D.sdf -o Psi4Sample3DOut.pml</span>
 1703 
 1704 <span class="s2">    To run the first example in multiprocessing mode on all available CPUs</span>
 1705 <span class="s2">    without loading all data into memory and write out a PML file, type:</span>
 1706 
 1707 <span class="s2">        % Psi4VisualizeFrontierOrbitals.py --mp yes -i Psi4Sample3D.sdf</span>
 1708 <span class="s2">            -o Psi4Sample3DOut.pml</span>
 1709 
 1710 <span class="s2">    To run the first example in multiprocessing mode on all available CPUs</span>
 1711 <span class="s2">    by loading all data into memory and write out a PML file, type:</span>
 1712 
 1713 <span class="s2">        % Psi4VisualizeFrontierOrbitals.py  --mp yes --mpParams &quot;inputDataMode,</span>
 1714 <span class="s2">            InMemory&quot; -i Psi4Sample3D.sdf  -o Psi4Sample3DOut.pml</span>
 1715 
 1716 <span class="s2">    To run the first example in multiprocessing mode on all available CPUs</span>
 1717 <span class="s2">    without loading all data into memory along with multiple threads for each</span>
 1718 <span class="s2">    Psi4 run and write out a SD file, type:</span>
 1719 
 1720 <span class="s2">        % Psi4VisualizeFrontierOrbitals.py --mp yes --psi4RunParams</span>
 1721 <span class="s2">          &quot;NumThreads,2&quot; -i Psi4Sample3D.sdf -o Psi4Sample3DOut.pml</span>
 1722 
 1723 <span class="s2">    To run the first example in using a specific set of parameters to generate and</span>
 1724 <span class="s2">    visualize frontier molecular orbitals and write out  a PML file, type:</span>
 1725 
 1726 <span class="s2">        % Psi4VisualizeFrontierOrbitals.py  --mode both -m SCF -b aug-cc-pVDZ </span>
 1727 <span class="s2">          --psi4CubeFilesParams &quot;gridSpacing, 0.2, gridOverage, 4.0&quot;</span>
 1728 <span class="s2">          --psi4RunParams &quot;MemoryInGB, 2&quot; --pymolViewParams &quot;contourColor1,</span>
 1729 <span class="s2">          red, contourColor2, blue,contourLevel1, -0.04, contourLevel2, 0.04,</span>
 1730 <span class="s2">          contourLevelAutoAt, 0.75,volumeColorRamp, auto,</span>
 1731 <span class="s2">          volumeColorRampOpacity,0.25, volumeContourWindowFactor,0.05&quot;</span>
 1732 <span class="s2">          -i Psi4Sample3D.sdf -o Psi4Sample3DOut.pml</span>
 1733 
 1734 <span class="s2">Author:</span>
 1735 <span class="s2">    Manish Sud(msud@san.rr.com)</span>
 1736 
 1737 <span class="s2">See also:</span>
 1738 <span class="s2">    Psi4PerformMinimization.py, Psi4GenerateConformers.py,</span>
 1739 <span class="s2">    Psi4VisualizeDualDescriptors.py, Psi4VisualizeElectrostaticPotential.py</span>
 1740 
 1741 <span class="s2">Copyright:</span>
 1742 <span class="s2">    Copyright (C) 2022 Manish Sud. All rights reserved.</span>
 1743 
 1744 <span class="s2">    The functionality available in this script is implemented using Psi4, an</span>
 1745 <span class="s2">    open source quantum chemistry software package, and RDKit, an open</span>
 1746 <span class="s2">    source toolkit for cheminformatics developed by Greg Landrum.</span>
 1747 
 1748 <span class="s2">    This file is part of MayaChemTools.</span>
 1749 
 1750 <span class="s2">    MayaChemTools is free software; you can redistribute it and/or modify it under</span>
 1751 <span class="s2">    the terms of the GNU Lesser General Public License as published by the Free</span>
 1752 <span class="s2">    Software Foundation; either version 3 of the License, or (at your option) any</span>
 1753 <span class="s2">    later version.</span>
 1754 
 1755 <span class="s2">&quot;&quot;&quot;</span>
 1756 
 1757 <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
 1758     <span class="n">main</span><span class="p">()</span>
</pre>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
