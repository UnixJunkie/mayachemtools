<html>
<head>
<title>MayaChemTools:Code:Python/Psi4Util.py</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsPythonCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
   1 <span class="ch">#!/bin/env python</span>
   2 <span class="c1"># File: Psi4Util.py</span>
   3 <span class="c1"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
   4 <span class="c1">#</span>
   5 <span class="c1"># Copyright (C) 2022 Manish Sud. All rights reserved.</span>
   6 <span class="c1">#</span>
   7 <span class="c1"># The functionality available in this file is implemented using Psi4, an open</span>
   8 <span class="c1"># source quantum chemistry software package.</span>
   9 <span class="c1">#</span>
  10 <span class="c1"># This file is part of MayaChemTools.</span>
  11 <span class="c1">#</span>
  12 <span class="c1"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
  13 <span class="c1"># the terms of the GNU Lesser General Public License as published by the Free</span>
  14 <span class="c1"># Software Foundation; either version 3 of the License, or (at your option) any</span>
  15 <span class="c1"># later version.</span>
  16 <span class="c1">#</span>
  17 <span class="c1"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
  18 <span class="c1"># any warranty; without even the implied warranty of merchantability of fitness</span>
  19 <span class="c1"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
  20 <span class="c1"># details.</span>
  21 <span class="c1">#</span>
  22 <span class="c1"># You should have received a copy of the GNU Lesser General Public License</span>
  23 <span class="c1"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
  24 <span class="c1"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
  25 <span class="c1"># Boston, MA, 02111-1307, USA.</span>
  26 <span class="c1">#</span>
  27 
  28 <span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
  29 
  30 <span class="kn">import</span> <span class="nn">os</span>
  31 <span class="kn">import</span> <span class="nn">sys</span>
  32 <span class="kn">import</span> <span class="nn">re</span>
  33 <span class="kn">import</span> <span class="nn">glob</span>
  34 
  35 <span class="kn">import</span> <span class="nn">MiscUtil</span>
  36 
  37 <span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CalculateSinglePointEnergy&quot;</span><span class="p">,</span> <span class="s2">&quot;InitializePsi4&quot;</span><span class="p">,</span> <span class="s2">&quot;JoinMethodNameAndBasisSet&quot;</span><span class="p">,</span> <span class="s2">&quot;ListPsi4RunParamaters&quot;</span><span class="p">,</span> <span class="s2">&quot;RetrieveIsocontourRangeFromCubeFile&quot;</span><span class="p">,</span> <span class="s2">&quot;RetrieveMinAndMaxValueFromCubeFile&quot;</span><span class="p">,</span> <span class="s2">&quot;PerformGeometryOptimization&quot;</span><span class="p">,</span> <span class="s2">&quot;ProcessPsi4CubeFilesParameters&quot;</span><span class="p">,</span> <span class="s2">&quot;ProcessPsi4OptionsParameters&quot;</span><span class="p">,</span> <span class="s2">&quot;ProcessPsi4RunParameters&quot;</span><span class="p">,</span> <span class="s2">&quot;RemoveScratchFiles&quot;</span><span class="p">,</span> <span class="s2">&quot;UpdatePsi4OptionsParameters&quot;</span><span class="p">,</span> <span class="s2">&quot;UpdatePsi4RunParameters&quot;</span><span class="p">,</span> <span class="s2">&quot;UpdatePsi4OutputFileUsingPID&quot;</span><span class="p">]</span>
  38 
  39 <span class="k">def</span> <span class="nf">InitializePsi4</span><span class="p">(</span><span class="n">Psi4RunParams</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>  <span class="n">Psi4OptionsParams</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">PrintVersion</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">PrintHeader</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
  40     <span class="sd">&quot;&quot;&quot;Import Psi4 module and configure it for running Psi4 jobs.</span>
  41 <span class="sd">    </span>
  42 <span class="sd">    Arguments:</span>
  43 <span class="sd">        Psi4RunParams (dict): Runtime parameter name and value pairs.</span>
  44 <span class="sd">        Psi4OptionsParams (dict): Option name and value pairs. This is simply</span>
  45 <span class="sd">            passed to ps4.set_options().      </span>
  46 <span class="sd">        PrintVersion (boolean): Print version number.</span>
  47 <span class="sd">        PrintHeader (boolean): Print header information.</span>
  48 
  49 <span class="sd">    Returns:</span>
  50 <span class="sd">        Object: Psi4 module reference.</span>
  51 
  52 <span class="sd">    &quot;&quot;&quot;</span>
  53     
  54     <span class="c1"># Import Psi4...</span>
  55     <span class="k">try</span><span class="p">:</span>
  56         <span class="kn">import</span> <span class="nn">psi4</span>
  57     <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">ErrMsg</span><span class="p">:</span>
  58         <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Failed to import Psi4 module/package: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ErrMsg</span><span class="p">)</span>
  59         <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Check/update your Psi4 environment and try again.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
  60         <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  61 
  62     <span class="n">Psi4Handle</span> <span class="o">=</span> <span class="n">psi4</span>
  63     
  64     <span class="k">if</span> <span class="n">PrintVersion</span><span class="p">:</span>
  65         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Importing Psi4 module (Psi4 v</span><span class="si">%s</span><span class="s2">)...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Psi4Handle</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span>
  66 
  67     <span class="c1"># Update Psi4 run paramaters...</span>
  68     <span class="k">if</span> <span class="n">Psi4RunParams</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
  69         <span class="n">UpdatePsi4RunParameters</span><span class="p">(</span><span class="n">Psi4Handle</span><span class="p">,</span> <span class="n">Psi4RunParams</span><span class="p">)</span>
  70 
  71     <span class="c1"># Update Psi4 options...</span>
  72     <span class="k">if</span> <span class="n">Psi4OptionsParams</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
  73         <span class="n">UpdatePsi4OptionsParameters</span><span class="p">(</span><span class="n">Psi4Handle</span><span class="p">,</span> <span class="n">Psi4OptionsParams</span><span class="p">)</span>
  74         
  75     <span class="c1"># Print header after updating Psi4 run parameters...</span>
  76     <span class="k">if</span> <span class="n">PrintHeader</span><span class="p">:</span>
  77         <span class="n">Psi4Handle</span><span class="o">.</span><span class="n">print_header</span><span class="p">()</span>
  78     
  79     <span class="k">return</span> <span class="n">Psi4Handle</span>
  80     
  81 <span class="k">def</span> <span class="nf">CalculateSinglePointEnergy</span><span class="p">(</span><span class="n">psi4</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">,</span> <span class="n">Method</span><span class="p">,</span> <span class="n">BasisSet</span><span class="p">,</span> <span class="n">ReturnWaveFunction</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">Quiet</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
  82     <span class="sd">&quot;&quot;&quot;Calculate single point electronic energy in Hartrees using a specified</span>
  83 <span class="sd">    method and basis set.</span>
  84 
  85 <span class="sd">    Arguments:</span>
  86 <span class="sd">        psi4 (Object): Psi4 module reference.</span>
  87 <span class="sd">        Molecule (Object): Psi4 molecule object.</span>
  88 <span class="sd">        Method (str): A valid method name.</span>
  89 <span class="sd">        BasisSet (str): A valid basis set.</span>
  90 <span class="sd">        ReturnWaveFunction (boolean): Return wave function.</span>
  91 <span class="sd">        Quiet (boolean): Flag to print error message.</span>
  92 
  93 <span class="sd">    Returns:</span>
  94 <span class="sd">        float: Total electronic energy in Hartrees.</span>
  95 <span class="sd">        (float, psi4 object): Energy and wavefuction.</span>
  96 
  97 <span class="sd">    &quot;&quot;&quot;</span>
  98     
  99     <span class="n">Status</span> <span class="o">=</span> <span class="bp">False</span>
 100     <span class="n">Energy</span><span class="p">,</span> <span class="n">WaveFunction</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
 101 
 102     <span class="k">try</span><span class="p">:</span>
 103         <span class="n">MethodAndBasisSet</span> <span class="o">=</span> <span class="n">JoinMethodNameAndBasisSet</span><span class="p">(</span><span class="n">Method</span><span class="p">,</span> <span class="n">BasisSet</span><span class="p">)</span>
 104         <span class="k">if</span> <span class="n">ReturnWaveFunction</span><span class="p">:</span>
 105             <span class="n">Energy</span><span class="p">,</span> <span class="n">WaveFunction</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">MethodAndBasisSet</span><span class="p">,</span> <span class="n">molecule</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">,</span> <span class="n">return_wfn</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
 106         <span class="k">else</span><span class="p">:</span>
 107             <span class="n">Energy</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">MethodAndBasisSet</span><span class="p">,</span> <span class="n">molecule</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">,</span> <span class="n">return_wfn</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
 108         <span class="n">Status</span> <span class="o">=</span> <span class="bp">True</span>
 109     <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ErrMsg</span><span class="p">:</span>
 110         <span class="k">if</span> <span class="ow">not</span> <span class="n">Quiet</span><span class="p">:</span>
 111             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Psi4Util.CalculateSinglePointEnergy: Failed to calculate energy:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ErrMsg</span><span class="p">)</span>
 112     
 113     <span class="k">return</span> <span class="p">(</span><span class="n">Status</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">WaveFunction</span><span class="p">)</span> <span class="k">if</span> <span class="n">ReturnWaveFunction</span> <span class="k">else</span> <span class="p">(</span><span class="n">Status</span><span class="p">,</span> <span class="n">Energy</span><span class="p">)</span>
 114     
 115 <span class="k">def</span> <span class="nf">PerformGeometryOptimization</span><span class="p">(</span><span class="n">psi4</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">,</span> <span class="n">Method</span><span class="p">,</span> <span class="n">BasisSet</span><span class="p">,</span> <span class="n">ReturnWaveFunction</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">Quiet</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
 116     <span class="sd">&quot;&quot;&quot;Perform geometry optimization using a specified method and basis set.</span>
 117 <span class="sd">    </span>
 118 <span class="sd">    Arguments:</span>
 119 <span class="sd">        psi4 (Object): Psi4 module reference.</span>
 120 <span class="sd">        Molecule (Object): Psi4 molecule object.</span>
 121 <span class="sd">        Method (str): A valid method name.</span>
 122 <span class="sd">        BasisSet (str): A valid basis set.</span>
 123 <span class="sd">        ReturnWaveFunction (boolean): Return wave function.</span>
 124 <span class="sd">        Quiet (boolean): Flag to print error message.</span>
 125 
 126 <span class="sd">    Returns:</span>
 127 <span class="sd">        float: Total electronic energy in Hartrees.</span>
 128 <span class="sd">        (float, psi4 object): Energy and wavefuction.</span>
 129 
 130 <span class="sd">    &quot;&quot;&quot;</span>
 131     
 132     <span class="n">Status</span> <span class="o">=</span> <span class="bp">False</span>
 133     <span class="n">Energy</span><span class="p">,</span> <span class="n">WaveFunction</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
 134 
 135     <span class="k">try</span><span class="p">:</span>
 136         <span class="n">MethodAndBasisSet</span> <span class="o">=</span> <span class="n">JoinMethodNameAndBasisSet</span><span class="p">(</span><span class="n">Method</span><span class="p">,</span> <span class="n">BasisSet</span><span class="p">)</span>
 137         <span class="k">if</span> <span class="n">ReturnWaveFunction</span><span class="p">:</span>
 138             <span class="n">Energy</span><span class="p">,</span> <span class="n">WaveFunction</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">MethodAndBasisSet</span><span class="p">,</span> <span class="n">molecule</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">,</span> <span class="n">return_wfn</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
 139         <span class="k">else</span><span class="p">:</span>
 140             <span class="n">Energy</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">MethodAndBasisSet</span><span class="p">,</span> <span class="n">molecule</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">,</span> <span class="n">return_wfn</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
 141         <span class="n">Status</span> <span class="o">=</span> <span class="bp">True</span>
 142     <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ErrMsg</span><span class="p">:</span>
 143         <span class="k">if</span> <span class="ow">not</span> <span class="n">Quiet</span><span class="p">:</span>
 144             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Psi4Util.PerformGeometryOptimization: Failed to perform geometry optimization:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ErrMsg</span><span class="p">)</span>
 145     
 146     <span class="k">return</span> <span class="p">(</span><span class="n">Status</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">WaveFunction</span><span class="p">)</span> <span class="k">if</span> <span class="n">ReturnWaveFunction</span> <span class="k">else</span> <span class="p">(</span><span class="n">Status</span><span class="p">,</span> <span class="n">Energy</span><span class="p">)</span>
 147     
 148 <span class="k">def</span> <span class="nf">JoinMethodNameAndBasisSet</span><span class="p">(</span><span class="n">MethodName</span><span class="p">,</span> <span class="n">BasisSet</span><span class="p">):</span>
 149     <span class="sd">&quot;&quot;&quot;Join method name and basis set using a backslash delimiter.</span>
 150 <span class="sd">    An empty basis set specification is ignored.</span>
 151 
 152 <span class="sd">    Arguments:</span>
 153 <span class="sd">        MethodName (str): A valid method name.</span>
 154 <span class="sd">        BasisSet (str): A valid basis set or an empty string.</span>
 155 
 156 <span class="sd">    Returns:</span>
 157 <span class="sd">        str: MethodName/BasisSet or MethodName</span>
 158 
 159 <span class="sd">    &quot;&quot;&quot;</span>
 160     
 161     <span class="k">return</span> <span class="n">MethodName</span> <span class="k">if</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">IsEmpty</span><span class="p">(</span><span class="n">BasisSet</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MethodName</span><span class="p">,</span> <span class="n">BasisSet</span><span class="p">)</span>
 162     
 163 <span class="k">def</span> <span class="nf">GetAtomPositions</span><span class="p">(</span><span class="n">psi4</span><span class="p">,</span> <span class="n">WaveFunction</span><span class="p">,</span> <span class="n">InAngstroms</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
 164     <span class="sd">&quot;&quot;&quot;Retrieve a list of lists containing coordinates of all atoms in the</span>
 165 <span class="sd">    molecule available in Psi4 wave function. By default, the atom positions</span>
 166 <span class="sd">    are returned in Angstroms. The Psi4 default is Bohr.</span>
 167 
 168 <span class="sd">    Arguments:</span>
 169 <span class="sd">        psi4 (Object): Psi4 module reference.</span>
 170 <span class="sd">        WaveFunction (Object): Psi4 wave function reference.</span>
 171 <span class="sd">        InAngstroms (bool): True - Positions in Angstroms; Otherwise, in Bohr.</span>
 172 
 173 <span class="sd">    Returns:</span>
 174 <span class="sd">        None or list : List of lists containing atom positions.</span>
 175 
 176 <span class="sd">    Examples:</span>
 177 
 178 <span class="sd">        for AtomPosition in Psi4Util.GetAtomPositions(Psi4Handle, WaveFunction):</span>
 179 <span class="sd">            print(&quot;X: %s; Y: %s; Z: %s&quot; % (AtomPosition[0], AtomPosition[1],</span>
 180 <span class="sd">                AtomPosition[2]))</span>
 181 
 182 <span class="sd">    &quot;&quot;&quot;</span>
 183 
 184     <span class="k">if</span> <span class="n">WaveFunction</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 185         <span class="k">return</span> <span class="bp">None</span>
 186     
 187     <span class="n">AtomPositions</span> <span class="o">=</span> <span class="n">WaveFunction</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span><span class="o">.</span><span class="n">to_array</span><span class="p">()</span>
 188     <span class="k">if</span> <span class="n">InAngstroms</span><span class="p">:</span>
 189         <span class="n">AtomPositions</span> <span class="o">=</span> <span class="n">AtomPositions</span> <span class="o">*</span> <span class="n">psi4</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">bohr2angstroms</span>
 190     
 191     <span class="k">return</span> <span class="n">AtomPositions</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
 192 
 193 <span class="k">def</span> <span class="nf">ListPsi4RunParamaters</span><span class="p">(</span><span class="n">psi4</span><span class="p">):</span>
 194     <span class="sd">&quot;&quot;&quot;List values for a key set of the following Psi4 runtime parameters:</span>
 195 <span class="sd">    Memory, NumThreads, OutputFile, ScratchDir, DataDir.</span>
 196 <span class="sd">    </span>
 197 <span class="sd">    Arguments:</span>
 198 <span class="sd">        psi4 (object): Psi4 module reference.</span>
 199 
 200 <span class="sd">    Returns:</span>
 201 <span class="sd">        None</span>
 202 
 203 <span class="sd">    &quot;&quot;&quot;</span>
 204     
 205     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Listing Psi4 run options:&quot;</span><span class="p">)</span>
 206     
 207     <span class="c1"># Memory in bytes...</span>
 208     <span class="n">Memory</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_memory</span><span class="p">()</span>
 209     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Memory: </span><span class="si">%s</span><span class="s2"> (B); </span><span class="si">%s</span><span class="s2"> (MB)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Memory</span><span class="p">,</span> <span class="n">Memory</span><span class="o">/</span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)))</span>
 210     
 211     <span class="c1"># Number of threads...</span>
 212     <span class="n">NumThreads</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_num_threads</span><span class="p">()</span>
 213     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;NumThreads: </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">NumThreads</span><span class="p">))</span>
 214     
 215     <span class="c1"># Output file...</span>
 216     <span class="n">OutputFile</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">get_output_file</span><span class="p">()</span>
 217     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;OutputFile: </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OutputFile</span><span class="p">))</span>
 218     
 219     <span class="c1"># Scratch dir...</span>
 220     <span class="n">psi4_io</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">IOManager</span><span class="o">.</span><span class="n">shared_object</span><span class="p">()</span>
 221     <span class="n">ScratchDir</span> <span class="o">=</span> <span class="n">psi4_io</span><span class="o">.</span><span class="n">get_default_path</span><span class="p">()</span>
 222     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;ScratchDir: </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ScratchDir</span><span class="p">))</span>
 223     
 224     <span class="c1"># Data dir...</span>
 225     <span class="n">DataDir</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">get_datadir</span><span class="p">()</span>
 226     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;DataDir: </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">DataDir</span><span class="p">))</span>
 227 
 228 <span class="k">def</span> <span class="nf">UpdatePsi4OptionsParameters</span><span class="p">(</span><span class="n">psi4</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">):</span>
 229     <span class="sd">&quot;&quot;&quot;Update Psi4 options using psi4.set_options().</span>
 230 <span class="sd">    </span>
 231 <span class="sd">    Arguments:</span>
 232 <span class="sd">        psi4 (object): Psi4 module reference.</span>
 233 <span class="sd">        OptionsInfo (dictionary) : Option name and value pairs for setting</span>
 234 <span class="sd">            global and module options.</span>
 235 
 236 <span class="sd">    Returns:</span>
 237 <span class="sd">        None</span>
 238 
 239 <span class="sd">    &quot;&quot;&quot;</span>
 240     <span class="k">if</span> <span class="n">OptionsInfo</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 241         <span class="k">return</span>
 242 
 243     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
 244         <span class="k">return</span>
 245 
 246     <span class="k">try</span><span class="p">:</span>
 247         <span class="n">psi4</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">)</span>
 248     <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ErrMsg</span><span class="p">:</span>
 249         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Psi4Util.UpdatePsi4OptionsParameters: Failed to set Psi4 options</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ErrMsg</span><span class="p">)</span>
 250 
 251 <span class="k">def</span> <span class="nf">UpdatePsi4RunParameters</span><span class="p">(</span><span class="n">psi4</span><span class="p">,</span> <span class="n">RunParamsInfo</span><span class="p">):</span>
 252     <span class="sd">&quot;&quot;&quot;Update Psi4 runtime parameters. The supported parameter names along with</span>
 253 <span class="sd">    their default values are as follows: MemoryInGB: 1; NumThreads: 1, OutputFile:</span>
 254 <span class="sd">    stdout; ScratchDir: auto; RemoveOutputFile: True.</span>
 255 
 256 <span class="sd">    Arguments:</span>
 257 <span class="sd">        psi4 (object): Psi4 module reference.</span>
 258 <span class="sd">        RunParamsInfo (dictionary) : Parameter name and value pairs for</span>
 259 <span class="sd">            configuring Psi4 jobs.</span>
 260 
 261 <span class="sd">    Returns:</span>
 262 <span class="sd">        None</span>
 263 
 264 <span class="sd">    &quot;&quot;&quot;</span>
 265 
 266     <span class="c1"># Set default values for possible arguments...</span>
 267     <span class="n">Psi4RunParams</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;MemoryInGB&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;NumThreads&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;OutputFile&quot;</span><span class="p">:</span> <span class="s2">&quot;stdout&quot;</span><span class="p">,</span>  <span class="s2">&quot;ScratchDir&quot;</span> <span class="p">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;RemoveOutputFile&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
 268     
 269     <span class="c1"># Set specified values for possible arguments...</span>
 270     <span class="k">for</span> <span class="n">Param</span> <span class="ow">in</span> <span class="n">Psi4RunParams</span><span class="p">:</span>
 271         <span class="k">if</span> <span class="n">Param</span> <span class="ow">in</span> <span class="n">RunParamsInfo</span><span class="p">:</span>
 272             <span class="n">Psi4RunParams</span><span class="p">[</span><span class="n">Param</span><span class="p">]</span> <span class="o">=</span> <span class="n">RunParamsInfo</span><span class="p">[</span><span class="n">Param</span><span class="p">]</span>
 273     
 274     <span class="c1"># Memory...</span>
 275     <span class="n">Memory</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Psi4RunParams</span><span class="p">[</span><span class="s2">&quot;MemoryInGB&quot;</span><span class="p">]</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span>
 276     <span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">set_memory_bytes</span><span class="p">(</span><span class="n">Memory</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
 277     
 278     <span class="c1"># Number of threads...</span>
 279     <span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">set_num_threads</span><span class="p">(</span><span class="n">Psi4RunParams</span><span class="p">[</span><span class="s2">&quot;NumThreads&quot;</span><span class="p">],</span> <span class="n">quiet</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
 280 
 281     <span class="c1"># Output file...</span>
 282     <span class="n">OutputFile</span> <span class="o">=</span> <span class="n">Psi4RunParams</span><span class="p">[</span><span class="s2">&quot;OutputFile&quot;</span><span class="p">]</span>
 283     <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^stdout$&quot;</span><span class="p">,</span> <span class="n">OutputFile</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 284         <span class="c1"># Possible values: stdout, quiet, devnull, or filename</span>
 285         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^(quiet|devnull)$&quot;</span><span class="p">,</span> <span class="n">OutputFile</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 286             <span class="c1"># Psi4 output is redirected to /dev/null after call to be_quiet function...</span>
 287             <span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">be_quiet</span><span class="p">()</span>
 288         <span class="k">else</span><span class="p">:</span>
 289             <span class="c1"># Delete existing output file at the start of the first Psi4 run...</span>
 290             <span class="k">if</span> <span class="n">Psi4RunParams</span><span class="p">[</span><span class="s2">&quot;RemoveOutputFile&quot;</span><span class="p">]:</span>
 291                 <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">OutputFile</span><span class="p">):</span>
 292                     <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">OutputFile</span><span class="p">)</span>
 293                     
 294             <span class="c1"># Append to handle output from multiple Psi4 runs for molecules in</span>
 295             <span class="c1"># input file...</span>
 296             <span class="n">Append</span> <span class="o">=</span> <span class="bp">True</span>
 297             <span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">set_output_file</span><span class="p">(</span><span class="n">OutputFile</span><span class="p">,</span> <span class="n">Append</span><span class="p">)</span>
 298 
 299     <span class="c1"># Scratch directory...</span>
 300     <span class="n">ScratchDir</span> <span class="o">=</span> <span class="n">Psi4RunParams</span><span class="p">[</span><span class="s2">&quot;ScratchDir&quot;</span><span class="p">]</span>
 301     <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">ScratchDir</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 302         <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">ScratchDir</span><span class="p">):</span>
 303             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;ScratchDir is not a directory: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ScratchDir</span><span class="p">)</span>
 304         <span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">IOManager</span><span class="o">.</span><span class="n">shared_object</span><span class="p">()</span><span class="o">.</span><span class="n">set_default_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">ScratchDir</span><span class="p">)))</span>
 305 
 306 <span class="k">def</span> <span class="nf">ProcessPsi4OptionsParameters</span><span class="p">(</span><span class="n">ParamsOptionName</span><span class="p">,</span> <span class="n">ParamsOptionValue</span><span class="p">):</span>
 307     <span class="sd">&quot;&quot;&quot;Process parameters for setting up Psi4 options and return a map</span>
 308 <span class="sd">    containing processed parameter names and values.</span>
 309 <span class="sd">    </span>
 310 <span class="sd">    ParamsOptionValue is a comma delimited list of Psi4 option name and value</span>
 311 <span class="sd">    pairs for setting global and module options. The names are &#39;option_name&#39;</span>
 312 <span class="sd">    for global options and &#39;module_name__option_name&#39; for options local to a</span>
 313 <span class="sd">    module. The specified option names must be valid Psi4 names. No validation</span>
 314 <span class="sd">    is performed.</span>
 315 <span class="sd">    </span>
 316 <span class="sd">    The specified option name and  value pairs are processed and passed to</span>
 317 <span class="sd">    psi4.set_options() as a dictionary. The supported value types are float,</span>
 318 <span class="sd">    integer, boolean, or string. The float value string is converted into a float.</span>
 319 <span class="sd">    The valid values for a boolean string are yes, no, true, false, on, or off. </span>
 320 
 321 <span class="sd">    Arguments:</span>
 322 <span class="sd">        ParamsOptionName (str): Command line input parameters option name.</span>
 323 <span class="sd">        ParamsOptionValue (str): Comma delimited list of parameter name and value pairs.</span>
 324 
 325 <span class="sd">    Returns:</span>
 326 <span class="sd">        dictionary: Processed parameter name and value pairs.</span>
 327 
 328 <span class="sd">    &quot;&quot;&quot;</span>
 329 
 330     <span class="n">OptionsInfo</span> <span class="o">=</span> <span class="p">{}</span>
 331     
 332     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^(auto|none)$&quot;</span><span class="p">,</span> <span class="n">ParamsOptionValue</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 333         <span class="k">return</span> <span class="bp">None</span>
 334 
 335     <span class="n">ParamsOptionValue</span> <span class="o">=</span> <span class="n">ParamsOptionValue</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
 336     <span class="k">if</span> <span class="ow">not</span> <span class="n">ParamsOptionValue</span><span class="p">:</span>
 337         <span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;No valid parameter name and value pairs specified using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> option&quot;</span> <span class="o">%</span> <span class="n">ParamsOptionName</span><span class="p">)</span>
 338     
 339     <span class="n">ParamsOptionValueWords</span> <span class="o">=</span> <span class="n">ParamsOptionValue</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
 340     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ParamsOptionValueWords</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
 341         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The number of comma delimited paramater names and values, </span><span class="si">%d</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> option must be an even number.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ParamsOptionValueWords</span><span class="p">),</span> <span class="n">ParamsOptionName</span><span class="p">))</span>
 342     
 343     <span class="c1"># Validate paramater name and value pairs...</span>
 344     <span class="k">for</span> <span class="n">Index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ParamsOptionValueWords</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
 345         <span class="n">Name</span> <span class="o">=</span> <span class="n">ParamsOptionValueWords</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
 346         <span class="n">Value</span> <span class="o">=</span> <span class="n">ParamsOptionValueWords</span><span class="p">[</span><span class="n">Index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
 347         
 348         <span class="k">if</span>  <span class="n">MiscUtil</span><span class="o">.</span><span class="n">IsInteger</span><span class="p">(</span><span class="n">Value</span><span class="p">):</span>
 349             <span class="n">Value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Value</span><span class="p">)</span>
 350         <span class="k">elif</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">IsFloat</span><span class="p">(</span><span class="n">Value</span><span class="p">):</span>
 351             <span class="n">Value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Value</span><span class="p">)</span>
 352         
 353         <span class="n">OptionsInfo</span><span class="p">[</span><span class="n">Name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Value</span>
 354 
 355     <span class="k">return</span> <span class="n">OptionsInfo</span>
 356 
 357 <span class="k">def</span> <span class="nf">ProcessPsi4RunParameters</span><span class="p">(</span><span class="n">ParamsOptionName</span><span class="p">,</span> <span class="n">ParamsOptionValue</span><span class="p">,</span> <span class="n">InfileName</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">ParamsDefaultInfo</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
 358     <span class="sd">&quot;&quot;&quot;Process parameters for Psi4 runs and return a map containing processed</span>
 359 <span class="sd">    parameter names and values.</span>
 360 <span class="sd">    </span>
 361 <span class="sd">    ParamsOptionValue a comma delimited list of parameter name and value pairs</span>
 362 <span class="sd">    for configuring Psi4 jobs.</span>
 363 <span class="sd">    </span>
 364 <span class="sd">    The supported parameter names along with their default and possible</span>
 365 <span class="sd">    values are shown below:</span>
 366 <span class="sd">    </span>
 367 <span class="sd">    MemoryInGB,1,NumThreads,1,OutputFile,auto,ScratchDir,auto,</span>
 368 <span class="sd">    RemoveOutputFile,yes</span>
 369 <span class="sd">            </span>
 370 <span class="sd">    Possible  values: OutputFile - stdout, quiet, or FileName; OutputFile -</span>
 371 <span class="sd">    DirName; RemoveOutputFile - yes, no, true, or false</span>
 372 <span class="sd">    </span>
 373 <span class="sd">    These parameters control the runtime behavior of Psi4.</span>
 374 <span class="sd">    </span>
 375 <span class="sd">    The default for &#39;OutputFile&#39; is a file name &lt;InFileRoot&gt;_Psi4.out. The PID</span>
 376 <span class="sd">    is appened the output file name during multiprocessing. The &#39;stdout&#39; value</span>
 377 <span class="sd">    for &#39;OutputType&#39; sends Psi4 output to stdout. The &#39;quiet&#39; or &#39;devnull&#39; value</span>
 378 <span class="sd">    suppresses all Psi4 output.</span>
 379 <span class="sd">    </span>
 380 <span class="sd">    The default &#39;Yes&#39; value of &#39;RemoveOutputFile&#39; option forces the removal</span>
 381 <span class="sd">    of any existing Psi4 before creating new files to append output from</span>
 382 <span class="sd">    multiple Psi4 runs.</span>
 383 <span class="sd">    </span>
 384 <span class="sd">    The option &#39;ScratchDir&#39; is a directory path to the location of scratch</span>
 385 <span class="sd">    files. The default value corresponds to Psi4 default. It may be used to</span>
 386 <span class="sd">    override the deafult path.</span>
 387 
 388 <span class="sd">    Arguments:</span>
 389 <span class="sd">        ParamsOptionName (str): Command line Psi4 run parameters option name.</span>
 390 <span class="sd">        ParamsOptionValues (str): Comma delimited list of parameter name and value pairs.</span>
 391 <span class="sd">        InfileName (str): Name of input file.</span>
 392 <span class="sd">        ParamsDefaultInfo (dict): Default values to override for selected parameters.</span>
 393 
 394 <span class="sd">    Returns:</span>
 395 <span class="sd">        dictionary: Processed parameter name and value pairs.</span>
 396 
 397 <span class="sd">    Notes:</span>
 398 <span class="sd">        The parameter name and values specified in ParamsOptionValues are validated before</span>
 399 <span class="sd">        returning them in a dictionary.</span>
 400 
 401 <span class="sd">    &quot;&quot;&quot;</span>
 402 
 403     <span class="n">ParamsInfo</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;MemoryInGB&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;NumThreads&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;OutputFile&quot;</span><span class="p">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>  <span class="s2">&quot;ScratchDir&quot;</span> <span class="p">:</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;RemoveOutputFile&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
 404     
 405     <span class="c1"># Setup a canonical paramater names...</span>
 406     <span class="n">ValidParamNames</span> <span class="o">=</span> <span class="p">[]</span>
 407     <span class="n">CanonicalParamNamesMap</span> <span class="o">=</span> <span class="p">{}</span>
 408     <span class="k">for</span> <span class="n">ParamName</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ParamsInfo</span><span class="p">):</span>
 409         <span class="n">ValidParamNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ParamName</span><span class="p">)</span>
 410         <span class="n">CanonicalParamNamesMap</span><span class="p">[</span><span class="n">ParamName</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">ParamName</span>
 411     
 412     <span class="c1"># Update default values...</span>
 413     <span class="k">if</span> <span class="n">ParamsDefaultInfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
 414         <span class="k">for</span> <span class="n">ParamName</span> <span class="ow">in</span> <span class="n">ParamsDefaultInfo</span><span class="p">:</span>
 415             <span class="k">if</span> <span class="n">ParamName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ParamsInfo</span><span class="p">:</span>
 416                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The default parameter name, </span><span class="si">%s</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> to function ProcessPsi4RunParameters is not a valid name. Supported parameter names: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ParamName</span><span class="p">,</span> <span class="n">ParamsDefaultInfo</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ValidParamNames</span><span class="p">)))</span>
 417             <span class="n">ParamsInfo</span><span class="p">[</span><span class="n">ParamName</span><span class="p">]</span> <span class="o">=</span> <span class="n">ParamsDefaultInfo</span><span class="p">[</span><span class="n">ParamName</span><span class="p">]</span>
 418     
 419     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">ParamsOptionValue</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 420         <span class="c1"># No specific parameters to process except for parameters with possible auto value...</span>
 421         <span class="n">_ProcessPsi4RunAutoParameters</span><span class="p">(</span><span class="n">ParamsInfo</span><span class="p">,</span> <span class="n">ParamsOptionName</span><span class="p">,</span> <span class="n">ParamsOptionValue</span><span class="p">,</span> <span class="n">InfileName</span><span class="p">)</span>
 422         <span class="k">return</span> <span class="n">ParamsInfo</span>
 423     
 424     <span class="n">ParamsOptionValue</span> <span class="o">=</span> <span class="n">ParamsOptionValue</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
 425     <span class="k">if</span> <span class="ow">not</span> <span class="n">ParamsOptionValue</span><span class="p">:</span>
 426         <span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;No valid parameter name and value pairs specified using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> option&quot;</span> <span class="o">%</span> <span class="n">ParamsOptionName</span><span class="p">)</span>
 427     
 428     <span class="n">ParamsOptionValueWords</span> <span class="o">=</span> <span class="n">ParamsOptionValue</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
 429     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ParamsOptionValueWords</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
 430         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The number of comma delimited paramater names and values, </span><span class="si">%d</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> option must be an even number.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ParamsOptionValueWords</span><span class="p">),</span> <span class="n">ParamsOptionName</span><span class="p">))</span>
 431     
 432     <span class="c1"># Validate paramater name and value pairs...</span>
 433     <span class="k">for</span> <span class="n">Index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ParamsOptionValueWords</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
 434         <span class="n">Name</span> <span class="o">=</span> <span class="n">ParamsOptionValueWords</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
 435         <span class="n">Value</span> <span class="o">=</span> <span class="n">ParamsOptionValueWords</span><span class="p">[</span><span class="n">Index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
 436 
 437         <span class="n">CanonicalName</span> <span class="o">=</span> <span class="n">Name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
 438         <span class="k">if</span>  <span class="ow">not</span> <span class="n">CanonicalName</span> <span class="ow">in</span> <span class="n">CanonicalParamNamesMap</span><span class="p">:</span>
 439             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The parameter name, </span><span class="si">%s</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> is not a valid name. Supported parameter names: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Name</span><span class="p">,</span> <span class="n">ParamsOptionName</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ValidParamNames</span><span class="p">)))</span>
 440 
 441         <span class="n">ParamName</span> <span class="o">=</span> <span class="n">CanonicalParamNamesMap</span><span class="p">[</span><span class="n">CanonicalName</span><span class="p">]</span>
 442         <span class="n">ParamValue</span> <span class="o">=</span> <span class="n">Value</span>
 443         
 444         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^MemoryInGB$&quot;</span><span class="p">,</span> <span class="n">ParamName</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 445             <span class="n">Value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Value</span><span class="p">)</span>
 446             <span class="k">if</span> <span class="n">Value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
 447                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The parameter value, </span><span class="si">%s</span><span class="s2">, specified for parameter name, </span><span class="si">%s</span><span class="s2">, using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> option is not a valid value. Supported values: &gt; 0&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Value</span><span class="p">,</span> <span class="n">Name</span><span class="p">,</span> <span class="n">ParamsOptionName</span><span class="p">))</span>
 448             <span class="n">ParamValue</span> <span class="o">=</span> <span class="n">Value</span>
 449         <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^NumThreads$&quot;</span><span class="p">,</span> <span class="n">ParamName</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 450             <span class="n">Value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Value</span><span class="p">)</span>
 451             <span class="k">if</span> <span class="n">Value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
 452                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The parameter value, </span><span class="si">%s</span><span class="s2">, specified for parameter name, </span><span class="si">%s</span><span class="s2">, using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> option is not a valid value. Supported values: &gt; 0&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Value</span><span class="p">,</span> <span class="n">Name</span><span class="p">,</span> <span class="n">ParamsOptionName</span><span class="p">))</span>
 453             <span class="n">ParamValue</span> <span class="o">=</span> <span class="n">Value</span>
 454         <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^ScratchDir$&quot;</span><span class="p">,</span> <span class="n">ParamName</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 455             <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">Value</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 456                 <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">Value</span><span class="p">):</span>
 457                     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The parameter value, </span><span class="si">%s</span><span class="s2">, specified for parameter name, </span><span class="si">%s</span><span class="s2">, using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> option is not a valid value. It must be a directory name.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Value</span><span class="p">,</span> <span class="n">Name</span><span class="p">,</span> <span class="n">ParamsOptionName</span><span class="p">))</span>
 458             <span class="n">ParamValue</span> <span class="o">=</span> <span class="n">Value</span>
 459         <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^RemoveOutputFile$&quot;</span><span class="p">,</span> <span class="n">ParamName</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 460             <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^(yes|true)$&quot;</span><span class="p">,</span> <span class="n">Value</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 461                 <span class="n">Value</span> <span class="o">=</span> <span class="bp">True</span>
 462             <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^(no|false)$&quot;</span><span class="p">,</span> <span class="n">Value</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 463                 <span class="n">Value</span> <span class="o">=</span> <span class="bp">False</span>
 464             <span class="k">else</span><span class="p">:</span>
 465                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The parameter value, </span><span class="si">%s</span><span class="s2">, specified for parameter name, </span><span class="si">%s</span><span class="s2">, using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> option is not a valid value. Supported values: yes, no, true, or false&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Value</span><span class="p">,</span> <span class="n">Name</span><span class="p">,</span> <span class="n">ParamsOptionName</span><span class="p">))</span>
 466             <span class="n">ParamValue</span> <span class="o">=</span> <span class="n">Value</span>
 467             
 468         <span class="c1"># Set value...</span>
 469         <span class="n">ParamsInfo</span><span class="p">[</span><span class="n">ParamName</span><span class="p">]</span> <span class="o">=</span> <span class="n">ParamValue</span>
 470     
 471     <span class="c1"># Handle paramaters with possible auto values...</span>
 472     <span class="n">_ProcessPsi4RunAutoParameters</span><span class="p">(</span><span class="n">ParamsInfo</span><span class="p">,</span> <span class="n">ParamsOptionName</span><span class="p">,</span> <span class="n">ParamsOptionValue</span><span class="p">,</span> <span class="n">InfileName</span><span class="p">)</span>
 473 
 474     <span class="k">return</span> <span class="n">ParamsInfo</span>
 475 
 476 <span class="k">def</span> <span class="nf">_ProcessPsi4RunAutoParameters</span><span class="p">(</span><span class="n">ParamsInfo</span><span class="p">,</span> <span class="n">ParamsOptionName</span><span class="p">,</span> <span class="n">ParamsOptionValue</span><span class="p">,</span> <span class="n">InfileName</span><span class="p">):</span>
 477     <span class="sd">&quot;&quot;&quot;Process parameters with possible auto values.</span>
 478 <span class="sd">    &quot;&quot;&quot;</span>
 479     
 480     <span class="n">Value</span> <span class="o">=</span> <span class="n">ParamsInfo</span><span class="p">[</span><span class="s2">&quot;OutputFile&quot;</span><span class="p">]</span>
 481     <span class="n">ParamValue</span> <span class="o">=</span> <span class="n">Value</span>
 482     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">Value</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 483         <span class="k">if</span> <span class="n">InfileName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
 484             <span class="c1"># Use InfileName to setup output file. The OutputFile name is automatically updated using</span>
 485             <span class="c1"># PID during multiprocessing...</span>
 486             <span class="n">InfileDir</span><span class="p">,</span> <span class="n">InfileRoot</span><span class="p">,</span> <span class="n">InfileExt</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ParseFileName</span><span class="p">(</span><span class="n">InfileName</span><span class="p">)</span>
 487             <span class="n">OutputFile</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_Psi4.out&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">InfileRoot</span><span class="p">)</span>
 488         <span class="k">else</span><span class="p">:</span>
 489             <span class="n">OutputFile</span> <span class="o">=</span> <span class="s2">&quot;Psi4.out&quot;</span>
 490     <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^(devnull|quiet)$&quot;</span><span class="p">,</span> <span class="n">Value</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 491         <span class="n">OutputFile</span> <span class="o">=</span> <span class="s2">&quot;quiet&quot;</span>
 492     <span class="k">else</span><span class="p">:</span>
 493         <span class="c1"># It&#39;ll be treated as a filename and processed later...</span>
 494         <span class="n">OutputFile</span> <span class="o">=</span> <span class="n">Value</span>
 495     
 496     <span class="n">ParamsInfo</span><span class="p">[</span><span class="s2">&quot;OutputFile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OutputFile</span>
 497 
 498     <span class="c1"># OutputFileSpecified is used to track the specified value of the paramater.</span>
 499     <span class="c1"># It may be used by the calling function to dynamically override the value of</span>
 500     <span class="c1"># OutputFile to suprress the Psi4 output based on the initial value.</span>
 501     <span class="n">ParamsInfo</span><span class="p">[</span><span class="s2">&quot;OutputFileSpecified&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ParamValue</span>
 502     
 503 <span class="k">def</span> <span class="nf">ProcessPsi4CubeFilesParameters</span><span class="p">(</span><span class="n">ParamsOptionName</span><span class="p">,</span> <span class="n">ParamsOptionValue</span><span class="p">,</span> <span class="n">ParamsDefaultInfo</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
 504     <span class="sd">&quot;&quot;&quot;Process parameters for Psi4 runs and return a map containing processed</span>
 505 <span class="sd">    parameter names and values.</span>
 506 <span class="sd">    </span>
 507 <span class="sd">    ParamsOptionValue is a comma delimited list of parameter name and value pairs</span>
 508 <span class="sd">    for generating cube files.</span>
 509 <span class="sd">    </span>
 510 <span class="sd">    The supported parameter names along with their default and possible</span>
 511 <span class="sd">    values are shown below:</span>
 512 <span class="sd">    </span>
 513 <span class="sd">    GridSpacing, 0.2, GridOverage, 4.0, IsoContourThreshold, 0.85</span>
 514 <span class="sd">    </span>
 515 <span class="sd">    GridSpacing: Units: Bohr. A higher value reduces the size of the cube files</span>
 516 <span class="sd">    on the disk. This option corresponds to Psi4 option CUBIC_GRID_SPACING.</span>
 517 <span class="sd">    </span>
 518 <span class="sd">    GridOverage: Units: Bohr.This option corresponds to Psi4 option</span>
 519 <span class="sd">    CUBIC_GRID_OVERAGE.</span>
 520 <span class="sd">        </span>
 521 <span class="sd">     IsoContourThreshold captures specified percent of the probability density</span>
 522 <span class="sd">     using the least amount of grid points. This option corresponds to Psi4 option</span>
 523 <span class="sd">     CUBEPROP_ISOCONTOUR_THRESHOLD.</span>
 524 
 525 <span class="sd">    Arguments:</span>
 526 <span class="sd">        ParamsOptionName (str): Command line Psi4 cube files option name.</span>
 527 <span class="sd">        ParamsOptionValues (str): Comma delimited list of parameter name and value pairs.</span>
 528 <span class="sd">        ParamsDefaultInfo (dict): Default values to override for selected parameters.</span>
 529 
 530 <span class="sd">    Returns:</span>
 531 <span class="sd">        dictionary: Processed parameter name and value pairs.</span>
 532 
 533 <span class="sd">    &quot;&quot;&quot;</span>
 534 
 535     <span class="n">ParamsInfo</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;GridSpacing&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;GridOverage&quot;</span><span class="p">:</span>  <span class="mf">4.0</span><span class="p">,</span> <span class="s2">&quot;IsoContourThreshold&quot;</span><span class="p">:</span> <span class="mf">0.85</span><span class="p">}</span>
 536     
 537     <span class="c1"># Setup a canonical paramater names...</span>
 538     <span class="n">ValidParamNames</span> <span class="o">=</span> <span class="p">[]</span>
 539     <span class="n">CanonicalParamNamesMap</span> <span class="o">=</span> <span class="p">{}</span>
 540     <span class="k">for</span> <span class="n">ParamName</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ParamsInfo</span><span class="p">):</span>
 541         <span class="n">ValidParamNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ParamName</span><span class="p">)</span>
 542         <span class="n">CanonicalParamNamesMap</span><span class="p">[</span><span class="n">ParamName</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">ParamName</span>
 543     
 544     <span class="c1"># Update default values...</span>
 545     <span class="k">if</span> <span class="n">ParamsDefaultInfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
 546         <span class="k">for</span> <span class="n">ParamName</span> <span class="ow">in</span> <span class="n">ParamsDefaultInfo</span><span class="p">:</span>
 547             <span class="k">if</span> <span class="n">ParamName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ParamsInfo</span><span class="p">:</span>
 548                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The default parameter name, </span><span class="si">%s</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> to function ProcessPsi4CubeFilesParameters not a valid name. Supported parameter names: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ParamName</span><span class="p">,</span> <span class="n">ParamsDefaultInfo</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ValidParamNames</span><span class="p">)))</span>
 549             <span class="n">ParamsInfo</span><span class="p">[</span><span class="n">ParamName</span><span class="p">]</span> <span class="o">=</span> <span class="n">ParamsDefaultInfo</span><span class="p">[</span><span class="n">ParamName</span><span class="p">]</span>
 550     
 551     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">ParamsOptionValue</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 552         <span class="c1"># No specific parameters to process except for parameters with possible auto value...</span>
 553         <span class="n">_ProcessPsi4CubeFilesAutoParameters</span><span class="p">(</span><span class="n">ParamsInfo</span><span class="p">,</span> <span class="n">ParamsOptionName</span><span class="p">,</span> <span class="n">ParamsOptionValue</span><span class="p">)</span>
 554         <span class="k">return</span> <span class="n">ParamsInfo</span>
 555     
 556     <span class="n">ParamsOptionValue</span> <span class="o">=</span> <span class="n">ParamsOptionValue</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
 557     <span class="k">if</span> <span class="ow">not</span> <span class="n">ParamsOptionValue</span><span class="p">:</span>
 558         <span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;No valid parameter name and value pairs specified using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> option&quot;</span> <span class="o">%</span> <span class="n">ParamsOptionName</span><span class="p">)</span>
 559     
 560     <span class="n">ParamsOptionValueWords</span> <span class="o">=</span> <span class="n">ParamsOptionValue</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
 561     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ParamsOptionValueWords</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
 562         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The number of comma delimited paramater names and values, </span><span class="si">%d</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> option must be an even number.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ParamsOptionValueWords</span><span class="p">),</span> <span class="n">ParamsOptionName</span><span class="p">))</span>
 563     
 564     <span class="c1"># Validate paramater name and value pairs...</span>
 565     <span class="k">for</span> <span class="n">Index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ParamsOptionValueWords</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
 566         <span class="n">Name</span> <span class="o">=</span> <span class="n">ParamsOptionValueWords</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
 567         <span class="n">Value</span> <span class="o">=</span> <span class="n">ParamsOptionValueWords</span><span class="p">[</span><span class="n">Index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
 568 
 569         <span class="n">CanonicalName</span> <span class="o">=</span> <span class="n">Name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
 570         <span class="k">if</span>  <span class="ow">not</span> <span class="n">CanonicalName</span> <span class="ow">in</span> <span class="n">CanonicalParamNamesMap</span><span class="p">:</span>
 571             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The parameter name, </span><span class="si">%s</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> is not a valid name. Supported parameter names: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Name</span><span class="p">,</span> <span class="n">ParamsOptionName</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ValidParamNames</span><span class="p">)))</span>
 572 
 573         <span class="n">ParamName</span> <span class="o">=</span> <span class="n">CanonicalParamNamesMap</span><span class="p">[</span><span class="n">CanonicalName</span><span class="p">]</span>
 574         <span class="n">ParamValue</span> <span class="o">=</span> <span class="n">Value</span>
 575         
 576         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^(GridSpacing|GridOverage)$&quot;</span><span class="p">,</span> <span class="n">ParamName</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 577             <span class="k">if</span> <span class="ow">not</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">IsFloat</span><span class="p">(</span><span class="n">Value</span><span class="p">):</span>
 578                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The parameter value, </span><span class="si">%s</span><span class="s2">, specified for parameter name, </span><span class="si">%s</span><span class="s2">, using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> option must be a float.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Value</span><span class="p">,</span> <span class="n">Name</span><span class="p">,</span> <span class="n">ParamsOptionName</span><span class="p">))</span>
 579             <span class="n">Value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Value</span><span class="p">)</span>
 580             <span class="k">if</span> <span class="n">Value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
 581                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The parameter value, </span><span class="si">%s</span><span class="s2">, specified for parameter name, </span><span class="si">%s</span><span class="s2">, using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> option is not a valid value. Supported values: &gt; 0&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Value</span><span class="p">,</span> <span class="n">Name</span><span class="p">,</span> <span class="n">ParamsOptionName</span><span class="p">))</span>
 582             <span class="n">ParamValue</span> <span class="o">=</span> <span class="n">Value</span>
 583         <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^IsoContourThreshold$&quot;</span><span class="p">,</span> <span class="n">ParamName</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 584             <span class="k">if</span> <span class="ow">not</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">IsFloat</span><span class="p">(</span><span class="n">Value</span><span class="p">):</span>
 585                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The parameter value, </span><span class="si">%s</span><span class="s2">, specified for parameter name, </span><span class="si">%s</span><span class="s2">, using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> option must be a float.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Value</span><span class="p">,</span> <span class="n">Name</span><span class="p">,</span> <span class="n">ParamsOptionName</span><span class="p">))</span>
 586             <span class="n">Value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Value</span><span class="p">)</span>
 587             <span class="k">if</span> <span class="n">Value</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">Value</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
 588                 <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The parameter value, </span><span class="si">%s</span><span class="s2">, specified for parameter name, </span><span class="si">%s</span><span class="s2">, using </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> option is not a valid value. Supported values: &gt;= 0 and &lt;= 1&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Value</span><span class="p">,</span> <span class="n">Name</span><span class="p">,</span> <span class="n">ParamsOptionName</span><span class="p">))</span>
 589             <span class="n">ParamValue</span> <span class="o">=</span> <span class="n">Value</span>
 590         
 591         <span class="c1"># Set value...</span>
 592         <span class="n">ParamsInfo</span><span class="p">[</span><span class="n">ParamName</span><span class="p">]</span> <span class="o">=</span> <span class="n">ParamValue</span>
 593     
 594     <span class="c1"># Handle paramaters with possible auto values...</span>
 595     <span class="n">_ProcessPsi4CubeFilesAutoParameters</span><span class="p">(</span><span class="n">ParamsInfo</span><span class="p">,</span> <span class="n">ParamsOptionName</span><span class="p">,</span> <span class="n">ParamsOptionValue</span><span class="p">)</span>
 596 
 597     <span class="k">return</span> <span class="n">ParamsInfo</span>
 598 
 599 <span class="k">def</span> <span class="nf">_ProcessPsi4CubeFilesAutoParameters</span><span class="p">(</span><span class="n">ParamsInfo</span><span class="p">,</span> <span class="n">ParamsOptionName</span><span class="p">,</span> <span class="n">ParamsOptionValue</span><span class="p">):</span>
 600     <span class="sd">&quot;&quot;&quot;Process parameters with possible auto values.</span>
 601 <span class="sd">    &quot;&quot;&quot;</span>
 602     
 603     <span class="c1"># No auto parameters to process</span>
 604     <span class="k">return</span>
 605 
 606 <span class="k">def</span> <span class="nf">RetrieveIsocontourRangeFromCubeFile</span><span class="p">(</span><span class="n">CubeFileName</span><span class="p">):</span>
 607     <span class="sd">&quot;&quot;&quot;Retrieve isocontour range values from the cube file. The range</span>
 608 <span class="sd">    values are retrieved from the second line in the cube file after</span>
 609 <span class="sd">    the string &#39;Isocontour range&#39;.</span>
 610 <span class="sd">    </span>
 611 <span class="sd">    Arguments:</span>
 612 <span class="sd">        CubeFileName (str): Cube file name.</span>
 613 
 614 <span class="sd">    Returns:</span>
 615 <span class="sd">        float: Minimum range value.</span>
 616 <span class="sd">        float: Maximum range value.</span>
 617 
 618 <span class="sd">    &quot;&quot;&quot;</span>
 619 
 620     <span class="n">IsocontourRangeMin</span><span class="p">,</span> <span class="n">IsocontourRangeMax</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
 621     
 622     <span class="n">CubeFH</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">CubeFileName</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
 623     <span class="k">if</span> <span class="n">CubeFH</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 624         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t open cube file: </span><span class="si">%s</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CubeFileName</span><span class="p">))</span>
 625 
 626     <span class="c1"># Look for isocontour range in the first 2 comments line...</span>
 627     <span class="n">RangeLine</span> <span class="o">=</span> <span class="bp">None</span>
 628     <span class="n">LineCount</span> <span class="o">=</span> <span class="mi">0</span>
 629     <span class="k">for</span> <span class="n">Line</span> <span class="ow">in</span> <span class="n">CubeFH</span><span class="p">:</span>
 630         <span class="n">LineCount</span> <span class="o">+=</span> <span class="mi">1</span>
 631         <span class="n">Line</span> <span class="o">=</span> <span class="n">Line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
 632         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Isocontour range&quot;</span><span class="p">,</span> <span class="n">Line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 633             <span class="n">RangeLine</span> <span class="o">=</span> <span class="n">Line</span>
 634             <span class="k">break</span>
 635         
 636         <span class="k">if</span> <span class="n">LineCount</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
 637             <span class="k">break</span>
 638     <span class="n">CubeFH</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
 639 
 640     <span class="k">if</span> <span class="n">RangeLine</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 641         <span class="k">return</span> <span class="p">(</span><span class="n">IsocontourRangeMin</span><span class="p">,</span> <span class="n">IsocontourRangeMax</span><span class="p">)</span>
 642     
 643     <span class="n">LineWords</span> <span class="o">=</span> <span class="n">RangeLine</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
 644     
 645     <span class="n">ContourRangeWord</span> <span class="o">=</span> <span class="n">LineWords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
 646     <span class="n">ContourRangeWord</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;(\(|\)| )&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ContourRangeWord</span><span class="p">)</span>
 647 
 648     <span class="n">ContourLevel1</span><span class="p">,</span> <span class="n">ContourLevel2</span> <span class="o">=</span> <span class="n">ContourRangeWord</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
 649     <span class="n">ContourLevel1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ContourLevel1</span><span class="p">)</span>
 650     <span class="n">ContourLevel2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ContourLevel2</span><span class="p">)</span>
 651     
 652     <span class="k">if</span> <span class="n">ContourLevel1</span> <span class="o">&lt;</span> <span class="n">ContourLevel2</span><span class="p">:</span>
 653         <span class="n">IsocontourRangeMin</span> <span class="o">=</span> <span class="n">ContourLevel1</span>
 654         <span class="n">IsocontourRangeMax</span> <span class="o">=</span> <span class="n">ContourLevel2</span>
 655     <span class="k">else</span><span class="p">:</span>
 656         <span class="n">IsocontourRangeMin</span> <span class="o">=</span> <span class="n">ContourLevel2</span>
 657         <span class="n">IsocontourRangeMax</span> <span class="o">=</span> <span class="n">ContourLevel1</span>
 658         
 659     <span class="k">return</span> <span class="p">(</span><span class="n">IsocontourRangeMin</span><span class="p">,</span> <span class="n">IsocontourRangeMax</span><span class="p">)</span>
 660     
 661 <span class="k">def</span> <span class="nf">RetrieveMinAndMaxValueFromCubeFile</span><span class="p">(</span><span class="n">CubeFileName</span><span class="p">):</span>
 662     <span class="sd">&quot;&quot;&quot;Retrieve minimum and maxmimum grid values from the cube file.</span>
 663 <span class="sd">    </span>
 664 <span class="sd">    Arguments:</span>
 665 <span class="sd">        CubeFileName (str): Cube file name.</span>
 666 
 667 <span class="sd">    Returns:</span>
 668 <span class="sd">        float: Minimum value.</span>
 669 <span class="sd">        float: Maximum value.</span>
 670 
 671 <span class="sd">    &quot;&quot;&quot;</span>
 672 
 673     <span class="n">MinValue</span><span class="p">,</span> <span class="n">MaxValue</span> <span class="o">=</span> <span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">min</span><span class="p">]</span>
 674     
 675     <span class="n">CubeFH</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">CubeFileName</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
 676     <span class="k">if</span> <span class="n">CubeFH</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 677         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t open cube file: </span><span class="si">%s</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CubeFileName</span><span class="p">))</span>
 678 
 679     <span class="c1"># Ignore first two comments lines:</span>
 680     <span class="c1">#</span>
 681     <span class="c1"># The first two lines of the header are comments, they are generally ignored by parsing packages or used as two default labels.</span>
 682     <span class="c1">#</span>
 683     <span class="c1"># Ignore lines upto the last section of the header lines:</span>
 684     <span class="c1">#</span>
 685     <span class="c1"># The third line has the number of atoms included in the file followed by the position of the origin of the volumetric data.</span>
 686     <span class="c1"># The next three lines give the number of voxels along each axis (x, y, z) followed by the axis vector.</span>
 687     <span class="c1"># The last section in the header is one line for each atom consisting of 5 numbers, the first is the atom number, the second</span>
 688     <span class="c1"># is the charge, and the last three are the x,y,z coordinates of the atom center.</span>
 689     <span class="c1">#</span>
 690     <span class="n">Line</span> <span class="o">=</span> <span class="n">CubeFH</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
 691     <span class="n">Line</span> <span class="o">=</span> <span class="n">CubeFH</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
 692     <span class="n">Line</span> <span class="o">=</span> <span class="n">CubeFH</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
 693     <span class="n">CubeFH</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
 694     
 695     <span class="n">Line</span> <span class="o">=</span> <span class="n">Line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
 696     <span class="n">LineWords</span> <span class="o">=</span> <span class="n">Line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
 697     <span class="n">NumOfAtoms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">LineWords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
 698 
 699     <span class="n">HeaderLinesCount</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">+</span> <span class="n">NumOfAtoms</span>
 700 
 701     <span class="c1"># Ignore header lines...</span>
 702     <span class="n">CubeFH</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">CubeFileName</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
 703     <span class="n">LineCount</span> <span class="o">=</span> <span class="mi">0</span>
 704     <span class="k">for</span> <span class="n">Line</span> <span class="ow">in</span> <span class="n">CubeFH</span><span class="p">:</span>
 705         <span class="n">LineCount</span> <span class="o">+=</span> <span class="mi">1</span>
 706         <span class="k">if</span> <span class="n">LineCount</span> <span class="o">&gt;=</span> <span class="n">HeaderLinesCount</span><span class="p">:</span>
 707             <span class="k">break</span>
 708     
 709     <span class="c1"># Process values....</span>
 710     <span class="k">for</span> <span class="n">Line</span> <span class="ow">in</span> <span class="n">CubeFH</span><span class="p">:</span>
 711         <span class="n">Line</span> <span class="o">=</span> <span class="n">Line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
 712         <span class="k">for</span> <span class="n">Value</span> <span class="ow">in</span> <span class="n">Line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
 713             <span class="n">Value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Value</span><span class="p">)</span>
 714             
 715             <span class="k">if</span> <span class="n">Value</span> <span class="o">&lt;</span> <span class="n">MinValue</span><span class="p">:</span>
 716                 <span class="n">MinValue</span> <span class="o">=</span> <span class="n">Value</span>
 717             <span class="k">if</span> <span class="n">Value</span> <span class="o">&gt;</span> <span class="n">MaxValue</span><span class="p">:</span>
 718                 <span class="n">MaxValue</span> <span class="o">=</span> <span class="n">Value</span>
 719     
 720     <span class="k">return</span> <span class="p">(</span><span class="n">MinValue</span><span class="p">,</span> <span class="n">MaxValue</span><span class="p">)</span>
 721 
 722 <span class="k">def</span> <span class="nf">UpdatePsi4OutputFileUsingPID</span><span class="p">(</span><span class="n">OutputFile</span><span class="p">,</span> <span class="n">PID</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
 723     <span class="sd">&quot;&quot;&quot;Append PID to output file name. The PID is automatically retrieved</span>
 724 <span class="sd">    during None value of PID.</span>
 725 <span class="sd">    </span>
 726 <span class="sd">    Arguments:</span>
 727 <span class="sd">        OutputFile (str): Output file name.</span>
 728 <span class="sd">        PID (int): Process ID or None.</span>
 729 
 730 <span class="sd">    Returns:</span>
 731 <span class="sd">        str: Update output file name. Format: &lt;OutFieRoot&gt;_&lt;PID&gt;.&lt;OutFileExt&gt;</span>
 732 
 733 <span class="sd">    &quot;&quot;&quot;</span>
 734     
 735     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;stdout|devnull|quiet&quot;</span><span class="p">,</span> <span class="n">OutputFile</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 736         <span class="k">return</span> <span class="n">OutputFile</span>
 737 
 738     <span class="k">if</span> <span class="n">PID</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 739         <span class="n">PID</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
 740     
 741     <span class="n">FileDir</span><span class="p">,</span> <span class="n">FileRoot</span><span class="p">,</span> <span class="n">FileExt</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ParseFileName</span><span class="p">(</span><span class="n">OutputFile</span><span class="p">)</span>
 742     <span class="n">OutputFile</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_PID</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">FileRoot</span><span class="p">,</span> <span class="n">PID</span><span class="p">,</span> <span class="n">FileExt</span><span class="p">)</span>
 743     
 744     <span class="k">return</span> <span class="n">OutputFile</span>
 745     
 746 <span class="k">def</span> <span class="nf">RemoveScratchFiles</span><span class="p">(</span><span class="n">psi4</span><span class="p">,</span> <span class="n">OutputFile</span><span class="p">,</span> <span class="n">PID</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
 747     <span class="sd">&quot;&quot;&quot;Remove any leftover scratch files associated with the specified output</span>
 748 <span class="sd">    file. The file specification, &lt;OutfileRoot&gt;.*&lt;PID&gt;.* is used to collect and</span>
 749 <span class="sd">    remove files from the scratch directory. In addition, the file</span>
 750 <span class="sd">    psi.&lt;PID&gt;.clean, in current directory is removed.</span>
 751 <span class="sd">    </span>
 752 <span class="sd">    Arguments:</span>
 753 <span class="sd">        psi4 (object): psi4 module reference.</span>
 754 <span class="sd">        OutputFile (str): Output file name.</span>
 755 <span class="sd">        PID (int): Process ID or None.</span>
 756 
 757 <span class="sd">    Returns:</span>
 758 <span class="sd">        None</span>
 759 
 760 <span class="sd">    &quot;&quot;&quot;</span>
 761     
 762     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;stdout|devnull|quiet&quot;</span><span class="p">,</span> <span class="n">OutputFile</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 763         <span class="c1"># Scratch files are associated to stdout prefix...</span>
 764         <span class="n">OutputFile</span> <span class="o">=</span> <span class="s2">&quot;stdout&quot;</span>
 765     
 766     <span class="k">if</span> <span class="n">PID</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 767         <span class="n">PID</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
 768     
 769     <span class="n">OutfileDir</span><span class="p">,</span> <span class="n">OutfileRoot</span><span class="p">,</span> <span class="n">OutfileExt</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ParseFileName</span><span class="p">(</span><span class="n">OutputFile</span><span class="p">)</span>
 770     
 771     <span class="n">ScratchOutfilesSpec</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">IOManager</span><span class="o">.</span><span class="n">shared_object</span><span class="p">()</span><span class="o">.</span><span class="n">get_default_path</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.*</span><span class="si">%s</span><span class="s2">.*&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OutfileRoot</span><span class="p">,</span> <span class="n">PID</span><span class="p">))</span>
 772     <span class="k">for</span> <span class="n">ScratchFile</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">ScratchOutfilesSpec</span><span class="p">):</span>
 773         <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ScratchFile</span><span class="p">)</span>
 774 
 775     <span class="c1"># Remove any psi.&lt;PID&gt;.clean in the current directory...</span>
 776     <span class="n">ScratchFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;psi.</span><span class="si">%s</span><span class="s2">.clean&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">PID</span><span class="p">))</span>
 777     <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ScratchFile</span><span class="p">):</span>
 778         <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ScratchFile</span><span class="p">)</span>
</pre>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
